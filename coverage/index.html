<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Rubyconsumer-civiccommons</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.8.0/application.js' type='text/javascript'></script>    
    <link href='./assets/0.8.0/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.8.0/favicon_yellow.png" />
    <link rel="icon" type="image/png" href="./assets/0.8.0/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.8.0/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2013-11-25T19:49:29-05:00">2013-11-25T19:49:29-05:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="yellow">85.83%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         85.03
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>216</b> files in total.
    <b>6042</b> relevant lines. 
    <span class="green"><b>5186</b> lines covered</span> and
    <span class="red"><b>856</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#9be8441f03d44cebd6e6d3c333aae0f5d3472c13" class="src_link" title="app/concerns/homepage_featurable.rb">app/concerns/homepage_featurable.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>16</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>1.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#eda2b5bdfbf193f32b4d2f8f163e3c5992a81b04" class="src_link" title="app/concerns/regionable.rb">app/concerns/regionable.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d17d49d33c1ec3a8d495fee440356769d15a1967" class="src_link" title="app/concerns/subscribable.rb">app/concerns/subscribable.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>17</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>26.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fa8c811dbb6773ac5615f6cd607fae10ec5653e9" class="src_link" title="app/concerns/thumbnail.rb">app/concerns/thumbnail.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>4.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#14cecadfe027e0503059e023d4d3ff7a235b6ff3" class="src_link" title="app/concerns/visitable.rb">app/concerns/visitable.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>45</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>14.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7e7b9bc573e4cf12e1df3de0fe4c75f61b2d2e18" class="src_link" title="app/concerns/you_tubeable.rb">app/concerns/you_tubeable.rb</a></td>
        <td class="green strong">93.75 %</td>
        <td>30</td>
        <td>16</td>
        <td>15</td>
        <td>1</td>
        <td>1.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#411b0671206a1baff9e77ce49e6b357a989a736b" class="src_link" title="app/concerns/you_tubeable_validator.rb">app/concerns/you_tubeable_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c961881ef367b97f221bcf9d77da49b8a079d6d0" class="src_link" title="app/controllers/actions_controller.rb">app/controllers/actions_controller.rb</a></td>
        <td class="yellow strong">84.62 %</td>
        <td>23</td>
        <td>13</td>
        <td>11</td>
        <td>2</td>
        <td>5.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cf155fe18f1fc24b90a8f2f27958a5f52e1819ce" class="src_link" title="app/controllers/admin/articles_controller.rb">app/controllers/admin/articles_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>78</td>
        <td>33</td>
        <td>33</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5abcf6a9482d2f2d21c099bfd39fef44c116ed84" class="src_link" title="app/controllers/admin/content_item_links_controller.rb">app/controllers/admin/content_item_links_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>47</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>2.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b6c82854cfc77ace2fef8b4cf4e1a137e18aca09" class="src_link" title="app/controllers/admin/content_items_controller.rb">app/controllers/admin/content_items_controller.rb</a></td>
        <td class="yellow strong">85.19 %</td>
        <td>136</td>
        <td>81</td>
        <td>69</td>
        <td>12</td>
        <td>8.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e7a328488c9a8ba4b9f68c444aabf61d9b6c3a78" class="src_link" title="app/controllers/admin/content_items_people_controller.rb">app/controllers/admin/content_items_people_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>40</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>6.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2f1aee242516938836a74ffa2ee19c537ed335b7" class="src_link" title="app/controllers/admin/content_templates_controller.rb">app/controllers/admin/content_templates_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>56</td>
        <td>27</td>
        <td>27</td>
        <td>0</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2b79ecaee63f8be5f7e0c09fd886b3023e8d60c5" class="src_link" title="app/controllers/admin/conversations_controller.rb">app/controllers/admin/conversations_controller.rb</a></td>
        <td class="red strong">57.32 %</td>
        <td>157</td>
        <td>82</td>
        <td>47</td>
        <td>35</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5bc1dd7747e0014997fc7561e78de19890a77604" class="src_link" title="app/controllers/admin/conversations_people_controller.rb">app/controllers/admin/conversations_people_controller.rb</a></td>
        <td class="red strong">26.09 %</td>
        <td>40</td>
        <td>23</td>
        <td>6</td>
        <td>17</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#01e9d0dfa0a725eb0ceabf132914a6fd65ed680f" class="src_link" title="app/controllers/admin/curated_feed_items_controller.rb">app/controllers/admin/curated_feed_items_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>47</td>
        <td>27</td>
        <td>27</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#91cfcf1880a549cfdedca8a122e0b644e3b5e13c" class="src_link" title="app/controllers/admin/curated_feeds_controller.rb">app/controllers/admin/curated_feeds_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>53</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>2.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#207ef531a67482df7be81f57c4f355de5105d31f" class="src_link" title="app/controllers/admin/dashboard_controller.rb">app/controllers/admin/dashboard_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>13</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>11.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b33b6373a2ee07e2c39b48194ff005d2be854118" class="src_link" title="app/controllers/admin/email_restrictions_controller.rb">app/controllers/admin/email_restrictions_controller.rb</a></td>
        <td class="red strong">41.46 %</td>
        <td>86</td>
        <td>41</td>
        <td>17</td>
        <td>24</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e26182f0a0d42fcc4c635d86ca52a25475c1c47f" class="src_link" title="app/controllers/admin/featured_homepage_controller.rb">app/controllers/admin/featured_homepage_controller.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>48</td>
        <td>18</td>
        <td>9</td>
        <td>9</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b68d0edc843af6a8ac3760090eff4b80e658022c" class="src_link" title="app/controllers/admin/featured_opportunities_controller.rb">app/controllers/admin/featured_opportunities_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>68</td>
        <td>43</td>
        <td>43</td>
        <td>0</td>
        <td>3.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#90880f0cbd1fb09aefc6364fa06fe954214cfeea" class="src_link" title="app/controllers/admin/issues_controller.rb">app/controllers/admin/issues_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>106</td>
        <td>54</td>
        <td>54</td>
        <td>0</td>
        <td>4.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6b9f93fcd7607d78b0262b5e2c5a425a6b0ae749" class="src_link" title="app/controllers/admin/managed_issue_pages_controller.rb">app/controllers/admin/managed_issue_pages_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>70</td>
        <td>38</td>
        <td>38</td>
        <td>0</td>
        <td>2.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#251a50892b939a632cdfb8cf46709af28f9dc250" class="src_link" title="app/controllers/admin/metro_regions_controller.rb">app/controllers/admin/metro_regions_controller.rb</a></td>
        <td class="red strong">44.83 %</td>
        <td>54</td>
        <td>29</td>
        <td>13</td>
        <td>16</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1d3b9d42df9d83ecfd8c983cd356217ef14a7fb1" class="src_link" title="app/controllers/admin/people_controller.rb">app/controllers/admin/people_controller.rb</a></td>
        <td class="red strong">73.68 %</td>
        <td>114</td>
        <td>57</td>
        <td>42</td>
        <td>15</td>
        <td>1.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9752b31c57cfac6eddf807ba7d9b6ba969a9a1d1" class="src_link" title="app/controllers/admin/regions_controller.rb">app/controllers/admin/regions_controller.rb</a></td>
        <td class="red strong">72.22 %</td>
        <td>35</td>
        <td>18</td>
        <td>13</td>
        <td>5</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6f74a487d26595ea075ec6508032060dbba0e85f" class="src_link" title="app/controllers/admin/surveys_controller.rb">app/controllers/admin/surveys_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>129</td>
        <td>71</td>
        <td>71</td>
        <td>0</td>
        <td>5.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c11d6d992ca9ec55eaa8d0f9815ec05fed38e32b" class="src_link" title="app/controllers/admin/topics_controller.rb">app/controllers/admin/topics_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>86</td>
        <td>41</td>
        <td>41</td>
        <td>0</td>
        <td>3.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#57dd5bd18d0dfe486207eb17a98973dfaaf2dda1" class="src_link" title="app/controllers/admin/user_registrations_controller.rb">app/controllers/admin/user_registrations_controller.rb</a></td>
        <td class="yellow strong">90.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>9</td>
        <td>1</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c41cec4011dcd6cc31fc87b7caeb657e0ec368a7" class="src_link" title="app/controllers/admin/widget_stats_controller.rb">app/controllers/admin/widget_stats_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>14</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>4.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4f2782333ace84218f6099b553c68e2563068118" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="green strong">97.06 %</td>
        <td>117</td>
        <td>68</td>
        <td>66</td>
        <td>2</td>
        <td>154.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d7a98467151d389a9511ea1cb88ae0afc337aa99" class="src_link" title="app/controllers/authentication_controller.rb">app/controllers/authentication_controller.rb</a></td>
        <td class="green strong">94.87 %</td>
        <td>70</td>
        <td>39</td>
        <td>37</td>
        <td>2</td>
        <td>2.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a6d917a1d04754d2cef9155c69c7f90f9b3f2473" class="src_link" title="app/controllers/blog_controller.rb">app/controllers/blog_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>26</td>
        <td>16</td>
        <td>16</td>
        <td>0</td>
        <td>11.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f777b185c2162cc7d0b1ccacba2c0d57613aabdb" class="src_link" title="app/controllers/community_controller.rb">app/controllers/community_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>43</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>14.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#323a24c17bf94dc94e8ea94d7c1406e8fb33a92e" class="src_link" title="app/controllers/confirmations_controller.rb">app/controllers/confirmations_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#94568870a95d7da708979dd83d65ef471a28dd9f" class="src_link" title="app/controllers/content_controller.rb">app/controllers/content_controller.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>10</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#728774869e1f29714e826ab2a8774cedc4134df7" class="src_link" title="app/controllers/contributions_controller.rb">app/controllers/contributions_controller.rb</a></td>
        <td class="red strong">40.0 %</td>
        <td>123</td>
        <td>75</td>
        <td>30</td>
        <td>45</td>
        <td>0.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#955343a1518cfc8293a2e6703f0526f184c1337a" class="src_link" title="app/controllers/conversations_controller.rb">app/controllers/conversations_controller.rb</a></td>
        <td class="red strong">65.9 %</td>
        <td>325</td>
        <td>173</td>
        <td>114</td>
        <td>59</td>
        <td>4.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f3e81f2e56a3678dc6b58949ebf86430443a2958" class="src_link" title="app/controllers/curated_feed_item_controller.rb">app/controllers/curated_feed_item_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0d3a0dc1d2feaddf9157e41fbc37da081fa059bc" class="src_link" title="app/controllers/feeds_controller.rb">app/controllers/feeds_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fbecacca6a6fa5359976d086a649e54e20a4d671" class="src_link" title="app/controllers/homepage_controller.rb">app/controllers/homepage_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>17</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>113.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f5493a4632db90eafb93e577a7e37d099c023502" class="src_link" title="app/controllers/invites_controller.rb">app/controllers/invites_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>40</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>1.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#15465242920f4c87a785f825b3094a17688bcb3c" class="src_link" title="app/controllers/issues_controller.rb">app/controllers/issues_controller.rb</a></td>
        <td class="red strong">67.5 %</td>
        <td>61</td>
        <td>40</td>
        <td>27</td>
        <td>13</td>
        <td>5.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#20efaff71608d94825afc47f0d710ecc5cb79458" class="src_link" title="app/controllers/links_controller.rb">app/controllers/links_controller.rb</a></td>
        <td class="red strong">37.5 %</td>
        <td>38</td>
        <td>24</td>
        <td>9</td>
        <td>15</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#afb063aa1e013bb15d08e1526f6ae1f6e1d13da4" class="src_link" title="app/controllers/managed_issue_pages_controller.rb">app/controllers/managed_issue_pages_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>15</td>
        <td>8</td>
        <td>8</td>
        <td>0</td>
        <td>3.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b2b6d3e450acb8b5dadc072a08cd06987f91807b" class="src_link" title="app/controllers/metro_regions_controller.rb">app/controllers/metro_regions_controller.rb</a></td>
        <td class="yellow strong">81.82 %</td>
        <td>18</td>
        <td>11</td>
        <td>9</td>
        <td>2</td>
        <td>1.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f09f0273543bf2cbeb84911aaee855e9e0a5b981" class="src_link" title="app/controllers/news_controller.rb">app/controllers/news_controller.rb</a></td>
        <td class="red strong">40.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>2</td>
        <td>3</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3d7b9fc0411e5c7fbfdaa59310d2e443f2b175a3" class="src_link" title="app/controllers/notifications_controller.rb">app/controllers/notifications_controller.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7033e328f3305da6b0ecd00b54844c0b70d1e165" class="src_link" title="app/controllers/opportunity_votes_controller.rb">app/controllers/opportunity_votes_controller.rb</a></td>
        <td class="green strong">91.23 %</td>
        <td>94</td>
        <td>57</td>
        <td>52</td>
        <td>5</td>
        <td>3.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0c364ca8066afafd2b526d428b57218d93b9e4cb" class="src_link" title="app/controllers/pages_controller.rb">app/controllers/pages_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5aa2f75b5440ca0e65701fff4231936f4f4e4e02" class="src_link" title="app/controllers/passwords_controller.rb">app/controllers/passwords_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>28</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>2.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1b22ff703b28ddc5422fd67c58908ecad61040e6" class="src_link" title="app/controllers/petitions_controller.rb">app/controllers/petitions_controller.rb</a></td>
        <td class="green strong">95.56 %</td>
        <td>74</td>
        <td>45</td>
        <td>43</td>
        <td>2</td>
        <td>3.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#064cb0d26b789ba09332ce2be6c0ed35942a8f76" class="src_link" title="app/controllers/products_services_controller.rb">app/controllers/products_services_controller.rb</a></td>
        <td class="red strong">36.36 %</td>
        <td>24</td>
        <td>11</td>
        <td>4</td>
        <td>7</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#74d67efed2bcda8ef16ae3ccccd440c73444b0f1" class="src_link" title="app/controllers/projects_controller.rb">app/controllers/projects_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>11</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>2.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0d087bbbcf49e232b84b91a431ee33faa1500fb7" class="src_link" title="app/controllers/radioshow_controller.rb">app/controllers/radioshow_controller.rb</a></td>
        <td class="green strong">94.44 %</td>
        <td>33</td>
        <td>18</td>
        <td>17</td>
        <td>1</td>
        <td>2.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fd968a677496a731149febfa23c7c24c5c95493a" class="src_link" title="app/controllers/reflection_comments_controller.rb">app/controllers/reflection_comments_controller.rb</a></td>
        <td class="green strong">93.94 %</td>
        <td>60</td>
        <td>33</td>
        <td>31</td>
        <td>2</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8c41a8b26c49b47d77b04dc17f8c3db7ea4ee423" class="src_link" title="app/controllers/reflections_controller.rb">app/controllers/reflections_controller.rb</a></td>
        <td class="green strong">95.45 %</td>
        <td>72</td>
        <td>44</td>
        <td>42</td>
        <td>2</td>
        <td>3.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ce6eef57f34f2b406c52181daee7db964c44481f" class="src_link" title="app/controllers/regions_controller.rb">app/controllers/regions_controller.rb</a></td>
        <td class="yellow strong">85.71 %</td>
        <td>13</td>
        <td>7</td>
        <td>6</td>
        <td>1</td>
        <td>0.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5b3a06aa05f7478a9a85dfb0a2becb776ba3e173" class="src_link" title="app/controllers/registrations/omniauth_callbacks_controller.rb">app/controllers/registrations/omniauth_callbacks_controller.rb</a></td>
        <td class="green strong">97.14 %</td>
        <td>151</td>
        <td>70</td>
        <td>68</td>
        <td>2</td>
        <td>4.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#499a92ce85bb016a3f77256c0ce043578d95a8ea" class="src_link" title="app/controllers/registrations_controller.rb">app/controllers/registrations_controller.rb</a></td>
        <td class="green strong">90.91 %</td>
        <td>57</td>
        <td>33</td>
        <td>30</td>
        <td>3</td>
        <td>5.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ab1186867203f076b3b635a016786fb6398a5f9a" class="src_link" title="app/controllers/search_controller.rb">app/controllers/search_controller.rb</a></td>
        <td class="green strong">96.3 %</td>
        <td>52</td>
        <td>27</td>
        <td>26</td>
        <td>1</td>
        <td>5.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#289ab8d630f19de989f409b82a0526c9bd9d1022" class="src_link" title="app/controllers/sessions_controller.rb">app/controllers/sessions_controller.rb</a></td>
        <td class="green strong">96.67 %</td>
        <td>47</td>
        <td>30</td>
        <td>29</td>
        <td>1</td>
        <td>23.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5b7710615a139fe382f1b8745cfb987146fdc8dd" class="src_link" title="app/controllers/subscriptions_controller.rb">app/controllers/subscriptions_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>25</td>
        <td>14</td>
        <td>14</td>
        <td>0</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d35fd8cbdf0fe67ba879cc0a9b21ceffff31f4f1" class="src_link" title="app/controllers/surveys_controller.rb">app/controllers/surveys_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>66</td>
        <td>36</td>
        <td>36</td>
        <td>0</td>
        <td>7.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ba26c29a1dcada63d14773beb4a97fb4c2972ab8" class="src_link" title="app/controllers/tos_controller.rb">app/controllers/tos_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>35</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>1.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ec6e5c49ada200afe822a548e0230ac358d97123" class="src_link" title="app/controllers/unsubscribe_digest_controller.rb">app/controllers/unsubscribe_digest_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>13</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>1.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c769e22508b2ce3df4f350cdf939e7b32b4ea627" class="src_link" title="app/controllers/user_controller.rb">app/controllers/user_controller.rb</a></td>
        <td class="green strong">94.55 %</td>
        <td>91</td>
        <td>55</td>
        <td>52</td>
        <td>3</td>
        <td>3.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#60a034a002671570442a1e4f18d68af71d75985b" class="src_link" title="app/controllers/widgets_controller.rb">app/controllers/widgets_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>15</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>6.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#94207a4a35c40b45542942f41e8b313e4531bfc0" class="src_link" title="app/helpers/actions_helper.rb">app/helpers/actions_helper.rb</a></td>
        <td class="red strong">75.0 %</td>
        <td>13</td>
        <td>8</td>
        <td>6</td>
        <td>2</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#803dedea6b8bc9d7f2d48b12cc32b0cc9ecf10a2" class="src_link" title="app/helpers/activity_helper.rb">app/helpers/activity_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>13</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>27.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7caa6b55519ba90f6f0a5eb3e3b51f3603073c4f" class="src_link" title="app/helpers/admin/conversations_helper.rb">app/helpers/admin/conversations_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1543ec7be55b63734f02f8d5e88850cafe923672" class="src_link" title="app/helpers/admin/dashboard_helper.rb">app/helpers/admin/dashboard_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#167eed9b6eccff3718e5b3de34dcab54771bcb08" class="src_link" title="app/helpers/admin/featured_opportunities_helper.rb">app/helpers/admin/featured_opportunities_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>8.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2ba89652daff9f72d8ad90bfbf8a3772550d1ba2" class="src_link" title="app/helpers/admin/issues_helper.rb">app/helpers/admin/issues_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4902d4428ca4934746a064fc2c47bd9266f3be73" class="src_link" title="app/helpers/admin/people_helper.rb">app/helpers/admin/people_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#063cb5df0dab70b285f0e792ea81c329c456c6c5" class="src_link" title="app/helpers/admin/surveys_helper.rb">app/helpers/admin/surveys_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#564a7927fce8043169f5a360bb8c57932f06b178" class="src_link" title="app/helpers/admin/topics_helper.rb">app/helpers/admin/topics_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d926c223521b1bd75f45feeabd4108c10b098f46" class="src_link" title="app/helpers/admin/widget_stats_helper.rb">app/helpers/admin/widget_stats_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>13</td>
        <td>13</td>
        <td>0</td>
        <td>39.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cc891c6d6b8419d820de232da23ef30b6ed57289" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
        <td class="red strong">70.0 %</td>
        <td>97</td>
        <td>50</td>
        <td>35</td>
        <td>15</td>
        <td>4266.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3ab6b86d2229cfb7c30431a54ad89916d784d738" class="src_link" title="app/helpers/authentication_helper.rb">app/helpers/authentication_helper.rb</a></td>
        <td class="green strong">92.31 %</td>
        <td>26</td>
        <td>13</td>
        <td>12</td>
        <td>1</td>
        <td>13.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#269434260e39b0cb5d79b6b64d4a8f64f810a12b" class="src_link" title="app/helpers/avatar_helper.rb">app/helpers/avatar_helper.rb</a></td>
        <td class="yellow strong">81.82 %</td>
        <td>95</td>
        <td>44</td>
        <td>36</td>
        <td>8</td>
        <td>135.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#06f44d7020d501763e8398c7a8f7eac532e96066" class="src_link" title="app/helpers/blog_helper.rb">app/helpers/blog_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>58</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>15.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#26b65626fe6745c2880d8cdd4360206d7f1e100a" class="src_link" title="app/helpers/buttons_helper.rb">app/helpers/buttons_helper.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>6</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5c37237874ed65cf9b5cf95346d2662905f9b0f0" class="src_link" title="app/helpers/community_helper.rb">app/helpers/community_helper.rb</a></td>
        <td class="green strong">90.91 %</td>
        <td>37</td>
        <td>22</td>
        <td>20</td>
        <td>2</td>
        <td>21.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#94e4dc3a894166ec6d1201c8d33a53dabba3d93b" class="src_link" title="app/helpers/content_templates_helper.rb">app/helpers/content_templates_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ba1f6ec33fce8b50749240922ebd0d7f7a51d6a2" class="src_link" title="app/helpers/contributions_helper.rb">app/helpers/contributions_helper.rb</a></td>
        <td class="red strong">69.23 %</td>
        <td>32</td>
        <td>13</td>
        <td>9</td>
        <td>4</td>
        <td>1.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d1927ac80eee1a4d257971112c5c7ce80eddf56d" class="src_link" title="app/helpers/conversations_helper.rb">app/helpers/conversations_helper.rb</a></td>
        <td class="red strong">44.55 %</td>
        <td>214</td>
        <td>110</td>
        <td>49</td>
        <td>61</td>
        <td>3.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#280e8cb57ed0d005a281ede725f50d490576defd" class="src_link" title="app/helpers/invites_helper.rb">app/helpers/invites_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6d4100a9b113aefa4f67e307b65ffd1447cfecb9" class="src_link" title="app/helpers/issues_helper.rb">app/helpers/issues_helper.rb</a></td>
        <td class="red strong">30.77 %</td>
        <td>43</td>
        <td>26</td>
        <td>8</td>
        <td>18</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8dbc74baedac9f4caae187f8a300ae4d54cef4ed" class="src_link" title="app/helpers/meta_helper.rb">app/helpers/meta_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>56</td>
        <td>31</td>
        <td>31</td>
        <td>0</td>
        <td>21.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7cf8e9aad7ef39c7001577927775adeb92ab6a1d" class="src_link" title="app/helpers/opportunity_votes_helper.rb">app/helpers/opportunity_votes_helper.rb</a></td>
        <td class="green strong">92.31 %</td>
        <td>28</td>
        <td>13</td>
        <td>12</td>
        <td>1</td>
        <td>5.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c2708aac4ab95c46039f1e862cf5209eff53960b" class="src_link" title="app/helpers/organizations_helper.rb">app/helpers/organizations_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#923990bfaab9b3348421f1f82ad4973ca00903f2" class="src_link" title="app/helpers/profile_helper.rb">app/helpers/profile_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>47</td>
        <td>31</td>
        <td>31</td>
        <td>0</td>
        <td>13.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#63179098f2c7ee5fb195df7605ee24cae6a4f1fc" class="src_link" title="app/helpers/radioshow_helper.rb">app/helpers/radioshow_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>16</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#40f93eb08c8721e1a3b7c4cdae04f91025ff1d87" class="src_link" title="app/helpers/ratings_helper.rb">app/helpers/ratings_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8de65eda300250ddd3bcba32b03f6e4a06912528" class="src_link" title="app/helpers/redirect_helper.rb">app/helpers/redirect_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>23</td>
        <td>13</td>
        <td>13</td>
        <td>0</td>
        <td>50.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f6cd1373ff943948d44aad50ecb0db35dc2c9f7a" class="src_link" title="app/helpers/reflections_helper.rb">app/helpers/reflections_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#adf8111df702ee508571907cc7db88dc7942a0ad" class="src_link" title="app/helpers/region_helper.rb">app/helpers/region_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>42</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>131.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0a6d5efb442e9b4d035d37335e25981969b943ac" class="src_link" title="app/helpers/search_helper.rb">app/helpers/search_helper.rb</a></td>
        <td class="red strong">69.23 %</td>
        <td>64</td>
        <td>39</td>
        <td>27</td>
        <td>12</td>
        <td>1.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1183ab14f8a59c4f02f40ca0cbb158e364637b47" class="src_link" title="app/helpers/secure_url_helper.rb">app/helpers/secure_url_helper.rb</a></td>
        <td class="green strong">93.1 %</td>
        <td>57</td>
        <td>29</td>
        <td>27</td>
        <td>2</td>
        <td>96.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#20381500122db46f4c80aecde29a6b6ad5d715ca" class="src_link" title="app/helpers/surveys_helper.rb">app/helpers/surveys_helper.rb</a></td>
        <td class="yellow strong">80.77 %</td>
        <td>46</td>
        <td>26</td>
        <td>21</td>
        <td>5</td>
        <td>12.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#dc1bb52ce14a0e4648cb26785838844a6079a675" class="src_link" title="app/helpers/topics_helper.rb">app/helpers/topics_helper.rb</a></td>
        <td class="yellow strong">89.19 %</td>
        <td>68</td>
        <td>37</td>
        <td>33</td>
        <td>4</td>
        <td>11.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f08433aab6ae7d065a9b1592c7c7a5f972bbe5d5" class="src_link" title="app/helpers/user_helper.rb">app/helpers/user_helper.rb</a></td>
        <td class="green strong">94.74 %</td>
        <td>75</td>
        <td>38</td>
        <td>36</td>
        <td>2</td>
        <td>8.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#09397abb38f3a2a03e95e80788bc6f4d6ee2d420" class="src_link" title="app/mailers/notifier.rb">app/mailers/notifier.rb</a></td>
        <td class="yellow strong">81.16 %</td>
        <td>117</td>
        <td>69</td>
        <td>56</td>
        <td>13</td>
        <td>260.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c115ea5002c674a49b46b6d86b31cc11a2b62284" class="src_link" title="app/models/ability.rb">app/models/ability.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>65</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>118.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ded849bb54e2138b73765ab3526f557c41496185" class="src_link" title="app/models/action.rb">app/models/action.rb</a></td>
        <td class="yellow strong">85.71 %</td>
        <td>26</td>
        <td>14</td>
        <td>12</td>
        <td>2</td>
        <td>1.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0498eca24dd96eeebb1b0e1c7e958549bfd7a8e5" class="src_link" title="app/models/activity.rb">app/models/activity.rb</a></td>
        <td class="yellow strong">89.91 %</td>
        <td>216</td>
        <td>109</td>
        <td>98</td>
        <td>11</td>
        <td>109.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6d5ed5496b177122b9c3f04947ff466c238cc2b1" class="src_link" title="app/models/article.rb">app/models/article.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>25</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#24dfc110c9faf558d0677d530d575aa642473dc2" class="src_link" title="app/models/authentication.rb">app/models/authentication.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>4.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f25f2e42baefd34e7883b980512df3d7e797901b" class="src_link" title="app/models/ckeditor/asset.rb">app/models/ckeditor/asset.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6d673350c800d0734653dc45024d04b682c700b3" class="src_link" title="app/models/ckeditor/attachment_file.rb">app/models/ckeditor/attachment_file.rb</a></td>
        <td class="red strong">75.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>3</td>
        <td>1</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#badadc0cc745c070e75f35c6a4749a6c81bf0cd3" class="src_link" title="app/models/ckeditor/picture.rb">app/models/ckeditor/picture.rb</a></td>
        <td class="red strong">75.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>3</td>
        <td>1</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1b22f59c78815e9eb30a54336160998329fecfcb" class="src_link" title="app/models/content_item.rb">app/models/content_item.rb</a></td>
        <td class="green strong">95.6 %</td>
        <td>188</td>
        <td>91</td>
        <td>87</td>
        <td>4</td>
        <td>12.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e90618e81fda42c6d152e6384bc72b7b8f7842dc" class="src_link" title="app/models/content_item_description.rb">app/models/content_item_description.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>4.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3696d16bb3955de3b84ed437576802c673ad9c44" class="src_link" title="app/models/content_item_link.rb">app/models/content_item_link.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3b868cbbd80612a99f16857854af45fa2673b015" class="src_link" title="app/models/content_items_conversation.rb">app/models/content_items_conversation.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#92eedf1790759f0a1cc1e40955eaa090fd5948a4" class="src_link" title="app/models/content_items_person.rb">app/models/content_items_person.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d99e91460859931ed6cecc94083b0079f9faef7d" class="src_link" title="app/models/content_items_topic.rb">app/models/content_items_topic.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d77d3bbcdcd53984a917ed4fa34059314406fe64" class="src_link" title="app/models/content_template.rb">app/models/content_template.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>16</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>5.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f873abec6c9ba57a98d981884c906b9f662dbc27" class="src_link" title="app/models/contribution.rb">app/models/contribution.rb</a></td>
        <td class="yellow strong">84.15 %</td>
        <td>350</td>
        <td>164</td>
        <td>138</td>
        <td>26</td>
        <td>37.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0727df4162b0875a3f9ba973ce76b27204209292" class="src_link" title="app/models/conversation.rb">app/models/conversation.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>390</td>
        <td>200</td>
        <td>175</td>
        <td>25</td>
        <td>54.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bf60ae24ffa1c8ebbdb2633af61f66bd675b4305" class="src_link" title="app/models/conversations_person.rb">app/models/conversations_person.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a5afd10a65ce889689ceba3f4c798f0c212c700b" class="src_link" title="app/models/conversations_topic.rb">app/models/conversations_topic.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#37ffb718fc6d36625ef8842cb6d63a9b95c1185c" class="src_link" title="app/models/county.rb">app/models/county.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#845fc5cc9e7c7734e4636d1ed249328dbf06c3cd" class="src_link" title="app/models/curated_feed.rb">app/models/curated_feed.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>15</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>8.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#45687ff8a36303a4085809e37dccaedd368eb9c0" class="src_link" title="app/models/curated_feed_item.rb">app/models/curated_feed_item.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>74</td>
        <td>45</td>
        <td>45</td>
        <td>0</td>
        <td>9.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4437993eb1794d7d4870c0abfb8cb777a31738cc" class="src_link" title="app/models/email_restriction.rb">app/models/email_restriction.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#09acf8feb722ef74d325c80c844d9cb20a2fbe9d" class="src_link" title="app/models/featured_opportunity.rb">app/models/featured_opportunity.rb</a></td>
        <td class="red strong">75.0 %</td>
        <td>20</td>
        <td>12</td>
        <td>9</td>
        <td>3</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#680a5bc315bb1faa10f78e6e93a25b4482c8ccd6" class="src_link" title="app/models/homepage_featured.rb">app/models/homepage_featured.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>21</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#47cf9b09925af3e73fc7beae521f90c3920ec86e" class="src_link" title="app/models/invite.rb">app/models/invite.rb</a></td>
        <td class="green strong">93.75 %</td>
        <td>68</td>
        <td>32</td>
        <td>30</td>
        <td>2</td>
        <td>4.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4d3fe8c348257031543f19b442e44078c9169f7d" class="src_link" title="app/models/issue.rb">app/models/issue.rb</a></td>
        <td class="green strong">93.33 %</td>
        <td>255</td>
        <td>135</td>
        <td>126</td>
        <td>9</td>
        <td>44.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#95317e25da27133a7e60dd2d2fd8a4e3996a5454" class="src_link" title="app/models/issues_topic.rb">app/models/issues_topic.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4d63446d3112c6fcd9a29d09e0ff8f244ce11a2f" class="src_link" title="app/models/managed_issue.rb">app/models/managed_issue.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>28</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>17.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d6fa366d057df9a2bd4dee638f658a138b10190a" class="src_link" title="app/models/managed_issue_page.rb">app/models/managed_issue_page.rb</a></td>
        <td class="yellow strong">88.46 %</td>
        <td>53</td>
        <td>26</td>
        <td>23</td>
        <td>3</td>
        <td>10.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1ac2ac381b4d3eadac56d70df897463fd2d10a0b" class="src_link" title="app/models/metro_region.rb">app/models/metro_region.rb</a></td>
        <td class="red strong">45.24 %</td>
        <td>76</td>
        <td>42</td>
        <td>19</td>
        <td>23</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c1dd906fcb9813625222821f95fbf7004662e55a" class="src_link" title="app/models/must_be_logged_in_validator.rb">app/models/must_be_logged_in_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>305.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5bfbfb1940b2cb74020f040ab3a54e1765f1e7c1" class="src_link" title="app/models/notification.rb">app/models/notification.rb</a></td>
        <td class="green strong">91.5 %</td>
        <td>384</td>
        <td>200</td>
        <td>183</td>
        <td>17</td>
        <td>28.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#408e449ce5258753d7df0bf7d1850f4d7cdb8c49" class="src_link" title="app/models/organization.rb">app/models/organization.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>37</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>1.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4dd7e370970bdc6fa2e35cbe8191771d0ab0f74b" class="src_link" title="app/models/organization_detail.rb">app/models/organization_detail.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>5</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>2.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#97d7d59418146858c971dfe0e64fce03454b1c9f" class="src_link" title="app/models/organization_member.rb">app/models/organization_member.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#acce817e34a6719cc32dd254ee768a8eb1c6497d" class="src_link" title="app/models/password_salt_validator.rb">app/models/password_salt_validator.rb</a></td>
        <td class="red strong">60.0 %</td>
        <td>15</td>
        <td>5</td>
        <td>3</td>
        <td>2</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3ea6b67d6d5018ec766b7d50f10ee965a6fe72ad" class="src_link" title="app/models/person.rb">app/models/person.rb</a></td>
        <td class="green strong">94.58 %</td>
        <td>501</td>
        <td>240</td>
        <td>227</td>
        <td>13</td>
        <td>503.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8af5b8f3eada80c653b20f8d09268d15c9896fa7" class="src_link" title="app/models/petition.rb">app/models/petition.rb</a></td>
        <td class="green strong">96.55 %</td>
        <td>62</td>
        <td>29</td>
        <td>28</td>
        <td>1</td>
        <td>6.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#88bfd596fb0b3d3ac8cbe26f6e15a004f8fd31d7" class="src_link" title="app/models/petition_signature.rb">app/models/petition_signature.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>16</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>8.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#635696a40b4e1cfb31c07df903514520db7969bc" class="src_link" title="app/models/rating.rb">app/models/rating.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>45</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#89b31a44bfc86e9ebfc21bea2f327c398be6cb1d" class="src_link" title="app/models/rating_descriptor.rb">app/models/rating_descriptor.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5b262c98280ce4cf7967fbe9a5869ea1720d9f22" class="src_link" title="app/models/rating_group.rb">app/models/rating_group.rb</a></td>
        <td class="green strong">98.48 %</td>
        <td>134</td>
        <td>66</td>
        <td>65</td>
        <td>1</td>
        <td>6.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#255aaf2611ca8a7f87b3edbbba3695444ea5f607" class="src_link" title="app/models/rating_group_validator.rb">app/models/rating_group_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>27.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0af9b1fdf40780c8e5c0011c1bbdb44855043b4b" class="src_link" title="app/models/reflection.rb">app/models/reflection.rb</a></td>
        <td class="yellow strong">86.36 %</td>
        <td>42</td>
        <td>22</td>
        <td>19</td>
        <td>3</td>
        <td>1.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7455efe5fd2d48c76e5d7e16070187354c97099e" class="src_link" title="app/models/reflection_comment.rb">app/models/reflection_comment.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>14</td>
        <td>8</td>
        <td>7</td>
        <td>1</td>
        <td>4.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bb219b626c68e671b095dbde49fd60412a3fe6e7" class="src_link" title="app/models/region.rb">app/models/region.rb</a></td>
        <td class="green strong">97.56 %</td>
        <td>76</td>
        <td>41</td>
        <td>40</td>
        <td>1</td>
        <td>4.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#de8dff9cd6a6e7676911dcec6773d271b1a624d8" class="src_link" title="app/models/selected_survey_option.rb">app/models/selected_survey_option.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>15</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>41.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#acbdae30cdb48eda0d2b9f25af8bf18904c8c8ab" class="src_link" title="app/models/subscription.rb">app/models/subscription.rb</a></td>
        <td class="red strong">79.17 %</td>
        <td>41</td>
        <td>24</td>
        <td>19</td>
        <td>5</td>
        <td>73.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e324c3e77f8c26a3561821ce67a11f0261f36d01" class="src_link" title="app/models/survey.rb">app/models/survey.rb</a></td>
        <td class="green strong">97.92 %</td>
        <td>96</td>
        <td>48</td>
        <td>47</td>
        <td>1</td>
        <td>29.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#249e3ffb105ff526c2ed72721d2eb1835652ed09" class="src_link" title="app/models/survey_option.rb">app/models/survey_option.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>35.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#39a5cb0880f9b322df541f395a3315718c831c8a" class="src_link" title="app/models/survey_response.rb">app/models/survey_response.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>61</td>
        <td>37</td>
        <td>37</td>
        <td>0</td>
        <td>48.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4cb3cd71524bb20c4541042cb0b4c7b593e072f0" class="src_link" title="app/models/survey_types/poll.rb">app/models/survey_types/poll.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e6d58b9c006125f3b64dbd018b3d68283e88427c" class="src_link" title="app/models/survey_types/vote.rb">app/models/survey_types/vote.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>3</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#53c3c4e0d895f3c53ef7cfc6deca808f641e9bdc" class="src_link" title="app/models/topic.rb">app/models/topic.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>73</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>5.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ecd84707ecff22df187c8d48de732b47e7a045eb" class="src_link" title="app/models/tos.rb">app/models/tos.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>1.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#03c4ab388197f81069c9e3c5a1e545eeb6ea9bc8" class="src_link" title="app/models/visit.rb">app/models/visit.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9417236037f905386d5cb80b6a9b18889990efea" class="src_link" title="app/models/widget_log.rb">app/models/widget_log.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>42</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>5.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#428ffab92377ae8f42e75ad6ac4500893199723b" class="src_link" title="app/models/zip_code.rb">app/models/zip_code.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#17b71720d95612d1d897ca910d984b434ba147a8" class="src_link" title="app/observers/activity_observer.rb">app/observers/activity_observer.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>36</td>
        <td>16</td>
        <td>14</td>
        <td>2</td>
        <td>37.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3576ff2666215e373495169d2ee93e6c2a54cc0e" class="src_link" title="app/observers/notification_observer.rb">app/observers/notification_observer.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>22</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>24.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3c967247385bcacce1870de0fd7ca7101d368332" class="src_link" title="app/observers/person_observer.rb">app/observers/person_observer.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>40.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ef0307ec34164465aea476a4f6504d2dbfed8dfa" class="src_link" title="app/presenters/contribution_presenter.rb">app/presenters/contribution_presenter.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>58</td>
        <td>32</td>
        <td>16</td>
        <td>16</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#03ce8934637f148c00b3169948249cef43399310" class="src_link" title="app/presenters/conversation_presenter.rb">app/presenters/conversation_presenter.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>7</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#54f9987f72e16a72b655bea415ccdc48f488671a" class="src_link" title="app/presenters/ingest_presenter.rb">app/presenters/ingest_presenter.rb</a></td>
        <td class="red strong">29.03 %</td>
        <td>63</td>
        <td>31</td>
        <td>9</td>
        <td>22</td>
        <td>0.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ca09b8864ae36b9bee2e5bb939486e13f902319b" class="src_link" title="app/presenters/issue_presenter.rb">app/presenters/issue_presenter.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f6e122baf748cd4ed3aa6baa050878b5963e266e" class="src_link" title="app/presenters/presenter_base.rb">app/presenters/presenter_base.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>15</td>
        <td>8</td>
        <td>8</td>
        <td>0</td>
        <td>190.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5d00741ced9b6403d678149ebff4ea90552b649c" class="src_link" title="app/presenters/presenter_form.rb">app/presenters/presenter_form.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>4.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#85c482c2c341714d2fad1a556d7381fce795d920" class="src_link" title="app/presenters/profile_presenter.rb">app/presenters/profile_presenter.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>110</td>
        <td>60</td>
        <td>60</td>
        <td>0</td>
        <td>13.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e26e899dd21d09c385f2a644888f8aa9133e0b9a" class="src_link" title="app/presenters/promotion_form_presenter.rb">app/presenters/promotion_form_presenter.rb</a></td>
        <td class="red strong">63.16 %</td>
        <td>41</td>
        <td>19</td>
        <td>12</td>
        <td>7</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#702ba21f54f2e4b703df31d0018ea1627fc4cdb7" class="src_link" title="app/presenters/registration_form_presenter.rb">app/presenters/registration_form_presenter.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>9.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#115a89b41a9a2dcc416560c56b49d0c703300664" class="src_link" title="app/presenters/subscription_presenter.rb">app/presenters/subscription_presenter.rb</a></td>
        <td class="red strong">45.0 %</td>
        <td>39</td>
        <td>20</td>
        <td>9</td>
        <td>11</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f20cf6b9bd30aaf2119442e0f2a0547630f62e9e" class="src_link" title="app/presenters/vote_response_presenter.rb">app/presenters/vote_response_presenter.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>118</td>
        <td>57</td>
        <td>57</td>
        <td>0</td>
        <td>256.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d9df10f5219ad23243c1ec6b5690500b23be24da" class="src_link" title="app/services/avatar_service.rb">app/services/avatar_service.rb</a></td>
        <td class="green strong">93.75 %</td>
        <td>61</td>
        <td>32</td>
        <td>30</td>
        <td>2</td>
        <td>78.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5d883922a643e8f0f1d1fccbb301c1060d2fd16e" class="src_link" title="app/services/digest_service.rb">app/services/digest_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>209</td>
        <td>89</td>
        <td>89</td>
        <td>0</td>
        <td>16.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f909e6a77b0188250de2f1afa724603b93172411" class="src_link" title="app/services/embedly_service.rb">app/services/embedly_service.rb</a></td>
        <td class="yellow strong">84.54 %</td>
        <td>366</td>
        <td>207</td>
        <td>175</td>
        <td>32</td>
        <td>55.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#41856a5a13d806968aaa6c50a3bb8b716e7958c1" class="src_link" title="app/services/member_export_service.rb">app/services/member_export_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>29</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>16.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#addf6df3dd00c4232e688bdf9e59eafda93d2a6e" class="src_link" title="app/services/participation_service.rb">app/services/participation_service.rb</a></td>
        <td class="red strong">67.65 %</td>
        <td>104</td>
        <td>34</td>
        <td>23</td>
        <td>11</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ffe4fcdd5e9a152c386b8aa20d27fc3ef6d711ca" class="src_link" title="app/services/petition_print_service.rb">app/services/petition_print_service.rb</a></td>
        <td class="red strong">18.46 %</td>
        <td>136</td>
        <td>65</td>
        <td>12</td>
        <td>53</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cff9992a50770b00c31ec9988e99d74ddeb68186" class="src_link" title="app/services/search_service.rb">app/services/search_service.rb</a></td>
        <td class="red strong">40.0 %</td>
        <td>95</td>
        <td>55</td>
        <td>22</td>
        <td>33</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e042531bb8a3ebd0d8af83c31ed056ff062ce258" class="src_link" title="app/services/spam_service.rb">app/services/spam_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>32</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>140.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8952029e12444817cd6194faf2b5f8756c978eb5" class="src_link" title="app/services/vote_progress_service.rb">app/services/vote_progress_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>168</td>
        <td>71</td>
        <td>71</td>
        <td>0</td>
        <td>30.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e2b1f41a0e9d04a507f530bd1532b728e1805100" class="src_link" title="app/uploaders/ckeditor_attachment_file_uploader.rb">app/uploaders/ckeditor_attachment_file_uploader.rb</a></td>
        <td class="red strong">71.43 %</td>
        <td>42</td>
        <td>7</td>
        <td>5</td>
        <td>2</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#80120a5a19d462217fc47d88af1f9fdf6cc1a185" class="src_link" title="app/uploaders/ckeditor_picture_uploader.rb">app/uploaders/ckeditor_picture_uploader.rb</a></td>
        <td class="yellow strong">84.62 %</td>
        <td>53</td>
        <td>13</td>
        <td>11</td>
        <td>2</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#66cebf0bc2525f154a5cf525408d7d167ad6e8ec" class="src_link" title="lib/ccml.rb">lib/ccml.rb</a></td>
        <td class="green strong">93.83 %</td>
        <td>421</td>
        <td>81</td>
        <td>76</td>
        <td>5</td>
        <td>23.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5dd11277b29118acf976bf0a3c8e8a6212c23c56" class="src_link" title="lib/ccml/error.rb">lib/ccml/error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#84a8d4feacbed4c375a321530f6b6457f0b37e25" class="src_link" title="lib/ccml/error/base.rb">lib/ccml/error/base.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>10.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6868b0d0b7b2022f228cac813d3de8850c356971" class="src_link" title="lib/ccml/error/external_source_error.rb">lib/ccml/error/external_source_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#829f26b66a34b2ec40243a549fb53f4441eb25fe" class="src_link" title="lib/ccml/error/malformed_tag_error.rb">lib/ccml/error/malformed_tag_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e620459a6311b9c01b2bd451fa9ee17d1187bf12" class="src_link" title="lib/ccml/error/not_implemented_error.rb">lib/ccml/error/not_implemented_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3f0f7bc09096c69f14328c17a24fd3b6411bd34e" class="src_link" title="lib/ccml/error/tag_base_class_in_template_error.rb">lib/ccml/error/tag_base_class_in_template_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fcddb7d047616e54828e2f97e0286202046e8bb0" class="src_link" title="lib/ccml/error/tag_class_not_found_error.rb">lib/ccml/error/tag_class_not_found_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#01fa0f257ffcbed1167196b67a42d181cc3b7eb8" class="src_link" title="lib/ccml/error/tag_method_not_found_error.rb">lib/ccml/error/tag_method_not_found_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#016a054b890b816b5479278edc9ca11ac6c01d24" class="src_link" title="lib/ccml/error/template_error.rb">lib/ccml/error/template_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#69b74fc1c322d99e9b1fdd32c40d0b3217134157" class="src_link" title="lib/ccml/tag.rb">lib/ccml/tag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#014c5c82d3434398cb37820f1879386ca96f9682" class="src_link" title="lib/ccml/tag/base.rb">lib/ccml/tag/base.rb</a></td>
        <td class="green strong">98.81 %</td>
        <td>142</td>
        <td>84</td>
        <td>83</td>
        <td>1</td>
        <td>62.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7eb246b38c921e65133e6035b1d736618b519d40" class="src_link" title="lib/ccml/tag/curated_feed_tag.rb">lib/ccml/tag/curated_feed_tag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>64</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>2.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#11dbac660417413c9f715428b011e50e61d6e77e" class="src_link" title="lib/ccml/tag/issue_tag.rb">lib/ccml/tag/issue_tag.rb</a></td>
        <td class="red strong">78.57 %</td>
        <td>163</td>
        <td>42</td>
        <td>33</td>
        <td>9</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#019a230d8f9dcb119ee73193d4cabb2dbe8634fa" class="src_link" title="lib/ccml/tag/route_tag.rb">lib/ccml/tag/route_tag.rb</a></td>
        <td class="red strong">65.38 %</td>
        <td>67</td>
        <td>26</td>
        <td>17</td>
        <td>9</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8461935e1a79144882aff854e1143e710d6d942f" class="src_link" title="lib/ccml/tag/rss_tag.rb">lib/ccml/tag/rss_tag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>196</td>
        <td>70</td>
        <td>70</td>
        <td>0</td>
        <td>16.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#dead7b191e5d38577e37f3d861a993f25df6dbeb" class="src_link" title="lib/ccml/tag/single_tag.rb">lib/ccml/tag/single_tag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#708387224c3ee97e9f1f39b9144d04d7bb247c96" class="src_link" title="lib/ccml/tag/tag_pair.rb">lib/ccml/tag/tag_pair.rb</a></td>
        <td class="green strong">97.47 %</td>
        <td>161</td>
        <td>79</td>
        <td>77</td>
        <td>2</td>
        <td>296.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bb1541a67ddcb1a77fd0050cf7879876a2f61dba" class="src_link" title="lib/ccml/tag/vote_tag.rb">lib/ccml/tag/vote_tag.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>21</td>
        <td>8</td>
        <td>7</td>
        <td>1</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#14144a7d11c0b597d23d17b11a3d0a070a10f603" class="src_link" title="lib/filter_constraint.rb">lib/filter_constraint.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>11</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>7.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4c7d2254f8b4921fed71b9af6d6fa2b1509ea300" class="src_link" title="lib/generic_object.rb">lib/generic_object.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>12</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#765e8112e4aa74d57d547d1520d701a28ee1bab8" class="src_link" title="lib/geometry_for_style.rb">lib/geometry_for_style.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>2</td>
        <td>2</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#91868468c438398539081cb50e150532e25cb9bc" class="src_link" title="lib/ingester.rb">lib/ingester.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>193</td>
        <td>60</td>
        <td>60</td>
        <td>0</td>
        <td>25.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#059d7c1b738435adb1dde9bd87fa6691b463c15f" class="src_link" title="lib/parent_validator.rb">lib/parent_validator.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>16</td>
        <td>6</td>
        <td>4</td>
        <td>2</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0606951742d5a7f85388fcc8b32f54d971527c10" class="src_link" title="lib/s3_config.rb">lib/s3_config.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>4.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c044a9faf0a3b47c502c6aea47ac8cf8bca86ab4" class="src_link" title="lib/unsubscribe_someone.rb">lib/unsubscribe_someone.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ae77079de42d9035fcfdca96dbf5210d7645eb36" class="src_link" title="lib/utilities/conversation_utilities.rb">lib/utilities/conversation_utilities.rb</a></td>
        <td class="yellow strong">86.21 %</td>
        <td>76</td>
        <td>29</td>
        <td>25</td>
        <td>4</td>
        <td>9.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fcb598f6074259d87e0b26e14bb0b914a4dd9043" class="src_link" title="lib/utilities/person_utilities.rb">lib/utilities/person_utilities.rb</a></td>
        <td class="green strong">97.8 %</td>
        <td>132</td>
        <td>91</td>
        <td>89</td>
        <td>2</td>
        <td>13.0</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
          <div class="file_list_container" id="Concerns">
  <h2>
    <span class="group_name">Concerns</span>
    (<span class="covered_percent"><span class="green">98.68%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         9.23
       </span>
    </span> hits/line)
  </h2>
  <a name="Concerns"></a>
  <div>
    <b>7</b> files in total.
    <b>76</b> relevant lines. 
    <span class="green"><b>75</b> lines covered</span> and
    <span class="red"><b>1</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#9be8441f03d44cebd6e6d3c333aae0f5d3472c13" class="src_link" title="app/concerns/homepage_featurable.rb">app/concerns/homepage_featurable.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>16</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>1.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#eda2b5bdfbf193f32b4d2f8f163e3c5992a81b04" class="src_link" title="app/concerns/regionable.rb">app/concerns/regionable.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d17d49d33c1ec3a8d495fee440356769d15a1967" class="src_link" title="app/concerns/subscribable.rb">app/concerns/subscribable.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>17</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>26.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fa8c811dbb6773ac5615f6cd607fae10ec5653e9" class="src_link" title="app/concerns/thumbnail.rb">app/concerns/thumbnail.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>4.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#14cecadfe027e0503059e023d4d3ff7a235b6ff3" class="src_link" title="app/concerns/visitable.rb">app/concerns/visitable.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>45</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>14.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7e7b9bc573e4cf12e1df3de0fe4c75f61b2d2e18" class="src_link" title="app/concerns/you_tubeable.rb">app/concerns/you_tubeable.rb</a></td>
        <td class="green strong">93.75 %</td>
        <td>30</td>
        <td>16</td>
        <td>15</td>
        <td>1</td>
        <td>1.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#411b0671206a1baff9e77ce49e6b357a989a736b" class="src_link" title="app/concerns/you_tubeable_validator.rb">app/concerns/you_tubeable_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.8</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent"><span class="yellow">83.24%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         10.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Controllers"></a>
  <div>
    <b>61</b> files in total.
    <b>1880</b> relevant lines. 
    <span class="green"><b>1565</b> lines covered</span> and
    <span class="red"><b>315</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#c961881ef367b97f221bcf9d77da49b8a079d6d0" class="src_link" title="app/controllers/actions_controller.rb">app/controllers/actions_controller.rb</a></td>
        <td class="yellow strong">84.62 %</td>
        <td>23</td>
        <td>13</td>
        <td>11</td>
        <td>2</td>
        <td>5.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cf155fe18f1fc24b90a8f2f27958a5f52e1819ce" class="src_link" title="app/controllers/admin/articles_controller.rb">app/controllers/admin/articles_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>78</td>
        <td>33</td>
        <td>33</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5abcf6a9482d2f2d21c099bfd39fef44c116ed84" class="src_link" title="app/controllers/admin/content_item_links_controller.rb">app/controllers/admin/content_item_links_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>47</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>2.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b6c82854cfc77ace2fef8b4cf4e1a137e18aca09" class="src_link" title="app/controllers/admin/content_items_controller.rb">app/controllers/admin/content_items_controller.rb</a></td>
        <td class="yellow strong">85.19 %</td>
        <td>136</td>
        <td>81</td>
        <td>69</td>
        <td>12</td>
        <td>8.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e7a328488c9a8ba4b9f68c444aabf61d9b6c3a78" class="src_link" title="app/controllers/admin/content_items_people_controller.rb">app/controllers/admin/content_items_people_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>40</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>6.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2f1aee242516938836a74ffa2ee19c537ed335b7" class="src_link" title="app/controllers/admin/content_templates_controller.rb">app/controllers/admin/content_templates_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>56</td>
        <td>27</td>
        <td>27</td>
        <td>0</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2b79ecaee63f8be5f7e0c09fd886b3023e8d60c5" class="src_link" title="app/controllers/admin/conversations_controller.rb">app/controllers/admin/conversations_controller.rb</a></td>
        <td class="red strong">57.32 %</td>
        <td>157</td>
        <td>82</td>
        <td>47</td>
        <td>35</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5bc1dd7747e0014997fc7561e78de19890a77604" class="src_link" title="app/controllers/admin/conversations_people_controller.rb">app/controllers/admin/conversations_people_controller.rb</a></td>
        <td class="red strong">26.09 %</td>
        <td>40</td>
        <td>23</td>
        <td>6</td>
        <td>17</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#01e9d0dfa0a725eb0ceabf132914a6fd65ed680f" class="src_link" title="app/controllers/admin/curated_feed_items_controller.rb">app/controllers/admin/curated_feed_items_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>47</td>
        <td>27</td>
        <td>27</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#91cfcf1880a549cfdedca8a122e0b644e3b5e13c" class="src_link" title="app/controllers/admin/curated_feeds_controller.rb">app/controllers/admin/curated_feeds_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>53</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>2.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#207ef531a67482df7be81f57c4f355de5105d31f" class="src_link" title="app/controllers/admin/dashboard_controller.rb">app/controllers/admin/dashboard_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>13</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>11.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b33b6373a2ee07e2c39b48194ff005d2be854118" class="src_link" title="app/controllers/admin/email_restrictions_controller.rb">app/controllers/admin/email_restrictions_controller.rb</a></td>
        <td class="red strong">41.46 %</td>
        <td>86</td>
        <td>41</td>
        <td>17</td>
        <td>24</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e26182f0a0d42fcc4c635d86ca52a25475c1c47f" class="src_link" title="app/controllers/admin/featured_homepage_controller.rb">app/controllers/admin/featured_homepage_controller.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>48</td>
        <td>18</td>
        <td>9</td>
        <td>9</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b68d0edc843af6a8ac3760090eff4b80e658022c" class="src_link" title="app/controllers/admin/featured_opportunities_controller.rb">app/controllers/admin/featured_opportunities_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>68</td>
        <td>43</td>
        <td>43</td>
        <td>0</td>
        <td>3.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#90880f0cbd1fb09aefc6364fa06fe954214cfeea" class="src_link" title="app/controllers/admin/issues_controller.rb">app/controllers/admin/issues_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>106</td>
        <td>54</td>
        <td>54</td>
        <td>0</td>
        <td>4.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6b9f93fcd7607d78b0262b5e2c5a425a6b0ae749" class="src_link" title="app/controllers/admin/managed_issue_pages_controller.rb">app/controllers/admin/managed_issue_pages_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>70</td>
        <td>38</td>
        <td>38</td>
        <td>0</td>
        <td>2.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#251a50892b939a632cdfb8cf46709af28f9dc250" class="src_link" title="app/controllers/admin/metro_regions_controller.rb">app/controllers/admin/metro_regions_controller.rb</a></td>
        <td class="red strong">44.83 %</td>
        <td>54</td>
        <td>29</td>
        <td>13</td>
        <td>16</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1d3b9d42df9d83ecfd8c983cd356217ef14a7fb1" class="src_link" title="app/controllers/admin/people_controller.rb">app/controllers/admin/people_controller.rb</a></td>
        <td class="red strong">73.68 %</td>
        <td>114</td>
        <td>57</td>
        <td>42</td>
        <td>15</td>
        <td>1.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9752b31c57cfac6eddf807ba7d9b6ba969a9a1d1" class="src_link" title="app/controllers/admin/regions_controller.rb">app/controllers/admin/regions_controller.rb</a></td>
        <td class="red strong">72.22 %</td>
        <td>35</td>
        <td>18</td>
        <td>13</td>
        <td>5</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6f74a487d26595ea075ec6508032060dbba0e85f" class="src_link" title="app/controllers/admin/surveys_controller.rb">app/controllers/admin/surveys_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>129</td>
        <td>71</td>
        <td>71</td>
        <td>0</td>
        <td>5.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c11d6d992ca9ec55eaa8d0f9815ec05fed38e32b" class="src_link" title="app/controllers/admin/topics_controller.rb">app/controllers/admin/topics_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>86</td>
        <td>41</td>
        <td>41</td>
        <td>0</td>
        <td>3.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#57dd5bd18d0dfe486207eb17a98973dfaaf2dda1" class="src_link" title="app/controllers/admin/user_registrations_controller.rb">app/controllers/admin/user_registrations_controller.rb</a></td>
        <td class="yellow strong">90.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>9</td>
        <td>1</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c41cec4011dcd6cc31fc87b7caeb657e0ec368a7" class="src_link" title="app/controllers/admin/widget_stats_controller.rb">app/controllers/admin/widget_stats_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>14</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>4.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4f2782333ace84218f6099b553c68e2563068118" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="green strong">97.06 %</td>
        <td>117</td>
        <td>68</td>
        <td>66</td>
        <td>2</td>
        <td>154.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d7a98467151d389a9511ea1cb88ae0afc337aa99" class="src_link" title="app/controllers/authentication_controller.rb">app/controllers/authentication_controller.rb</a></td>
        <td class="green strong">94.87 %</td>
        <td>70</td>
        <td>39</td>
        <td>37</td>
        <td>2</td>
        <td>2.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a6d917a1d04754d2cef9155c69c7f90f9b3f2473" class="src_link" title="app/controllers/blog_controller.rb">app/controllers/blog_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>26</td>
        <td>16</td>
        <td>16</td>
        <td>0</td>
        <td>11.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f777b185c2162cc7d0b1ccacba2c0d57613aabdb" class="src_link" title="app/controllers/community_controller.rb">app/controllers/community_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>43</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>14.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#323a24c17bf94dc94e8ea94d7c1406e8fb33a92e" class="src_link" title="app/controllers/confirmations_controller.rb">app/controllers/confirmations_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#94568870a95d7da708979dd83d65ef471a28dd9f" class="src_link" title="app/controllers/content_controller.rb">app/controllers/content_controller.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>10</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#728774869e1f29714e826ab2a8774cedc4134df7" class="src_link" title="app/controllers/contributions_controller.rb">app/controllers/contributions_controller.rb</a></td>
        <td class="red strong">40.0 %</td>
        <td>123</td>
        <td>75</td>
        <td>30</td>
        <td>45</td>
        <td>0.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#955343a1518cfc8293a2e6703f0526f184c1337a" class="src_link" title="app/controllers/conversations_controller.rb">app/controllers/conversations_controller.rb</a></td>
        <td class="red strong">65.9 %</td>
        <td>325</td>
        <td>173</td>
        <td>114</td>
        <td>59</td>
        <td>4.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f3e81f2e56a3678dc6b58949ebf86430443a2958" class="src_link" title="app/controllers/curated_feed_item_controller.rb">app/controllers/curated_feed_item_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0d3a0dc1d2feaddf9157e41fbc37da081fa059bc" class="src_link" title="app/controllers/feeds_controller.rb">app/controllers/feeds_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fbecacca6a6fa5359976d086a649e54e20a4d671" class="src_link" title="app/controllers/homepage_controller.rb">app/controllers/homepage_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>17</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>113.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f5493a4632db90eafb93e577a7e37d099c023502" class="src_link" title="app/controllers/invites_controller.rb">app/controllers/invites_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>40</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>1.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#15465242920f4c87a785f825b3094a17688bcb3c" class="src_link" title="app/controllers/issues_controller.rb">app/controllers/issues_controller.rb</a></td>
        <td class="red strong">67.5 %</td>
        <td>61</td>
        <td>40</td>
        <td>27</td>
        <td>13</td>
        <td>5.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#20efaff71608d94825afc47f0d710ecc5cb79458" class="src_link" title="app/controllers/links_controller.rb">app/controllers/links_controller.rb</a></td>
        <td class="red strong">37.5 %</td>
        <td>38</td>
        <td>24</td>
        <td>9</td>
        <td>15</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#afb063aa1e013bb15d08e1526f6ae1f6e1d13da4" class="src_link" title="app/controllers/managed_issue_pages_controller.rb">app/controllers/managed_issue_pages_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>15</td>
        <td>8</td>
        <td>8</td>
        <td>0</td>
        <td>3.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b2b6d3e450acb8b5dadc072a08cd06987f91807b" class="src_link" title="app/controllers/metro_regions_controller.rb">app/controllers/metro_regions_controller.rb</a></td>
        <td class="yellow strong">81.82 %</td>
        <td>18</td>
        <td>11</td>
        <td>9</td>
        <td>2</td>
        <td>1.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f09f0273543bf2cbeb84911aaee855e9e0a5b981" class="src_link" title="app/controllers/news_controller.rb">app/controllers/news_controller.rb</a></td>
        <td class="red strong">40.0 %</td>
        <td>11</td>
        <td>5</td>
        <td>2</td>
        <td>3</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3d7b9fc0411e5c7fbfdaa59310d2e443f2b175a3" class="src_link" title="app/controllers/notifications_controller.rb">app/controllers/notifications_controller.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7033e328f3305da6b0ecd00b54844c0b70d1e165" class="src_link" title="app/controllers/opportunity_votes_controller.rb">app/controllers/opportunity_votes_controller.rb</a></td>
        <td class="green strong">91.23 %</td>
        <td>94</td>
        <td>57</td>
        <td>52</td>
        <td>5</td>
        <td>3.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0c364ca8066afafd2b526d428b57218d93b9e4cb" class="src_link" title="app/controllers/pages_controller.rb">app/controllers/pages_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5aa2f75b5440ca0e65701fff4231936f4f4e4e02" class="src_link" title="app/controllers/passwords_controller.rb">app/controllers/passwords_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>28</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>2.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1b22ff703b28ddc5422fd67c58908ecad61040e6" class="src_link" title="app/controllers/petitions_controller.rb">app/controllers/petitions_controller.rb</a></td>
        <td class="green strong">95.56 %</td>
        <td>74</td>
        <td>45</td>
        <td>43</td>
        <td>2</td>
        <td>3.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#064cb0d26b789ba09332ce2be6c0ed35942a8f76" class="src_link" title="app/controllers/products_services_controller.rb">app/controllers/products_services_controller.rb</a></td>
        <td class="red strong">36.36 %</td>
        <td>24</td>
        <td>11</td>
        <td>4</td>
        <td>7</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#74d67efed2bcda8ef16ae3ccccd440c73444b0f1" class="src_link" title="app/controllers/projects_controller.rb">app/controllers/projects_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>11</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>2.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0d087bbbcf49e232b84b91a431ee33faa1500fb7" class="src_link" title="app/controllers/radioshow_controller.rb">app/controllers/radioshow_controller.rb</a></td>
        <td class="green strong">94.44 %</td>
        <td>33</td>
        <td>18</td>
        <td>17</td>
        <td>1</td>
        <td>2.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fd968a677496a731149febfa23c7c24c5c95493a" class="src_link" title="app/controllers/reflection_comments_controller.rb">app/controllers/reflection_comments_controller.rb</a></td>
        <td class="green strong">93.94 %</td>
        <td>60</td>
        <td>33</td>
        <td>31</td>
        <td>2</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8c41a8b26c49b47d77b04dc17f8c3db7ea4ee423" class="src_link" title="app/controllers/reflections_controller.rb">app/controllers/reflections_controller.rb</a></td>
        <td class="green strong">95.45 %</td>
        <td>72</td>
        <td>44</td>
        <td>42</td>
        <td>2</td>
        <td>3.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ce6eef57f34f2b406c52181daee7db964c44481f" class="src_link" title="app/controllers/regions_controller.rb">app/controllers/regions_controller.rb</a></td>
        <td class="yellow strong">85.71 %</td>
        <td>13</td>
        <td>7</td>
        <td>6</td>
        <td>1</td>
        <td>0.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5b3a06aa05f7478a9a85dfb0a2becb776ba3e173" class="src_link" title="app/controllers/registrations/omniauth_callbacks_controller.rb">app/controllers/registrations/omniauth_callbacks_controller.rb</a></td>
        <td class="green strong">97.14 %</td>
        <td>151</td>
        <td>70</td>
        <td>68</td>
        <td>2</td>
        <td>4.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#499a92ce85bb016a3f77256c0ce043578d95a8ea" class="src_link" title="app/controllers/registrations_controller.rb">app/controllers/registrations_controller.rb</a></td>
        <td class="green strong">90.91 %</td>
        <td>57</td>
        <td>33</td>
        <td>30</td>
        <td>3</td>
        <td>5.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ab1186867203f076b3b635a016786fb6398a5f9a" class="src_link" title="app/controllers/search_controller.rb">app/controllers/search_controller.rb</a></td>
        <td class="green strong">96.3 %</td>
        <td>52</td>
        <td>27</td>
        <td>26</td>
        <td>1</td>
        <td>5.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#289ab8d630f19de989f409b82a0526c9bd9d1022" class="src_link" title="app/controllers/sessions_controller.rb">app/controllers/sessions_controller.rb</a></td>
        <td class="green strong">96.67 %</td>
        <td>47</td>
        <td>30</td>
        <td>29</td>
        <td>1</td>
        <td>23.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5b7710615a139fe382f1b8745cfb987146fdc8dd" class="src_link" title="app/controllers/subscriptions_controller.rb">app/controllers/subscriptions_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>25</td>
        <td>14</td>
        <td>14</td>
        <td>0</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d35fd8cbdf0fe67ba879cc0a9b21ceffff31f4f1" class="src_link" title="app/controllers/surveys_controller.rb">app/controllers/surveys_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>66</td>
        <td>36</td>
        <td>36</td>
        <td>0</td>
        <td>7.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ba26c29a1dcada63d14773beb4a97fb4c2972ab8" class="src_link" title="app/controllers/tos_controller.rb">app/controllers/tos_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>35</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>1.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ec6e5c49ada200afe822a548e0230ac358d97123" class="src_link" title="app/controllers/unsubscribe_digest_controller.rb">app/controllers/unsubscribe_digest_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>13</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>1.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c769e22508b2ce3df4f350cdf939e7b32b4ea627" class="src_link" title="app/controllers/user_controller.rb">app/controllers/user_controller.rb</a></td>
        <td class="green strong">94.55 %</td>
        <td>91</td>
        <td>55</td>
        <td>52</td>
        <td>3</td>
        <td>3.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#60a034a002671570442a1e4f18d68af71d75985b" class="src_link" title="app/controllers/widgets_controller.rb">app/controllers/widgets_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>15</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>6.0</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent"><span class="red">78.6%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         355.87
       </span>
    </span> hits/line)
  </h2>
  <a name="Helpers"></a>
  <div>
    <b>35</b> files in total.
    <b>645</b> relevant lines. 
    <span class="green"><b>507</b> lines covered</span> and
    <span class="red"><b>138</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#94207a4a35c40b45542942f41e8b313e4531bfc0" class="src_link" title="app/helpers/actions_helper.rb">app/helpers/actions_helper.rb</a></td>
        <td class="red strong">75.0 %</td>
        <td>13</td>
        <td>8</td>
        <td>6</td>
        <td>2</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#803dedea6b8bc9d7f2d48b12cc32b0cc9ecf10a2" class="src_link" title="app/helpers/activity_helper.rb">app/helpers/activity_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>13</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>27.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7caa6b55519ba90f6f0a5eb3e3b51f3603073c4f" class="src_link" title="app/helpers/admin/conversations_helper.rb">app/helpers/admin/conversations_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1543ec7be55b63734f02f8d5e88850cafe923672" class="src_link" title="app/helpers/admin/dashboard_helper.rb">app/helpers/admin/dashboard_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#167eed9b6eccff3718e5b3de34dcab54771bcb08" class="src_link" title="app/helpers/admin/featured_opportunities_helper.rb">app/helpers/admin/featured_opportunities_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>8.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2ba89652daff9f72d8ad90bfbf8a3772550d1ba2" class="src_link" title="app/helpers/admin/issues_helper.rb">app/helpers/admin/issues_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4902d4428ca4934746a064fc2c47bd9266f3be73" class="src_link" title="app/helpers/admin/people_helper.rb">app/helpers/admin/people_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#063cb5df0dab70b285f0e792ea81c329c456c6c5" class="src_link" title="app/helpers/admin/surveys_helper.rb">app/helpers/admin/surveys_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#564a7927fce8043169f5a360bb8c57932f06b178" class="src_link" title="app/helpers/admin/topics_helper.rb">app/helpers/admin/topics_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d926c223521b1bd75f45feeabd4108c10b098f46" class="src_link" title="app/helpers/admin/widget_stats_helper.rb">app/helpers/admin/widget_stats_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>13</td>
        <td>13</td>
        <td>0</td>
        <td>39.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cc891c6d6b8419d820de232da23ef30b6ed57289" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
        <td class="red strong">70.0 %</td>
        <td>97</td>
        <td>50</td>
        <td>35</td>
        <td>15</td>
        <td>4266.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3ab6b86d2229cfb7c30431a54ad89916d784d738" class="src_link" title="app/helpers/authentication_helper.rb">app/helpers/authentication_helper.rb</a></td>
        <td class="green strong">92.31 %</td>
        <td>26</td>
        <td>13</td>
        <td>12</td>
        <td>1</td>
        <td>13.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#269434260e39b0cb5d79b6b64d4a8f64f810a12b" class="src_link" title="app/helpers/avatar_helper.rb">app/helpers/avatar_helper.rb</a></td>
        <td class="yellow strong">81.82 %</td>
        <td>95</td>
        <td>44</td>
        <td>36</td>
        <td>8</td>
        <td>135.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#06f44d7020d501763e8398c7a8f7eac532e96066" class="src_link" title="app/helpers/blog_helper.rb">app/helpers/blog_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>58</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>15.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#26b65626fe6745c2880d8cdd4360206d7f1e100a" class="src_link" title="app/helpers/buttons_helper.rb">app/helpers/buttons_helper.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>6</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5c37237874ed65cf9b5cf95346d2662905f9b0f0" class="src_link" title="app/helpers/community_helper.rb">app/helpers/community_helper.rb</a></td>
        <td class="green strong">90.91 %</td>
        <td>37</td>
        <td>22</td>
        <td>20</td>
        <td>2</td>
        <td>21.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#94e4dc3a894166ec6d1201c8d33a53dabba3d93b" class="src_link" title="app/helpers/content_templates_helper.rb">app/helpers/content_templates_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ba1f6ec33fce8b50749240922ebd0d7f7a51d6a2" class="src_link" title="app/helpers/contributions_helper.rb">app/helpers/contributions_helper.rb</a></td>
        <td class="red strong">69.23 %</td>
        <td>32</td>
        <td>13</td>
        <td>9</td>
        <td>4</td>
        <td>1.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d1927ac80eee1a4d257971112c5c7ce80eddf56d" class="src_link" title="app/helpers/conversations_helper.rb">app/helpers/conversations_helper.rb</a></td>
        <td class="red strong">44.55 %</td>
        <td>214</td>
        <td>110</td>
        <td>49</td>
        <td>61</td>
        <td>3.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#280e8cb57ed0d005a281ede725f50d490576defd" class="src_link" title="app/helpers/invites_helper.rb">app/helpers/invites_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6d4100a9b113aefa4f67e307b65ffd1447cfecb9" class="src_link" title="app/helpers/issues_helper.rb">app/helpers/issues_helper.rb</a></td>
        <td class="red strong">30.77 %</td>
        <td>43</td>
        <td>26</td>
        <td>8</td>
        <td>18</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8dbc74baedac9f4caae187f8a300ae4d54cef4ed" class="src_link" title="app/helpers/meta_helper.rb">app/helpers/meta_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>56</td>
        <td>31</td>
        <td>31</td>
        <td>0</td>
        <td>21.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7cf8e9aad7ef39c7001577927775adeb92ab6a1d" class="src_link" title="app/helpers/opportunity_votes_helper.rb">app/helpers/opportunity_votes_helper.rb</a></td>
        <td class="green strong">92.31 %</td>
        <td>28</td>
        <td>13</td>
        <td>12</td>
        <td>1</td>
        <td>5.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c2708aac4ab95c46039f1e862cf5209eff53960b" class="src_link" title="app/helpers/organizations_helper.rb">app/helpers/organizations_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#923990bfaab9b3348421f1f82ad4973ca00903f2" class="src_link" title="app/helpers/profile_helper.rb">app/helpers/profile_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>47</td>
        <td>31</td>
        <td>31</td>
        <td>0</td>
        <td>13.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#63179098f2c7ee5fb195df7605ee24cae6a4f1fc" class="src_link" title="app/helpers/radioshow_helper.rb">app/helpers/radioshow_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>16</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#40f93eb08c8721e1a3b7c4cdae04f91025ff1d87" class="src_link" title="app/helpers/ratings_helper.rb">app/helpers/ratings_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8de65eda300250ddd3bcba32b03f6e4a06912528" class="src_link" title="app/helpers/redirect_helper.rb">app/helpers/redirect_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>23</td>
        <td>13</td>
        <td>13</td>
        <td>0</td>
        <td>50.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f6cd1373ff943948d44aad50ecb0db35dc2c9f7a" class="src_link" title="app/helpers/reflections_helper.rb">app/helpers/reflections_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#adf8111df702ee508571907cc7db88dc7942a0ad" class="src_link" title="app/helpers/region_helper.rb">app/helpers/region_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>42</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>131.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0a6d5efb442e9b4d035d37335e25981969b943ac" class="src_link" title="app/helpers/search_helper.rb">app/helpers/search_helper.rb</a></td>
        <td class="red strong">69.23 %</td>
        <td>64</td>
        <td>39</td>
        <td>27</td>
        <td>12</td>
        <td>1.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1183ab14f8a59c4f02f40ca0cbb158e364637b47" class="src_link" title="app/helpers/secure_url_helper.rb">app/helpers/secure_url_helper.rb</a></td>
        <td class="green strong">93.1 %</td>
        <td>57</td>
        <td>29</td>
        <td>27</td>
        <td>2</td>
        <td>96.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#20381500122db46f4c80aecde29a6b6ad5d715ca" class="src_link" title="app/helpers/surveys_helper.rb">app/helpers/surveys_helper.rb</a></td>
        <td class="yellow strong">80.77 %</td>
        <td>46</td>
        <td>26</td>
        <td>21</td>
        <td>5</td>
        <td>12.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#dc1bb52ce14a0e4648cb26785838844a6079a675" class="src_link" title="app/helpers/topics_helper.rb">app/helpers/topics_helper.rb</a></td>
        <td class="yellow strong">89.19 %</td>
        <td>68</td>
        <td>37</td>
        <td>33</td>
        <td>4</td>
        <td>11.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f08433aab6ae7d065a9b1592c7c7a5f972bbe5d5" class="src_link" title="app/helpers/user_helper.rb">app/helpers/user_helper.rb</a></td>
        <td class="green strong">94.74 %</td>
        <td>75</td>
        <td>38</td>
        <td>36</td>
        <td>2</td>
        <td>8.1</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent"><span class="green">93.97%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         53.04
       </span>
    </span> hits/line)
  </h2>
  <a name="Libraries"></a>
  <div>
    <b>28</b> files in total.
    <b>663</b> relevant lines. 
    <span class="green"><b>623</b> lines covered</span> and
    <span class="red"><b>40</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#66cebf0bc2525f154a5cf525408d7d167ad6e8ec" class="src_link" title="lib/ccml.rb">lib/ccml.rb</a></td>
        <td class="green strong">93.83 %</td>
        <td>421</td>
        <td>81</td>
        <td>76</td>
        <td>5</td>
        <td>23.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5dd11277b29118acf976bf0a3c8e8a6212c23c56" class="src_link" title="lib/ccml/error.rb">lib/ccml/error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#84a8d4feacbed4c375a321530f6b6457f0b37e25" class="src_link" title="lib/ccml/error/base.rb">lib/ccml/error/base.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>10.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6868b0d0b7b2022f228cac813d3de8850c356971" class="src_link" title="lib/ccml/error/external_source_error.rb">lib/ccml/error/external_source_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#829f26b66a34b2ec40243a549fb53f4441eb25fe" class="src_link" title="lib/ccml/error/malformed_tag_error.rb">lib/ccml/error/malformed_tag_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e620459a6311b9c01b2bd451fa9ee17d1187bf12" class="src_link" title="lib/ccml/error/not_implemented_error.rb">lib/ccml/error/not_implemented_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3f0f7bc09096c69f14328c17a24fd3b6411bd34e" class="src_link" title="lib/ccml/error/tag_base_class_in_template_error.rb">lib/ccml/error/tag_base_class_in_template_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fcddb7d047616e54828e2f97e0286202046e8bb0" class="src_link" title="lib/ccml/error/tag_class_not_found_error.rb">lib/ccml/error/tag_class_not_found_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#01fa0f257ffcbed1167196b67a42d181cc3b7eb8" class="src_link" title="lib/ccml/error/tag_method_not_found_error.rb">lib/ccml/error/tag_method_not_found_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#016a054b890b816b5479278edc9ca11ac6c01d24" class="src_link" title="lib/ccml/error/template_error.rb">lib/ccml/error/template_error.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#69b74fc1c322d99e9b1fdd32c40d0b3217134157" class="src_link" title="lib/ccml/tag.rb">lib/ccml/tag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#014c5c82d3434398cb37820f1879386ca96f9682" class="src_link" title="lib/ccml/tag/base.rb">lib/ccml/tag/base.rb</a></td>
        <td class="green strong">98.81 %</td>
        <td>142</td>
        <td>84</td>
        <td>83</td>
        <td>1</td>
        <td>62.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7eb246b38c921e65133e6035b1d736618b519d40" class="src_link" title="lib/ccml/tag/curated_feed_tag.rb">lib/ccml/tag/curated_feed_tag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>64</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>2.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#11dbac660417413c9f715428b011e50e61d6e77e" class="src_link" title="lib/ccml/tag/issue_tag.rb">lib/ccml/tag/issue_tag.rb</a></td>
        <td class="red strong">78.57 %</td>
        <td>163</td>
        <td>42</td>
        <td>33</td>
        <td>9</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#019a230d8f9dcb119ee73193d4cabb2dbe8634fa" class="src_link" title="lib/ccml/tag/route_tag.rb">lib/ccml/tag/route_tag.rb</a></td>
        <td class="red strong">65.38 %</td>
        <td>67</td>
        <td>26</td>
        <td>17</td>
        <td>9</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8461935e1a79144882aff854e1143e710d6d942f" class="src_link" title="lib/ccml/tag/rss_tag.rb">lib/ccml/tag/rss_tag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>196</td>
        <td>70</td>
        <td>70</td>
        <td>0</td>
        <td>16.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#dead7b191e5d38577e37f3d861a993f25df6dbeb" class="src_link" title="lib/ccml/tag/single_tag.rb">lib/ccml/tag/single_tag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#708387224c3ee97e9f1f39b9144d04d7bb247c96" class="src_link" title="lib/ccml/tag/tag_pair.rb">lib/ccml/tag/tag_pair.rb</a></td>
        <td class="green strong">97.47 %</td>
        <td>161</td>
        <td>79</td>
        <td>77</td>
        <td>2</td>
        <td>296.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bb1541a67ddcb1a77fd0050cf7879876a2f61dba" class="src_link" title="lib/ccml/tag/vote_tag.rb">lib/ccml/tag/vote_tag.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>21</td>
        <td>8</td>
        <td>7</td>
        <td>1</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#14144a7d11c0b597d23d17b11a3d0a070a10f603" class="src_link" title="lib/filter_constraint.rb">lib/filter_constraint.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>11</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>7.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4c7d2254f8b4921fed71b9af6d6fa2b1509ea300" class="src_link" title="lib/generic_object.rb">lib/generic_object.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>12</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#765e8112e4aa74d57d547d1520d701a28ee1bab8" class="src_link" title="lib/geometry_for_style.rb">lib/geometry_for_style.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>2</td>
        <td>2</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#91868468c438398539081cb50e150532e25cb9bc" class="src_link" title="lib/ingester.rb">lib/ingester.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>193</td>
        <td>60</td>
        <td>60</td>
        <td>0</td>
        <td>25.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#059d7c1b738435adb1dde9bd87fa6691b463c15f" class="src_link" title="lib/parent_validator.rb">lib/parent_validator.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>16</td>
        <td>6</td>
        <td>4</td>
        <td>2</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0606951742d5a7f85388fcc8b32f54d971527c10" class="src_link" title="lib/s3_config.rb">lib/s3_config.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>4.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c044a9faf0a3b47c502c6aea47ac8cf8bca86ab4" class="src_link" title="lib/unsubscribe_someone.rb">lib/unsubscribe_someone.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ae77079de42d9035fcfdca96dbf5210d7645eb36" class="src_link" title="lib/utilities/conversation_utilities.rb">lib/utilities/conversation_utilities.rb</a></td>
        <td class="yellow strong">86.21 %</td>
        <td>76</td>
        <td>29</td>
        <td>25</td>
        <td>4</td>
        <td>9.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fcb598f6074259d87e0b26e14bb0b914a4dd9043" class="src_link" title="lib/utilities/person_utilities.rb">lib/utilities/person_utilities.rb</a></td>
        <td class="green strong">97.8 %</td>
        <td>132</td>
        <td>91</td>
        <td>89</td>
        <td>2</td>
        <td>13.0</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent"><span class="yellow">81.16%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         260.4
       </span>
    </span> hits/line)
  </h2>
  <a name="Mailers"></a>
  <div>
    <b>1</b> files in total.
    <b>69</b> relevant lines. 
    <span class="green"><b>56</b> lines covered</span> and
    <span class="red"><b>13</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#09397abb38f3a2a03e95e80788bc6f4d6ee2d420" class="src_link" title="app/mailers/notifier.rb">app/mailers/notifier.rb</a></td>
        <td class="yellow strong">81.16 %</td>
        <td>117</td>
        <td>69</td>
        <td>56</td>
        <td>13</td>
        <td>260.4</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent"><span class="green">91.55%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         94.42
       </span>
    </span> hits/line)
  </h2>
  <a name="Models"></a>
  <div>
    <b>59</b> files in total.
    <b>1834</b> relevant lines. 
    <span class="green"><b>1679</b> lines covered</span> and
    <span class="red"><b>155</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#c115ea5002c674a49b46b6d86b31cc11a2b62284" class="src_link" title="app/models/ability.rb">app/models/ability.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>65</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>118.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ded849bb54e2138b73765ab3526f557c41496185" class="src_link" title="app/models/action.rb">app/models/action.rb</a></td>
        <td class="yellow strong">85.71 %</td>
        <td>26</td>
        <td>14</td>
        <td>12</td>
        <td>2</td>
        <td>1.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0498eca24dd96eeebb1b0e1c7e958549bfd7a8e5" class="src_link" title="app/models/activity.rb">app/models/activity.rb</a></td>
        <td class="yellow strong">89.91 %</td>
        <td>216</td>
        <td>109</td>
        <td>98</td>
        <td>11</td>
        <td>109.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6d5ed5496b177122b9c3f04947ff466c238cc2b1" class="src_link" title="app/models/article.rb">app/models/article.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>25</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#24dfc110c9faf558d0677d530d575aa642473dc2" class="src_link" title="app/models/authentication.rb">app/models/authentication.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>4.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f25f2e42baefd34e7883b980512df3d7e797901b" class="src_link" title="app/models/ckeditor/asset.rb">app/models/ckeditor/asset.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6d673350c800d0734653dc45024d04b682c700b3" class="src_link" title="app/models/ckeditor/attachment_file.rb">app/models/ckeditor/attachment_file.rb</a></td>
        <td class="red strong">75.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>3</td>
        <td>1</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#badadc0cc745c070e75f35c6a4749a6c81bf0cd3" class="src_link" title="app/models/ckeditor/picture.rb">app/models/ckeditor/picture.rb</a></td>
        <td class="red strong">75.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>3</td>
        <td>1</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1b22f59c78815e9eb30a54336160998329fecfcb" class="src_link" title="app/models/content_item.rb">app/models/content_item.rb</a></td>
        <td class="green strong">95.6 %</td>
        <td>188</td>
        <td>91</td>
        <td>87</td>
        <td>4</td>
        <td>12.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e90618e81fda42c6d152e6384bc72b7b8f7842dc" class="src_link" title="app/models/content_item_description.rb">app/models/content_item_description.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>4.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3696d16bb3955de3b84ed437576802c673ad9c44" class="src_link" title="app/models/content_item_link.rb">app/models/content_item_link.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3b868cbbd80612a99f16857854af45fa2673b015" class="src_link" title="app/models/content_items_conversation.rb">app/models/content_items_conversation.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#92eedf1790759f0a1cc1e40955eaa090fd5948a4" class="src_link" title="app/models/content_items_person.rb">app/models/content_items_person.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d99e91460859931ed6cecc94083b0079f9faef7d" class="src_link" title="app/models/content_items_topic.rb">app/models/content_items_topic.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d77d3bbcdcd53984a917ed4fa34059314406fe64" class="src_link" title="app/models/content_template.rb">app/models/content_template.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>16</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>5.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f873abec6c9ba57a98d981884c906b9f662dbc27" class="src_link" title="app/models/contribution.rb">app/models/contribution.rb</a></td>
        <td class="yellow strong">84.15 %</td>
        <td>350</td>
        <td>164</td>
        <td>138</td>
        <td>26</td>
        <td>37.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0727df4162b0875a3f9ba973ce76b27204209292" class="src_link" title="app/models/conversation.rb">app/models/conversation.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>390</td>
        <td>200</td>
        <td>175</td>
        <td>25</td>
        <td>54.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bf60ae24ffa1c8ebbdb2633af61f66bd675b4305" class="src_link" title="app/models/conversations_person.rb">app/models/conversations_person.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a5afd10a65ce889689ceba3f4c798f0c212c700b" class="src_link" title="app/models/conversations_topic.rb">app/models/conversations_topic.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#37ffb718fc6d36625ef8842cb6d63a9b95c1185c" class="src_link" title="app/models/county.rb">app/models/county.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#845fc5cc9e7c7734e4636d1ed249328dbf06c3cd" class="src_link" title="app/models/curated_feed.rb">app/models/curated_feed.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>15</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>8.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#45687ff8a36303a4085809e37dccaedd368eb9c0" class="src_link" title="app/models/curated_feed_item.rb">app/models/curated_feed_item.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>74</td>
        <td>45</td>
        <td>45</td>
        <td>0</td>
        <td>9.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4437993eb1794d7d4870c0abfb8cb777a31738cc" class="src_link" title="app/models/email_restriction.rb">app/models/email_restriction.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#09acf8feb722ef74d325c80c844d9cb20a2fbe9d" class="src_link" title="app/models/featured_opportunity.rb">app/models/featured_opportunity.rb</a></td>
        <td class="red strong">75.0 %</td>
        <td>20</td>
        <td>12</td>
        <td>9</td>
        <td>3</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#680a5bc315bb1faa10f78e6e93a25b4482c8ccd6" class="src_link" title="app/models/homepage_featured.rb">app/models/homepage_featured.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>21</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>3.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#47cf9b09925af3e73fc7beae521f90c3920ec86e" class="src_link" title="app/models/invite.rb">app/models/invite.rb</a></td>
        <td class="green strong">93.75 %</td>
        <td>68</td>
        <td>32</td>
        <td>30</td>
        <td>2</td>
        <td>4.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4d3fe8c348257031543f19b442e44078c9169f7d" class="src_link" title="app/models/issue.rb">app/models/issue.rb</a></td>
        <td class="green strong">93.33 %</td>
        <td>255</td>
        <td>135</td>
        <td>126</td>
        <td>9</td>
        <td>44.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#95317e25da27133a7e60dd2d2fd8a4e3996a5454" class="src_link" title="app/models/issues_topic.rb">app/models/issues_topic.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4d63446d3112c6fcd9a29d09e0ff8f244ce11a2f" class="src_link" title="app/models/managed_issue.rb">app/models/managed_issue.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>28</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>17.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d6fa366d057df9a2bd4dee638f658a138b10190a" class="src_link" title="app/models/managed_issue_page.rb">app/models/managed_issue_page.rb</a></td>
        <td class="yellow strong">88.46 %</td>
        <td>53</td>
        <td>26</td>
        <td>23</td>
        <td>3</td>
        <td>10.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1ac2ac381b4d3eadac56d70df897463fd2d10a0b" class="src_link" title="app/models/metro_region.rb">app/models/metro_region.rb</a></td>
        <td class="red strong">45.24 %</td>
        <td>76</td>
        <td>42</td>
        <td>19</td>
        <td>23</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c1dd906fcb9813625222821f95fbf7004662e55a" class="src_link" title="app/models/must_be_logged_in_validator.rb">app/models/must_be_logged_in_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>305.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5bfbfb1940b2cb74020f040ab3a54e1765f1e7c1" class="src_link" title="app/models/notification.rb">app/models/notification.rb</a></td>
        <td class="green strong">91.5 %</td>
        <td>384</td>
        <td>200</td>
        <td>183</td>
        <td>17</td>
        <td>28.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#408e449ce5258753d7df0bf7d1850f4d7cdb8c49" class="src_link" title="app/models/organization.rb">app/models/organization.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>37</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>1.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4dd7e370970bdc6fa2e35cbe8191771d0ab0f74b" class="src_link" title="app/models/organization_detail.rb">app/models/organization_detail.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>5</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>2.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#97d7d59418146858c971dfe0e64fce03454b1c9f" class="src_link" title="app/models/organization_member.rb">app/models/organization_member.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#acce817e34a6719cc32dd254ee768a8eb1c6497d" class="src_link" title="app/models/password_salt_validator.rb">app/models/password_salt_validator.rb</a></td>
        <td class="red strong">60.0 %</td>
        <td>15</td>
        <td>5</td>
        <td>3</td>
        <td>2</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3ea6b67d6d5018ec766b7d50f10ee965a6fe72ad" class="src_link" title="app/models/person.rb">app/models/person.rb</a></td>
        <td class="green strong">94.58 %</td>
        <td>501</td>
        <td>240</td>
        <td>227</td>
        <td>13</td>
        <td>503.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8af5b8f3eada80c653b20f8d09268d15c9896fa7" class="src_link" title="app/models/petition.rb">app/models/petition.rb</a></td>
        <td class="green strong">96.55 %</td>
        <td>62</td>
        <td>29</td>
        <td>28</td>
        <td>1</td>
        <td>6.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#88bfd596fb0b3d3ac8cbe26f6e15a004f8fd31d7" class="src_link" title="app/models/petition_signature.rb">app/models/petition_signature.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>16</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>8.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#635696a40b4e1cfb31c07df903514520db7969bc" class="src_link" title="app/models/rating.rb">app/models/rating.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>45</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#89b31a44bfc86e9ebfc21bea2f327c398be6cb1d" class="src_link" title="app/models/rating_descriptor.rb">app/models/rating_descriptor.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5b262c98280ce4cf7967fbe9a5869ea1720d9f22" class="src_link" title="app/models/rating_group.rb">app/models/rating_group.rb</a></td>
        <td class="green strong">98.48 %</td>
        <td>134</td>
        <td>66</td>
        <td>65</td>
        <td>1</td>
        <td>6.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#255aaf2611ca8a7f87b3edbbba3695444ea5f607" class="src_link" title="app/models/rating_group_validator.rb">app/models/rating_group_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>27.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0af9b1fdf40780c8e5c0011c1bbdb44855043b4b" class="src_link" title="app/models/reflection.rb">app/models/reflection.rb</a></td>
        <td class="yellow strong">86.36 %</td>
        <td>42</td>
        <td>22</td>
        <td>19</td>
        <td>3</td>
        <td>1.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7455efe5fd2d48c76e5d7e16070187354c97099e" class="src_link" title="app/models/reflection_comment.rb">app/models/reflection_comment.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>14</td>
        <td>8</td>
        <td>7</td>
        <td>1</td>
        <td>4.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bb219b626c68e671b095dbde49fd60412a3fe6e7" class="src_link" title="app/models/region.rb">app/models/region.rb</a></td>
        <td class="green strong">97.56 %</td>
        <td>76</td>
        <td>41</td>
        <td>40</td>
        <td>1</td>
        <td>4.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#de8dff9cd6a6e7676911dcec6773d271b1a624d8" class="src_link" title="app/models/selected_survey_option.rb">app/models/selected_survey_option.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>15</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>41.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#acbdae30cdb48eda0d2b9f25af8bf18904c8c8ab" class="src_link" title="app/models/subscription.rb">app/models/subscription.rb</a></td>
        <td class="red strong">79.17 %</td>
        <td>41</td>
        <td>24</td>
        <td>19</td>
        <td>5</td>
        <td>73.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e324c3e77f8c26a3561821ce67a11f0261f36d01" class="src_link" title="app/models/survey.rb">app/models/survey.rb</a></td>
        <td class="green strong">97.92 %</td>
        <td>96</td>
        <td>48</td>
        <td>47</td>
        <td>1</td>
        <td>29.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#249e3ffb105ff526c2ed72721d2eb1835652ed09" class="src_link" title="app/models/survey_option.rb">app/models/survey_option.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>35.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#39a5cb0880f9b322df541f395a3315718c831c8a" class="src_link" title="app/models/survey_response.rb">app/models/survey_response.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>61</td>
        <td>37</td>
        <td>37</td>
        <td>0</td>
        <td>48.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4cb3cd71524bb20c4541042cb0b4c7b593e072f0" class="src_link" title="app/models/survey_types/poll.rb">app/models/survey_types/poll.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e6d58b9c006125f3b64dbd018b3d68283e88427c" class="src_link" title="app/models/survey_types/vote.rb">app/models/survey_types/vote.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>3</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#53c3c4e0d895f3c53ef7cfc6deca808f641e9bdc" class="src_link" title="app/models/topic.rb">app/models/topic.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>73</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>5.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ecd84707ecff22df187c8d48de732b47e7a045eb" class="src_link" title="app/models/tos.rb">app/models/tos.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>1.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#03c4ab388197f81069c9e3c5a1e545eeb6ea9bc8" class="src_link" title="app/models/visit.rb">app/models/visit.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9417236037f905386d5cb80b6a9b18889990efea" class="src_link" title="app/models/widget_log.rb">app/models/widget_log.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>42</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>5.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#428ffab92377ae8f42e75ad6ac4500893199723b" class="src_link" title="app/models/zip_code.rb">app/models/zip_code.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Observers">
  <h2>
    <span class="group_name">Observers</span>
    (<span class="covered_percent"><span class="green">93.1%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         33.34
       </span>
    </span> hits/line)
  </h2>
  <a name="Observers"></a>
  <div>
    <b>3</b> files in total.
    <b>29</b> relevant lines. 
    <span class="green"><b>27</b> lines covered</span> and
    <span class="red"><b>2</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#17b71720d95612d1d897ca910d984b434ba147a8" class="src_link" title="app/observers/activity_observer.rb">app/observers/activity_observer.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>36</td>
        <td>16</td>
        <td>14</td>
        <td>2</td>
        <td>37.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3576ff2666215e373495169d2ee93e6c2a54cc0e" class="src_link" title="app/observers/notification_observer.rb">app/observers/notification_observer.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>22</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>24.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3c967247385bcacce1870de0fd7ca7101d368332" class="src_link" title="app/observers/person_observer.rb">app/observers/person_observer.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>40.7</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Services">
  <h2>
    <span class="group_name">Services</span>
    (<span class="covered_percent"><span class="red">77.37%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         35.12
       </span>
    </span> hits/line)
  </h2>
  <a name="Services"></a>
  <div>
    <b>9</b> files in total.
    <b>579</b> relevant lines. 
    <span class="green"><b>448</b> lines covered</span> and
    <span class="red"><b>131</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#d9df10f5219ad23243c1ec6b5690500b23be24da" class="src_link" title="app/services/avatar_service.rb">app/services/avatar_service.rb</a></td>
        <td class="green strong">93.75 %</td>
        <td>61</td>
        <td>32</td>
        <td>30</td>
        <td>2</td>
        <td>78.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5d883922a643e8f0f1d1fccbb301c1060d2fd16e" class="src_link" title="app/services/digest_service.rb">app/services/digest_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>209</td>
        <td>89</td>
        <td>89</td>
        <td>0</td>
        <td>16.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f909e6a77b0188250de2f1afa724603b93172411" class="src_link" title="app/services/embedly_service.rb">app/services/embedly_service.rb</a></td>
        <td class="yellow strong">84.54 %</td>
        <td>366</td>
        <td>207</td>
        <td>175</td>
        <td>32</td>
        <td>55.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#41856a5a13d806968aaa6c50a3bb8b716e7958c1" class="src_link" title="app/services/member_export_service.rb">app/services/member_export_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>29</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>16.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#addf6df3dd00c4232e688bdf9e59eafda93d2a6e" class="src_link" title="app/services/participation_service.rb">app/services/participation_service.rb</a></td>
        <td class="red strong">67.65 %</td>
        <td>104</td>
        <td>34</td>
        <td>23</td>
        <td>11</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ffe4fcdd5e9a152c386b8aa20d27fc3ef6d711ca" class="src_link" title="app/services/petition_print_service.rb">app/services/petition_print_service.rb</a></td>
        <td class="red strong">18.46 %</td>
        <td>136</td>
        <td>65</td>
        <td>12</td>
        <td>53</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cff9992a50770b00c31ec9988e99d74ddeb68186" class="src_link" title="app/services/search_service.rb">app/services/search_service.rb</a></td>
        <td class="red strong">40.0 %</td>
        <td>95</td>
        <td>55</td>
        <td>22</td>
        <td>33</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e042531bb8a3ebd0d8af83c31ed056ff062ce258" class="src_link" title="app/services/spam_service.rb">app/services/spam_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>32</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>140.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8952029e12444817cd6194faf2b5f8756c978eb5" class="src_link" title="app/services/vote_progress_service.rb">app/services/vote_progress_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>168</td>
        <td>71</td>
        <td>71</td>
        <td>0</td>
        <td>30.5</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Presenters">
  <h2>
    <span class="group_name">Presenters</span>
    (<span class="covered_percent"><span class="red">76.92%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         69.23
       </span>
    </span> hits/line)
  </h2>
  <a name="Presenters"></a>
  <div>
    <b>11</b> files in total.
    <b>247</b> relevant lines. 
    <span class="green"><b>190</b> lines covered</span> and
    <span class="red"><b>57</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#ef0307ec34164465aea476a4f6504d2dbfed8dfa" class="src_link" title="app/presenters/contribution_presenter.rb">app/presenters/contribution_presenter.rb</a></td>
        <td class="red strong">50.0 %</td>
        <td>58</td>
        <td>32</td>
        <td>16</td>
        <td>16</td>
        <td>0.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#03ce8934637f148c00b3169948249cef43399310" class="src_link" title="app/presenters/conversation_presenter.rb">app/presenters/conversation_presenter.rb</a></td>
        <td class="red strong">66.67 %</td>
        <td>7</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#54f9987f72e16a72b655bea415ccdc48f488671a" class="src_link" title="app/presenters/ingest_presenter.rb">app/presenters/ingest_presenter.rb</a></td>
        <td class="red strong">29.03 %</td>
        <td>63</td>
        <td>31</td>
        <td>9</td>
        <td>22</td>
        <td>0.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ca09b8864ae36b9bee2e5bb939486e13f902319b" class="src_link" title="app/presenters/issue_presenter.rb">app/presenters/issue_presenter.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f6e122baf748cd4ed3aa6baa050878b5963e266e" class="src_link" title="app/presenters/presenter_base.rb">app/presenters/presenter_base.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>15</td>
        <td>8</td>
        <td>8</td>
        <td>0</td>
        <td>190.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5d00741ced9b6403d678149ebff4ea90552b649c" class="src_link" title="app/presenters/presenter_form.rb">app/presenters/presenter_form.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>4.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#85c482c2c341714d2fad1a556d7381fce795d920" class="src_link" title="app/presenters/profile_presenter.rb">app/presenters/profile_presenter.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>110</td>
        <td>60</td>
        <td>60</td>
        <td>0</td>
        <td>13.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e26e899dd21d09c385f2a644888f8aa9133e0b9a" class="src_link" title="app/presenters/promotion_form_presenter.rb">app/presenters/promotion_form_presenter.rb</a></td>
        <td class="red strong">63.16 %</td>
        <td>41</td>
        <td>19</td>
        <td>12</td>
        <td>7</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#702ba21f54f2e4b703df31d0018ea1627fc4cdb7" class="src_link" title="app/presenters/registration_form_presenter.rb">app/presenters/registration_form_presenter.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>9.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#115a89b41a9a2dcc416560c56b49d0c703300664" class="src_link" title="app/presenters/subscription_presenter.rb">app/presenters/subscription_presenter.rb</a></td>
        <td class="red strong">45.0 %</td>
        <td>39</td>
        <td>20</td>
        <td>9</td>
        <td>11</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f20cf6b9bd30aaf2119442e0f2a0547630f62e9e" class="src_link" title="app/presenters/vote_response_presenter.rb">app/presenters/vote_response_presenter.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>118</td>
        <td>57</td>
        <td>57</td>
        <td>0</td>
        <td>256.2</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Ungrouped">
  <h2>
    <span class="group_name">Ungrouped</span>
    (<span class="covered_percent"><span class="red">80.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.77
       </span>
    </span> hits/line)
  </h2>
  <a name="Ungrouped"></a>
  <div>
    <b>2</b> files in total.
    <b>20</b> relevant lines. 
    <span class="green"><b>16</b> lines covered</span> and
    <span class="red"><b>4</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#e2b1f41a0e9d04a507f530bd1532b728e1805100" class="src_link" title="app/uploaders/ckeditor_attachment_file_uploader.rb">app/uploaders/ckeditor_attachment_file_uploader.rb</a></td>
        <td class="red strong">71.43 %</td>
        <td>42</td>
        <td>7</td>
        <td>5</td>
        <td>2</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#80120a5a19d462217fc47d88af1f9fdf6cc1a185" class="src_link" title="app/uploaders/ckeditor_picture_uploader.rb">app/uploaders/ckeditor_picture_uploader.rb</a></td>
        <td class="yellow strong">84.62 %</td>
        <td>53</td>
        <td>13</td>
        <td>11</td>
        <td>2</td>
        <td>0.8</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.8.2 
        and simplecov-html v0.8.0<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="9be8441f03d44cebd6e6d3c333aae0f5d3472c13">
  <div class="header">
    <h3>app/concerns/homepage_featurable.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module HomepageFeaturable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.included(base)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="3">
          <span class="hits">2</span>
          
          <code class="ruby">    base.has_one :homepage_featured, as: :homepage_featureable</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="4">
          <span class="hits">2</span>
          
          <code class="ruby">    base.extend(Scopes)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def featured?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="8">
          <span class="hits">4</span>
          
          <code class="ruby">    not self.homepage_featured.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  module Scopes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    def featured</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="13">
          <span class="hits">2</span>
          
          <code class="ruby">      includes(:homepage_featured).where('homepage_featureds.homepage_featureable_id IS NOT NULL')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="eda2b5bdfbf193f32b4d2f8f163e3c5992a81b04">
  <div class="header">
    <h3>app/concerns/regionable.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Regionable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def region</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="4">
          <span class="hits">2</span>
          
          <code class="ruby">    region = Region.find_by_zip_code(self.zip_code)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="5">
          <span class="hits">2</span>
          
          <code class="ruby">    region ||= Region.default</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">#  TODO: i would've liked for this to work, but it wasn't always loaded at the right time so i moved it to region.rb</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">#  def self.included(base)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">#    # if regionable is included in Issue, then it will create a method to return all issues for a region</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">#    new_method = base.to_s.downcase.pluralize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">#    Region.class_eval &lt;&lt;-ruby_eval, __FILE__, __LINE__ + 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">#      def #{new_method}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">#        where_clause = &quot;zip_code NOT IN (SELECT DISTINCT zip_code FROM zip_codes)&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">#        where_clause = &quot;zip_code IN (&quot; + zip_code_string.gsub(/\n/,&quot;,&quot;) + &quot;)&quot; unless self.name == Region.default_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">#        return #{base.to_s}.where(where_clause)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">#      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">#    ruby_eval</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">#  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d17d49d33c1ec3a8d495fee440356769d15a1967">
  <div class="header">
    <h3>app/concerns/subscribable.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Subscribable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def subscribe(subscriber)</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="3">
          <span class="hits">20</span>
          
          <code class="ruby">    Subscription.find_or_create_by_subscribable_id_and_subscribable_type_and_person_id(self.id, self.class.to_s, subscriber.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def unsubscribe(subscriber)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="7">
          <span class="hits">3</span>
          
          <code class="ruby">    Subscription.where(:subscribable_id =&gt; self.id, :subscribable_type =&gt; self.class, :person_id =&gt; subscriber).delete_all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def subscribers</code>
        </li>
      
        <li class="covered" data-hits="142" data-linenumber="11">
          <span class="hits">142</span>
          
          <code class="ruby">    Subscription.where(:subscribable_id =&gt; self.id, :subscribable_type =&gt; self.class).collect{|subscription| subscription.person}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def friendly_name</code>
        </li>
      
        <li class="covered" data-hits="69" data-linenumber="15">
          <span class="hits">69</span>
          
          <code class="ruby">    self.class.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fa8c811dbb6773ac5615f6cd607fae10ec5653e9">
  <div class="header">
    <h3>app/concerns/thumbnail.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Thumbnail</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def custom_image?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="3">
          <span class="hits">5</span>
          
          <code class="ruby">    self.image &amp;&amp; !self.default_image?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def default_image(style='original')</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="7">
          <span class="hits">10</span>
          
          <code class="ruby">    if self.class.attachment_definitions[:image][:default_url]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="8">
          <span class="hits">6</span>
          
          <code class="ruby">      self.class.attachment_definitions[:image][:default_url].gsub(/\:style/, style).to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def default_image?(style='original')</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">    default_image = default_image(style)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">    default_image &amp;&amp; self.image.to_s == default_image</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="14cecadfe027e0503059e023d4d3ff7a235b6ff3">
  <div class="header">
    <h3>app/concerns/visitable.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Visitable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  module ClassMethods</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_top_visited(options = {})</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="5">
          <span class="hits">6</span>
          
          <code class="ruby">      options.reverse_merge!(filter:0, limit:10)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="6">
          <span class="hits">6</span>
          
          <code class="ruby">      filter = options[:filter]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="7">
          <span class="hits">6</span>
          
          <code class="ruby">      filter = [filter] unless options[:filter].respond_to?(:flatten) || filter.nil?</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="8">
          <span class="hits">6</span>
          
          <code class="ruby">      filter.flatten!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="10">
          <span class="hits">6</span>
          
          <code class="ruby">      self.where(&quot;#{self.table_name}.last_visit_date &gt;= '#{(Time.now - 30.days)}'&quot;).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">           where(&quot;#{self.table_name}.id not in (?)&quot;, filter).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">           order(&quot;#{self.table_name}.recent_visits DESC&quot;).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">           limit(options[:limit])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.included(base)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="18">
          <span class="hits">3</span>
          
          <code class="ruby">    base.has_many :visits, :as =&gt; :visitable</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="19">
          <span class="hits">3</span>
          
          <code class="ruby">    base.extend(ClassMethods)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def visit(user_id)</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="23">
          <span class="hits">37</span>
          
          <code class="ruby">    self.visits &lt;&lt; Visit.new({:person_id=&gt;user_id})</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="24">
          <span class="hits">37</span>
          
          <code class="ruby">    self.total_visits ||= 0</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="25">
          <span class="hits">37</span>
          
          <code class="ruby">    self.total_visits = self.total_visits + 1</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="26">
          <span class="hits">37</span>
          
          <code class="ruby">    self.last_visit_date = Time.now</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="27">
          <span class="hits">37</span>
          
          <code class="ruby">    self.recent_visits = calculate_recent_visits</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def visit!(user_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    # We don't want to change the update_at time during a visit tracking only during real changes.</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="32">
          <span class="hits">21</span>
          
          <code class="ruby">    self.class.record_timestamps = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="34">
          <span class="hits">21</span>
          
          <code class="ruby">    self.visit(user_id)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="35">
          <span class="hits">21</span>
          
          <code class="ruby">    self.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="37">
          <span class="hits">21</span>
          
          <code class="ruby">    self.class.record_timestamps = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def calculate_recent_visits</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="41">
          <span class="hits">40</span>
          
          <code class="ruby">    self.visits.where(&quot;created_at &gt;= '#{(Time.now - 30.days)}'&quot;).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7e7b9bc573e4cf12e1df3de0fe4c75f61b2d2e18">
  <div class="header">
    <h3>app/concerns/you_tubeable.rb</h3>
    <h4><span class="green">93.75 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module YouTubeable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.included(base)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    base.before_save :embed_youtube_video, :if =&gt; [:youtube_link?]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    base.validates :url, :you_tubeable =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  YOUTUBE_REGEX = /^http:\/\/www\.youtube\.com\/watch\?.*v=([-\d\w]+).*/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def youtube_link?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="11">
          <span class="hits">3</span>
          
          <code class="ruby">    YOUTUBE_REGEX.match(self.url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def embed_youtube_video</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="15">
          <span class="hits">3</span>
          
          <code class="ruby">    video_id = self.url.gsub(YOUTUBE_REGEX, '\1')</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="16">
          <span class="hits">3</span>
          
          <code class="ruby">    if self.respond_to?(:youtube_id)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="17">
          <span class="hits">3</span>
          
          <code class="ruby">      self.youtube_id = video_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="19">
          <span class="hits">3</span>
          
          <code class="ruby">    self.embed_target = embed_code_for_video(video_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def embed_code_for_video(video_id)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="23">
          <span class="hits">3</span>
          
          <code class="ruby">    &quot;&lt;object width='300' height='180'&gt;&lt;param name='wmode' value='opaque'&gt;&lt;/param&gt;&lt;param name='movie' value='http://www.youtube.com/v/#{video_id}?fs=1&amp;amp;hl=en_US'&gt;&lt;/param&gt;&lt;param name='allowFullScreen' value='true'&gt;&lt;/param&gt;&lt;param name='allowscriptaccess' value='always'&gt;&lt;/param&gt;&lt;embed wmode='opaque' src='http://www.youtube.com/v/#{video_id}?fs=1&amp;amp;hl=en_US' type='application/x-shockwave-flash' allowscriptaccess='always' allowfullscreen='true' width='300' height='180'&gt;&lt;/embed&gt;&lt;/object&gt;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def you_tubeable?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="411b0671206a1baff9e77ce49e6b357a989a736b">
  <div class="header">
    <h3>app/concerns/you_tubeable_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class YouTubeableValidator &lt; ActiveModel::EachValidator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_each(record, attribute, value)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="4">
          <span class="hits">8</span>
          
          <code class="ruby">    record.errors[attribute] &lt;&lt; &quot;Link is not a valid YouTube URL&quot; unless valid_youtube_url_format?(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def valid_youtube_url_format?(url)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="8">
          <span class="hits">8</span>
          
          <code class="ruby">    url =~ YouTubeable::YOUTUBE_REGEX || url.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c961881ef367b97f221bcf9d77da49b8a079d6d0">
  <div class="header">
    <h3>app/controllers/actions_controller.rb</h3>
    <h4><span class="yellow">84.62 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ActionsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout 'opportunity'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :find_conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="7">
          <span class="hits">12</span>
          
          <code class="ruby">    @actions = @conversation.actions.order('id DESC')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="9">
          <span class="hits">12</span>
          
          <code class="ruby">    if (params[:type] == 'petition')</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">      @actions = @actions.where(actionable_type:&quot;Petition&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="12">
          <span class="hits">12</span>
          
          <code class="ruby">    if (params[:type] == 'ballot')</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      @actions = @actions.where(actionable_type:&quot;Survey&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="15">
          <span class="hits">12</span>
          
          <code class="ruby">    @participants = @conversation.action_participants</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def find_conversation</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="20">
          <span class="hits">12</span>
          
          <code class="ruby">    @conversation = Conversation.find(params[:conversation_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="cf155fe18f1fc24b90a8f2f27958a5f52e1819ce">
  <div class="header">
    <h3>app/controllers/admin/articles_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>33</b> relevant lines. 
      <span class="green"><b>33</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ArticlesController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_articles</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # GET /articles</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # GET /articles.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="8">
          <span class="hits">2</span>
          
          <code class="ruby">    @articles = Article.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="10">
          <span class="hits">2</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="11">
          <span class="hits">2</span>
          
          <code class="ruby">      format.html  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  # GET /articles/1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # GET /articles/1.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    @article = Article.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      format.html  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  # GET /articles/new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  # GET /articles/new.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="28">
          <span class="hits">2</span>
          
          <code class="ruby">    @article = Article.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="30">
          <span class="hits">2</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="31">
          <span class="hits">2</span>
          
          <code class="ruby">      format.html </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  # GET /articles/1/edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">    @article = Article.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  # POST /articles</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  # POST /articles.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="43">
          <span class="hits">4</span>
          
          <code class="ruby">    @article = Article.new(params[:article])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="45">
          <span class="hits">4</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="46">
          <span class="hits">4</span>
          
          <code class="ruby">      if @article.save</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="47">
          <span class="hits">4</span>
          
          <code class="ruby">        format.html { redirect_to(admin_article_path(@article), :notice =&gt; 'Article was successfully created.') }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="49">
          <span class="hits">4</span>
          
          <code class="ruby">        format.html { render :new }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  # PUT /articles/1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  # PUT /articles/1.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="57">
          <span class="hits">5</span>
          
          <code class="ruby">    @article = Article.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="59">
          <span class="hits">5</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="60">
          <span class="hits">5</span>
          
          <code class="ruby">      if @article.update_attributes(params[:article])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="61">
          <span class="hits">4</span>
          
          <code class="ruby">        format.html { redirect_to(admin_article_path(@article), :notice =&gt; 'Article was successfully updated.') }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="63">
          <span class="hits">6</span>
          
          <code class="ruby">        format.html { render :edit }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  # DELETE /articles/1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  # DELETE /articles/1.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="71">
          <span class="hits">2</span>
          
          <code class="ruby">    @article = Article.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="72">
          <span class="hits">2</span>
          
          <code class="ruby">    @article.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="74">
          <span class="hits">2</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="75">
          <span class="hits">4</span>
          
          <code class="ruby">      format.html { redirect_to(admin_articles_url) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5abcf6a9482d2f2d21c099bfd39fef44c116ed84">
  <div class="header">
    <h3>app/controllers/admin/content_item_links_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>25</b> relevant lines. 
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ContentItemLinksController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_content_item_links</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :get_content_item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  #GET admin/content_items/123/links</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="8">
          <span class="hits">5</span>
          
          <code class="ruby">    @links = @content_item.links</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="12">
          <span class="hits">2</span>
          
          <code class="ruby">    @link = @content_item.links.build</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="16">
          <span class="hits">2</span>
          
          <code class="ruby">    @link = @content_item.links.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="20">
          <span class="hits">3</span>
          
          <code class="ruby">    @link = @content_item.links.build(params[:content_item_link])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="21">
          <span class="hits">3</span>
          
          <code class="ruby">    if @link.save</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to admin_content_item_content_item_links_path(@content_item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      render :action =&gt; :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="29">
          <span class="hits">3</span>
          
          <code class="ruby">    @link = @content_item.links.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="30">
          <span class="hits">3</span>
          
          <code class="ruby">    if @link.update_attributes(params[:content_item_link])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="31">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to admin_content_item_content_item_links_path(@content_item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      render :action =&gt; :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    @content_item.links.destroy(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    redirect_to admin_content_item_content_item_links_path(@content_item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_content_item</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="45">
          <span class="hits">16</span>
          
          <code class="ruby">    @content_item = ContentItem.find(params[:content_item_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b6c82854cfc77ace2fef8b4cf4e1a137e18aca09">
  <div class="header">
    <h3>app/controllers/admin/content_items_controller.rb</h3>
    <h4><span class="yellow">85.19 %</span> covered</h4>
    <div>
      <b>81</b> relevant lines. 
      <span class="green"><b>69</b> lines covered</span> and
      <span class="red"><b>12</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ContentItemsController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  load_and_authorize_resource :content_item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  #GET admin/content_items</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="7">
          <span class="hits">22</span>
          
          <code class="ruby">    if params[:type]</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="8">
          <span class="hits">17</span>
          
          <code class="ruby">      @filter = params[:type].classify</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="9">
          <span class="hits">17</span>
          
          <code class="ruby">      @content_items = ContentItem.where(content_type: @filter).order('content_type ASC, published DESC, created_at DESC')</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="10">
          <span class="hits">17</span>
          
          <code class="ruby">      @content_item_description = ContentItemDescription.find_or_initialize_by_content_type(@filter)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="12">
          <span class="hits">5</span>
          
          <code class="ruby">      @filter = 'All'</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="13">
          <span class="hits">5</span>
          
          <code class="ruby">      @content_items = ContentItem.all(order: 'content_type ASC, published DESC, created_at DESC')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="18">
          <span class="hits">20</span>
          
          <code class="ruby">    @content_item = ContentItem.new(params[:content_item])</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="19">
          <span class="hits">20</span>
          
          <code class="ruby">    @authors = Person.where('admin = ? OR blog_admin = ?', true, true).order('first_name, last_name ASC')</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="20">
          <span class="hits">20</span>
          
          <code class="ruby">    @content_item.author = current_person</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="21">
          <span class="hits">20</span>
          
          <code class="ruby">    @content_item.published = Date.today</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="22">
          <span class="hits">20</span>
          
          <code class="ruby">    @topics = Topic.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="26">
          <span class="hits">24</span>
          
          <code class="ruby">    unless params[:summary_preview].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">      redirect_to summary_preview</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="30">
          <span class="hits">24</span>
          
          <code class="ruby">    @content_item = ContentItem.new(params[:content_item])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="32">
          <span class="hits">24</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="33">
          <span class="hits">24</span>
          
          <code class="ruby">      error = false</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="34">
          <span class="hits">24</span>
          
          <code class="ruby">      @content_item.published = params[:content_item][:published] ? Date.strptime(params[:content_item][:published], &quot;%m/%d/%Y&quot;) : Date.today </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    rescue</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="36">
          <span class="hits">3</span>
          
          <code class="ruby">      error = true</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="37">
          <span class="hits">3</span>
          
          <code class="ruby">      @content_item.errors.add :published, &quot;invalid date&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="40">
          <span class="hits">24</span>
          
          <code class="ruby">    @content_item.embed_code = get_embed_code_from_embedly(@content_item.external_link, @content_item.embed_code) unless error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="42">
          <span class="hits">24</span>
          
          <code class="ruby">    @authors = Person.where('admin = ? OR blog_admin = ?', true, true).order('first_name, last_name ASC')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="44">
          <span class="hits">24</span>
          
          <code class="ruby">    if !error &amp;&amp; @content_item.save</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="45">
          <span class="hits">11</span>
          
          <code class="ruby">      flash[:notice] = &quot;Your #{@content_item.content_type} has been created!&quot;</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="46">
          <span class="hits">11</span>
          
          <code class="ruby">      redirect_to admin_content_item_path(@content_item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="48">
          <span class="hits">13</span>
          
          <code class="ruby">      @topics = Topic.all</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="49">
          <span class="hits">13</span>
          
          <code class="ruby">      render :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_description</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="54">
          <span class="hits">4</span>
          
          <code class="ruby">    @filter = params[:type].classify</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="55">
          <span class="hits">4</span>
          
          <code class="ruby">    @content_item_description = ContentItemDescription.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="57">
          <span class="hits">4</span>
          
          <code class="ruby">    if @content_item_description.update_attributes(params['content_item_description'])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="58">
          <span class="hits">4</span>
          
          <code class="ruby">      redirect_to admin_content_items_type_path(@filter.underscore)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">      @content_items = ContentItem.where(content_type: @filter).order('content_type ASC, published DESC, created_at DESC')</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">      render :index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="66">
          <span class="hits">15</span>
          
          <code class="ruby">    @content_item = ContentItem.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="67">
          <span class="hits">15</span>
          
          <code class="ruby">    @person = Person.find(@content_item.person_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="71">
          <span class="hits">7</span>
          
          <code class="ruby">    @content_item = ContentItem.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="72">
          <span class="hits">7</span>
          
          <code class="ruby">    @authors = Person.where('admin = ? OR blog_admin = ?', true, true).order('first_name, last_name ASC')</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="73">
          <span class="hits">7</span>
          
          <code class="ruby">    @content_item.url_slug = @content_item.slug</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="74">
          <span class="hits">7</span>
          
          <code class="ruby">    @topics = Topic.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="78">
          <span class="hits">3</span>
          
          <code class="ruby">    @content_item = ContentItem.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="79">
          <span class="hits">3</span>
          
          <code class="ruby">    @content_item.destroy</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="80">
          <span class="hits">3</span>
          
          <code class="ruby">    flash[:notice] = &quot;Successfully deleted content item&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="81">
          <span class="hits">3</span>
          
          <code class="ruby">    redirect_to admin_content_items_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="85">
          <span class="hits">10</span>
          
          <code class="ruby">    @content_item = ContentItem.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="86">
          <span class="hits">10</span>
          
          <code class="ruby">    @authors = Person.where('admin = ? OR blog_admin = ?', true, true).order('first_name, last_name ASC')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="88">
          <span class="hits">10</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="89">
          <span class="hits">10</span>
          
          <code class="ruby">      params[:content_item][:published] = params[:content_item][:published] ? Date.strptime(params[:content_item][:published], &quot;%m/%d/%Y&quot;) : Date.today </code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="90">
          <span class="hits">9</span>
          
          <code class="ruby">      error = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">    rescue</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">      error = true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">      @content_item.errors.add :published, &quot;invalid date&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="96">
          <span class="hits">10</span>
          
          <code class="ruby">    params[:content_item][:embed_code] = get_embed_code_from_embedly(params[:content_item][:external_link], params[:content_item][:embed_code]) unless error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="98">
          <span class="hits">10</span>
          
          <code class="ruby">    if !error &amp;&amp; @content_item.update_attributes(params[:content_item])</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="99">
          <span class="hits">6</span>
          
          <code class="ruby">      flash[:notice] = &quot;Successfully edited your #{@content_item.content_type}&quot;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="100">
          <span class="hits">6</span>
          
          <code class="ruby">      redirect_to admin_content_item_path(@content_item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="102">
          <span class="hits">4</span>
          
          <code class="ruby">      @topics = Topic.all</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="103">
          <span class="hits">4</span>
          
          <code class="ruby">      render :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_description</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">    @filter = params[:type].classify</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="109">
          
          
          <code class="ruby">    @content_item_description = ContentItemDescription.find_by_content_type(@filter)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">    if @content_item_description.update_attributes(params['content_item_description'])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">      redirect_to admin_content_items_type_path(@filter.underscore)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">      @content_items = ContentItem.where(content_type: @filter).order('content_type ASC, published DESC, created_at DESC')</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">      render :index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_embed_code_from_embedly(external_link, embed_code = nil)</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="123">
          <span class="hits">30</span>
          
          <code class="ruby">    if embed_code.blank? and external_link =~ URI::regexp(%w(http https))</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="124">
          <span class="hits">2</span>
          
          <code class="ruby">      embed_code = EmbedlyService.get_simple_embed(external_link)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="126">
          <span class="hits">30</span>
          
          <code class="ruby">    return embed_code</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">  def verify_admin_and_content_item_admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="130">
          
          
          <code class="ruby">    if require_user and not current_person.admin? and not current_person.blog_admin?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="131">
          
          
          <code class="ruby">      flash[:error] = &quot;You must be an admin to view this page.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">      redirect_to secure_session_url(current_person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e7a328488c9a8ba4b9f68c444aabf61d9b6c3a78">
  <div class="header">
    <h3>app/controllers/admin/content_items_people_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>25</b> relevant lines. 
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ContentItemsPeopleController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_people</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :get_content_item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  #GET admin/content_items/123/people</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="8">
          <span class="hits">8</span>
          
          <code class="ruby">    @hosts = @content_item.hosts</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="9">
          <span class="hits">8</span>
          
          <code class="ruby">    @guests = @content_item.guests</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="13">
          <span class="hits">12</span>
          
          <code class="ruby">    if params[:letter] == 'all'</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="14">
          <span class="hits">4</span>
          
          <code class="ruby">      @letter = params[:letter]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="15">
          <span class="hits">4</span>
          
          <code class="ruby">      @queried_letter = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      @letter = params[:letter] || 'A'</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="18">
          <span class="hits">8</span>
          
          <code class="ruby">      @queried_letter = @letter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="20">
          <span class="hits">12</span>
          
          <code class="ruby">    @people = Person.find_confirmed_order_by_last_name(@queried_letter)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="21">
          <span class="hits">12</span>
          
          <code class="ruby">    @role = params[:role]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="25">
          <span class="hits">7</span>
          
          <code class="ruby">    @person = Person.find(params[:person_id])</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="26">
          <span class="hits">7</span>
          
          <code class="ruby">    @content_item.add_person(params[:role], @person)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="27">
          <span class="hits">7</span>
          
          <code class="ruby">    redirect_to admin_content_item_content_items_people_path(@content_item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="31">
          <span class="hits">5</span>
          
          <code class="ruby">    @person = Person.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="32">
          <span class="hits">5</span>
          
          <code class="ruby">    @content_item.delete_person(params[:role], @person)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="33">
          <span class="hits">5</span>
          
          <code class="ruby">    redirect_to admin_content_item_content_items_people_path(@content_item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_content_item</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="38">
          <span class="hits">32</span>
          
          <code class="ruby">    @content_item = ContentItem.find(params[:content_item_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2f1aee242516938836a74ffa2ee19c537ed335b7">
  <div class="header">
    <h3>app/controllers/admin/content_templates_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>27</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ContentTemplatesController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_content_templates</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # GET /admin/content_templates</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    @content_templates = ContentTemplate.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # GET /admin/content_templates/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    @content_template = ContentTemplate.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  # GET /admin/content_templates/new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="17">
          <span class="hits">2</span>
          
          <code class="ruby">    @content_template = ContentTemplate.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # GET /admin/content_templates/1/edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    @content_template = ContentTemplate.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  # POST /admin/content_templates</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="27">
          <span class="hits">4</span>
          
          <code class="ruby">    @content_template = ContentTemplate.new(params[:content_template])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="28">
          <span class="hits">4</span>
          
          <code class="ruby">    @content_template.author = current_person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="30">
          <span class="hits">4</span>
          
          <code class="ruby">    if @content_template.save</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="31">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to(admin_content_template_path(@content_template), :notice =&gt; 'Content template was successfully created.')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="33">
          <span class="hits">2</span>
          
          <code class="ruby">      render :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  # PUT /admin/content_templates/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="39">
          <span class="hits">5</span>
          
          <code class="ruby">    @content_template = ContentTemplate.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="40">
          <span class="hits">5</span>
          
          <code class="ruby">    @content_template.attributes = params[:content_template]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="41">
          <span class="hits">5</span>
          
          <code class="ruby">    @content_template.author = current_person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="43">
          <span class="hits">5</span>
          
          <code class="ruby">    if @content_template.save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="44">
          <span class="hits">3</span>
          
          <code class="ruby">      redirect_to(admin_content_template_path(@content_template), :notice =&gt; 'Content template was successfully updated.')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="46">
          <span class="hits">2</span>
          
          <code class="ruby">      render :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  # DELETE /admin/content_templates/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="52">
          <span class="hits">2</span>
          
          <code class="ruby">    @content_template = ContentTemplate.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="53">
          <span class="hits">2</span>
          
          <code class="ruby">    @content_template.destroy</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="54">
          <span class="hits">2</span>
          
          <code class="ruby">    redirect_to(admin_content_templates_url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2b79ecaee63f8be5f7e0c09fd886b3023e8d60c5">
  <div class="header">
    <h3>app/controllers/admin/conversations_controller.rb</h3>
    <h4><span class="red">57.32 %</span> covered</h4>
    <div>
      <b>82</b> relevant lines. 
      <span class="green"><b>47</b> lines covered</span> and
      <span class="red"><b>35</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ConversationsController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_conversations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  #GET admin/conversations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="7">
          <span class="hits">5</span>
          
          <code class="ruby">    @conversations = Conversation.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  #GET admin/conversations/new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="12">
          <span class="hits">4</span>
          
          <code class="ruby">    @conversation = Conversation.new(params[:conversation])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="13">
          <span class="hits">4</span>
          
          <code class="ruby">    @presenter = IngestPresenter.new(@conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  #GET admin/conversations/staff_picked</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def staff_picked</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    @conversations = Conversation.staff_picked.sort_position_asc.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  #PUT admin/conversations/1/move_to_position/2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def move_to_position</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    if params[:conversation] &amp;&amp; params[:conversation][:position].present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">      new_position = params[:conversation][:position].to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      @conversation = Conversation.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      if new_position.to_i != @conversation.position.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">        @conversation.move_to_position(new_position)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">        flash[:notice] = &quot;Successfully moved the conversation \&quot;#{@conversation.title.truncate(50)}\&quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    redirect_to staff_picked_admin_conversations_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  #POST admin/conversations/</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="36">
          <span class="hits">2</span>
          
          <code class="ruby">    ActiveRecord::Base.transaction do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="37">
          <span class="hits">2</span>
          
          <code class="ruby">      params[:conversation].merge!({</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">        :person =&gt; current_person,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">        :from_community =&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      })</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="41">
          <span class="hits">2</span>
          
          <code class="ruby">      @conversation = Conversation.new(params[:conversation])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="42">
          <span class="hits">2</span>
          
          <code class="ruby">      @presenter = IngestPresenter.new(@conversation, params[:transcript_file])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="44">
          <span class="hits">2</span>
          
          <code class="ruby">      @conversation.save!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">      @presenter.save!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">        format.html { redirect_to(admin_conversation_path(@conversation), :notice =&gt; 'Your conversation has been created!') }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">        format.xml  { render :xml =&gt; @conversation, :status =&gt; :created, :location =&gt; @conversation }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  rescue ActiveRecord::RecordInvalid =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="52">
          <span class="hits">2</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="53">
          <span class="hits">4</span>
          
          <code class="ruby">      format.html { render :new }</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="54">
          <span class="hits">2</span>
          
          <code class="ruby">      format.xml  { render :xml =&gt; @conversation.errors + @presenter.errors, :status =&gt; :unprocessable_entity }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  #GET admin/conversations/:id/edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="61">
          <span class="hits">2</span>
          
          <code class="ruby">    @conversation = Conversation.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="62">
          <span class="hits">2</span>
          
          <code class="ruby">    @presenter = IngestPresenter.new(@conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  #PUT admin/conversations/:id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="68">
          <span class="hits">2</span>
          
          <code class="ruby">    @conversation = Conversation.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="70">
          <span class="hits">2</span>
          
          <code class="ruby">    conversation_starting_issues = @conversation.issues.collect(&amp;:id).sort</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="71">
          <span class="hits">2</span>
          
          <code class="ruby">    conversation_final_issues = params[:conversation][:issue_ids].reject(&amp;:empty?).collect(&amp;:to_i).sort</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="73">
          <span class="hits">2</span>
          
          <code class="ruby">    if @conversation.update_attributes(params[:conversation])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="74">
          <span class="hits">2</span>
          
          <code class="ruby">      @conversation.touch_issues unless conversation_starting_issues == conversation_final_issues</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="75">
          <span class="hits">2</span>
          
          <code class="ruby">      flash[:notice] = &quot;Successfully updated conversation&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="76">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to admin_conversations_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">      @presenter = IngestPresenter.new(@conversation)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">      render :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  #PUT admin/conversations/update_order</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_order</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    # validate parameters</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">    current_position = format_param(params[:current])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">    next_position = format_param(params[:next])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="88">
          
          
          <code class="ruby">    previous_position = format_param(params[:prev])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">    raise &quot;Current position cannot be nil&quot; if current_position.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">    if previous_position.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">      set_position(current_position, 0, next_position)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">    elsif next_position.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">      set_position(current_position, 0, previous_position)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">    elsif next_position &gt; previous_position</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">      set_position(current_position, previous_position + 1, next_position)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">    elsif next_position &lt; previous_position</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">      set_position(current_position, next_position + 1, previous_position)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">    Conversation.sort</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">    render :nothing =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">  #GET admin/conversations/:id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">    @conversation = Conversation.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">  #DELETE admin/conversations/:id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">    @conversation = Conversation.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">    @conversation.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">    redirect_to admin_conversations_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">  #POST admin/conversations/:id/toggle_staff_pick</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">  def toggle_staff_pick</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="120">
          <span class="hits">4</span>
          
          <code class="ruby">    @conversation = Conversation.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="121">
          <span class="hits">4</span>
          
          <code class="ruby">    @conversation.toggle(:staff_pick)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="123">
          <span class="hits">4</span>
          
          <code class="ruby">    if @conversation.save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="124">
          <span class="hits">3</span>
          
          <code class="ruby">      status = @conversation.staff_pick? ? 'on' : 'off'</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="125">
          <span class="hits">3</span>
          
          <code class="ruby">      flash[:notice] = &quot;Staff Pick is turned #{status} for \&quot;#{@conversation.title.truncate(50)}\&quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="126">
          <span class="hits">3</span>
          
          <code class="ruby">      @conversation.sort</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="127">
          <span class="hits">3</span>
          
          <code class="ruby">      @conversation.move_to_position(0) if status == 'on'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">      flash[:error] = &quot;Error saving conversation: \&quot;#{@conversation.title.truncate(50)}\&quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="132">
          <span class="hits">4</span>
          
          <code class="ruby">    if params[:redirect_to]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">      redirect_to :action =&gt; params[:redirect_to]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="135">
          <span class="hits">3</span>
          
          <code class="ruby">      redirect_to admin_conversation_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">  def format_param(param)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">    if param.match(/^\d+$/)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="143">
          
          
          <code class="ruby">      param.to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_position(current, new_index, comparison)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="150">
          
          
          <code class="ruby">    current_conversation = Conversation.find_by_position(current)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">    Conversation.where('position &gt;= ?', comparison).each do |conversation|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">      Conversation.where('id = ?', conversation.id).update_all(position: conversation.position + 1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="154">
          
          
          <code class="ruby">    Conversation.where('id = ?', current_conversation.id).update_all(position: new_index)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5bc1dd7747e0014997fc7561e78de19890a77604">
  <div class="header">
    <h3>app/controllers/admin/conversations_people_controller.rb</h3>
    <h4><span class="red">26.09 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>17</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ConversationsPeopleController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_conversations_people</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    @conversation = Conversation.includes(conversations_people: [:person] ).find(params[:conversation_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    if params[:letter] == 'all'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      @letter = params[:letter]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      @queried_letter = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      @letter = params[:letter] || 'A'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      @queried_letter = @letter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    @people = Person.find_confirmed_order_by_last_name(@queried_letter)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    @conversation = Conversation.find(params[:conversation_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    @conversation = Conversation.find(params[:conversation_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    @moderator = ConversationsPerson.new(conversation_id:@conversation.id, person_id:params[:person_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    if @moderator.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      redirect_to admin_conversation_conversations_people_path(params[:conversation_id]) #@conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">      @conversations = Conversation.all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">      render :action =&gt; :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    @moderator = ConversationsPerson.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    @moderator.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">    redirect_to admin_conversation_conversations_people_path(params[:conversation_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="01e9d0dfa0a725eb0ceabf132914a6fd65ed680f">
  <div class="header">
    <h3>app/controllers/admin/curated_feed_items_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>27</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::CuratedFeedItemsController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_curated_feed_items</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # GET /admin/feeds/1/items/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    @feed = CuratedFeed.find(params[:curated_feed_id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    @item = CuratedFeedItem.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  # GET /admin/feeds/1/items/1/edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="13">
          <span class="hits">2</span>
          
          <code class="ruby">    @feed = CuratedFeed.find(params[:curated_feed_id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="14">
          <span class="hits">2</span>
          
          <code class="ruby">    @item = CuratedFeedItem.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  # POST /admin/feeds/1/items</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="19">
          <span class="hits">5</span>
          
          <code class="ruby">    @feed = CuratedFeed.find(params[:curated_feed_id])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="20">
          <span class="hits">5</span>
          
          <code class="ruby">    @item = CuratedFeedItem.new(params[:curated_feed_item])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="21">
          <span class="hits">5</span>
          
          <code class="ruby">    @item.feed = @feed</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="22">
          <span class="hits">5</span>
          
          <code class="ruby">    @item.save</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="23">
          <span class="hits">5</span>
          
          <code class="ruby">    redirect_to(admin_curated_feed_path(@feed))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  # PUT /admin/feeds/1/items/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="28">
          <span class="hits">6</span>
          
          <code class="ruby">    @feed = CuratedFeed.find(params[:curated_feed_id])</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="29">
          <span class="hits">6</span>
          
          <code class="ruby">    @item = CuratedFeedItem.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="30">
          <span class="hits">6</span>
          
          <code class="ruby">    @item.feed = @feed</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="31">
          <span class="hits">6</span>
          
          <code class="ruby">    @item.attributes = params[:curated_feed_item]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="33">
          <span class="hits">6</span>
          
          <code class="ruby">    if @item.save</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="34">
          <span class="hits">4</span>
          
          <code class="ruby">      redirect_to(admin_curated_feed_path(@feed), :notice =&gt; 'Feed item was successfully updated.')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="36">
          <span class="hits">2</span>
          
          <code class="ruby">      render :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  # DELETE /admin/feeds/1/items/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="42">
          <span class="hits">3</span>
          
          <code class="ruby">    @feed = CuratedFeed.find(params[:curated_feed_id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="43">
          <span class="hits">3</span>
          
          <code class="ruby">    @item = CuratedFeedItem.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="44">
          <span class="hits">3</span>
          
          <code class="ruby">    @item.destroy</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="45">
          <span class="hits">3</span>
          
          <code class="ruby">    redirect_to(admin_curated_feed_path(@feed))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="91cfcf1880a549cfdedca8a122e0b644e3b5e13c">
  <div class="header">
    <h3>app/controllers/admin/curated_feeds_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::CuratedFeedsController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_curated_feeds</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # GET /admin/curated_feeds</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def index </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    @feeds = CuratedFeed.order(title: 'ASC')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # GET /admin/curated_feeds/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="12">
          <span class="hits">8</span>
          
          <code class="ruby">    @feed = CuratedFeed.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  # GET /admin/curated_feeds/new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="17">
          <span class="hits">4</span>
          
          <code class="ruby">    @feed = CuratedFeed.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # GET /admin/curated_feeds/1/edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    @feed = CuratedFeed.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  # POST /admin/curated_feeds</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="27">
          <span class="hits">6</span>
          
          <code class="ruby">    @feed = CuratedFeed.new(params[:curated_feed])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="29">
          <span class="hits">6</span>
          
          <code class="ruby">    if @feed.save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="30">
          <span class="hits">3</span>
          
          <code class="ruby">      redirect_to(admin_curated_feed_path(@feed), :notice =&gt; 'Feed successfully created.')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="32">
          <span class="hits">3</span>
          
          <code class="ruby">      render :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  # PUT /admin/curated_feeds/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="38">
          <span class="hits">5</span>
          
          <code class="ruby">    @feed = CuratedFeed.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="40">
          <span class="hits">5</span>
          
          <code class="ruby">    if @feed.update_attributes(params[:curated_feed])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="41">
          <span class="hits">3</span>
          
          <code class="ruby">      redirect_to(admin_curated_feed_path(@feed), :notice =&gt; 'Curated feed was successfully updated.')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="43">
          <span class="hits">2</span>
          
          <code class="ruby">      render :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  # DELETE /admin/curated_feeds/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="49">
          <span class="hits">2</span>
          
          <code class="ruby">    @feed = CuratedFeed.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="50">
          <span class="hits">2</span>
          
          <code class="ruby">    @feed.destroy</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="51">
          <span class="hits">2</span>
          
          <code class="ruby">    redirect_to(admin_curated_feeds_url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="207ef531a67482df7be81f57c4f355de5105d31f">
  <div class="header">
    <h3>app/controllers/admin/dashboard_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'socket'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::DashboardController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_dashboard</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  layout 'admin'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="10">
          <span class="hits">76</span>
          
          <code class="ruby">    @host = Socket.gethostname</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b33b6373a2ee07e2c39b48194ff005d2be854118">
  <div class="header">
    <h3>app/controllers/admin/email_restrictions_controller.rb</h3>
    <h4><span class="red">41.46 %</span> covered</h4>
    <div>
      <b>41</b> relevant lines. 
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>24</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::EmailRestrictionsController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_restrictions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # GET /admin/email_restrictions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # GET /admin/email_restrictions.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    @email_restrictions = EmailRestriction.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">      format.html # index.html.erb</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">      format.xml  { render :xml =&gt; @email_restrictions }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # GET /admin/email_restrictions/1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  # GET /admin/email_restrictions/1.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    @email_restriction = EmailRestriction.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">      format.html # show.html.erb</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      format.xml  { render :xml =&gt; @email_restriction }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  # GET /admin/email_restrictions/new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # GET /admin/email_restrictions/new.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    @email_restriction = EmailRestriction.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      format.html # new.html.erb</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      format.xml  { render :xml =&gt; @email_restriction }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  # GET /admin/email_restrictions/1/edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    @email_restriction = EmailRestriction.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  # POST /admin/email_restrictions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  # POST /admin/email_restrictions.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    @email_restriction = EmailRestriction.new(params[:email_restriction])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">      if @email_restriction.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">        format.html { redirect_to([:admin,@email_restriction], :notice =&gt; 'EmailRestriction was successfully created.') }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">        format.xml  { render :xml =&gt; @email_restriction, :status =&gt; :created, :location =&gt; @email_restriction }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">        format.html { render :action =&gt; &quot;new&quot; }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">        format.xml  { render :xml =&gt; @email_restriction.errors, :status =&gt; :unprocessable_entity }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  # PUT /admin/email_restrictions/1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  # PUT /admin/email_restrictions/1.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">    @email_restriction = EmailRestriction.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">      if @email_restriction.update_attributes(params[:email_restriction])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">        format.html { redirect_to([:admin,@email_restriction], :notice =&gt; 'EmailRestriction was successfully updated.') }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">        format.xml  { head :ok }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">        format.html { render :action =&gt; &quot;edit&quot; }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">        format.xml  { render :xml =&gt; @email_restriction.errors, :status =&gt; :unprocessable_entity }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  # DELETE /admin/email_restrictions/1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  # DELETE /admin/email_restrictions/1.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">    @email_restriction = EmailRestriction.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">    @email_restriction.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">      format.html { redirect_to(admin_email_restrictions_url) }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">      format.xml  { head :ok }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e26182f0a0d42fcc4c635d86ca52a25475c1c47f">
  <div class="header">
    <h3>app/controllers/admin/featured_homepage_controller.rb</h3>
    <h4><span class="red">50.0 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::FeaturedHomepageController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_featured_homepages</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    @items = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    conversations = Conversation.includes(:homepage_featured).latest_created</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    @items |= conversations.collect do |conversation|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">        created_at: conversation.created_at,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">        featured: conversation.featured?,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">        id: conversation.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">        custom_image: conversation.custom_image?,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">        title: short_title(conversation.title),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">        type: conversation.class.to_s,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">        url: admin_conversation_path(conversation)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    issues = Issue.includes(:homepage_featured).most_recent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    @items |= issues.collect do |issue|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">        created_at: issue.created_at,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">        featured: issue.featured?,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">        id: issue.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">        custom_image: issue.custom_image?,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">        title: issue.name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">        type: issue.class.to_s,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">        url: admin_issue_path(issue)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    item = params[:type].constantize.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">    if params[:featured]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">      item.homepage_featured = HomepageFeatured.create unless item.featured?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">      item.homepage_featured.destroy if item.featured?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    flash[:notice] = &quot;Successfully updated #{ params[:type] } #{ params[:id] } to #{ (!params[:featured].nil?).to_s }.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">      format.html { redirect_to admin_featured_homepage_index_path }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b68d0edc843af6a8ac3760090eff4b80e658022c">
  <div class="header">
    <h3>app/controllers/admin/featured_opportunities_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>43</b> relevant lines. 
      <span class="green"><b>43</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::FeaturedOpportunitiesController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_featured_opportunities</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="6">
          <span class="hits">4</span>
          
          <code class="ruby">    @featured_opportunity = FeaturedOpportunity.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="10">
          <span class="hits">7</span>
          
          <code class="ruby">    @featured_opportunity = FeaturedOpportunity.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="11">
          <span class="hits">7</span>
          
          <code class="ruby">    @conversations = Conversation.conversations_with_actions_and_reflections</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="12">
          <span class="hits">7</span>
          
          <code class="ruby">    build_featured_opportunity_items</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="16">
          <span class="hits">6</span>
          
          <code class="ruby">    @featured_opportunities = FeaturedOpportunity.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="20">
          <span class="hits">7</span>
          
          <code class="ruby">    @featured_opportunity = FeaturedOpportunity.new</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="21">
          <span class="hits">7</span>
          
          <code class="ruby">    @conversations = Conversation.conversations_with_actions_and_reflections</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="22">
          <span class="hits">7</span>
          
          <code class="ruby">    build_featured_opportunity_items</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="26">
          <span class="hits">3</span>
          
          <code class="ruby">    @featured_opportunity = FeaturedOpportunity.new(params[:featured_opportunity])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="27">
          <span class="hits">3</span>
          
          <code class="ruby">    if @featured_opportunity.save</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="28">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to [:admin,@featured_opportunity]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">      @conversations = Conversation.conversations_with_actions_and_reflections</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">      build_featured_opportunity_items</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">      render :action =&gt; :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="37">
          <span class="hits">3</span>
          
          <code class="ruby">    @featured_opportunity = FeaturedOpportunity.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="38">
          <span class="hits">3</span>
          
          <code class="ruby">    @featured_opportunity.attributes = (params[:featured_opportunity])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="39">
          <span class="hits">3</span>
          
          <code class="ruby">    if @featured_opportunity.save</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="40">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to [:admin,@featured_opportunity]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">      @conversations = Conversation.conversations_with_actions_and_reflections</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">      build_featured_opportunity_items</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">      render :action =&gt; :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="50">
          <span class="hits">2</span>
          
          <code class="ruby">    @featured_opportunity = FeaturedOpportunity.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="51">
          <span class="hits">2</span>
          
          <code class="ruby">    @featured_opportunity.destroy</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="52">
          <span class="hits">2</span>
          
          <code class="ruby">    redirect_to :action =&gt; :index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">  def change_conversation_selection</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="56">
          <span class="hits">5</span>
          
          <code class="ruby">    @conversation = Conversation.find(params[:conversation_id])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="57">
          <span class="hits">5</span>
          
          <code class="ruby">    @contributions = @conversation.contributions</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="58">
          <span class="hits">5</span>
          
          <code class="ruby">    @actions = @conversation.actions</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="59">
          <span class="hits">5</span>
          
          <code class="ruby">    @reflections = @conversation.reflections</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  def build_featured_opportunity_items</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="64">
          <span class="hits">16</span>
          
          <code class="ruby">    @featured_opportunity.contributions.build if @featured_opportunity.contributions.length &lt; 1</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="65">
          <span class="hits">16</span>
          
          <code class="ruby">    @featured_opportunity.actions.build if @featured_opportunity.actions.length &lt; 1</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="66">
          <span class="hits">16</span>
          
          <code class="ruby">    @featured_opportunity.reflections.build if @featured_opportunity.reflections.length &lt; 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="90880f0cbd1fb09aefc6364fa06fe954214cfeea">
  <div class="header">
    <h3>app/controllers/admin/issues_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>54</b> relevant lines. 
      <span class="green"><b>54</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::IssuesController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_issues</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  #GET admin/issues/</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="7">
          <span class="hits">5</span>
          
          <code class="ruby">    @issues = ManagedIssue.custom_order</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  #GET admin/issues/new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="12">
          <span class="hits">5</span>
          
          <code class="ruby">    @issue = ManagedIssue.new(params[:issue])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="13">
          <span class="hits">5</span>
          
          <code class="ruby">    @topics = Topic.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  #POST admin/issues</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="18">
          <span class="hits">9</span>
          
          <code class="ruby">    @issue = ManagedIssue.new(params[:issue])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="20">
          <span class="hits">9</span>
          
          <code class="ruby">    params[:issue][:topic_ids] ||= []</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="21">
          <span class="hits">9</span>
          
          <code class="ruby">    @issue.attributes = params[:issue]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="23">
          <span class="hits">9</span>
          
          <code class="ruby">    if @issue.save</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="24">
          <span class="hits">5</span>
          
          <code class="ruby">      redirect_to admin_issues_path</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="25">
          <span class="hits">5</span>
          
          <code class="ruby">      flash[:notice] = &quot;Thank you for submitting an issue&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="27">
          <span class="hits">4</span>
          
          <code class="ruby">      @topics = Topic.all</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="28">
          <span class="hits">4</span>
          
          <code class="ruby">      render :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  #GET admin/issues/:id/edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="34">
          <span class="hits">4</span>
          
          <code class="ruby">    @issue = ManagedIssue.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="35">
          <span class="hits">4</span>
          
          <code class="ruby">    @topics = Topic.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="37">
          <span class="hits">4</span>
          
          <code class="ruby">    render &quot;/admin/issues/edit&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  #PUT admin/issues/:id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="42">
          <span class="hits">7</span>
          
          <code class="ruby">    @issue = ManagedIssue.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="44">
          <span class="hits">7</span>
          
          <code class="ruby">    params[:issue][:topic_ids] ||= []</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="45">
          <span class="hits">7</span>
          
          <code class="ruby">    @issue.attributes = params[:issue]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="47">
          <span class="hits">7</span>
          
          <code class="ruby">    if @issue.save</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="48">
          <span class="hits">4</span>
          
          <code class="ruby">      redirect_to admin_issues_path</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="49">
          <span class="hits">4</span>
          
          <code class="ruby">      flash[:notice] = &quot;Thank you for updating the issue&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="51">
          <span class="hits">3</span>
          
          <code class="ruby">      flash[:error] = @issue.errors[:base].join(&quot;&lt;br/&gt;&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="53">
          <span class="hits">3</span>
          
          <code class="ruby">      @topics = Topic.all</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="54">
          <span class="hits">3</span>
          
          <code class="ruby">      render :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  #PUT admin/issues/update_order</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_order</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    # validate parameters</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="61">
          <span class="hits">8</span>
          
          <code class="ruby">    current_position = format_param(params[:current])</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="62">
          <span class="hits">8</span>
          
          <code class="ruby">    next_position = format_param(params[:next])</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="63">
          <span class="hits">8</span>
          
          <code class="ruby">    previous_position = format_param(params[:prev])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="65">
          <span class="hits">8</span>
          
          <code class="ruby">    if current_position.nil? || ManagedIssue.find_by_position(current_position).nil?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="66">
          <span class="hits">2</span>
          
          <code class="ruby">      raise &quot;Current position cannot be nil and must exist&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    if ((next_position.nil? || ManagedIssue.find_by_position(next_position).nil?) &amp;&amp;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="70">
          <span class="hits">6</span>
          
          <code class="ruby">      (previous_position.nil? || ManagedIssue.find_by_position(previous_position).nil?))</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="71">
          <span class="hits">3</span>
          
          <code class="ruby">      raise &quot;next or previous position must not be nil and exist&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="74">
          <span class="hits">3</span>
          
          <code class="ruby">    ManagedIssue.set_position(current_position, next_position, previous_position)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="75">
          <span class="hits">3</span>
          
          <code class="ruby">    render :nothing =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  rescue RuntimeError =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="78">
          <span class="hits">5</span>
          
          <code class="ruby">    ManagedIssue.assign_positions</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="79">
          <span class="hits">5</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="80">
          <span class="hits">10</span>
          
          <code class="ruby">      format.html { render :text =&gt; e.message, :status =&gt; 403 }</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="81">
          <span class="hits">5</span>
          
          <code class="ruby">      format.js { render :text =&gt; e.message, :status =&gt; 403 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  #GET admin/issues/:id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="87">
          <span class="hits">2</span>
          
          <code class="ruby">    @issue = ManagedIssue.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">  #DELETE admin/issues/:id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="92">
          <span class="hits">2</span>
          
          <code class="ruby">    @issue = ManagedIssue.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="93">
          <span class="hits">2</span>
          
          <code class="ruby">    @issue.destroy</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="94">
          <span class="hits">2</span>
          
          <code class="ruby">    redirect_to admin_issues_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">  def format_param(param)</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="100">
          <span class="hits">24</span>
          
          <code class="ruby">    if !param.nil? &amp;&amp; param.match(/^\d+$/)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="101">
          <span class="hits">13</span>
          
          <code class="ruby">      param.to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="6b9f93fcd7607d78b0262b5e2c5a425a6b0ae749">
  <div class="header">
    <h3>app/controllers/admin/managed_issue_pages_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>38</b> relevant lines. 
      <span class="green"><b>38</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::ManagedIssuePagesController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_managed_issue_pages</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # GET /admin/issues/1/pages</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def all</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    @managed_issue_pages = ManagedIssuePage.order('issue_id ASC, name ASC')</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    render :index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  # GET /admin/issues/1/pages</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="13">
          <span class="hits">2</span>
          
          <code class="ruby">    @issue = ManagedIssue.find(params[:issue_id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="14">
          <span class="hits">2</span>
          
          <code class="ruby">    @managed_issue_pages = ManagedIssuePage.where(issue_id: @issue.id).order('name ASC')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  # GET /admin/issues/1/pages/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    @issue = ManagedIssue.find(params[:issue_id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    @managed_issue_page = ManagedIssuePage.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  # GET /admin/issues/1/pages/new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    @issue = ManagedIssue.find(params[:issue_id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    @managed_issue_page = ManagedIssuePage.new(issue: @issue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  # GET /admin/issues/1/pages/1/edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    @issue = ManagedIssue.find(params[:issue_id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    @managed_issue_page = ManagedIssuePage.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  # POST /admin/issues/1/pages</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="37">
          <span class="hits">4</span>
          
          <code class="ruby">    @issue = ManagedIssue.find(params[:issue_id])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="38">
          <span class="hits">4</span>
          
          <code class="ruby">    @managed_issue_page = ManagedIssuePage.new(params[:managed_issue_page])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="39">
          <span class="hits">4</span>
          
          <code class="ruby">    @managed_issue_page.issue = @issue</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="40">
          <span class="hits">4</span>
          
          <code class="ruby">    @managed_issue_page.author = current_person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="42">
          <span class="hits">4</span>
          
          <code class="ruby">    if @managed_issue_page.save</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="43">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to(admin_issue_page_path(@issue, @managed_issue_page), :notice =&gt; 'Content template was successfully created.')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="45">
          <span class="hits">2</span>
          
          <code class="ruby">      render :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  # PUT /admin/issues/1/pages/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="51">
          <span class="hits">5</span>
          
          <code class="ruby">    @issue = ManagedIssue.find(params[:issue_id])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="52">
          <span class="hits">5</span>
          
          <code class="ruby">    @managed_issue_page = ManagedIssuePage.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="53">
          <span class="hits">5</span>
          
          <code class="ruby">    @managed_issue_page.attributes = params[:managed_issue_page]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="54">
          <span class="hits">5</span>
          
          <code class="ruby">    @managed_issue_page.author = current_person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="56">
          <span class="hits">5</span>
          
          <code class="ruby">    if @managed_issue_page.save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="57">
          <span class="hits">3</span>
          
          <code class="ruby">      redirect_to(admin_issue_page_path(@issue, @managed_issue_page), :notice =&gt; 'Content template was successfully updated.')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="59">
          <span class="hits">2</span>
          
          <code class="ruby">      render :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  # DELETE /admin/issues/1/pages/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="65">
          <span class="hits">2</span>
          
          <code class="ruby">    @issue = ManagedIssue.find(params[:issue_id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="66">
          <span class="hits">2</span>
          
          <code class="ruby">    @managed_issue_page = ManagedIssuePage.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="67">
          <span class="hits">2</span>
          
          <code class="ruby">    @managed_issue_page.destroy</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="68">
          <span class="hits">2</span>
          
          <code class="ruby">    redirect_to(admin_issue_pages_path(@issue))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="251a50892b939a632cdfb8cf46709af28f9dc250">
  <div class="header">
    <h3>app/controllers/admin/metro_regions_controller.rb</h3>
    <h4><span class="red">44.83 %</span> covered</h4>
    <div>
      <b>29</b> relevant lines. 
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>16</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::MetroRegionsController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_metro_regions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    @region = MetroRegion.new(params[:region])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    @region = MetroRegion.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    @region = MetroRegion.find params[:id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    if @region.update_attributes(params[:metro_region])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      redirect_to &quot;/admin/metro_regions&quot;, :notice =&gt; &quot;Region updated&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">      render :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    @region = MetroRegion.create params[:region]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    if @region.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      redirect_to &quot;/admin/metro_regions&quot;, :notice =&gt; &quot;Region created&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">      render :new, :notice =&gt; &quot;oh no&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    @regions = MetroRegion.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def display_names</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">    @regions = MetroRegion.group(:display_name)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    render :display_names</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit_display_names</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    @region = MetroRegion.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_display_names</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    @region = MetroRegion.find params[:id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    MetroRegion.update_all [&quot;display_name = ?&quot;, params[:metro_region][:display_name]], [&quot;display_name = ?&quot;, @region.display_name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">    @region.reload</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">    @region.update_amazon_slideout_image</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">    redirect_to &quot;/admin/metro_regions/display_names&quot;, :notice =&gt; &quot;Region updated&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1d3b9d42df9d83ecfd8c983cd356217ef14a7fb1">
  <div class="header">
    <h3>app/controllers/admin/people_controller.rb</h3>
    <h4><span class="red">73.68 %</span> covered</h4>
    <div>
      <b>57</b> relevant lines. 
      <span class="green"><b>42</b> lines covered</span> and
      <span class="red"><b>15</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::PeopleController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_people</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :prepare_stats, :only =&gt; [:index, :proxies]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def export_members</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="8">
          <span class="hits">4</span>
          
          <code class="ruby">    csv_string = MemberExportService.export_to_csv</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="9">
          <span class="hits">4</span>
          
          <code class="ruby">    render :text =&gt; csv_string, :content_type =&gt; Mime::CSV</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  #GET admin/people/</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="14">
          <span class="hits">6</span>
          
          <code class="ruby">    @people = Person.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  #GET admin/proxies</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def proxies</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    @people = Person.proxy_accounts</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    render :index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  #GET admin/people/new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    @person = Person.new(params[:person])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  #POST admin/people</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">    @person = Person.new(params[:person])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    @person.create_proxy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    if @person.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">      flash[:notice] = &quot;Thank you for creating the proxy account&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">      redirect_to admin_people_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">      render :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  #GET admin/people/1/edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    @person = Person.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  #PUT admin/people/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="47">
          <span class="hits">2</span>
          
          <code class="ruby">    @person = Person.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="48">
          <span class="hits">2</span>
          
          <code class="ruby">    if params[:person] &amp;&amp; params[:person][:admin] &amp;&amp; current_person.admin?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">      @person.admin = params[:person][:admin]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">      @person.blog_admin = params[:person][:blog_admin]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="53">
          <span class="hits">2</span>
          
          <code class="ruby">    if @person.update_attributes(params[:person])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="54">
          <span class="hits">2</span>
          
          <code class="ruby">      flash[:notice] = &quot;Successfully updated person record&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to admin_people_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">      render :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  def lock_access</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">    toggle_lock(:lock)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  def unlock_access</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">    toggle_lock(:unlock)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  #GET admin/people/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">    @person = Person.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  #DELETE admin/people/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">    @person = Person.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">    @person.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">      format.html { redirect_to(admin_people_path) }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">      format.json { redirect_to (admin_people_path)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">  def confirm</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="85">
          <span class="hits">3</span>
          
          <code class="ruby">    @person = Person.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="86">
          <span class="hits">3</span>
          
          <code class="ruby">    @person.confirm!</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="87">
          <span class="hits">3</span>
          
          <code class="ruby">    redirect_to admin_people_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">  def prepare_stats</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="93">
          <span class="hits">7</span>
          
          <code class="ruby">    @stats = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      :confirmed         =&gt; Person.confirmed_accounts.size,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      :unconfirmed       =&gt; Person.unconfirmed_accounts.size,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      :unconfirmed_real  =&gt; Person.unconfirmed_accounts.real_accounts.size,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">      :unconfirmed_proxy =&gt; Person.proxy_accounts.size</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  # Locks or unlocks a person's account which will disable login access</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  # action = either :lock or :unlock</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">  def toggle_lock(action)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="104">
          <span class="hits">2</span>
          
          <code class="ruby">    @person = Person.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="105">
          <span class="hits">2</span>
          
          <code class="ruby">    @person.send(&quot;#{action}_access!&quot;)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="106">
          <span class="hits">2</span>
          
          <code class="ruby">    flash[:notice] = &quot;Successfully #{action}ed #{@person.name}&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="107">
          <span class="hits">2</span>
          
          <code class="ruby">    if params[:redirect_to]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">      redirect_to :action =&gt; params[:redirect_to]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="110">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to admin_people_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9752b31c57cfac6eddf807ba7d9b6ba969a9a1d1">
  <div class="header">
    <h3>app/controllers/admin/regions_controller.rb</h3>
    <h4><span class="red">72.22 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::RegionsController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_regions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    @region = Region.new(params[:region])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    @region = Region.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    @region = Region.find params[:id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    if @region.update_attributes(params[:region])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      redirect_to &quot;/admin/regions&quot;, :notice =&gt; &quot;Region updated&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      render :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    @region = Region.create params[:region]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    if @region.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      redirect_to &quot;/admin/regions&quot;, :notice =&gt; &quot;Region created&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">      render :new, :notice =&gt; &quot;oh no&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    @regions = Region.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="6f74a487d26595ea075ec6508032060dbba0e85f">
  <div class="header">
    <h3>app/controllers/admin/surveys_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>71</b> relevant lines. 
      <span class="green"><b>71</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::SurveysController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_surveys</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # GET /admin/surveys</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # GET /admin/surveys.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="8">
          <span class="hits">6</span>
          
          <code class="ruby">    @surveys = Survey.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="10">
          <span class="hits">6</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="11">
          <span class="hits">6</span>
          
          <code class="ruby">      format.html # index.html.erb</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="12">
          <span class="hits">6</span>
          
          <code class="ruby">      format.xml  { render :xml =&gt; @surveys }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # GET /admin/surveys/1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  # GET /admin/surveys/1.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="19">
          <span class="hits">5</span>
          
          <code class="ruby">    @survey = Survey.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="21">
          <span class="hits">5</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="22">
          <span class="hits">5</span>
          
          <code class="ruby">      format.html # show.html.erb</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="23">
          <span class="hits">5</span>
          
          <code class="ruby">      format.xml  { render :xml =&gt; @survey }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  # GET /admin/surveys/new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # GET /admin/surveys/new.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="30">
          <span class="hits">8</span>
          
          <code class="ruby">    @survey = Survey.new(:max_selected_options =&gt; 3)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="31">
          <span class="hits">8</span>
          
          <code class="ruby">    @survey.type = 'Vote'</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="32">
          <span class="hits">8</span>
          
          <code class="ruby">    5.times do</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="33">
          <span class="hits">40</span>
          
          <code class="ruby">      @survey.options.build</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="36">
          <span class="hits">8</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="37">
          <span class="hits">8</span>
          
          <code class="ruby">      format.html # new.html.erb</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="38">
          <span class="hits">8</span>
          
          <code class="ruby">      format.xml  { render :xml =&gt; @survey }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  # GET /admin/surveys/1/edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="44">
          <span class="hits">2</span>
          
          <code class="ruby">    @survey = Survey.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="45">
          <span class="hits">2</span>
          
          <code class="ruby">    @survey = @survey.becomes(Survey) # needed for STI so that the form can use the parent, not the child</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="46">
          <span class="hits">2</span>
          
          <code class="ruby">    5.times do</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="47">
          <span class="hits">10</span>
          
          <code class="ruby">      @survey.options.build</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="50">
          <span class="hits">2</span>
          
          <code class="ruby">    @survey_options = @survey.options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  # POST /admin/surveys</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  # POST /admin/surveys.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="56">
          <span class="hits">9</span>
          
          <code class="ruby">    @survey = Survey.new(params[:survey])</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="57">
          <span class="hits">9</span>
          
          <code class="ruby">    @survey.type = params[&quot;survey&quot;][&quot;type&quot;]</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="58">
          <span class="hits">9</span>
          
          <code class="ruby">    @survey = @survey.becomes(Survey) # needed for STI so that the form can use the parent, not the child</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="59">
          <span class="hits">9</span>
          
          <code class="ruby">    @survey.attributes = params[:survey]</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="60">
          <span class="hits">9</span>
          
          <code class="ruby">    @survey.person_id = current_person.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    # External Parties will handle sending email.  We will mark it as sent and assume it's been done.</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="63">
          <span class="hits">9</span>
          
          <code class="ruby">    if params[:survey][:manual_results]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="64">
          <span class="hits">4</span>
          
          <code class="ruby">      @survey.end_notification_email_sent = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="67">
          <span class="hits">9</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="68">
          <span class="hits">9</span>
          
          <code class="ruby">      if @survey.save</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="69">
          <span class="hits">14</span>
          
          <code class="ruby">        format.html { redirect_to(admin_survey_url(@survey), :notice =&gt; 'Survey was successfully created.') }</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="70">
          <span class="hits">7</span>
          
          <code class="ruby">        format.xml  { render :xml =&gt; @survey, :status =&gt; :created, :location =&gt; @survey }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="72">
          <span class="hits">4</span>
          
          <code class="ruby">        format.html { render :action =&gt; &quot;new&quot; }</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="73">
          <span class="hits">2</span>
          
          <code class="ruby">        format.xml  { render :xml =&gt; @survey.errors, :status =&gt; :unprocessable_entity }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">  # PUT /admin/surveys/1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">  # PUT /admin/surveys/1.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="81">
          <span class="hits">5</span>
          
          <code class="ruby">    @survey = Survey.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="82">
          <span class="hits">5</span>
          
          <code class="ruby">    @survey = @survey.becomes(Survey) # needed for STI so that the form can use the parent, not the child</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="83">
          <span class="hits">5</span>
          
          <code class="ruby">    @survey.type = params[&quot;survey&quot;][&quot;type&quot;] if params['survey'] &amp;&amp; params['survey']['type']</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="84">
          <span class="hits">5</span>
          
          <code class="ruby">    @survey.attributes = params[:survey]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="85">
          <span class="hits">5</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="86">
          <span class="hits">5</span>
          
          <code class="ruby">      if @survey.save</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="87">
          <span class="hits">4</span>
          
          <code class="ruby">        format.html { redirect_to(admin_survey_url(@survey), :notice =&gt; 'Survey was successfully updated.') }</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="88">
          <span class="hits">2</span>
          
          <code class="ruby">        format.xml  { head :ok }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="90">
          <span class="hits">6</span>
          
          <code class="ruby">        format.html { render :action =&gt; &quot;edit&quot; }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="91">
          <span class="hits">3</span>
          
          <code class="ruby">        format.xml  { render :xml =&gt; @survey.errors, :status =&gt; :unprocessable_entity }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  # DELETE /admin/surveys/1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">  # DELETE /admin/surveys/1.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="99">
          <span class="hits">2</span>
          
          <code class="ruby">    @survey = Survey.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="100">
          <span class="hits">2</span>
          
          <code class="ruby">    @survey.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="102">
          <span class="hits">2</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="103">
          <span class="hits">4</span>
          
          <code class="ruby">      format.html { redirect_to(admin_surveys_url) }</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="104">
          <span class="hits">2</span>
          
          <code class="ruby">      format.xml  { head :ok }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  #GET /admin/surveys/1/progress</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">  def progress</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="110">
          <span class="hits">4</span>
          
          <code class="ruby">    @survey = Survey.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="111">
          <span class="hits">4</span>
          
          <code class="ruby">    @vote_progress_service = VoteProgressService.new(@survey)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="112">
          <span class="hits">4</span>
          
          <code class="ruby">    @responses = @survey.survey_responses.sort_last_created_first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">  def export_progress</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="116">
          <span class="hits">4</span>
          
          <code class="ruby">    @survey = Survey.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="117">
          <span class="hits">4</span>
          
          <code class="ruby">    @vote_progress_service = VoteProgressService.new(@survey)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="118">
          <span class="hits">4</span>
          
          <code class="ruby">    csv_string = @vote_progress_service.export_to_csv</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="119">
          <span class="hits">4</span>
          
          <code class="ruby">    render :text =&gt; csv_string, :content_type =&gt; Mime::CSV</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">  def export_voting_records</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="123">
          <span class="hits">4</span>
          
          <code class="ruby">    @survey = Survey.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="124">
          <span class="hits">4</span>
          
          <code class="ruby">    @vote_progress_service = VoteProgressService.new(@survey)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="125">
          <span class="hits">4</span>
          
          <code class="ruby">    csv_string = @vote_progress_service.export_selected_survey_options_to_csv</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="126">
          <span class="hits">4</span>
          
          <code class="ruby">    render :text =&gt; csv_string, :content_type =&gt; Mime::CSV</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c11d6d992ca9ec55eaa8d0f9815ec05fed38e32b">
  <div class="header">
    <h3>app/controllers/admin/topics_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>41</b> relevant lines. 
      <span class="green"><b>41</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::TopicsController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_topics</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # GET /admin/topics</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # GET /admin/topics.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="8">
          <span class="hits">5</span>
          
          <code class="ruby">    @topics = Topic.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="10">
          <span class="hits">5</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="11">
          <span class="hits">5</span>
          
          <code class="ruby">      format.html # index.html.erb</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="12">
          <span class="hits">5</span>
          
          <code class="ruby">      format.xml  { render :xml =&gt; @topics }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # GET /admin/topics/1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  # GET /admin/topics/1.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="19">
          <span class="hits">3</span>
          
          <code class="ruby">    @topic = Topic.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="21">
          <span class="hits">3</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="22">
          <span class="hits">3</span>
          
          <code class="ruby">      format.html # show.html.erb</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="23">
          <span class="hits">3</span>
          
          <code class="ruby">      format.xml  { render :xml =&gt; @topic }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  # GET /admin/topics/new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # GET /admin/topics/new.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="30">
          <span class="hits">4</span>
          
          <code class="ruby">    @topic = Topic.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="32">
          <span class="hits">4</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="33">
          <span class="hits">4</span>
          
          <code class="ruby">      format.html # new.html.erb</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="34">
          <span class="hits">4</span>
          
          <code class="ruby">      format.xml  { render :xml =&gt; @topic }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  # GET /admin/topics/1/edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="40">
          <span class="hits">2</span>
          
          <code class="ruby">    @topic = Topic.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  # POST /admin/topics</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  # POST /admin/topics.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="46">
          <span class="hits">6</span>
          
          <code class="ruby">    @topic = Topic.new(params[:topic])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="48">
          <span class="hits">6</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="49">
          <span class="hits">6</span>
          
          <code class="ruby">      if @topic.save</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="50">
          <span class="hits">6</span>
          
          <code class="ruby">        format.html { redirect_to([:admin,@topic], :notice =&gt; 'Topic was successfully created.') }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="51">
          <span class="hits">3</span>
          
          <code class="ruby">        format.xml  { render :xml =&gt; @topic, :status =&gt; :created, :location =&gt; @topic }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="53">
          <span class="hits">6</span>
          
          <code class="ruby">        format.html { render :action =&gt; &quot;new&quot; }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="54">
          <span class="hits">3</span>
          
          <code class="ruby">        format.xml  { render :xml =&gt; @topic.errors, :status =&gt; :unprocessable_entity }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  # PUT /admin/topics/1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  # PUT /admin/topics/1.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="62">
          <span class="hits">6</span>
          
          <code class="ruby">    @topic = Topic.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="64">
          <span class="hits">6</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="65">
          <span class="hits">6</span>
          
          <code class="ruby">      if @topic.update_attributes(params[:topic])</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="66">
          <span class="hits">6</span>
          
          <code class="ruby">        format.html { redirect_to([:admin,@topic], :notice =&gt; 'Topic was successfully updated.') }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="67">
          <span class="hits">3</span>
          
          <code class="ruby">        format.xml  { head :ok }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="69">
          <span class="hits">6</span>
          
          <code class="ruby">        format.html { render :action =&gt; &quot;edit&quot; }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="70">
          <span class="hits">3</span>
          
          <code class="ruby">        format.xml  { render :xml =&gt; @topic.errors, :status =&gt; :unprocessable_entity }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  # DELETE /admin/topics/1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  # DELETE /admin/topics/1.xml</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="78">
          <span class="hits">3</span>
          
          <code class="ruby">    @topic = Topic.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="79">
          <span class="hits">3</span>
          
          <code class="ruby">    @topic.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="81">
          <span class="hits">3</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="82">
          <span class="hits">6</span>
          
          <code class="ruby">      format.html { redirect_to(admin_topics_url) }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="83">
          <span class="hits">3</span>
          
          <code class="ruby">      format.xml  { head :ok }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="57dd5bd18d0dfe486207eb17a98973dfaaf2dda1">
  <div class="header">
    <h3>app/controllers/admin/user_registrations_controller.rb</h3>
    <h4><span class="yellow">90.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::UserRegistrationsController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_user_registrations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="6">
          <span class="hits">4</span>
          
          <code class="ruby">    @person = Person.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="10">
          <span class="hits">4</span>
          
          <code class="ruby">    @person = Person.new(params[:person])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="11">
          <span class="hits">4</span>
          
          <code class="ruby">    if @person.confirm!</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="12">
          <span class="hits">4</span>
          
          <code class="ruby">      flash[:notice] = 'Thank you for registering with The Civic Commons'</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="13">
          <span class="hits">4</span>
          
          <code class="ruby">      redirect_to admin_people_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      render :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c41cec4011dcd6cc31fc87b7caeb657e0ec368a7">
  <div class="header">
    <h3>app/controllers/admin/widget_stats_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Admin::WidgetStatsController &lt; Admin::DashboardController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  authorize_resource :class =&gt; :admin_widget_stats</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="6">
          <span class="hits">7</span>
          
          <code class="ruby">    @week_of = params[:week_of] || 0</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="7">
          <span class="hits">7</span>
          
          <code class="ruby">    @widget_stats = WidgetLog.find_all_url_summary_for_week(@week_of)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="10">
          <span class="hits">6</span>
          
          <code class="ruby">    @widget_url = params[:widget_url]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="11">
          <span class="hits">6</span>
          
          <code class="ruby">    @week_of = params[:week_of] || 0</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="12">
          <span class="hits">6</span>
          
          <code class="ruby">    @widget_stats = WidgetLog.find_one_url_summary_for_week(@widget_url, @week_of)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4f2782333ace84218f6099b553c68e2563068118">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4><span class="green">97.06 %</span> covered</h4>
    <div>
      <b>68</b> relevant lines. 
      <span class="green"><b>66</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include ApplicationHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include SecureUrlHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include RedirectHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  include MetaHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  protect_from_forgery</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  include AvatarHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  include RegionHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  layout 'application'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :fetch_notifications</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_no_ssl</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  helper_method :with_format, :default_region, :region_recent_conversations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from CanCan::AccessDenied do |exception|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="18">
          <span class="hits">15</span>
          
          <code class="ruby">    flash[:notice] = exception.message</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="19">
          <span class="hits">15</span>
          
          <code class="ruby">    redirect_to root_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def fetch_notifications</code>
        </li>
      
        <li class="covered" data-hits="1542" data-linenumber="23">
          <span class="hits">1542</span>
          
          <code class="ruby">    @notifications = Notification.where(receiver_id:current_person).order(&quot;created_at desc&quot;) if current_person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def verify_admin</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="28">
          <span class="hits">22</span>
          
          <code class="ruby">    if require_user and not current_person.admin?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="29">
          <span class="hits">10</span>
          
          <code class="ruby">      flash[:error] = &quot;You must be an admin to view this page.&quot;</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="30">
          <span class="hits">10</span>
          
          <code class="ruby">      redirect_to secure_session_url(current_person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_widget(results)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="35">
          <span class="hits">9</span>
          
          <code class="ruby">    @remote_url = params[:remote_url]</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="36">
          <span class="hits">9</span>
          
          <code class="ruby">    WidgetLog.create(:url =&gt; request.path, :remote_url =&gt; @remote_url)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="37">
          <span class="hits">9</span>
          
          <code class="ruby">    if results[:css].present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">      results[:css] &lt;&lt; '/assets/widget.css'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="40">
          <span class="hits">9</span>
          
          <code class="ruby">      results[:css] = ['/assets/widget.css']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="42">
          <span class="hits">9</span>
          
          <code class="ruby">    json = results.to_json</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="43">
          <span class="hits">9</span>
          
          <code class="ruby">    callback = params[:callback]</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="44">
          <span class="hits">9</span>
          
          <code class="ruby">    jsonp = callback.to_s + &quot;(&quot; + json + &quot;)&quot; #REQUIRED</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="45">
          <span class="hits">9</span>
          
          <code class="ruby">    render :text =&gt; jsonp,  :content_type =&gt; &quot;text/javascript&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  def require_user</code>
        </li>
      
        <li class="covered" data-hits="758" data-linenumber="49">
          <span class="hits">758</span>
          
          <code class="ruby">    if current_person.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      # AJAX file uploads submitted normal-style via iframe, so also</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      # check for custom remotipart_submitted param set in jquery.remotipart.js</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="52">
          <span class="hits">12</span>
          
          <code class="ruby">      if request.xhr? || params[:remotipart_submitted]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">        @requested_url = request.url</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">        respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">          format.html { render :partial =&gt; 'sessions/new_in_modal' }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">          format.js { render 'sessions/new_in_modal' }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="59">
          <span class="hits">11</span>
          
          <code class="ruby">        redirect_to secure_new_person_session_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="61">
          <span class="hits">12</span>
          
          <code class="ruby">      return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="746" data-linenumber="63">
          <span class="hits">746</span>
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  # This by default redirects everything https to http</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  # need to pass in :except whenever there is a 'require_ssl' before filter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">  def require_no_ssl</code>
        </li>
      
        <li class="covered" data-hits="1153" data-linenumber="70">
          <span class="hits">1153</span>
          
          <code class="ruby">    if request.ssl? &amp;&amp; SecureUrlHelper.https?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">      redirect_to request.url.gsub(/^https:\/\//i, 'http://')</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">      return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">  def require_ssl</code>
        </li>
      
        <li class="covered" data-hits="315" data-linenumber="77">
          <span class="hits">315</span>
          
          <code class="ruby">    if not request.ssl? and SecureUrlHelper.https?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">      redirect_to request.url.gsub(/^http:\/\//i, 'https://')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">  def after_sign_in_path_for(resource_or_scope)</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="83">
          <span class="hits">132</span>
          
          <code class="ruby">    if RedirectHelper.valid?(session[:previous])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">      session[:previous]</code>
        </li>
      
        <li class="covered" data-hits="131" data-linenumber="85">
          <span class="hits">131</span>
          
          <code class="ruby">    elsif session[:link]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">      new_link_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="131" data-linenumber="88">
          <span class="hits">131</span>
          
          <code class="ruby">      root_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">  def with_format(format, &amp;block)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="93">
          <span class="hits">4</span>
          
          <code class="ruby">    old_formats = formats</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="94">
          <span class="hits">4</span>
          
          <code class="ruby">    self.formats = [format]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="95">
          <span class="hits">4</span>
          
          <code class="ruby">    block.call</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="96">
          <span class="hits">4</span>
          
          <code class="ruby">    self.formats = old_formats</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">    nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  # redirects to the previous page, if there are any</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">  def redirect_to_back(default = nil)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="102">
          <span class="hits">8</span>
          
          <code class="ruby">    if !request.env[&quot;HTTP_REFERER&quot;].blank? and request.env[&quot;HTTP_REFERER&quot;] != request.env[&quot;REQUEST_URI&quot;]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="103">
          <span class="hits">4</span>
          
          <code class="ruby">      redirect_to :back</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="105">
          <span class="hits">4</span>
          
          <code class="ruby">      redirect_to default || root_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">  def region_recent_conversations</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="110">
          <span class="hits">4</span>
          
          <code class="ruby">    Conversation.filter_metro_region(default_region).latest_created.limit(6)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_ability</code>
        </li>
      
        <li class="covered" data-hits="5379" data-linenumber="114">
          <span class="hits">5379</span>
          
          <code class="ruby">    @current_ability ||= ::Ability.new(current_person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d7a98467151d389a9511ea1cb88ae0afc337aa99">
  <div class="header">
    <h3>app/controllers/authentication_controller.rb</h3>
    <h4><span class="green">94.87 %</span> covered</h4>
    <div>
      <b>39</b> relevant lines. 
      <span class="green"><b>37</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class AuthenticationController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  skip_before_filter :require_no_ssl</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user, :except =&gt; [:registering_email_taken]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_facebook_authenticated, :only =&gt; [:before_facebook_unlinking,:confirm_facebook_unlinking, :process_facebook_unlinking]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  layout :set_layout, :only =&gt; [:before_facebook_unlinking, :confirm_facebook_unlinking, :process_facebook_unlinking]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def before_facebook_unlinking</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="8">
          <span class="hits">3</span>
          
          <code class="ruby">    @person = current_person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def confirm_facebook_unlinking</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def conflicting_email</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="15">
          <span class="hits">2</span>
          
          <code class="ruby">    render :layout =&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def decline_fb_auth</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="19">
          <span class="hits">3</span>
          
          <code class="ruby">    if current_person.update_attribute(:declined_fb_auth, true)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="20">
          <span class="hits">2</span>
          
          <code class="ruby">      render :nothing =&gt; true, :status =&gt; :ok</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">      render :text =&gt; current_person.errors.full_messages, :status =&gt; :unprocessable_entity</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def process_facebook_unlinking</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="27">
          <span class="hits">6</span>
          
          <code class="ruby">    @person = current_person</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="28">
          <span class="hits">6</span>
          
          <code class="ruby">    @person.unlink_from_facebook(params[:person])</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="29">
          <span class="hits">6</span>
          
          <code class="ruby">    if @person.valid?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="30">
          <span class="hits">4</span>
          
          <code class="ruby">      sign_in @person, :event =&gt; :authentication, :bypass =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="31">
          <span class="hits">4</span>
          
          <code class="ruby">      render :template =&gt; '/authentication/fb_unlinking_success', :format =&gt; 'html'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="33">
          <span class="hits">2</span>
          
          <code class="ruby">      render :template =&gt; '/authentication/before_facebook_unlinking', :format =&gt; 'html'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  def registering_email_taken</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="38">
          <span class="hits">3</span>
          
          <code class="ruby">    render :layout =&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def successful_registration</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    render :layout =&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_conflicting_email</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="46">
          <span class="hits">3</span>
          
          <code class="ruby">    if !session[:other_email].blank? &amp;&amp; current_person.update_attribute(:email, session[:other_email]) </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="47">
          <span class="hits">2</span>
          
          <code class="ruby">      session[:other_email] = nil</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="48">
          <span class="hits">2</span>
          
          <code class="ruby">      render :nothing =&gt; true, :status =&gt; :ok</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">      render :text =&gt; current_person.errors.full_messages, :status =&gt; :unprocessable_entity</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">  def fb_linking_success</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="55">
          <span class="hits">4</span>
          
          <code class="ruby">    render :layout =&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_layout</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="61">
          <span class="hits">13</span>
          
          <code class="ruby">    request.xhr? ? 'content_for/main_body' : 'application'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  def require_facebook_authenticated</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="65">
          <span class="hits">13</span>
          
          <code class="ruby">    unless current_person.facebook_authenticated?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">      render :text =&gt; '&lt;p&gt;Your account needs to have been connected to Facebook in order to do this.&lt;/p&gt;' </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">      return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a6d917a1d04754d2cef9155c69c7f90f9b3f2473">
  <div class="header">
    <h3>app/controllers/blog_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>16</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class BlogController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # GET /blog/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    @blog_post = ContentItem.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    setup_meta_info(@blog_post)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  # GET /blog</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="11">
          <span class="hits">15</span>
          
          <code class="ruby">    @blogpost_description = ContentItemDescription.blog_post.first</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="12">
          <span class="hits">15</span>
          
          <code class="ruby">    @blog_authors = ContentItem.blog_authors</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="13">
          <span class="hits">15</span>
          
          <code class="ruby">    @current_author = Person.find(params[:author_id]) if params[:author_id]</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="14">
          <span class="hits">15</span>
          
          <code class="ruby">    @blog_rss_url = &quot;http://feeds.theciviccommons.com/civiccommonsblog&quot;</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="15">
          <span class="hits">15</span>
          
          <code class="ruby">    @topics = Topic.including_public_blogposts</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="16">
          <span class="hits">15</span>
          
          <code class="ruby">    @current_topic = Topic.find_by_id(params[:topic])</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="17">
          <span class="hits">15</span>
          
          <code class="ruby">    search = @current_topic ? @current_topic.blogposts : ContentItem.blog_post</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="18">
          <span class="hits">15</span>
          
          <code class="ruby">    @blog_posts = search.recent_blog_posts(@current_author.try(:id))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="20">
          <span class="hits">15</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="21">
          <span class="hits">15</span>
          
          <code class="ruby">      format.xml { @blog_posts = @blog_posts.limit(25) }</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="22">
          <span class="hits">30</span>
          
          <code class="ruby">      format.html { @blog_posts = @blog_posts.paginate(:page =&gt; params[:page], :per_page =&gt; 5) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f777b185c2162cc7d0b1ccacba2c0d57613aabdb">
  <div class="header">
    <h3>app/controllers/community_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>25</b> relevant lines. 
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class CommunityController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="4">
          <span class="hits">28</span>
          
          <code class="ruby">    @issue = Issue.find(params[:issue_id]) if params[:issue_id]</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="5">
          <span class="hits">28</span>
          
          <code class="ruby">    ordered_people</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="6">
          <span class="hits">28</span>
          
          <code class="ruby">    filtered_people</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="7">
          <span class="hits">28</span>
          
          <code class="ruby">    paginated_people</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="8">
          <span class="hits">28</span>
          
          <code class="ruby">    @regions = Region.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def ordered_people</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="13">
          <span class="hits">27</span>
          
          <code class="ruby">    @order = params[:order] || 'newest-member'</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="14">
          <span class="hits">27</span>
          
          <code class="ruby">    case @order</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    when 'alphabetical'</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="16">
          <span class="hits">4</span>
          
          <code class="ruby">      @subtitle = 'Alphabetical'</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="17">
          <span class="hits">4</span>
          
          <code class="ruby">      @community = @issue.present? ? @issue.order_by_alpha_users(params[:letter]) : Person.find_confirmed_order_by_last_name(params[:letter])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    when 'active-member'</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="19">
          <span class="hits">8</span>
          
          <code class="ruby">      @subtitle = 'Most Active'</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="20">
          <span class="hits">8</span>
          
          <code class="ruby">      @community = @issue.present? ? @issue.most_active_users : Person.find_confirmed_order_by_most_active</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="22">
          <span class="hits">15</span>
          
          <code class="ruby">      @subtitle = 'Newest Members'</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="23">
          <span class="hits">15</span>
          
          <code class="ruby">      @community = @issue.present? ? @issue.most_newest_users : Person.find_confirmed_order_by_recency</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def filtered_people</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="28">
          <span class="hits">27</span>
          
          <code class="ruby">    @current_filter = params[:filter] || 'all'</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="29">
          <span class="hits">27</span>
          
          <code class="ruby">    case @current_filter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    when 'all'</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="31">
          <span class="hits">20</span>
          
          <code class="ruby">      @community</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    when 'people'</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="33">
          <span class="hits">2</span>
          
          <code class="ruby">      @community = @community.only_people</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    when 'organizations'</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="35">
          <span class="hits">5</span>
          
          <code class="ruby">      @community = @community.only_organizations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def paginated_people</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="40">
          <span class="hits">27</span>
          
          <code class="ruby">    @community = @community.paginate(:page =&gt; params[:page], :per_page =&gt; 16)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="323a24c17bf94dc94e8ea94d7c1406e8fb33a92e">
  <div class="header">
    <h3>app/controllers/confirmations_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ConfirmationsController &lt; Devise::ConfirmationsController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="94568870a95d7da708979dd83d65ef471a28dd9f">
  <div class="header">
    <h3>app/controllers/content_controller.rb</h3>
    <h4><span class="red">50.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ContentController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    @content_item = ContentItem.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    setup_meta_info(@content_item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    @content_items = ContentItem.find_all_by_content_type(&quot;Untyped&quot;);</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="728774869e1f29714e826ab2a8774cedc4134df7">
  <div class="header">
    <h3>app/controllers/contributions_controller.rb</h3>
    <h4><span class="red">40.0 %</span> covered</h4>
    <div>
      <b>75</b> relevant lines. 
      <span class="green"><b>30</b> lines covered</span> and
      <span class="red"><b>45</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ContributionsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include ContributionsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include ConversationsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :load_conversation, only: [:edit, :update, :moderate, :moderated]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :verify_admin, only: [:moderate, :moderated]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user, only: [ :create ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    @conversation = Conversation.find(params[:conversation_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    Rails.logger.info @conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    unless params[:contribution][:url].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      embedly = EmbedlyService.new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      embedly.fetch_and_merge_params!(params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    @contribution = Contribution.new(params[:contribution])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    @contribution.person = current_person</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    @contribution.item = @conversation</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    @contribution.confirmed = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    if @contribution.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      flash[:notice] = &quot;Thank you for participating&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">      Subscription.create_unless_exists(current_person, @contribution.item)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      @ratings = RatingGroup.default_contribution_hash</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      @new_contribution = @conversation.contributions.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">      format.js { render &quot;conversations/create_node_contribution&quot;, locals: {css_classes: &quot;new&quot;} }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">      format.html do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">        # NOTE: this path does poor error handling - Jerry</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">        if @contribution.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">          redirect_to conversations_node_show_path(@conversation, @contribution.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">        elsif @contribution.parent</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">          redirect_to conversations_node_show_path(@conversation, @contribution.parent.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">          redirect_to conversations_path(@conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="45">
          <span class="hits">7</span>
          
          <code class="ruby">    @contribution = Contribution.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="46">
          <span class="hits">7</span>
          
          <code class="ruby">    if @contribution.destroy_by_user(current_person)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="47">
          <span class="hits">4</span>
          
          <code class="ruby">      flash[:notice] = &quot;Contribution has been deleted&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="49">
          <span class="hits">3</span>
          
          <code class="ruby">      flash[:notice] = &quot;Could not delete contribution&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="52">
          <span class="hits">7</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="53">
          <span class="hits">7</span>
          
          <code class="ruby">      format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_confirmed_contribution</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="58">
          <span class="hits">2</span>
          
          <code class="ruby">    @contribution = Contribution.create_node(params[:contribution], current_person, true)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="59">
          <span class="hits">2</span>
          
          <code class="ruby">    redirect_to(&quot;#{contribution_parent_page(@contribution)}#contribution#{@contribution.id}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                    :notice =&gt; 'Contribution was successfully created.')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">    @contribution = @conversation.contributions.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">      format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  # a url that is sent to facebook, when users like, or share a contribution</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">  def fb_link</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="72">
          <span class="hits">2</span>
          
          <code class="ruby">    @contribution = Contribution.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="73">
          <span class="hits">2</span>
          
          <code class="ruby">    unless request.env['HTTP_USER_AGENT'] =~ /facebookexternalhit/i</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">      redirect_to conversation_node_url(@contribution)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="76">
          <span class="hits">2</span>
          
          <code class="ruby">    setup_meta_info_for_conversation_contribution(@contribution)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">    @contribution = Contribution.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">    @contributions = @contribution.self_and_descendants</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">    @ratings = RatingGroup.ratings_for_conversation_by_contribution_with_count(@contribution.conversation, current_person)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="84">
          
          
          <code class="ruby">      format.js { render(:partial =&gt; &quot;conversations/threaded_contribution_template&quot;, :locals =&gt; { :ratings =&gt; @ratings }, :collection =&gt; @contributions, :as =&gt; :contribution) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">    @contribution = @conversation.contributions.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">    attributes = { contribution: params[:contribution] }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">    attributes = fetch_embedly_information(attributes, params[:contribution][:url]) unless params[:contribution][:url].blank? # TODO Move this to the model</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">    @success = @contribution.update_attributes_by_user(attributes, current_person)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">      format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">  def moderate</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">    @contribution = Contribution.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">  def moderated</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">    @contribution = Contribution.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">    @contribution.moderate_content(params, current_person)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="105">
          
          
          <code class="ruby">    redirect_to conversation_path(@conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">  def load_conversation</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">    if params.has_key?(:conversation_id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">      @conversation = Conversation.find(params[:conversation_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">  def fetch_embedly_information(attributes, url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">    attributes[:contribution][:url] = url</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="118">
          
          
          <code class="ruby">    embedly = EmbedlyService.new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">    embedly.fetch_and_merge_params!(attributes)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">    attributes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="955343a1518cfc8293a2e6703f0526f184c1337a">
  <div class="header">
    <h3>app/controllers/conversations_controller.rb</h3>
    <h4><span class="red">65.9 %</span> covered</h4>
    <div>
      <b>173</b> relevant lines. 
      <span class="green"><b>114</b> lines covered</span> and
      <span class="red"><b>59</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ConversationsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout 'opportunity', :except =&gt; :index</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :force_friendly_id, :only =&gt; :show</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user, :only =&gt; [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    :new,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    :create,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    :toggle_rating,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    :create_from_blog_post,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    :create_from_radioshow,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  ################################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # Conversation Modal Methods - BEGIN</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  ################################################################################</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def agree_to_be_civil_modal</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    render :partial =&gt; 'agree_to_be_civil_modal', :layout =&gt; nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def permission_to_use_image_modal</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    render :partial =&gt; 'permission_to_use_image_modal', :layout =&gt; nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def take_action</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    @conversation = Conversation.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    render :partial =&gt; 'take_conversation_action', :layout =&gt; nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  ################################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # Conversation Modal Methods - END</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  ################################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  # Topic Set Up</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def topic_setup</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    # List of Valid Topics and Number of Conversations Each Topic Has</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="34">
          <span class="hits">15</span>
          
          <code class="ruby">    @topics = Topic.where(&quot;topics.id != 9&quot;).filter_metro_region(default_region)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="35">
          <span class="hits">15</span>
          
          <code class="ruby">    @topics = @topics.including_conversations if @topics.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    # The Current Topic and It's Subtitle</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="38">
          <span class="hits">15</span>
          
          <code class="ruby">    @current_topic = Topic.find_by_id(params[:topic])</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="39">
          <span class="hits">15</span>
          
          <code class="ruby">    @subtitle = @current_topic.name if @current_topic</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="41">
          <span class="hits">15</span>
          
          <code class="ruby">    @search = @current_topic ? @current_topic.conversations : Conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  # GET /conversations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="46">
          <span class="hits">14</span>
          
          <code class="ruby">    topic_setup</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="48">
          <span class="hits">14</span>
          
          <code class="ruby">    @recommended = @search.filter_metro_region(default_region).recommended.limit(3)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="49">
          <span class="hits">14</span>
          
          <code class="ruby">    if default_region == cc_metro_region || default_region.blank? #&amp;&amp; !@current_topic.present?</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="50">
          <span class="hits">11</span>
          
          <code class="ruby">      @active = @search.filter_metro_region(default_region).most_active.limit(6)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="51">
          <span class="hits">11</span>
          
          <code class="ruby">      @recent = @search.filter_metro_region(default_region).latest_created.limit(6)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="53">
          <span class="hits">3</span>
          
          <code class="ruby">      @all_conversations = @search.filter_metro_region(default_region).paginate(:page =&gt; params[:page], :per_page =&gt; 12)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="56">
          <span class="hits">14</span>
          
          <code class="ruby">    @top_metro_regions = MetroRegion.top_metro_regions(5)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="58">
          <span class="hits">14</span>
          
          <code class="ruby">    @recent_items = Activity.most_recent_activity_items(limit: 3)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="59">
          <span class="hits">14</span>
          
          <code class="ruby">    render :index, :layout =&gt; 'category_index'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  # GET /conversations/recommended</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  # GET /conversations/active</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  # GET /conversations/recent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  def filter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">    topic_setup</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">    @filter = params[:filter]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">    @conversations = @search.filter_metro_region(default_region).filtered(@filter).paginate(:page =&gt; params[:page], :per_page =&gt; 12)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">    @top_metro_regions = MetroRegion.top_metro_regions(5)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">    @recent_items = Activity.most_recent_activity_items(limit: 3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">    render :filter, :layout =&gt; 'category_index'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  # GET /conversations/rss</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">  def rss</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="78">
          <span class="hits">3</span>
          
          <code class="ruby">    @conversations = Conversation.where(&quot;created_at &gt;= '#{1.month.ago}'&quot;).order(:created_at =&gt; :desc)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="79">
          <span class="hits">3</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="80">
          <span class="hits">3</span>
          
          <code class="ruby">      format.html { redirect_to(conversations_url) }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="81">
          <span class="hits">3</span>
          
          <code class="ruby">      format.xml</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  # GET /conversations/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="87">
          <span class="hits">10</span>
          
          <code class="ruby">    @new_conversation = params[:conversation_created] ? true : false</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="88">
          <span class="hits">10</span>
          
          <code class="ruby">    @conversation = Conversation.includes(:issues).find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="89">
          <span class="hits">10</span>
          
          <code class="ruby">    @conversation.visit!(current_person.id) if current_person</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="90">
          <span class="hits">10</span>
          
          <code class="ruby">    @contributions = @conversation.contributions.includes(:rating_groups, :person).confirmed.where(parent_id: nil).order(&quot;created_at DESC&quot;)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="91">
          <span class="hits">10</span>
          
          <code class="ruby">    @ratings = RatingGroup.ratings_for_conversation_by_contribution_with_count(@conversation, current_person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    # Build rating totals into contribution</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">    # @contributions.each do |c|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    #   c.ratings       #=&gt; {'some-descriptor' =&gt; {:total =&gt; 5, :person =&gt; true}, 'some-other' =&gt; 0, 'and-again' =&gt; 1}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">    # end</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="97">
          <span class="hits">19</span>
          
          <code class="ruby">    @top_level_contributions = @contributions.select{ |c| c.top_level_contribution? }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">    # grab all direct contributions to conversation that aren't TLC</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="99">
          <span class="hits">19</span>
          
          <code class="ruby">    @conversation_contributions = @contributions.select{ |c| !c.top_level_contribution? &amp;&amp; c.parent_id.nil? }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="101">
          <span class="hits">10</span>
          
          <code class="ruby">    @top_level_contribution = @conversation.contributions.new # for conversation comment form</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="102">
          <span class="hits">10</span>
          
          <code class="ruby">    @tlc_participants = @top_level_contributions.collect{ |tlc| tlc.owner }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="104">
          <span class="hits">10</span>
          
          <code class="ruby">    @latest_contribution = @conversation.confirmed_contributions.most_recent.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="106">
          <span class="hits">10</span>
          
          <code class="ruby">    @recent_items = @conversation.activities.where(&quot;item_type NOT IN (?)&quot;, [&quot;RatingGroup&quot;, &quot;Reflection&quot;, &quot;ReflectionComment&quot;]).order(&quot;created_at DESC&quot;).limit(30)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">    # The Participants in a Conversation               | Moved from View to Controller. TODO: Move to model</code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="109">
          <span class="hits">29</span>
          
          <code class="ruby">    @conversation_participants = @conversation.participants.select{ |p| !@tlc_participants.include?(p.id) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="111">
          <span class="hits">10</span>
          
          <code class="ruby">    setup_meta_info(@conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="113">
          <span class="hits">10</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="114">
          <span class="hits">17</span>
          
          <code class="ruby">      format.html{ render :show }</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="115">
          <span class="hits">10</span>
          
          <code class="ruby">      format.embed do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="116">
          <span class="hits">3</span>
          
          <code class="ruby">        html = render_to_string</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="117">
          <span class="hits">3</span>
          
          <code class="ruby">        json = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">          :html =&gt; html,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">          :js =&gt; [ActionController::Base.helpers.asset_path('conversations/show_embed.js')]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="121">
          <span class="hits">3</span>
          
          <code class="ruby">        render_widget(json)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="123">
          <span class="hits">10</span>
          
          <code class="ruby">      format.any{ render :show}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">  def embed</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="128">
          <span class="hits">3</span>
          
          <code class="ruby">    @conversation = Conversation.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="129">
          <span class="hits">3</span>
          
          <code class="ruby">    render :layout =&gt; 'application'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">  def activities</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="133">
          <span class="hits">12</span>
          
          <code class="ruby">    @page = params[:page].present? ? params[:page].to_i : 1</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="134">
          <span class="hits">12</span>
          
          <code class="ruby">    @hide_container = params[:hide_container]</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="135">
          <span class="hits">12</span>
          
          <code class="ruby">    @per_page = 5</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="136">
          <span class="hits">12</span>
          
          <code class="ruby">    @offset = @per_page * (@page - 1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="138">
          <span class="hits">12</span>
          
          <code class="ruby">    @conversation = Conversation.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">    # Added 1 to @per_page to see if there is a next page</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="141">
          <span class="hits">12</span>
          
          <code class="ruby">    @recent_items = Activity.most_recent_activity_items(conversation:@conversation, limit:@per_page + 1, offset:@offset, exclude_conversation:true)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="142">
          <span class="hits">12</span>
          
          <code class="ruby">    @next_page = @recent_items.length &gt; @per_page</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">    # if there is a next page, pop the last item because it was temporarily used to see if there is a next page.</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="145">
          <span class="hits">12</span>
          
          <code class="ruby">    @recent_items.pop if @next_page</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="147">
          <span class="hits">12</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="148">
          <span class="hits">12</span>
          
          <code class="ruby">      format.embed do</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="149">
          <span class="hits">5</span>
          
          <code class="ruby">        @embed = true # needed to differentiate the truncation limit on the activity content length when displaying as an embed</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="150">
          <span class="hits">5</span>
          
          <code class="ruby">        html = render_to_string</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="151">
          <span class="hits">5</span>
          
          <code class="ruby">        json = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">          :html =&gt; html,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">          :page =&gt; @page,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">          :next_page =&gt; @next_page,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">          :js =&gt; [ActionController::Base.helpers.asset_path('conversations/activities.embed.js')]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="157">
          <span class="hits">5</span>
          
          <code class="ruby">        render_widget(json)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">  def node_conversation</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="163">
          
          
          <code class="ruby">    @contribution = Contribution.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="164">
          
          
          <code class="ruby">    @contributions = @contribution.descendants.confirmed.includes(:person)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="165">
          
          
          <code class="ruby">    @contribution.visit!((current_person.nil? ? nil : current_person.id))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="167">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="168">
          
          
          <code class="ruby">      format.js { render :partial =&gt; &quot;conversations/node_conversation&quot;, :layout =&gt; false}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="169">
          
          
          <code class="ruby">      format.html { render :partial =&gt; &quot;conversations/node_conversation&quot;, :layout =&gt; false}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">  def node_permalink</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="174">
          
          
          <code class="ruby">    contribution = Contribution.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">    @contributions = contribution.self_and_ancestors</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="176">
          
          
          <code class="ruby">    @top_level_contribution = @contributions.root</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="177">
          
          
          <code class="ruby">    contribution.visit!((current_person.nil? ? nil : current_person.id))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="179">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="180">
          
          
          <code class="ruby">      format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">  # GET /conversations/new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="186">
          <span class="hits">11</span>
          
          <code class="ruby">    get_content_item(params)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="187">
          <span class="hits">11</span>
          
          <code class="ruby">    @conversation = Conversation.new</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="188">
          <span class="hits">11</span>
          
          <code class="ruby">    render :new, :layout =&gt; 'category_index'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">  # GET /conversations/1/edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">  # NOT IMPLEMENTED YET, I.E. NOT ROUTEABLE</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="194">
          
          
          <code class="ruby">    @conversation = Conversation.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">  # POST /conversations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="199">
          <span class="hits">9</span>
          
          <code class="ruby">    prep_convo(params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="201">
          <span class="hits">9</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="202">
          <span class="hits">9</span>
          
          <code class="ruby">      if @conversation.save</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="203">
          <span class="hits">14</span>
          
          <code class="ruby">        format.html { redirect_to(conversation_path(@conversation.id, :conversation_created =&gt; true), :notice =&gt; &quot;Thank you! You're helping to make your community stronger!&quot;) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="205">
          <span class="hits">4</span>
          
          <code class="ruby">        format.html { render :new, :layout =&gt; 'category_index' }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">  # PUT /conversations/blog/:id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_from_blog_post</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="212">
          
          
          <code class="ruby">    @blog_post = ContentItem.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="213">
          
          
          <code class="ruby">    if request.xhr?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="214">
          
          
          <code class="ruby">      render partial: 'shared/redirect_after_xhr', locals: { url: blog_url(@blog_post) }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="215">
          
          
          <code class="ruby">    elsif @blog_post.conversation</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="216">
          
          
          <code class="ruby">      redirect_to conversation_url(@blog_post.conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="218">
          
          
          <code class="ruby">      params[:conversation][:summary] = &quot;&lt;em&gt;This is a conversation about a blog post from #{@blog_post.author.name}: &lt;a href=\&quot;#{blog_url(@blog_post)}\&quot;&gt;#{@blog_post.title}&lt;/a&gt;&lt;/em&gt;&lt;br/&gt;&lt;br/&gt;#{@blog_post.summary}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="219">
          
          
          <code class="ruby">      params[:conversation][:title] = &quot;Blog Post: #{@blog_post.title}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="220">
          
          
          <code class="ruby">      params[:conversation][:zip_code] = &quot;ALL&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="221">
          
          
          <code class="ruby">      prep_convo(params)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="222">
          
          
          <code class="ruby">      if @conversation.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="223">
          
          
          <code class="ruby">        @blog_post.conversation = @conversation</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="224">
          
          
          <code class="ruby">        @blog_post.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="225">
          
          
          <code class="ruby">        redirect_to conversation_path(@conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="227">
          
          
          <code class="ruby">        render 'blog/show'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">  # PUT /conversations/radio/:id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_from_radioshow</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="234">
          
          
          <code class="ruby">    @radioshow = ContentItem.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="235">
          
          
          <code class="ruby">    if request.xhr?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">      render partial: 'shared/redirect_after_xhr', locals: { url: radioshow_url(@radioshow) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="238">
          
          
          <code class="ruby">      params[:conversation][:summary] = &quot;&lt;em&gt;This is a conversation about The Civic Commons Radio &lt;a href=\&quot;#{radioshow_url(@radioshow)}\&quot;&gt;#{@radioshow.title}&lt;/a&gt;&lt;/em&gt;&lt;br/&gt;&lt;br/&gt;#{@radioshow.summary}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="239">
          
          
          <code class="ruby">      params[:conversation][:title] = &quot;The Civic Commons Radio #{@radioshow.title}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="240">
          
          
          <code class="ruby">      params[:conversation][:zip_code] = &quot;ALL&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="241">
          
          
          <code class="ruby">      prep_convo(params)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="242">
          
          
          <code class="ruby">      if @conversation.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="243">
          
          
          <code class="ruby">        @radioshow.conversations &lt;&lt; @conversation</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="244">
          
          
          <code class="ruby">        redirect_to conversation_path(@conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="246">
          
          
          <code class="ruby">        render 'radioshow/show'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">  # PUT /conversations/1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">  # NOT IMPLEMENTED YET, I.E. NOT ROUTEABLE</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="254">
          
          
          <code class="ruby">    @conversation = Conversation.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="256">
          
          
          <code class="ruby">    if @conversation.update_attributes(params[:conversation])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="257">
          
          
          <code class="ruby">      redirect_to(@conversation, :notice =&gt; 'Conversation was successfully updated.')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="259">
          
          
          <code class="ruby">      render :action =&gt; &quot;edit&quot;, :status =&gt; :unprocessable_entity</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="260">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">  def toggle_rating</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="264">
          
          
          <code class="ruby">    @contribution = Contribution.find(params[:contribution_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="265">
          
          
          <code class="ruby">    @rating_descriptor = RatingDescriptor.find_by_title(params[:rating_descriptor_title])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="267">
          
          
          <code class="ruby">    @rating_group = RatingGroup.toggle_rating!(current_person, @contribution, @rating_descriptor)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="268">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="269">
          
          
          <code class="ruby">      format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="270">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="273">
          <span class="hits">1</span>
          
          <code class="ruby">  def updates</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="274">
          
          
          <code class="ruby">    @conversation = Conversation.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="275">
          
          
          <code class="ruby">    @ratings = RatingGroup.ratings_for_conversation_by_contribution_with_count(@conversation, current_person)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="276">
          
          
          <code class="ruby">    @new_contribution = @conversation.contributions.new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="277">
          
          
          <code class="ruby">    @time = params[:time].to_datetime</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="278">
          
          
          <code class="ruby">    @items = @conversation.activities.where(&quot;item_created_at &gt; ?&quot;, @time)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="280">
          
          
          <code class="ruby">    @contributions = @conversation.contributions.where(&quot;created_at &gt; ?&quot;, @time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="281">
          
          
          <code class="ruby">    @contributions = @contributions.where(&quot;owner &lt;&gt; ?&quot;, current_person.id) if current_person</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="282">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="283">
          
          
          <code class="ruby">      format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="287">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">  def force_friendly_id</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="290">
          <span class="hits">9</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="291">
          <span class="hits">9</span>
          
          <code class="ruby">      @conversation = Conversation.find params[:id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">    rescue ActiveRecord::RecordNotFound</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="293">
          
          
          <code class="ruby">      render 'public/404.html', :layout =&gt; nil, :status =&gt; 404 and return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="296">
          
          
          <code class="ruby">    # If an old id or a numeric id was used to find the record, then</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby">    # the request path will not match the post_path, and we should do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">    # a 301 redirect that uses the current friendly id.</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="299">
          <span class="hits">9</span>
          
          <code class="ruby">    if request.format != 'embed' and request.path != conversation_path(@conversation)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="300">
          <span class="hits">3</span>
          
          <code class="ruby">      return redirect_to request.parameters.merge({:id =&gt; @conversation.slug, :status =&gt; :moved_permanently})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">  def prep_convo(params)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="305">
          <span class="hits">9</span>
          
          <code class="ruby">    @conversation = Conversation.new(params[:conversation])</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="306">
          <span class="hits">9</span>
          
          <code class="ruby">    get_content_item(params)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="307">
          <span class="hits">9</span>
          
          <code class="ruby">    @conversation.content_items = [@content_item] if @content_item.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="309">
          <span class="hits">9</span>
          
          <code class="ruby">    @conversation.person = current_person</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="310">
          <span class="hits">9</span>
          
          <code class="ruby">    @conversation.from_community = true</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="311">
          <span class="hits">9</span>
          
          <code class="ruby">    @conversation.started_at = Time.now</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="312">
          <span class="hits">9</span>
          
          <code class="ruby">    @conversation.contributions.each do |contribution|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="313">
          
          
          <code class="ruby">      contribution.confirmed = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="314">
          
          
          <code class="ruby">      contribution.item = @conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="318">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_content_item(params)</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="319">
          <span class="hits">18</span>
          
          <code class="ruby">    if params[:radioshow_id] || params[:blog_id]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="320">
          <span class="hits">4</span>
          
          <code class="ruby">      @content_item = ContentItem.find(params[:radioshow_id]||params[:blog_id])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="321">
          <span class="hits">4</span>
          
          <code class="ruby">      @start_from = @content_item.content_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f3e81f2e56a3678dc6b58949ebf86430443a2958">
  <div class="header">
    <h3>app/controllers/curated_feed_item_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class CuratedFeedItemController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  # Retrieve curated feed and related entries to create RSS feed</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def curated_feed</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    @curated_feed = CuratedFeed.find(params[:curated_feed_id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    @curated_feed_items = CuratedFeedItem.where(:curated_feed_id =&gt; @curated_feed.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0d3a0dc1d2feaddf9157e41fbc37da081fa059bc">
  <div class="header">
    <h3>app/controllers/feeds_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class FeedsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # GET /feeds/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="5">
          <span class="hits">2</span>
          
          <code class="ruby">    @feed = CuratedFeed.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    render :show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  rescue ActiveRecord::RecordNotFound =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    redirect_to feeds_path, format: :html</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fbecacca6a6fa5359976d086a649e54e20a4d671">
  <div class="header">
    <h3>app/controllers/homepage_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class HomepageController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout 'homepage'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="161" data-linenumber="5">
          <span class="hits">161</span>
          
          <code class="ruby">    @most_recent_conversation  = Conversation.latest_created.limit(1)</code>
        </li>
      
        <li class="covered" data-hits="161" data-linenumber="6">
          <span class="hits">161</span>
          
          <code class="ruby">    @most_active_conversation  = Conversation.most_active(filter:@most_recent_conversation).limit(1)</code>
        </li>
      
        <li class="covered" data-hits="161" data-linenumber="7">
          <span class="hits">161</span>
          
          <code class="ruby">    @most_recommended_conversation = Conversation.recommended(filter:[@most_recent_conversation, @most_active_conversation]).limit(1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="161" data-linenumber="9">
          <span class="hits">161</span>
          
          <code class="ruby">    @recent_items = Activity.most_recent_activity_items(limit: 3)</code>
        </li>
      
        <li class="covered" data-hits="161" data-linenumber="10">
          <span class="hits">161</span>
          
          <code class="ruby">    @recent_blog_posts = ContentItem.recent_blog_posts.limit(3)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="161" data-linenumber="12">
          <span class="hits">161</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="161" data-linenumber="13">
          <span class="hits">161</span>
          
          <code class="ruby">      format.html</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f5493a4632db90eafb93e577a7e37d099c023502">
  <div class="header">
    <h3>app/controllers/invites_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class InvitesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="5">
          <span class="hits">3</span>
          
          <code class="ruby">    @invite = Invite.new</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="6">
          <span class="hits">3</span>
          
          <code class="ruby">    @invite.source_type = params[:source_type]</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="7">
          <span class="hits">3</span>
          
          <code class="ruby">    @invite.source_id = params[:source_id]</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="8">
          <span class="hits">3</span>
          
          <code class="ruby">    @invite.user = current_person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="10">
          <span class="hits">3</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="11">
          <span class="hits">3</span>
          
          <code class="ruby">      if request.xhr?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">        format.html { render :partial =&gt; 'form', :layout =&gt; false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">        format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="15">
          <span class="hits">2</span>
          
          <code class="ruby">        format.html</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="21">
          <span class="hits">2</span>
          
          <code class="ruby">    @invite = Invite.new(params[:invite])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">    @invite.user = current_person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">      if @invite.valid?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">        @invite.send_invites</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">        @notice = &quot;Thank you! You're helping to make your community stronger!&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="29">
          <span class="hits">2</span>
          
          <code class="ruby">        format.html{ redirect_to({ :controller =&gt; @invite.source_type, :action =&gt; :show, :id =&gt; @invite.source_id }, :notice =&gt; @notice) }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">        format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">        flash[:notice] = @error = &quot;There was a problem with this form: #{@invite.errors.full_messages.to_sentence}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="34">
          <span class="hits">2</span>
          
          <code class="ruby">        format.html { render :action =&gt; &quot;new&quot; }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="15465242920f4c87a785f825b3094a17688bcb3c">
  <div class="header">
    <h3>app/controllers/issues_controller.rb</h3>
    <h4><span class="red">67.5 %</span> covered</h4>
    <div>
      <b>40</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>13</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class IssuesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout 'category_index'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user, :only =&gt; [:create_contribution]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # GET /issues</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="7">
          <span class="hits">9</span>
          
          <code class="ruby">    @topics = Topic.filter_metro_region(default_region).including_public_issues</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="8">
          <span class="hits">9</span>
          
          <code class="ruby">    @current_topic = Topic.find_by_id(params[:topic])</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="9">
          <span class="hits">9</span>
          
          <code class="ruby">    @subtitle = @current_topic.name if @current_topic</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="11">
          <span class="hits">9</span>
          
          <code class="ruby">    @search = @current_topic ? @current_topic.issues : Issue</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="12">
          <span class="hits">9</span>
          
          <code class="ruby">    @issues = @search.filter_metro_region(default_region).standard_issue.published.custom_order.paginate(:page =&gt; params[:page], :per_page =&gt; 20)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="13">
          <span class="hits">9</span>
          
          <code class="ruby">    @recent_items = Activity.most_recent_activity_items(limit: 3)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="14">
          <span class="hits">9</span>
          
          <code class="ruby">    @top_metro_regions = MetroRegion.top_metro_regions(5)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  # GET /issues/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="19">
          <span class="hits">13</span>
          
          <code class="ruby">    issue = Issue.includes(:conversations, :participants).find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="20">
          <span class="hits">13</span>
          
          <code class="ruby">    @issue = IssuePresenter.new(issue)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="21">
          <span class="hits">13</span>
          
          <code class="ruby">    @issue.visit!((current_person.nil? ? nil : current_person.id))</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="22">
          <span class="hits">13</span>
          
          <code class="ruby">    setup_meta_info(@issue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="24">
          <span class="hits">13</span>
          
          <code class="ruby">    if @issue.managed? and @issue.index</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">      @page = @issue.index</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="26">
          <span class="hits">2</span>
          
          <code class="ruby">      render 'managed_issue_pages/show'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="28">
          <span class="hits">11</span>
          
          <code class="ruby">      @latest_conversations = @issue.conversations.latest_updated.limit(3)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="29">
          <span class="hits">11</span>
          
          <code class="ruby">      all_conversations_on_issue = @issue.conversations.latest_updated</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="30">
          <span class="hits">11</span>
          
          <code class="ruby">      @conversations = all_conversations_on_issue.paginate(:page =&gt; params[:page], :per_page =&gt; 6)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="31">
          <span class="hits">11</span>
          
          <code class="ruby">      @people = @issue.most_active_users.limit(20)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="32">
          <span class="hits">11</span>
          
          <code class="ruby">      @people_count = @issue.community_user_ids.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="34">
          <span class="hits">11</span>
          
          <code class="ruby">      @conversation_comments = @issue.conversation_comments.most_recent</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="35">
          <span class="hits">11</span>
          
          <code class="ruby">      @contributions = @issue.contributions.includes(:person).most_recent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      #@recent_items = Activity.most_recent_activity_items(issue:issue, limit:5)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_contribution</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">    @issue = Issue.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    params[:contribution].merge!(:issue_id =&gt; @issue.id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">    unless params[:contribution][:url].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">      embedly = EmbedlyService.new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">      embedly.fetch_and_merge_params!(params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    @contribution = Contribution.create_node(params[:contribution], current_person, true)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">    Subscription.create_unless_exists(current_person, @issue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">      if @contribution.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">        format.html { render :partial =&gt; 'issues/create_contribution', :locals =&gt; {:issue =&gt; @issue}, :status =&gt; :created }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">        format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">        format.html { render :json =&gt; {:errors =&gt; @contribution.errors.full_messages }, :status =&gt; :unprocessable_entity }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">        format.js { render :json =&gt; {:errors =&gt; @contribution.errors.full_messages }, :status =&gt; :unprocessable_entity }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="20efaff71608d94825afc47f0d710ecc5cb79458">
  <div class="header">
    <h3>app/controllers/links_controller.rb</h3>
    <h4><span class="red">37.5 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>15</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class LinksController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :remember_url, :require_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    @issues = Issue.alphabetical</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    @conversations = Conversation.all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    @contribution = Contribution.new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    @contribution.url = link</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    @contribution.title = title</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    forget_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    @link = Contribution.new params[:contribution]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    @link.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    redirect_to &quot;/&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def remember_url</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    return if params[:link].nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    session[:link] = params[:link]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    session[:title] = params[:title]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def forget_url</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    session[:link] = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def title</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    session[:title] || params[:title]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def link</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    session[:link] || params[:link]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="afb063aa1e013bb15d08e1526f6ae1f6e1d13da4">
  <div class="header">
    <h3>app/controllers/managed_issue_pages_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>8</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ManagedIssuePagesController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="4">
          <span class="hits">7</span>
          
          <code class="ruby">    @issue = ManagedIssue.find(params[:issue_id])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="5">
          <span class="hits">4</span>
          
          <code class="ruby">    @page = ManagedIssuePage.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="6">
          <span class="hits">2</span>
          
          <code class="ruby">    render :show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  rescue ActiveRecord::RecordNotFound =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="8">
          <span class="hits">5</span>
          
          <code class="ruby">    if @issue</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="9">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to issue_path(@issue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="11">
          <span class="hits">3</span>
          
          <code class="ruby">      redirect_to issues_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b2b6d3e450acb8b5dadc072a08cd06987f91807b">
  <div class="header">
    <h3>app/controllers/metro_regions_controller.rb</h3>
    <h4><span class="yellow">81.82 %</span> covered</h4>
    <div>
      <b>11</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class MetroRegionsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include RegionHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def filter</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="5">
          <span class="hits">4</span>
          
          <code class="ruby">    default_region(params[:metrocode])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="6">
          <span class="hits">4</span>
          
          <code class="ruby">    redirect_to_back(conversations_url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def cancel_regions_filter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    if signed_in?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      current_person.default_region = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      current_person.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    cookies.delete( :default_region )</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    redirect_to_back(conversations_url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f09f0273543bf2cbeb84911aaee855e9e0a5b981">
  <div class="header">
    <h3>app/controllers/news_controller.rb</h3>
    <h4><span class="red">40.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class NewsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # GET /news</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">      format.xml { @news_items = ContentItem.where(&quot;content_type = 'NewsItem' AND (published &lt;= curdate() OR DAY(published) = DAY(curdate())) &quot;).order(&quot;published desc&quot;).limit(25) }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">      format.html { @news_items = ContentItem.where(&quot;content_type = 'NewsItem' AND (published &lt;= curdate() OR DAY(published) = DAY(curdate())) &quot;).order(&quot;published desc&quot;).paginate(:page =&gt; params[:page], :per_page =&gt; 5) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3d7b9fc0411e5c7fbfdaa59310d2e443f2b175a3">
  <div class="header">
    <h3>app/controllers/notifications_controller.rb</h3>
    <h4><span class="red">50.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class NotificationsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout :nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    @notification = Notification.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    @notifications = Notification.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def viewed</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    if current_person</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      Notification.viewed(current_person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      render :nothing =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7033e328f3305da6b0ecd00b54844c0b70d1e165">
  <div class="header">
    <h3>app/controllers/opportunity_votes_controller.rb</h3>
    <h4><span class="green">91.23 %</span> covered</h4>
    <div>
      <b>57</b> relevant lines. 
      <span class="green"><b>52</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class OpportunityVotesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout 'opportunity'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user, :except =&gt; [:show]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :find_conversation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :find_vote, :only =&gt; [:create_select_options, :create_rank_options]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :restrict_voter_access, :only =&gt; [:select_options,:create_select_options,:rank_options, :create_rank_options]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  DEFAULT_NUM_OF_OPTIONS = 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="10">
          <span class="hits">6</span>
          
          <code class="ruby">    @vote = Vote.new(:max_selected_options =&gt; 1)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="11">
          <span class="hits">6</span>
          
          <code class="ruby">    DEFAULT_NUM_OF_OPTIONS.times do |i|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="12">
          <span class="hits">6</span>
          
          <code class="ruby">      @vote.options.build(:position =&gt; i+1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="17">
          <span class="hits">5</span>
          
          <code class="ruby">    @vote = Vote.new(params[:vote])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="18">
          <span class="hits">5</span>
          
          <code class="ruby">    @vote.surveyable = @conversation</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="19">
          <span class="hits">5</span>
          
          <code class="ruby">    @vote.person = current_person</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="20">
          <span class="hits">5</span>
          
          <code class="ruby">    @vote.show_progress = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="22">
          <span class="hits">5</span>
          
          <code class="ruby">    if @vote.save</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">      redirect_to(conversation_vote_path(@conversation, @vote, :anchor =&gt; 'opportunity-nav'), :notice =&gt; 'Vote was successfully created.')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="25">
          <span class="hits">4</span>
          
          <code class="ruby">      render :action =&gt; &quot;new&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="30">
          <span class="hits">10</span>
          
          <code class="ruby">    @vote = @conversation.surveys.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="31">
          <span class="hits">10</span>
          
          <code class="ruby">    @vote_response_presenter = VoteResponsePresenter.new(:person_id =&gt; try(:current_person).try(:id), :survey_id =&gt; @vote.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def select_options</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    @vote = @conversation.surveys.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    selected_option_ids = params[:selected_option_ids].to_s.split(',') || []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">    @vote_response_presenter = VoteResponsePresenter.new({:person_id =&gt; current_person.id, :survey_id =&gt; @vote.id}.merge!(:selected_option_ids =&gt; selected_option_ids))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">    render :action =&gt; :show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_select_options</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="42">
          <span class="hits">5</span>
          
          <code class="ruby">    attributes = {:person_id =&gt; current_person.id, :survey_id =&gt; @vote.id}</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="43">
          <span class="hits">5</span>
          
          <code class="ruby">    @vote_response_presenter = VoteResponsePresenter.new(attributes.merge(@vote_response_params))</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="44">
          <span class="hits">5</span>
          
          <code class="ruby">    if @vote_response_presenter.valid_selected_options?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      # If only one is selected then create the vote and don't go to the rank options page</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="47">
          <span class="hits">3</span>
          
          <code class="ruby">      if @vote_response_presenter.only_one_selected_option?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="48">
          <span class="hits">2</span>
          
          <code class="ruby">        @vote_response_presenter = VoteResponsePresenter.new(attributes.merge(selected_option_1_id: @vote_response_params[:selected_option_ids].first))</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="49">
          <span class="hits">2</span>
          
          <code class="ruby">        save_the_vote_and_redirect</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">        redirect_to rank_options_conversation_vote_path(@conversation,@vote,:selected_option_ids =&gt; @vote_response_presenter.selected_option_ids.join(','), :anchor =&gt; 'opportunity-nav')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">      render :action =&gt; :show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def rank_options</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">    selected_option_ids = params[:selected_option_ids].to_s.split(',') || []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">    @vote = @conversation.surveys.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">    @vote_response_presenter = VoteResponsePresenter.new({:person_id =&gt; current_person.id, :survey_id =&gt; @vote.id}.merge!(:selected_option_ids =&gt; selected_option_ids))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_rank_options</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">    @vote_response_presenter = VoteResponsePresenter.new({:person_id =&gt; current_person.id, :survey_id =&gt; @vote.id}.merge!(@vote_response_params))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">    save_the_vote_and_redirect</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">  def save_the_vote_and_redirect</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="73">
          <span class="hits">3</span>
          
          <code class="ruby">    if @vote_response_presenter.save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="74">
          <span class="hits">3</span>
          
          <code class="ruby">      flash[:notice] = &quot;Thank you for voting!&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="75">
          <span class="hits">3</span>
          
          <code class="ruby">      redirect_to rank_options_conversation_vote_path(@conversation,@vote, :anchor =&gt; 'opportunity-nav')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">      render :action =&gt; :rank_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">  def find_vote</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="82">
          <span class="hits">6</span>
          
          <code class="ruby">    @vote_response_params = params[:vote_response_presenter] || {}</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="83">
          <span class="hits">6</span>
          
          <code class="ruby">    @vote = @conversation.surveys.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  def find_conversation</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="87">
          <span class="hits">31</span>
          
          <code class="ruby">    @conversation = Conversation.find(params[:conversation_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">  def restrict_voter_access</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="91">
          <span class="hits">10</span>
          
          <code class="ruby">    vote = VoteResponsePresenter.new({:person_id =&gt; current_person.id, :survey_id =&gt; params[:id]})</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="92">
          <span class="hits">10</span>
          
          <code class="ruby">    redirect_to conversation_vote_path(@conversation,params[:id], :anchor =&gt; 'opportunity-nav') unless vote.allowed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0c364ca8066afafd2b526d428b57218d93b9e4cb">
  <div class="header">
    <h3>app/controllers/pages_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PagesController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="4">
          <span class="hits">4</span>
          
          <code class="ruby">    @template = ContentTemplate.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="5">
          <span class="hits">2</span>
          
          <code class="ruby">    render :show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  rescue ActiveRecord::RecordNotFound =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    redirect_to root_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5aa2f75b5440ca0e65701fff4231936f4f4e4e02">
  <div class="header">
    <h3>app/controllers/passwords_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PasswordsController &lt; Devise::PasswordsController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_ssl, :only =&gt; [:new, :create]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  skip_before_filter :require_no_ssl</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # POST /resource/password</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="8">
          <span class="hits">7</span>
          
          <code class="ruby">    self.resource = resource_class.send_reset_password_instructions(params[resource_name])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="10">
          <span class="hits">7</span>
          
          <code class="ruby">    if resource.facebook_authenticated?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="11">
          <span class="hits">4</span>
          
          <code class="ruby">      @fb_auth_forgot_password = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      # resets the resource, as new instance</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="14">
          <span class="hits">4</span>
          
          <code class="ruby">      build_resource({})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="16">
          <span class="hits">4</span>
          
          <code class="ruby">      render_with_scope :new</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="17">
          <span class="hits">3</span>
          
          <code class="ruby">    elsif resource.errors.empty?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="18">
          <span class="hits">2</span>
          
          <code class="ruby">      set_flash_message :notice, :send_instructions</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="19">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to new_session_path(resource_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      render_with_scope :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def fb_auth_forgot_password</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="26">
          <span class="hits">2</span>
          
          <code class="ruby">    render :layout =&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1b22ff703b28ddc5422fd67c58908ecad61040e6">
  <div class="header">
    <h3>app/controllers/petitions_controller.rb</h3>
    <h4><span class="green">95.56 %</span> covered</h4>
    <div>
      <b>45</b> relevant lines. 
      <span class="green"><b>43</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PetitionsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout 'opportunity'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user, :except =&gt; [:show, :print]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :verify_admin, :only =&gt; [:edit,:update,:destroy]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :find_conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="9">
          <span class="hits">3</span>
          
          <code class="ruby">    @petition = @conversation.petitions.build</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="13">
          <span class="hits">9</span>
          
          <code class="ruby">    @petition = @conversation.petitions.includes(:signatures).includes(:signers).find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="14">
          <span class="hits">9</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="15">
          <span class="hits">9</span>
          
          <code class="ruby">      format.html</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="16">
          <span class="hits">9</span>
          
          <code class="ruby">      format.pdf</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="21">
          <span class="hits">2</span>
          
          <code class="ruby">    @petition = @conversation.petitions.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="25">
          <span class="hits">4</span>
          
          <code class="ruby">    @petition = @conversation.petitions.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="26">
          <span class="hits">4</span>
          
          <code class="ruby">    if @petition.update_attributes(params[:petition])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="27">
          <span class="hits">3</span>
          
          <code class="ruby">      redirect_to conversation_petition_path(@conversation, @petition)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">      render :action =&gt; :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="34">
          <span class="hits">5</span>
          
          <code class="ruby">    @petition = @conversation.petitions.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="35">
          <span class="hits">5</span>
          
          <code class="ruby">    @petition.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="37">
          <span class="hits">5</span>
          
          <code class="ruby">    flash[:notice] = 'The petition have been successfully deleted'</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="38">
          <span class="hits">5</span>
          
          <code class="ruby">    redirect_to conversation_actions_path(@conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="42">
          <span class="hits">6</span>
          
          <code class="ruby">    @petition = @conversation.petitions.build(params[:petition])</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="43">
          <span class="hits">6</span>
          
          <code class="ruby">    @petition.person_id = current_person.id</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="44">
          <span class="hits">6</span>
          
          <code class="ruby">    if @petition.save</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="45">
          <span class="hits">4</span>
          
          <code class="ruby">      @petition.sign(current_person)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="46">
          <span class="hits">4</span>
          
          <code class="ruby">      redirect_to conversation_petition_path(@conversation, @petition)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="48">
          <span class="hits">2</span>
          
          <code class="ruby">      render :action =&gt; :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">  def sign</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="53">
          <span class="hits">4</span>
          
          <code class="ruby">    @petition = @conversation.petitions.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="54">
          <span class="hits">4</span>
          
          <code class="ruby">    @petition.sign(current_person)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="55">
          <span class="hits">4</span>
          
          <code class="ruby">    flash[:petition_notice] = '&lt;strong&gt;Thank you!&lt;/strong&gt; You successfully signed this petition.'</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="56">
          <span class="hits">4</span>
          
          <code class="ruby">    redirect_to conversation_petition_path(@conversation, @petition)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def sign_modal</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="60">
          <span class="hits">2</span>
          
          <code class="ruby">    @petition = @conversation.petitions.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    #returns the sign modal dialog</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="62">
          <span class="hits">2</span>
          
          <code class="ruby">    render :layout =&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  def print</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">    @petition = @conversation.petitions.includes(:signatures).includes(:signers).find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">    render layout: false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">  def find_conversation</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="72">
          <span class="hits">35</span>
          
          <code class="ruby">    @conversation = Conversation.find(params[:conversation_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="064cb0d26b789ba09332ce2be6c0ed35942a8f76">
  <div class="header">
    <h3>app/controllers/products_services_controller.rb</h3>
    <h4><span class="red">36.36 %</span> covered</h4>
    <div>
      <b>11</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProductsServicesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def promotion</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    @promotion_form_presenter = PromotionFormPresenter.new(:product =&gt; params[:product])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def submit_promotion</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    @promotion_form_presenter = PromotionFormPresenter.new(params[:promotion_form_presenter])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    if @promotion_form_presenter.valid?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      Notifier.products_services_promo(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">        @promotion_form_presenter.name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">        @promotion_form_presenter.email,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">        @promotion_form_presenter.question,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">        @promotion_form_presenter.product).deliver</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      flash[:notice] = &quot;Thank you contacting us! We'll get back to you shortly!&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">      redirect_to products_services_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      render :action =&gt; :promotion</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="74d67efed2bcda8ef16ae3ccccd440c73444b0f1">
  <div class="header">
    <h3>app/controllers/projects_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProjectsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout 'category_index'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  # GET /projects</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="6">
          <span class="hits">4</span>
          
          <code class="ruby">    @projects = Issue.filter_metro_region(default_region).managed_issue.published.custom_order.paginate(:page =&gt; params[:page], :per_page =&gt; 20)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="7">
          <span class="hits">4</span>
          
          <code class="ruby">    @recent_items = Activity.most_recent_activity_items(limit: 3)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="8">
          <span class="hits">4</span>
          
          <code class="ruby">    @top_metro_regions = MetroRegion.top_metro_regions(5)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0d087bbbcf49e232b84b91a431ee33faa1500fb7">
  <div class="header">
    <h3>app/controllers/radioshow_controller.rb</h3>
    <h4><span class="green">94.44 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class RadioshowController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # GET /radioshow/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="5">
          <span class="hits">2</span>
          
          <code class="ruby">    @radioshow_description = ContentItemDescription.radio_show.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    @radioshow = ContentItem.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="8">
          <span class="hits">2</span>
          
          <code class="ruby">    setup_meta_info(@radioshow)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  # GET /radioshow</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="13">
          <span class="hits">3</span>
          
          <code class="ruby">    @radioshow_description = ContentItemDescription.radio_show.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="15">
          <span class="hits">3</span>
          
          <code class="ruby">    @topics = Topic.including_public_radioshows</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="16">
          <span class="hits">3</span>
          
          <code class="ruby">    @current_topic = Topic.find_by_id(params[:topic])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="17">
          <span class="hits">3</span>
          
          <code class="ruby">    search = @current_topic ? @current_topic.radioshows : ContentItem.radio_show</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="18">
          <span class="hits">3</span>
          
          <code class="ruby">    @radioshows = search.where('published &lt;= curdate() OR DAY(published) = DAY(curdate())').order(&quot;published desc&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="20">
          <span class="hits">3</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="21">
          <span class="hits">3</span>
          
          <code class="ruby">      format.xml { @radioshows = @radioshows.limit(25) }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="22">
          <span class="hits">3</span>
          
          <code class="ruby">      format.html do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="23">
          <span class="hits">3</span>
          
          <code class="ruby">        @radioshows = @radioshows.paginate(:page =&gt; params[:page], :per_page =&gt; 5)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="24">
          <span class="hits">3</span>
          
          <code class="ruby">        @recent_blog_posts = ContentItem.recent_blog_posts.limit(3)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  # GET /podcast</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def podcast</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    @radioshows = ContentItem.radio_show('published &lt;= curdate() OR DAY(published) = DAY(curdate())').order(&quot;published desc&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fd968a677496a731149febfa23c7c24c5c95493a">
  <div class="header">
    <h3>app/controllers/reflection_comments_controller.rb</h3>
    <h4><span class="green">93.94 %</span> covered</h4>
    <div>
      <b>33</b> relevant lines. 
      <span class="green"><b>31</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ReflectionCommentsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout 'opportunity'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user, :only =&gt; [:create, :edit, :update, :destroy]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :find_conversation_and_reflection</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :find_comment, :only =&gt; [:edit, :update, :destroy]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :verify_moderating_ability, :only =&gt; [:edit, :update, :destroy]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="14">
          <span class="hits">4</span>
          
          <code class="ruby">    if @comment.update_attributes(params[:reflection_comment])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="15">
          <span class="hits">3</span>
          
          <code class="ruby">      flash[:notice] = 'This comment has been successfully updated'</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="16">
          <span class="hits">3</span>
          
          <code class="ruby">      redirect_to conversation_reflection_path(@conversation,@reflection)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">      render :action =&gt; :edit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="23">
          <span class="hits">3</span>
          
          <code class="ruby">    @comment.destroy</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="24">
          <span class="hits">3</span>
          
          <code class="ruby">    flash[:notice] = 'This comment has been successfully deleted'</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="25">
          <span class="hits">3</span>
          
          <code class="ruby">    redirect_to conversation_reflection_path(@conversation,@reflection)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="29">
          <span class="hits">5</span>
          
          <code class="ruby">    @comment = @reflection.comments.build(params[:reflection_comment])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="30">
          <span class="hits">5</span>
          
          <code class="ruby">    @comment.person_id = current_person.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="32">
          <span class="hits">5</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="33">
          <span class="hits">5</span>
          
          <code class="ruby">      if @comment.save</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="34">
          <span class="hits">8</span>
          
          <code class="ruby">        format.html { redirect_to conversation_reflection_path @conversation, @reflection }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="36">
          <span class="hits">2</span>
          
          <code class="ruby">        format.html { render :template =&gt; '/reflections/show' }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def find_comment</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="44">
          <span class="hits">9</span>
          
          <code class="ruby">    @comment = @reflection.comments.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  def verify_moderating_ability</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="48">
          <span class="hits">3</span>
          
          <code class="ruby">    if !current_person.admin? &amp;&amp; (@comment.person != current_person)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">      flash[:notice] = &quot;You're not allowed to view this page&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">      redirect_to conversation_reflection_path @conversation, @reflection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">  def find_conversation_and_reflection</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="55">
          <span class="hits">14</span>
          
          <code class="ruby">    @conversation = Conversation.find(params[:conversation_id])</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="56">
          <span class="hits">14</span>
          
          <code class="ruby">    @reflection = @conversation.reflections.find(params[:reflection_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8c41a8b26c49b47d77b04dc17f8c3db7ea4ee423">
  <div class="header">
    <h3>app/controllers/reflections_controller.rb</h3>
    <h4><span class="green">95.45 %</span> covered</h4>
    <div>
      <b>44</b> relevant lines. 
      <span class="green"><b>42</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ReflectionsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout 'opportunity'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user, :except =&gt; [:index, :show]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :verify_admin, :only =&gt; [:edit, :update, :destroy]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :find_conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def find_conversation</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="10">
          <span class="hits">24</span>
          
          <code class="ruby">    @conversation = Conversation.find(params[:conversation_id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  public</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="15">
          <span class="hits">3</span>
          
          <code class="ruby">    @reflections = Reflection.where(:conversation_id =&gt; @conversation).order('id DESC')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="19">
          <span class="hits">9</span>
          
          <code class="ruby">    @reflection = Reflection.find(params[:id], :include =&gt; :person)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="20">
          <span class="hits">9</span>
          
          <code class="ruby">    @participated_actions = @reflection.actions</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="21">
          <span class="hits">9</span>
          
          <code class="ruby">    @comment = ReflectionComment.new</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="22">
          <span class="hits">9</span>
          
          <code class="ruby">    @comments = @reflection.comments</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    @reflection = Reflection.new(:conversation_id =&gt; @conversation.id, :owner =&gt; current_person.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    @reflection = Reflection.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="34">
          <span class="hits">4</span>
          
          <code class="ruby">    @reflection = Reflection.new(params[:reflection])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="35">
          <span class="hits">4</span>
          
          <code class="ruby">    @reflection.conversation_id = @conversation.id if @reflection.conversation_id.blank? &amp;&amp; @conversation</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="36">
          <span class="hits">4</span>
          
          <code class="ruby">    @reflection.owner = current_person.id if @reflection.owner.blank? &amp;&amp; current_person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="38">
          <span class="hits">4</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="39">
          <span class="hits">4</span>
          
          <code class="ruby">      if @reflection.save</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="40">
          <span class="hits">4</span>
          
          <code class="ruby">        format.html { redirect_to conversation_reflection_path @conversation, @reflection }</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="41">
          <span class="hits">2</span>
          
          <code class="ruby">        format.xml  { render :xml =&gt; @reflection, :status =&gt; :created, :location =&gt; @reflection }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="43">
          <span class="hits">4</span>
          
          <code class="ruby">        format.html { render :controller =&gt; [@conversation, @reflection], :action =&gt; &quot;new&quot; }</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="44">
          <span class="hits">2</span>
          
          <code class="ruby">        format.xml  { render :xml =&gt; @reflection.errors, :status =&gt; :unprocessable_entity }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="50">
          <span class="hits">4</span>
          
          <code class="ruby">    @reflection = Reflection.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="51">
          <span class="hits">4</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="52">
          <span class="hits">4</span>
          
          <code class="ruby">      if @reflection.update_attributes(params[:reflection])</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="53">
          <span class="hits">8</span>
          
          <code class="ruby">        format.html { redirect_to([@conversation, @reflection], :notice =&gt; 'Reflection was successfully updated.') }</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="54">
          <span class="hits">4</span>
          
          <code class="ruby">        format.xml  { head :ok }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">        format.html { render :action =&gt; &quot;edit&quot; }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">        format.xml  { render :xml =&gt; @reflection.errors, :status =&gt; :unprocessable_entity }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="63">
          <span class="hits">2</span>
          
          <code class="ruby">    @reflection = Reflection.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="64">
          <span class="hits">2</span>
          
          <code class="ruby">    @reflection.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="66">
          <span class="hits">2</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="67">
          <span class="hits">4</span>
          
          <code class="ruby">      format.html { redirect_to(conversation_reflections_url @conversation) }</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="68">
          <span class="hits">2</span>
          
          <code class="ruby">      format.xml  { head :ok }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ce6eef57f34f2b406c52181daee7db964c44481f">
  <div class="header">
    <h3>app/controllers/regions_controller.rb</h3>
    <h4><span class="yellow">85.71 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class RegionsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    @regions = Region.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    @region = params[:id] == &quot;default&quot; ? Region.default : Region.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    @regions = Region.all</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    @conversations = @region.conversations(params[:page])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5b3a06aa05f7478a9a85dfb0a2becb776ba3e173">
  <div class="header">
    <h3>app/controllers/registrations/omniauth_callbacks_controller.rb</h3>
    <h4><span class="green">97.14 %</span> covered</h4>
    <div>
      <b>70</b> relevant lines. 
      <span class="green"><b>68</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Registrations::OmniauthCallbacksController &lt; Devise::OmniauthCallbacksController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  skip_before_filter :require_no_ssl</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def facebook</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="5">
          <span class="hits">17</span>
          
          <code class="ruby">    if signed_in? &amp;&amp; !current_person.facebook_authenticated?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="6">
          <span class="hits">10</span>
          
          <code class="ruby">      link_with_facebook</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="8">
          <span class="hits">7</span>
          
          <code class="ruby">      if authentication = Authentication.find_from_auth_hash(env['omniauth.auth'])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="9">
          <span class="hits">5</span>
          
          <code class="ruby">        successful_authentication(authentication)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="11">
          <span class="hits">2</span>
          
          <code class="ruby">        create_account_using_facebook_credentials</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def failure</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    text = &quot;#{I18n.t('devise.omniauth_callbacks.failure', :kind =&gt; failed_strategy.name.to_s.humanize, :reason =&gt; failure_message)}&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    render_popup(text)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def auth_popup?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    params[:auth_popup] &amp;&amp; params[:auth_popup] == true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_account_using_facebook_credentials</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="27">
          <span class="hits">2</span>
          
          <code class="ruby">    person = Person.build_from_auth_hash(env['omniauth.auth'])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="28">
          <span class="hits">2</span>
          
          <code class="ruby">    if Person.where(email: person.email).size == 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">      send_person_data_to_the_opening_window(person, registrations_principles_path)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">      flash[:email] = person.email</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">      render_js_registering_email_taken</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def we_came_from_the_registration_page? request</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">     request.env['omniauth.origin'] == new_person_registration_url or request.env['omniauth.origin'] == person_registration_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def failed_linked_to_facebook</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="41">
          <span class="hits">3</span>
          
          <code class="ruby">    flash[:notice] = I18n.t &quot;devise.omniauth_callbacks.linked_failure&quot;, :kind =&gt; &quot;Facebook&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="42">
          <span class="hits">3</span>
          
          <code class="ruby">    render_js_redirect_to(env['omniauth.origin'] || root_path)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def link_with_facebook</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="46">
          <span class="hits">10</span>
          
          <code class="ruby">    authentication = Authentication.new_from_auth_hash(env['omniauth.auth'])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="48">
          <span class="hits">10</span>
          
          <code class="ruby">    if current_person.link_with_facebook(authentication)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="49">
          <span class="hits">7</span>
          
          <code class="ruby">      @other_email = Authentication.email_from_auth_hash(env['omniauth.auth'])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="51">
          <span class="hits">7</span>
          
          <code class="ruby">      sign_in current_person, :event =&gt; :authentication, :bypass =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="52">
          <span class="hits">7</span>
          
          <code class="ruby">      if current_person.conflicting_email?(@other_email)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">        successfully_linked_but_conflicting_email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="55">
          <span class="hits">6</span>
          
          <code class="ruby">        successfully_linked_to_facebook</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="58">
          <span class="hits">3</span>
          
          <code class="ruby">      failed_linked_to_facebook</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">  def successfully_linked_to_facebook</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="63">
          <span class="hits">6</span>
          
          <code class="ruby">    flash[:notice] = I18n.t &quot;devise.omniauth_callbacks.linked_success&quot;, :kind =&gt; &quot;Facebook&quot;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="64">
          <span class="hits">6</span>
          
          <code class="ruby">    render_js_fb_linking_success</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">  def successfully_linked_but_conflicting_email</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">    session[:other_email] = @other_email</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">    render_js_conflicting_email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">  def successful_authentication(authentication)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="73">
          <span class="hits">5</span>
          
          <code class="ruby">    flash[:notice] = I18n.t &quot;devise.omniauth_callbacks.success&quot;, :kind =&gt; &quot;Facebook&quot;</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="74">
          <span class="hits">5</span>
          
          <code class="ruby">    authentication.person.remember_me = true</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="75">
          <span class="hits">5</span>
          
          <code class="ruby">    sign_in authentication.person, :event =&gt; :authentication</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="76">
          <span class="hits">5</span>
          
          <code class="ruby">    render_js_redirect_to (env['omniauth.origin'] || root_path), :text =&gt; 'Logging in to CivicCommons with Facebook...'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_js_registering_email_taken(options={})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">    options[:path] = registering_email_taken_path</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">    render_js_colorbox(options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_js_conflicting_email(options={})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">    options[:path] = conflicting_email_path</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">    render_js_colorbox(options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_js_fb_linking_success(options={})</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="90">
          <span class="hits">6</span>
          
          <code class="ruby">    options[:path] = fb_linking_success_path</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="91">
          <span class="hits">6</span>
          
          <code class="ruby">    render_js_colorbox(options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_js_colorbox(options={})</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="95">
          <span class="hits">8</span>
          
          <code class="ruby">    @text = options.delete(:text) || 'Redirecting back to CivicCommons....'</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="96">
          <span class="hits">8</span>
          
          <code class="ruby">    @path = options.delete(:path)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="97">
          <span class="hits">8</span>
          
          <code class="ruby">    @script = &quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">      #{isUnsafeJSPopup}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">      if(window.opener) {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">        if(isUnsafeJSPopup() != true){</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">          window.opener.$.colorbox({href:'#{@path}',opacity:0.5, onComplete: function(){</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">            window.close();</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">          }});</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">        }else{</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">          window.close();</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">      }&quot;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="108">
          <span class="hits">8</span>
          
          <code class="ruby">    render_popup(@text, @script)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_js_redirect_to(path = '', options={})</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="112">
          <span class="hits">8</span>
          
          <code class="ruby">    @text = options.delete(:text) || 'Redirecting back to CivicCommons....'</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="113">
          <span class="hits">8</span>
          
          <code class="ruby">    @script = isUnsafeJSPopup</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="114">
          <span class="hits">8</span>
          
          <code class="ruby">    @script += &quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">      #{isUnsafeJSPopup}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">      if(window.opener) {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">        if(isUnsafeJSPopup() != true){</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">          window.opener.onunload = function(){</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">              window.close();</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">          };</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">          window.opener.location = '#{path}';</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">        }else{</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">          window.opener.location = '#{path}';</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">          window.close();</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">      }&quot;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="127">
          <span class="hits">8</span>
          
          <code class="ruby">   render_popup(@text, @script)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">  def isUnsafeJSPopup</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">    #used to see if it's cross domain or not</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">    &quot;isUnsafeJSPopup = function(){</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">      var cross_domain = false;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">      try{</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">        cross_domain = window.opener.location.protocol != window.location.protocol;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">      } catch(e){</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">        cross_domain = true;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">      return cross_domain;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="140">
          <span class="hits">24</span>
          
          <code class="ruby">    }&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_popup(text,script = nil)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="144">
          <span class="hits">16</span>
          
          <code class="ruby">    render :partial =&gt; '/authentication/fb_interstitial_message', :layout =&gt; 'fb_popup', :locals =&gt; {:text =&gt; text, :script =&gt; script}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_person_data_to_the_opening_window(person, redirect_path)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">    render :partial =&gt; '/plain_old_javascript', locals: {</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">      script: &quot;window.opener.OmniAuthHandler.handleAccountCreation(#{person.to_json(:include=&gt;:authentications)}, '#{redirect_path}')&quot; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="499a92ce85bb016a3f77256c0ce043578d95a8ea">
  <div class="header">
    <h3>app/controllers/registrations_controller.rb</h3>
    <h4><span class="green">90.91 %</span> covered</h4>
    <div>
      <b>33</b> relevant lines. 
      <span class="green"><b>30</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class RegistrationsController &lt; Devise::RegistrationsController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_ssl</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  skip_before_filter :require_no_ssl</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  helper_method :form_presenter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="8">
          <span class="hits">10</span>
          
          <code class="ruby">    if params['person'].has_key?('authentications_attributes')</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="9">
          <span class="hits">3</span>
          
          <code class="ruby">      params['person']['create_from_auth'] = true</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="10">
          <span class="hits">3</span>
          
          <code class="ruby">      params['person']['encrypted_password'] = ''</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="11">
          <span class="hits">3</span>
          
          <code class="ruby">      params['person']['confirmed_at'] = DateTime.now</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="13">
          <span class="hits">10</span>
          
          <code class="ruby">    super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def after_inactive_sign_up_path_for(resource)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="17">
          <span class="hits">6</span>
          
          <code class="ruby">    url_for :new_person_confirmation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def form_presenter</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="21">
          <span class="hits">83</span>
          
          <code class="ruby">    @presenter = RegistrationFormPresenter.new(resource)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def new_organization</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    # taken from devise's registration_controller#new and modified</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="26">
          <span class="hits">5</span>
          
          <code class="ruby">    resource = build_organization_resource</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="27">
          <span class="hits">10</span>
          
          <code class="ruby">    respond_with_navigational(resource){ render_with_scope :new_organization }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_organization</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    # taken from devise's registration_controller#create and modified</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="32">
          <span class="hits">3</span>
          
          <code class="ruby">    build_organization_resource</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="34">
          <span class="hits">3</span>
          
          <code class="ruby">    if resource.save</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">      if resource.active_for_authentication?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">        set_flash_message :notice, :signed_up if is_navigational_format?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">        sign_in(resource_name, resource)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">        respond_with resource, :location =&gt; redirect_location(resource_name, resource)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">        set_flash_message :notice, :inactive_signed_up, :reason =&gt; inactive_reason(resource) if is_navigational_format?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">        expire_session_data_after_sign_in!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">        respond_with resource, :location =&gt; after_inactive_sign_up_path_for(resource)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="45">
          <span class="hits">2</span>
          
          <code class="ruby">      clean_up_passwords(resource)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="46">
          <span class="hits">4</span>
          
          <code class="ruby">      respond_with_navigational(resource) { render_with_scope :new_organization }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def build_organization_resource(hash=nil)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    # taken from devise and modified</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="53">
          <span class="hits">8</span>
          
          <code class="ruby">    hash ||= params[:organization] || {}</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="54">
          <span class="hits">8</span>
          
          <code class="ruby">    self.resource = Organization.new(hash)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ab1186867203f076b3b635a016786fb6398a5f9a">
  <div class="header">
    <h3>app/controllers/search_controller.rb</h3>
    <h4><span class="green">96.3 %</span> covered</h4>
    <div>
      <b>27</b> relevant lines. 
      <span class="green"><b>26</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SearchController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def results</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="4">
          <span class="hits">15</span>
          
          <code class="ruby">    search_service = SearchService.new</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="5">
          <span class="hits">15</span>
          
          <code class="ruby">    @top_metro_regions = MetroRegion.top_metro_regions(5)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="7">
          <span class="hits">15</span>
          
          <code class="ruby">    if params[:filter] and not determine_model_class(params[:filter]).nil?</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="8">
          <span class="hits">6</span>
          
          <code class="ruby">      @models_to_search = determine_model_class(params[:filter])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="10">
          <span class="hits">9</span>
          
          <code class="ruby">      @models_to_search = [Conversation, ManagedIssue, Person, Contribution, ContentItem, ManagedIssuePage]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="13">
          <span class="hits">15</span>
          
          <code class="ruby">    if params[:q] == ''</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="14">
          <span class="hits">9</span>
          
          <code class="ruby">      flash[:error] = 'You did not search for anything.  Please try again.'</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="15">
          <span class="hits">9</span>
          
          <code class="ruby">      @results = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="17">
          <span class="hits">6</span>
          
          <code class="ruby">      if(params.key?(:filter))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">        @results = search_service.fetch_filtered_results(params[:q], params[:filter], :models =&gt; @models_to_search, :region_metrocodes =&gt; default_region).paginate(page: params[:page], per_page: 10)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="20">
          <span class="hits">6</span>
          
          <code class="ruby">        @results = search_service.fetch_results(params[:q], :models =&gt; @models_to_search, :region_metrocodes =&gt; default_region).paginate(page: params[:page], per_page: 10)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def metro_region_city</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="27">
          <span class="hits">3</span>
          
          <code class="ruby">    unless params[:term] =~ /^\s*$/i</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="28">
          <span class="hits">3</span>
          
          <code class="ruby">      @results = MetroRegion.search_city_province(params[:term])</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="29">
          <span class="hits">11</span>
          
          <code class="ruby">      @metro_regions = @results.collect{|region| {:id =&gt; region.id, :label =&gt; region.city_display_name, :metrocode =&gt; region.metrocode} }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="31">
          <span class="hits">3</span>
          
          <code class="ruby">      render :json =&gt; @metro_regions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def determine_model_class(model_string)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="37">
          <span class="hits">13</span>
          
          <code class="ruby">    case model_string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    when &quot;contributions&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="39">
          <span class="hits">2</span>
          
          <code class="ruby">      return Contribution</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    when &quot;conversations&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="41">
          <span class="hits">2</span>
          
          <code class="ruby">      return Conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    when &quot;community&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="43">
          <span class="hits">2</span>
          
          <code class="ruby">      return Person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    when &quot;blogs&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="45">
          <span class="hits">2</span>
          
          <code class="ruby">      return ContentItem</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    when &quot;radioshows&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="47">
          <span class="hits">2</span>
          
          <code class="ruby">      return ContentItem</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    when &quot;projects&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="49">
          <span class="hits">2</span>
          
          <code class="ruby">      return [ManagedIssue, ManagedIssuePage]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="289ab8d630f19de989f409b82a0526c9bd9d1022">
  <div class="header">
    <h3>app/controllers/sessions_controller.rb</h3>
    <h4><span class="green">96.67 %</span> covered</h4>
    <div>
      <b>30</b> relevant lines. 
      <span class="green"><b>29</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SessionsController &lt; Devise::SessionsController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout 'devise/sessions'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include RegionHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  prepend_before_filter :require_no_authentication, :only =&gt; [:new, :create, :ajax_new, :ajax_create]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  prepend_before_filter :allow_params_authentication!, :only =&gt; [:create, :ajax_create]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_ssl, :only =&gt; [:new, :create]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  skip_before_filter :require_no_ssl</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="131" data-linenumber="11">
          <span class="hits">131</span>
          
          <code class="ruby">    super</code>
        </li>
      
        <li class="covered" data-hits="131" data-linenumber="12">
          <span class="hits">131</span>
          
          <code class="ruby">    if RedirectHelper.valid?(request.headers['Referer'])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="13">
          <span class="hits">3</span>
          
          <code class="ruby">      session[:previous] = request.headers['Referer']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="127" data-linenumber="18">
          <span class="hits">127</span>
          
          <code class="ruby">    super</code>
        </li>
      
        <li class="covered" data-hits="126" data-linenumber="19">
          <span class="hits">126</span>
          
          <code class="ruby">    session[:previous] = nil</code>
        </li>
      
        <li class="covered" data-hits="126" data-linenumber="20">
          <span class="hits">126</span>
          
          <code class="ruby">    default_region(current_person.default_region)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def ajax_new</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">    session[:close_modal_on_exit] = true</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">    session[:previous] = request.headers['Referer'] if RedirectHelper.valid?(request.headers['Referer'])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="26">
          <span class="hits">2</span>
          
          <code class="ruby">    render :partial =&gt; 'sessions/new', :layout =&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  # POST /resource/ajax_login</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def ajax_create</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="31">
          <span class="hits">6</span>
          
          <code class="ruby">    resource = warden.authenticate!(:scope =&gt; resource_name, :recall =&gt; &quot;#{controller_path}#new&quot;)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="32">
          <span class="hits">6</span>
          
          <code class="ruby">    sign_in(resource_name, resource)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="33">
          <span class="hits">6</span>
          
          <code class="ruby">    if session.has_key?(:close_modal_on_exit) and session[:close_modal_on_exit]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="34">
          <span class="hits">6</span>
          
          <code class="ruby">      @notice = &quot;You have successfully logged in.&quot;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="35">
          <span class="hits">6</span>
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="36">
          <span class="hits">7</span>
          
          <code class="ruby">        format.js {render :partial =&gt; 'sessions/close_modal_on_exit', :layout =&gt; false}</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="37">
          <span class="hits">6</span>
          
          <code class="ruby">        format.html do </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="38">
          <span class="hits">5</span>
          
          <code class="ruby">          redirect_to session[:previous] || root_path</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="39">
          <span class="hits">5</span>
          
          <code class="ruby">          session[:previous] = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      render :action =&gt; :new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5b7710615a139fe382f1b8745cfb987146fdc8dd">
  <div class="header">
    <h3>app/controllers/subscriptions_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>14</b> relevant lines. 
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SubscriptionsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def subscribe</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="5">
          <span class="hits">2</span>
          
          <code class="ruby">    Rails.logger.info(&quot;We are in the ajax subscribe.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    subscription = Subscription.subscribe(params[:type], params[:id], current_person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="9">
          <span class="hits">2</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="10">
          <span class="hits">3</span>
          
          <code class="ruby">      format.html { render :partial =&gt; &quot;subscriptions/subscribed&quot;, :locals =&gt; {:subscribable_type =&gt; params[:type], :subscribable_id =&gt; params[:id]}, :layout =&gt; false}</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="11">
          <span class="hits">2</span>
          
          <code class="ruby">      format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def unsubscribe</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    Rails.logger.info(&quot;We are in the ajax unsubscribe.&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    subscription = Subscription.unsubscribe(params[:type], params[:id], current_person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="20">
          <span class="hits">2</span>
          
          <code class="ruby">      format.html { render :partial =&gt; &quot;subscriptions/notsubscribed&quot;, :locals =&gt; {:subscribable_type =&gt; params[:type], :subscribable_id =&gt; params[:id]}, :layout =&gt; false}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d35fd8cbdf0fe67ba879cc0a9b21ceffff31f4f1">
  <div class="header">
    <h3>app/controllers/surveys_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>36</b> relevant lines. 
      <span class="green"><b>36</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SurveysController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :find_survey, :only =&gt; [:show, :create_response]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :redirect_to_proper_url, :only =&gt; [:show]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :allow_active_survey, :only =&gt; [:show]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="9">
          <span class="hits">21</span>
          
          <code class="ruby">    @survey_response_presenter = VoteResponsePresenter.new(:person_id =&gt; current_person.id, :survey_id =&gt; @survey.id)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="10">
          <span class="hits">21</span>
          
          <code class="ruby">    if @survey_response_presenter.allowed?</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="11">
          <span class="hits">12</span>
          
          <code class="ruby">      render :template =&gt; &quot;surveys/show_#{@survey.class.name.underscore}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="13">
          <span class="hits">9</span>
          
          <code class="ruby">      if @survey.show_progress?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="14">
          <span class="hits">4</span>
          
          <code class="ruby">        @vote_progress_service = VoteProgressService.new(@survey)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="15">
          <span class="hits">4</span>
          
          <code class="ruby">        render :template =&gt;&quot;surveys/show_#{@survey.class.name.underscore}_show_progress&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="17">
          <span class="hits">5</span>
          
          <code class="ruby">        render :template =&gt; &quot;surveys/show_#{@survey.class.name.underscore}_hide_progress&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_response</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="23">
          <span class="hits">15</span>
          
          <code class="ruby">    @survey_response_presenter = VoteResponsePresenter.new({:person_id =&gt; current_person.id, :survey_id =&gt; @survey.id}.merge!(params[:survey_response_presenter]))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    # if it has been confirmed, then it can be saved</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="25">
          <span class="hits">15</span>
          
          <code class="ruby">    if @survey_response_presenter.confirmed?</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="26">
          <span class="hits">7</span>
          
          <code class="ruby">      if @survey_response_presenter.save</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="27">
          <span class="hits">6</span>
          
          <code class="ruby">        flash[:vote_successful] = true</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="28">
          <span class="hits">6</span>
          
          <code class="ruby">        respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="29">
          <span class="hits">8</span>
          
          <code class="ruby">          format.html{redirect_to :action =&gt; :show}</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="30">
          <span class="hits">10</span>
          
          <code class="ruby">          format.js{render :js =&gt; &quot;document.location = '#{url_for(:action =&gt; :show)}';&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">        render :template =&gt; &quot;surveys/show_#{@survey.class.name.underscore}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="36">
          <span class="hits">8</span>
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="37">
          <span class="hits">15</span>
          
          <code class="ruby">        format.js{ render :js =&gt; render_to_string(:partial =&gt; &quot;/surveys/#{@survey.class.name.underscore}_response_confirmation&quot;) }</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="38">
          <span class="hits">9</span>
          
          <code class="ruby">        format.html{render :text =&gt; 'Javascript needs to be turned on to vote'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  # vote_successful modal dialog</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def vote_successful</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="45">
          <span class="hits">4</span>
          
          <code class="ruby">    render :layout =&gt; nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def find_survey</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="51">
          <span class="hits">40</span>
          
          <code class="ruby">      @survey = Survey.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">  def allow_active_survey</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="55">
          <span class="hits">24</span>
          
          <code class="ruby">    unless @survey.active?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="56">
          <span class="hits">3</span>
          
          <code class="ruby">      render :template =&gt; &quot;surveys/show_#{@survey.class.name.underscore}_inactive&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  def redirect_to_proper_url</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="61">
          <span class="hits">25</span>
          
          <code class="ruby">    if @survey.surveyable &amp;&amp; @survey.surveyable_type == 'Conversation'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">      redirect_to conversation_vote_url(@survey.surveyable, @survey)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ba26c29a1dcada63d14773beb4a97fb4c2972ab8">
  <div class="header">
    <h3>app/controllers/tos_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>19</b> relevant lines. 
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class TosController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="5">
          <span class="hits">3</span>
          
          <code class="ruby">    @contribution = params[:contribution_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="7">
          <span class="hits">3</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="8">
          <span class="hits">3</span>
          
          <code class="ruby">      if request.xhr?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="9">
          <span class="hits">2</span>
          
          <code class="ruby">        format.html { render :partial =&gt; 'tos_contribution_form', :layout =&gt; false }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="11">
          <span class="hits">4</span>
          
          <code class="ruby">        format.html { render :partial =&gt; 'tos_contribution_form'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="17">
          <span class="hits">2</span>
          
          <code class="ruby">    reason = params[:tos][:reason]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="18">
          <span class="hits">2</span>
          
          <code class="ruby">    @contribution = Contribution.find(params[:contribution_id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="19">
          <span class="hits">2</span>
          
          <code class="ruby">    if !reason.blank? &amp;&amp; @contribution</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">      result = Tos.send_violation_complaint(current_person, @contribution, reason)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    # Rails.logger.info(&quot;TOS Result:#{result}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">      unless reason.blank?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">        @notice = &quot;Thank you! You're helping to make your community stronger!&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">        format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">        flash[:notice] = @error = &quot;Please include a reason.&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">        format.js</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ec6e5c49ada200afe822a548e0230ac358d97123">
  <div class="header">
    <h3>app/controllers/unsubscribe_digest_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class UnsubscribeDigestController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def unsubscribe_me</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    @person = Person.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def remove_from_digest</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="8">
          <span class="hits">2</span>
          
          <code class="ruby">    @person = Person.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="9">
          <span class="hits">2</span>
          
          <code class="ruby">    @person.unsubscribe_from_daily_digest</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="10">
          <span class="hits">2</span>
          
          <code class="ruby">    redirect_to root_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c769e22508b2ce3df4f350cdf939e7b32b4ea627">
  <div class="header">
    <h3>app/controllers/user_controller.rb</h3>
    <h4><span class="green">94.55 %</span> covered</h4>
    <div>
      <b>55</b> relevant lines. 
      <span class="green"><b>52</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class UserController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include OrganizationsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_user, :only =&gt; [:join_as_member, :remove_membership]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :require_ssl, :only =&gt; [:update,:edit]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  skip_before_filter :require_no_ssl, :only =&gt; [:update, :edit, :destroy_avatar]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :verify_ownership?, :only =&gt; [:edit, :update, :destroy_avatar]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def verify_ownership?</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="9">
          <span class="hits">18</span>
          
          <code class="ruby">    unless(current_person &amp;&amp; current_person == Person.find(params[:id]))</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="10">
          <span class="hits">5</span>
          
          <code class="ruby">      redirect_to community_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def join_as_member</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="15">
          <span class="hits">3</span>
          
          <code class="ruby">    @organization = Organization.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="16">
          <span class="hits">3</span>
          
          <code class="ruby">    if @organization &amp;&amp; @organization.join_as_member(current_person)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="17">
          <span class="hits">2</span>
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="18">
          <span class="hits">4</span>
          
          <code class="ruby">        format.js { render :template =&gt; '/organizations/join_as_member.js', :format =&gt; 'js' }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">        format.js { render :nothing =&gt; true, :status =&gt; 500 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def remove_membership</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="28">
          <span class="hits">3</span>
          
          <code class="ruby">    @organization = Organization.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="29">
          <span class="hits">3</span>
          
          <code class="ruby">    if @organization &amp;&amp; @organization.remove_member(current_person)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="30">
          <span class="hits">3</span>
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="31">
          <span class="hits">5</span>
          
          <code class="ruby">        format.js { render :template =&gt; '/organizations/remove_membership.js', :format =&gt; 'js' }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">        format.js { render :nothing =&gt; true, :status =&gt; 500 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def confirm_membership</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">    render :template =&gt; '/organizations/confirm_membership_modal', :layout =&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="45">
          <span class="hits">7</span>
          
          <code class="ruby">    @person = Person.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="46">
          <span class="hits">7</span>
          
          <code class="ruby">    @person.require_zip_code = true  #did this So that there is a validation error on the view.</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="47">
          <span class="hits">7</span>
          
          <code class="ruby">    @person.valid?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="51">
          <span class="hits">10</span>
          
          <code class="ruby">    unless Person.exists? params[:id]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">      redirect_to community_path</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="55">
          <span class="hits">9</span>
          
          <code class="ruby">    user = Person.includes(:contributions, :subscriptions, :organization_detail).find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="56">
          <span class="hits">9</span>
          
          <code class="ruby">    @user = ProfilePresenter.new(user, page: params[:page])</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="57">
          <span class="hits">9</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="58">
          <span class="hits">9</span>
          
          <code class="ruby">      format.html</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="59">
          <span class="hits">9</span>
          
          <code class="ruby">      format.xml</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="64">
          <span class="hits">6</span>
          
          <code class="ruby">    @person = Person.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="65">
          <span class="hits">6</span>
          
          <code class="ruby">    @person.require_zip_code = true</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="66">
          <span class="hits">6</span>
          
          <code class="ruby">    attributes = params[:person] || params[:organization]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="67">
          <span class="hits">6</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="68">
          <span class="hits">6</span>
          
          <code class="ruby">      if @person.update_attributes(attributes)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="69">
          <span class="hits">6</span>
          
          <code class="ruby">        flash[:notice] = &quot;Successfully edited your profile&quot;</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="70">
          <span class="hits">12</span>
          
          <code class="ruby">        format.html { redirect_to user_url(@person) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">        format.html { render :action =&gt; &quot;edit&quot; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy_avatar</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="78">
          <span class="hits">3</span>
          
          <code class="ruby">    @person = Person.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="79">
          <span class="hits">3</span>
          
          <code class="ruby">    @person.avatar = nil</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="80">
          <span class="hits">3</span>
          
          <code class="ruby">    if @person.save</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="81">
          <span class="hits">2</span>
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="82">
          <span class="hits">4</span>
          
          <code class="ruby">        format.js { render :json =&gt; { :avatarUrl =&gt; ( AvatarService.avatar_image_url(@person) )} }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="86">
          <span class="hits">2</span>
          
          <code class="ruby">        format.js { render :nothing =&gt; true, :status =&gt; 500 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="60a034a002671570442a1e4f18d68af71d75985b">
  <div class="header">
    <h3>app/controllers/widgets_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class WidgetsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  # Widget</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  #   src: source of the data for the widget</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  #   dom: what dom element to replace with the results on the users page.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  #   styled: user must set a value of 0 to turn off styling. Defaults to a styled widget.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def cc_widget</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="7">
          <span class="hits">7</span>
          
          <code class="ruby">    @data_source = params[:src]</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="8">
          <span class="hits">7</span>
          
          <code class="ruby">    @dom_id = params[:dom] || 'civic-commons-widget'</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="9">
          <span class="hits">7</span>
          
          <code class="ruby">    @styled = !(params[:styled] == &quot;0&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="11">
          <span class="hits">7</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="12">
          <span class="hits">12</span>
          
          <code class="ruby">      format.js{render :template =&gt; '/widgets/cc_widget.js', :format =&gt; 'js'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="94207a4a35c40b45542942f41e8b313e4531bfc0">
  <div class="header">
    <h3>app/helpers/actions_helper.rb</h3>
    <h4><span class="red">75.0 %</span> covered</h4>
    <div>
      <b>8</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ActionsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def moderate_link_for(action)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="3">
          <span class="hits">4</span>
          
          <code class="ruby">    case action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    when Petition</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="5">
          <span class="hits">4</span>
          
          <code class="ruby">      edit_url = edit_conversation_petition_url(action.conversation, action)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="6">
          <span class="hits">4</span>
          
          <code class="ruby">      delete_url =  conversation_petition_url(action.conversation, action)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      edit_url = ''</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      delete_url = ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="11">
          <span class="hits">4</span>
          
          <code class="ruby">    raw &quot;&lt;p class=\&quot;fl-right alert alert-admin\&quot;&gt;&amp;nbsp;&lt;strong&gt;Moderate:&lt;/strong&gt; #{link_to &quot;Edit&quot;, edit_url} | #{link_to 'Delete', delete_url, :method =&gt; :delete, :confirm =&gt; 'Are you sure you want to delete this?'}&lt;/p&gt;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="803dedea6b8bc9d7f2d48b12cc32b0cc9ecf10a2">
  <div class="header">
    <h3>app/helpers/activity_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ActivityHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_recent_items_sidebar(recent_items=@recent_items)</code>
        </li>
      
        <li class="covered" data-hits="169" data-linenumber="3">
          <span class="hits">169</span>
          
          <code class="ruby">    render 'shared/recent_items_sidebar', :recent_items =&gt; recent_items</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_conversation_recent_items_sidebar(recent_items=@recent_items)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="7">
          <span class="hits">3</span>
          
          <code class="ruby">    render 'shared/conversation_recent_items_sidebar', :recent_items =&gt; recent_items</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def embed_activity_length</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="11">
          <span class="hits">14</span>
          
          <code class="ruby">    @embed ? 250 : 100</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7caa6b55519ba90f6f0a5eb3e3b51f3603073c4f">
  <div class="header">
    <h3>app/helpers/admin/conversations_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Admin::ConversationsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def toggle_staff_pick_link(conversation)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="4">
          <span class="hits">5</span>
          
          <code class="ruby">    link_text = conversation.staff_pick? ? 'on' : 'off'</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="5">
          <span class="hits">5</span>
          
          <code class="ruby">    full_link_text = &quot;&lt;span class=\&quot;text\&quot;&gt;#{conversation.position}&lt;/span&gt;&quot;</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="6">
          <span class="hits">5</span>
          
          <code class="ruby">    link_to raw(full_link_text), toggle_staff_pick_admin_conversation_path(conversation, :redirect_to =&gt; action_name), :method =&gt; :put, :class =&gt; 'staff_pick ' +  link_text</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1543ec7be55b63734f02f8d5e88850cafe923672">
  <div class="header">
    <h3>app/helpers/admin/dashboard_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Admin::DashboardHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="167eed9b6eccff3718e5b3de34dcab54771bcb08">
  <div class="header">
    <h3>app/helpers/admin/featured_opportunities_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Admin::FeaturedOpportunitiesHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def featured_opportunity_options_for_select(record, selected, max_length=120)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="4">
          <span class="hits">12</span>
          
          <code class="ruby">    if record.present?</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="5">
          <span class="hits">8</span>
          
          <code class="ruby">      array = record.collect do |r|</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="6">
          <span class="hits">14</span>
          
          <code class="ruby">        [ strip_and_truncate(&quot;#{r.id} - #{r.one_line_summary}&quot;, max_length),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">          r.id ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="9">
          <span class="hits">8</span>
          
          <code class="ruby">      array.unshift ['Select one...',nil]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="11">
          <span class="hits">4</span>
          
          <code class="ruby">      array = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="13">
          <span class="hits">12</span>
          
          <code class="ruby">    options_for_select array, :selected =&gt; selected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def strip_and_truncate(text='', max_length=120)</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="17">
          <span class="hits">26</span>
          
          <code class="ruby">    strip_tags(text).truncate(max_length)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2ba89652daff9f72d8ad90bfbf8a3772550d1ba2">
  <div class="header">
    <h3>app/helpers/admin/issues_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Admin::IssuesHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4902d4428ca4934746a064fc2c47bd9266f3be73">
  <div class="header">
    <h3>app/helpers/admin/people_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Admin::PeopleHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="063cb5df0dab70b285f0e792ea81c329c456c6c5">
  <div class="header">
    <h3>app/helpers/admin/surveys_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Admin::SurveysHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="564a7927fce8043169f5a360bb8c57932f06b178">
  <div class="header">
    <h3>app/helpers/admin/topics_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Admin::TopicsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d926c223521b1bd75f45feeabd4108c10b098f46">
  <div class="header">
    <h3>app/helpers/admin/widget_stats_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Admin::WidgetStatsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def weeks_ago_date_range_select(week_ago = 8)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="3">
          <span class="hits">8</span>
          
          <code class="ruby">    week_range = (0..week_ago)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="4">
          <span class="hits">8</span>
          
          <code class="ruby">    selections = []</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="5">
          <span class="hits">8</span>
          
          <code class="ruby">    week_range.each do |week|</code>
        </li>
      
        <li class="covered" data-hits="117" data-linenumber="6">
          <span class="hits">117</span>
          
          <code class="ruby">      selections.push [&quot;#{week.weeks.ago.beginning_of_week.to_s(:short_friendly_with_day_name)} - #{week.weeks.ago.end_of_week.to_s(:short_friendly_with_day_name)}&quot;, week]</code>
        </li>
      
        <li class="covered" data-hits="117" data-linenumber="7">
          <span class="hits">117</span>
          
          <code class="ruby">      selections.push ['---------','none', :disabled =&gt; true] if first_week_of_month?(week)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="9">
          <span class="hits">8</span>
          
          <code class="ruby">    selections</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def url_for_widget_stat(widget_stat, *options)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="12">
          <span class="hits">3</span>
          
          <code class="ruby">    show_admin_widget_stats_path(widget_stat.url.gsub(/^\//i,''), *options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def first_week_of_month?(week)</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="15">
          <span class="hits">122</span>
          
          <code class="ruby">    beginning_week_date = week.weeks.ago.beginning_of_week</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="16">
          <span class="hits">122</span>
          
          <code class="ruby">    (beginning_week_date.day / 7.0).ceil == 1 #need to round up the float to work</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="cc891c6d6b8419d820de232da23ef30b6ed57289">
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4><span class="red">70.0 %</span> covered</h4>
    <div>
      <b>50</b> relevant lines. 
      <span class="green"><b>35</b> lines covered</span> and
      <span class="red"><b>15</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ApplicationHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  # Meta Information Helpers</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def page_title</code>
        </li>
      
        <li class="covered" data-hits="450" data-linenumber="4">
          <span class="hits">450</span>
          
          <code class="ruby">    @meta_info &amp;&amp; !@meta_info[:page_title].blank? ? @meta_info[:page_title].chomp : &quot;The Civic Commons&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def meta_description</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    @meta_info &amp;&amp; !@meta_info[:meta_description].blank? ? @meta_info[:meta_description].chomp : &quot;The Civic Commons is a new way to bring communities together with conversation and emerging technology. We are focused on building conversations and connections that have the power to become informed, productive collective civic action.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def meta_keywords</code>
        </li>
      
        <li class="covered" data-hits="450" data-linenumber="12">
          <span class="hits">450</span>
          
          <code class="ruby">    @meta_info &amp;&amp; !@meta_info[:meta_tags].blank? ? @meta_info[:meta_tags].chomp : &quot;community, conversation, civic action&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def show_errors(model)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="16">
          <span class="hits">6</span>
          
          <code class="ruby">    rv = &quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="17">
          <span class="hits">6</span>
          
          <code class="ruby">    all_errors = model.errors.full_messages</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="18">
          <span class="hits">6</span>
          
          <code class="ruby">    if all_errors.any?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      rv = &quot;&lt;div id=\&quot;error_explanation\&quot;&gt;&lt;h2&gt;#{pluralize(all_errors.size, &quot;error&quot;)} prohibited this #{model.class.to_s.downcase} from being saved:&lt;/h2&gt;&lt;ul&gt;&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">      all_errors.each do |msg|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">        rv = rv +&quot;&lt;li&gt;#{msg}&lt;/li&gt;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">      rv = rv + &quot;&lt;/ul&gt;&lt;/div&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="25">
          <span class="hits">6</span>
          
          <code class="ruby">    rv.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def can_edit?(owner)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    return false if current_person.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    return true if (current_person.admin || current_person == owner)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def paginated_showing_info(collection, name_of_collection)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    &quot;Showing %s of %s&quot;%[collection.count,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">                        pluralize(collection.total_entries, name_of_collection)]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def nl2br(string)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    string.gsub(/\n/, '&lt;br /&gt;') if string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def url_for(options = nil)</code>
        </li>
      
        <li class="covered" data-hits="76434" data-linenumber="44">
          <span class="hits">76434</span>
          
          <code class="ruby">    if Hash === options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      # change all links to use 'http' protocol unless specified</code>
        </li>
      
        <li class="covered" data-hits="47319" data-linenumber="46">
          <span class="hits">47319</span>
          
          <code class="ruby">      options[:protocol] ||= 'http'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="76434" data-linenumber="48">
          <span class="hits">76434</span>
          
          <code class="ruby">    super(options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def contribution_item_url(contribution)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">    if contribution.issue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">      issue_url( contribution.item )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">    elsif contribution.conversation</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">      conversation_url( contribution.item )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def pluralize_without_count(count, singular, plural=nil, options={})</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="60">
          <span class="hits">25</span>
          
          <code class="ruby">    plural = pluralize count, singular, plural</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="61">
          <span class="hits">25</span>
          
          <code class="ruby">    plural.gsub(/\d+ /, &quot;&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  def cc_widget_embed_code(src_path, dom_id ='')</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">    src_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">    dom_id ||= 'civic-commons-widget'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">    render :partial =&gt; '/widgets/cc_widget_embed_code', :locals =&gt; {:src_path =&gt; src_path, :dom_id =&gt; dom_id}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  def asset_url(asset)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">    &quot;#{request.protocol}#{request.host_with_port}#{asset_path(asset)}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">  def mailer_asset_url(asset)</code>
        </li>
      
        <li class="covered" data-hits="6067" data-linenumber="75">
          <span class="hits">6067</span>
          
          <code class="ruby">    base_url = root_url.to_s.gsub(/\/$/i,'')</code>
        </li>
      
        <li class="covered" data-hits="6067" data-linenumber="76">
          <span class="hits">6067</span>
          
          <code class="ruby">    base_url + asset_path(asset)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">  # Determine if we should display the Regions Filter Tab</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  # since the conversations/filter doesn't exist, we wrap it all with a begin/rescue</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">  def show_regions_filter_tab?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="83">
          <span class="hits">2</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      if current_page?(:controller =&gt; :conversations, :action =&gt; :index) ||</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="85">
          <span class="hits">2</span>
          
          <code class="ruby">        current_page?(:controller =&gt; :issues, :action =&gt; :index) ||</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">        current_page?(:controller =&gt; :projects, :action =&gt; :index) ||</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">        current_page?(:controller =&gt; :search, :action =&gt; :results) ||</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">        current_page?(:controller =&gt; :conversations, :action =&gt; :filter)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="89">
          <span class="hits">2</span>
          
          <code class="ruby">        true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">        false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    rescue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">      false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3ab6b86d2229cfb7c30431a54ad89916d784d738">
  <div class="header">
    <h3>app/helpers/authentication_helper.rb</h3>
    <h4><span class="green">92.31 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module AuthenticationHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def unlink_from_facebook_link</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="3">
          <span class="hits">11</span>
          
          <code class="ruby">    link_to &quot;Unlink from Facebook&quot;, confirm_facebook_unlinking_path, :class =&gt; 'connectacct-link facebook-auth disconnect-fb', :id =&gt; 'facebook-connect'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def link_with_facebook_link</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="7">
          <span class="hits">23</span>
          
          <code class="ruby">    link_to(&quot;Connect with Facebook&quot;, person_omniauth_authorize_path(:facebook), :class =&gt; 'connectacct-link facebook-auth', :id =&gt; 'facebook-connect' )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def facebook_sign_in_link</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="11">
          <span class="hits">132</span>
          
          <code class="ruby">    link_to &quot;Sign in with Facebook&quot;, person_omniauth_authorize_path(:facebook), :class =&gt; 'createacct-link facebook-auth fb-login-btn'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # uses url instead of path if https</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def person_omniauth_authorize_path_or_url(provider)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="16">
          <span class="hits">2</span>
          
          <code class="ruby">    SecureUrlHelper.https? ? person_omniauth_authorize_url(provider, :protocol =&gt; 'https') : person_omniauth_authorize_path(provider)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def person_omniauth_authorize_url(provider, params = {})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    if Devise.omniauth_configs[provider.to_sym]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      &quot;#{root_url(:protocol =&gt; params.delete(:protocol))}people/auth/#{provider}#{'?'+params.to_param if params.present?}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      raise ArgumentError, &quot;Could not find omniauth provider #{provider.inspect}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="269434260e39b0cb5d79b6b64d4a8f64f810a12b">
  <div class="header">
    <h3>app/helpers/avatar_helper.rb</h3>
    <h4><span class="yellow">81.82 %</span> covered</h4>
    <div>
      <b>44</b> relevant lines. 
      <span class="green"><b>36</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module AvatarHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # Create Avatar and Link for a Users Profile</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_profile(person)</code>
        </li>
      
        <li class="covered" data-hits="273" data-linenumber="5">
          <span class="hits">273</span>
          
          <code class="ruby">    if person</code>
        </li>
      
        <li class="covered" data-hits="273" data-linenumber="6">
          <span class="hits">273</span>
          
          <code class="ruby">      person = Person.find(person) if person.is_a?(Numeric)</code>
        </li>
      
        <li class="covered" data-hits="273" data-linenumber="7">
          <span class="hits">273</span>
          
          <code class="ruby">      link_to_profile(person) do</code>
        </li>
      
        <li class="covered" data-hits="273" data-linenumber="8">
          <span class="hits">273</span>
          
          <code class="ruby">        loggedin_image(person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      loggedout_image</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def text_profile(person)</code>
        </li>
      
        <li class="covered" data-hits="382" data-linenumber="16">
          <span class="hits">382</span>
          
          <code class="ruby">    if person</code>
        </li>
      
        <li class="covered" data-hits="382" data-linenumber="17">
          <span class="hits">382</span>
          
          <code class="ruby">      person = Person.find(person) if person.is_a?(Numeric)</code>
        </li>
      
        <li class="covered" data-hits="382" data-linenumber="18">
          <span class="hits">382</span>
          
          <code class="ruby">      link_to_profile(person) do</code>
        </li>
      
        <li class="covered" data-hits="382" data-linenumber="19">
          <span class="hits">382</span>
          
          <code class="ruby">        person.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def member_profile(person, css_class='callout')</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="25">
          <span class="hits">24</span>
          
          <code class="ruby">    avatar_profile(person, 40, css_class)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_profile(person, css_class='callout')</code>
        </li>
      
        <li class="covered" data-hits="78" data-linenumber="29">
          <span class="hits">78</span>
          
          <code class="ruby">    avatar_profile(person, 40, css_class)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def contribution_profile(person, css_class='callout')</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    avatar_profile(person, 40, css_class)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def featured_profile(person, css_class='callout')</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="37">
          <span class="hits">6</span>
          
          <code class="ruby">    avatar_profile(person, 50, css_class)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def author_card(person, size=40, css_class='image')</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="41">
          <span class="hits">55</span>
          
          <code class="ruby">    avatar_profile(person, size, css_class)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  # Profile's Avatar Image with name as alt text</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def profile_image(person, size=20, css_class='callout')</code>
        </li>
      
        <li class="covered" data-hits="524" data-linenumber="46">
          <span class="hits">524</span>
          
          <code class="ruby">    if person.avatar_image_url.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="523" data-linenumber="49">
          <span class="hits">523</span>
          
          <code class="ruby">      image_tag person.avatar_image_url, alt: person.name, height: size, width: size, title: person.name, class: css_class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def loggedin_image(person, size=40, css_class='callout')</code>
        </li>
      
        <li class="covered" data-hits="273" data-linenumber="54">
          <span class="hits">273</span>
          
          <code class="ruby">    profile_image(person, size, css_class)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  def loggedout_image(size=40, css_class='callout')</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">    image_tag &quot;avatar_#{size}.gif&quot;, alt: 'default avatar', class: css_class, height: size, width: size</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  def avatar_profile(person, size=20, css_class='callout')</code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="62">
          <span class="hits">184</span>
          
          <code class="ruby">    if person</code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="63">
          <span class="hits">184</span>
          
          <code class="ruby">      person = Person.find(person) if person.is_a?(Numeric)</code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="64">
          <span class="hits">184</span>
          
          <code class="ruby">      link_to_profile(person) do</code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="65">
          <span class="hits">184</span>
          
          <code class="ruby">        profile_image(person, size, css_class)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  def link_to_profile(person)</code>
        </li>
      
        <li class="covered" data-hits="841" data-linenumber="71">
          <span class="hits">841</span>
          
          <code class="ruby">    link_to yield, user_url(person), title: person.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">  def link_to_settings(person, css_class='user-link')</code>
        </li>
      
        <li class="covered" data-hits="248" data-linenumber="75">
          <span class="hits">248</span>
          
          <code class="ruby">    link_to &quot;Settings&quot;, secure_edit_user_url(person), title: &quot;Profile Settings&quot;, class: css_class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">  # Creates an image_tag for a particular person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">  # options includes options passed along to image_tag along with</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  # :style_name which is a directive for paperclip which determines the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  # ':style' paperclip should use for the image.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">  def avatar_tag(person, options={})</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="84">
          
          
          <code class="ruby">    style_name = options.delete(:style_name) || :small</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">    url = person.avatar.url(style_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">    if request.ssl? then url = url.gsub(/http:/i, 'https:') end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">    image_options = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      :width =&gt; 50,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">      :height =&gt; 50,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">      :alt =&gt; &quot;avatar&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">      :title =&gt; person.name}.merge(options)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">    image_tag(url, image_options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="06f44d7020d501763e8398c7a8f7eac532e96066">
  <div class="header">
    <h3>app/helpers/blog_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module BlogHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  ##</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # Returns the truncated summary text for a blog post. </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  # This method performs an HTML-safe truncation, so any </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # HTML elements defined in the text do not count against</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # the maximum character limit for the summary.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  # The current maximum number of characters is 235.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # If the summary is less than the maximum number of characters,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  # then it is returned unchanged.  If the summary is nil, then</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  # nil is returned.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # If the text is truncated, then an ellipsis is appended onto it.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # @param [ContentItem] blog_post The blog post to get</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  #   the summary text from</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  # @return [String] The summary text from +blog_post+ </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  #   truncated to 235 characters.  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def truncate_blog_summary(blog_post)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="22">
          <span class="hits">33</span>
          
          <code class="ruby">    return nil if blog_post.summary.nil?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="23">
          <span class="hits">32</span>
          
          <code class="ruby">    return truncate_html(blog_post.summary.html_safe, :length =&gt; 235)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  ##</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  # Returns the truncated title for a blog post.  It is a </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # simple truncation to 68 characters, with an ellipsis</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  # appended.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  # If the title is less than or equal to 68 characters, then</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  # it is returned unchanged.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  # @param [ContentItem] blog_post The blog post to get the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  #   title from</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  # @return [String] The title from +blog_post+ truncated</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  #   to 68 characters; returns nil if the title is nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def truncate_blog_title(blog_post)</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="40">
          <span class="hits">24</span>
          
          <code class="ruby">    return nil if blog_post.title.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="42">
          <span class="hits">23</span>
          
          <code class="ruby">    return blog_post.title.truncate(68)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def format_publish_date(date)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="46">
          <span class="hits">15</span>
          
          <code class="ruby">    date = date.published if date.is_a? ContentItem</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="47">
          <span class="hits">15</span>
          
          <code class="ruby">    return date.strftime('%A, %B %d, %Y')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def blog_filter_by_author_link(author,current_author)</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="51">
          <span class="hits">26</span>
          
          <code class="ruby">    if author == current_author</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="52">
          <span class="hits">3</span>
          
          <code class="ruby">      path = blog_index_path(request.parameters.merge({:author_id =&gt; nil, :page =&gt; nil}))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="54">
          <span class="hits">23</span>
          
          <code class="ruby">      path = blog_index_path(request.parameters.merge({:author_id =&gt; author.id, :page =&gt; nil}))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="56">
          <span class="hits">26</span>
          
          <code class="ruby">    link_to raw(&quot;#{profile_image(author,16,  'mem-img')}&lt;span&gt;#{author.name}&lt;/span&gt;&quot;), path , :class =&gt; &quot;#{'active' if current_author.try(:id) == author.id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="26b65626fe6745c2880d8cdd4360206d7f1e100a">
  <div class="header">
    <h3>app/helpers/buttons_helper.rb</h3>
    <h4><span class="red">66.67 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ButtonsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def delete_button_for(form_params={})</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    render :partial =&gt; 'shared/delete_button', :locals =&gt; { :form_params =&gt; form_params }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5c37237874ed65cf9b5cf95346d2662905f9b0f0">
  <div class="header">
    <h3>app/helpers/community_helper.rb</h3>
    <h4><span class="green">90.91 %</span> covered</h4>
    <div>
      <b>22</b> relevant lines. 
      <span class="green"><b>20</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CommunityHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def community_site_filter_link(order)</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="3">
          <span class="hits">36</span>
          
          <code class="ruby">    issue = @issue ? @issue.becomes(Issue) : nil</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="4">
          <span class="hits">36</span>
          
          <code class="ruby">    case order</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    when 'alphabetical'</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="6">
          <span class="hits">10</span>
          
          <code class="ruby">      title = 'Alphabetical'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    when 'newest-member'</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="8">
          <span class="hits">16</span>
          
          <code class="ruby">      title = 'Newest Members'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    when 'active-member'</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="10">
          <span class="hits">10</span>
          
          <code class="ruby">      title = 'Most Active'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    when 'organizations'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      title = 'Organizations'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    when 'people'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      title = 'People'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="16">
          <span class="hits">36</span>
          
          <code class="ruby">    merged_params =  request.parameters.except(:controller, :action).merge({:order =&gt; (@order == order ? nil : order), :page =&gt; params[:page]})</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="17">
          <span class="hits">36</span>
          
          <code class="ruby">    css_class = @order == order ? 'active' : nil </code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="18">
          <span class="hits">36</span>
          
          <code class="ruby">    link_to title, polymorphic_path([issue,:community], merged_params), :id =&gt; order, :class =&gt; css_class </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def community_site_people_filter_link(filter)</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="22">
          <span class="hits">36</span>
          
          <code class="ruby">    issue = @issue ? @issue.becomes(Issue) : nil</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="23">
          <span class="hits">36</span>
          
          <code class="ruby">    active = @current_filter == filter</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="24">
          <span class="hits">36</span>
          
          <code class="ruby">    css_class = active ? 'active' : ''</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="25">
          <span class="hits">36</span>
          
          <code class="ruby">    case filter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    when 'people'</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="27">
          <span class="hits">16</span>
          
          <code class="ruby">      filter_name = 'People Only'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    when 'organizations'</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="29">
          <span class="hits">10</span>
          
          <code class="ruby">      filter_name = 'Organizations Only'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="31">
          <span class="hits">10</span>
          
          <code class="ruby">      filter_name = 'People &amp; Organizations'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="33">
          <span class="hits">36</span>
          
          <code class="ruby">    merged_params = request.parameters.except(:controller, :action).merge({:filter =&gt; filter, :page=&gt;nil})</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="34">
          <span class="hits">36</span>
          
          <code class="ruby">    link_to raw(&quot;&lt;span&gt;#{filter_name}&lt;/span&gt;&quot;), polymorphic_path([issue,:community], merged_params), :class=&gt; css_class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="94e4dc3a894166ec6d1201c8d33a53dabba3d93b">
  <div class="header">
    <h3>app/helpers/content_templates_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ContentTemplatesHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def parse_content_template(id)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="4">
          <span class="hits">4</span>
          
          <code class="ruby">    template = ContentTemplate.find(id)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="5">
          <span class="hits">3</span>
          
          <code class="ruby">    return CCML.parse(template.template, controller.request.url) unless template.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  rescue =&gt; error</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    return ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ba1f6ec33fce8b50749240922ebd0d7f7a51d6a2">
  <div class="header">
    <h3>app/helpers/contributions_helper.rb</h3>
    <h4><span class="red">69.23 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ContributionsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def contribution_parent_page(contribution)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="3">
          <span class="hits">2</span>
          
          <code class="ruby">    if contribution.conversation</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="4">
          <span class="hits">2</span>
          
          <code class="ruby">      conversation_path(contribution.conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">      issue_path(contribution.issue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def person_display_name(person)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    if person</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      text_profile(person).html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      'An unknown person'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def link_to_edit_contribution(contribution,options= {})</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="19">
          <span class="hits">2</span>
          
          <code class="ruby">    link_to edit_conversation_contribution_path(contribution.conversation, contribution),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      options.merge({</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">        :remote =&gt; true,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">        :method =&gt; :get,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">        :class =&gt; &quot;edit-contribution-action&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">        :id =&gt; &quot;edit-#{contribution.id}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">        'data-target' =&gt; &quot;#show-contribution-#{contribution.id}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">        'data-type' =&gt; 'html'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      ) do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="28">
          <span class="hits">2</span>
          
          <code class="ruby">        yield if block_given?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="29">
          <span class="hits">2</span>
          
          <code class="ruby">        &quot;Edit&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d1927ac80eee1a4d257971112c5c7ce80eddf56d">
  <div class="header">
    <h3>app/helpers/conversations_helper.rb</h3>
    <h4><span class="red">44.55 %</span> covered</h4>
    <div>
      <b>110</b> relevant lines. 
      <span class="green"><b>49</b> lines covered</span> and
      <span class="red"><b>61</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ConversationsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def opportunity_navigation_item_selected?(type)</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="4">
          <span class="hits">80</span>
          
          <code class="ruby">    type == controller.controller_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def format_rating(contribution)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    return &quot;&quot; unless contribution.total_rating</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    out = contribution.total_rating &gt; 0 ? &quot;+&quot; : &quot;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    out += contribution.total_rating.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def format_user_rating(value)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    return case value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    when 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      &quot;You found this productive&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      &quot;You found this unproductive&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def format_time(t)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">     return &quot;no particular time&quot; if t.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">     return t.localtime.strftime(&quot;%c&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def format_time_only(t)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    return t.localtime.strftime(&quot;%l:%M %p&quot;) unless t.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def format_date(t)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    t.localtime.strftime(&quot;%b %e, %G&quot;) unless t.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def contribution_action_past_tense(contribution)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    if contribution.comment_only?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">      action = 'commented'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    elsif contribution.has_attachment?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">      action = 'shared a file'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    elsif contribution.has_media?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">      action = 'shared a link'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      action = 'shared a file and a link'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    if not contribution.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">      case contribution.embedly_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      when &quot;image&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">        type = &quot;image&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      when &quot;video&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">        type = &quot;video&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      when &quot;audio&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">        type = &quot;audio&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      when &quot;ppt&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">        type = &quot;presentation&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      when &quot;photo&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">        type = &quot;photo&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">        type = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">      action.sub!('link', type) unless type.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">    return action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">  def contribution_form_placeholder_text_for(type, subtype = nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">    case type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    when :comment</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">      &quot;Leave a Comment...&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    when :question</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">      &quot;Ask a Question...&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    when :answer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    when :attached_file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">      &quot;Comment on file...&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">    when :embedded_snippet</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">      &quot;Comment on video...&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    when :link</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">      &quot;Comment on link...&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">    when :suggested_action</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">      &quot;Suggest an action...&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    when :embedly_contribution</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="84">
          
          
          <code class="ruby">      if subtype == :video</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">        &quot;Share a video...&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">        &quot;Share a link...&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">      &quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">  # This method allows you to get the subset of direct descendents of this_contribution_id from the complete thread of root_contribution_and_descendents</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  #  root_contribution in this case is a TopLevelContribution node, and the whole thing has already been loaded by the controller,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  #  so we don't want to poll the database for each subset when we've already loaded the entire set once.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">  def display_direct_descendant_subset(contribution_descendants, this_contribution_id, ratings=nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">    out = &quot;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">    ratings = ratings || RatingGroup.ratings_for_conversation_by_contribution_with_count(Contribution.find(this_contribution_id).conversation, current_person)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">    return out unless contribution_descendants</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">    contribution_descendants.select{ |c| c.parent_id == this_contribution_id }.sort_by{ |c| c.created_at }.each do |contribution|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">      out += render(:partial =&gt; &quot;conversations/threaded_contribution_template&quot;, :locals =&gt; { :contribution =&gt; contribution, :ratings =&gt; ratings })</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">    raw(out)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">  def display_direct_descendant_subset_154(contribution_descendants, this_contribution_id, ratings=nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">    out = &quot;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="109">
          
          
          <code class="ruby">    ratings = ratings || RatingGroup.ratings_for_conversation_by_contribution_with_count(Contribution.find(this_contribution_id).conversation, current_person)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">    return out unless contribution_descendants</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">    contribution_descendants.select{ |c| c.parent_id == this_contribution_id }.sort_by{ |c| c.created_at }.each do |contribution|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">      out += render(:partial =&gt; &quot;conversations/threaded_contribution_template&quot;, :locals =&gt; { :contribution =&gt; contribution, :ratings =&gt; ratings })</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">    raw(out)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_node_path(contribution)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="118">
          
          
          <code class="ruby">    conversation_path(contribution.conversation, anchor: &quot;node-#{contribution.id}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_node_url(contribution, options = {})</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="122">
          <span class="hits">17</span>
          
          <code class="ruby">    options ||= {}</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="123">
          <span class="hits">17</span>
          
          <code class="ruby">    if Hash === options</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="124">
          <span class="hits">17</span>
          
          <code class="ruby">      options[:anchor] ||= &quot;node-#{contribution.id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="126">
          <span class="hits">17</span>
          
          <code class="ruby">    conversation_url(contribution.conversation, options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">  def filter_title(filter, suffix = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">    case filter.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">    when :active</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">      title = &quot;Most Active&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">    when :recommended</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">      title = &quot;Recommended&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">    when :popular</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="136">
          
          
          <code class="ruby">      title = &quot;Most Popular&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">    when :recent</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">      title = &quot;Newest&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="140">
          
          
          <code class="ruby">      title = &quot;Filtered&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">    if suffix then title += suffix end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">    title</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">  def filter_description(filter)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">    case filter.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">    when :active</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">      &quot;These are conversations that are inspiring people to join in.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">    when :recommended</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">      &quot;These are conversations we think you should check out because they're important and inspiring.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">    when :popular</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="155">
          
          
          <code class="ruby">      &quot;These are the conversations that are sparking interest.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">    when :recent</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">      &quot;These are the conversations that are just getting started.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="159">
          
          
          <code class="ruby">      &quot;These are the conversations that match your filter.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">  def path_to_content_item(content_item)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="164">
          <span class="hits">2</span>
          
          <code class="ruby">    if content_item.content_type == 'RadioShow'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">      path = radioshow_path(content_item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">    elsif content_item.content_type == 'BlogPost'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">      path = blog_path(content_item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="169">
          <span class="hits">2</span>
          
          <code class="ruby">    return path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">  def rating_buttons(contribution, ratings_hash)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">    out = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">    RatingGroup.cached_rating_descriptors.each do |id, title|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">      if current_person &amp;&amp; current_person.id == contribution.owner</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="176">
          
          
          <code class="ruby">        out &lt;&lt; &quot;&lt;li&gt;#{title} &lt;span class='count number'&gt;#{ratings_hash[contribution.id][title][:total]}&lt;/span&gt;&lt;/li&gt;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="178">
          
          
          <code class="ruby">        out &lt;&lt; &quot;&lt;li&gt;&quot; + link_to( &quot;#{title} &lt;span class='loading' style='display: none;'&gt;#{image_tag 'loading.gif'}&lt;/span&gt;&lt;span class='number'&gt;#{ratings_hash[contribution.id][title][:total]}&lt;/span&gt;&quot;.html_safe, conversation_contribution_toggle_rating_path(:contribution_id =&gt; contribution, :rating_descriptor_title =&gt; title), :remote =&gt; true, :method =&gt; :post, :id =&gt; &quot;contribution-#{contribution.id}-rating-#{title}&quot;, :class =&gt; &quot;rating-link #{'active' if ratings_hash[contribution.id][title][:person]}&quot; ) + &quot;&lt;/li&gt;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">    raw(out.join(' '))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">  def format_comment(contribution)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">    text = contribution.content.gsub(/([^\n]\n)(?=[^\n])/, ' ')</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">    sanitize(auto_link(text, html: {target: &quot;_blank&quot;}, sanitize: false), tags: %w(strong em span p ul ol li a), attributes: %w(href title target))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">  def respond_button_text(contribution)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="190">
          
          
          <code class="ruby">    current_person &amp;&amp; contribution.person == current_person ? &quot;Add More&quot; : &quot;Respond#{' to ' + contribution.person.short_name if contribution.person}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">  def short_title(title, length = 50, separator = ' ')</code>
        </li>
      
        <li class="covered" data-hits="198" data-linenumber="194">
          <span class="hits">198</span>
          
          <code class="ruby">    truncate(title, {:length =&gt; length, :separator =&gt; separator})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">  def setup_conversation(conversation)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">    conversation.tap do |conversation|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">      conversation.contributions.build if conversation.contributions.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_path_sym(content_item)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="204">
          <span class="hits">3</span>
          
          <code class="ruby">    if content_item</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="205">
          <span class="hits">2</span>
          
          <code class="ruby">      case content_item.content_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">      when 'RadioShow'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">        :radioshow</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">      when 'BlogPost'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">        :blog</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="280e8cb57ed0d005a281ede725f50d490576defd">
  <div class="header">
    <h3>app/helpers/invites_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module InvitesHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def from_conversation_create_page?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="4">
          <span class="hits">2</span>
          
          <code class="ruby">    params[:conversation_created]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="6d4100a9b113aefa4f67e307b65ffd1447cfecb9">
  <div class="header">
    <h3>app/helpers/issues_helper.rb</h3>
    <h4><span class="red">30.77 %</span> covered</h4>
    <div>
      <b>26</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>18</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module IssuesHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def media_style(contribution)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    if contribution.is_image? #or contribution.embedly_type == &quot;image&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">      &quot;image&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    elsif contribution.has_attachment?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">      &quot;document&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    elsif contribution.embedly_type == &quot;video&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      &quot;video&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    elsif not contribution.url.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">      &quot;link&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      &quot;comment&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def media_link_info(contribution)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    if contribution.has_attachment?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      link_to(contribution.attachment_file_name, contribution.attachment.url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">      link_to(contribution.title, contribution.url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def source_url(issue)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    if issue.url.match(/^https?:/)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      issue.url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">      &quot;http://&quot; + issue.url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def issue_node_path(contribution)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    issue_path(contribution.issue, anchor: &quot;node-#{contribution.id}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def issue_node_url(contribution, options = {})</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">    options ||= {}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">    if Hash === options</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">      options[:anchor] ||= &quot;node-#{contribution.id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">    issue_url(contribution.issue, options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8dbc74baedac9f4caae187f8a300ae4d54cef4ed">
  <div class="header">
    <h3>app/helpers/meta_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>31</b> relevant lines. 
      <span class="green"><b>31</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module MetaHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  # Removes extra spaces, style, script and truncates data</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def clean_and_truncate(data, length=125)</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="4">
          <span class="hits">41</span>
          
          <code class="ruby">    result = data.gsub(/\n/, &quot; &quot;).split.join(&quot; &quot;)</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="5">
          <span class="hits">41</span>
          
          <code class="ruby">    result = Sanitize.clean(result, :remove_contents =&gt; ['style','script'])</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="6">
          <span class="hits">41</span>
          
          <code class="ruby">    result = result.truncate(length, separator:&quot; &quot;)</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="7">
          <span class="hits">41</span>
          
          <code class="ruby">    result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # Different Types of Classes Have Different Default Values</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def default_meta_info(meta_data)</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="12">
          <span class="hits">39</span>
          
          <code class="ruby">    meta_info = {:page_title =&gt; nil, :meta_description =&gt; nil, :meta_tags =&gt; nil, :image_url =&gt; nil}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="14">
          <span class="hits">39</span>
          
          <code class="ruby">    meta_info[:page_title]       = Sanitize.clean(meta_data.page_title, :remove_contents =&gt; ['style','script']) if meta_data.page_title</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="15">
          <span class="hits">39</span>
          
          <code class="ruby">    meta_info[:meta_description] = clean_and_truncate(meta_data.summary) if meta_data.summary</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="17">
          <span class="hits">39</span>
          
          <code class="ruby">    if meta_data.is_a?(ContentItem) #&amp;&amp; meta_data.content_type_is_blog_post?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="18">
          <span class="hits">5</span>
          
          <code class="ruby">      meta_title = meta_data.page_title ? meta_data.page_title : meta_data.title</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="19">
          <span class="hits">5</span>
          
          <code class="ruby">      meta_info[:page_title]       = &quot;The Civic Commons #{meta_data.h_content_type}: #{Sanitize.clean(meta_title, :remove_contents =&gt; ['style','script'])}&quot;</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="20">
          <span class="hits">5</span>
          
          <code class="ruby">      meta_info[:image_url]        = ActionController::Base.helpers.asset_path(&quot;cc_podcast_small.jpg&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    #puts &quot;meta_data:#{meta_data.inspect}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    #puts &quot;issue?#{meta_data.is_a?(Issue)}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    #puts &quot;ancestor?#{meta_data.class}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    #puts &quot;default_meta_info:#{meta_info.inspect}&quot;</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="27">
          <span class="hits">39</span>
          
          <code class="ruby">    meta_info</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def setup_meta_info_for_conversation_contribution(contribution)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="31">
          <span class="hits">6</span>
          
          <code class="ruby">    conversation = contribution.conversation</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="32">
          <span class="hits">6</span>
          
          <code class="ruby">    @meta_info = {}</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="33">
          <span class="hits">6</span>
          
          <code class="ruby">    @meta_info[:page_title]= &quot;The Civic Commons Comment on: #{conversation.page_title.present? ? conversation.page_title : conversation.title}&quot;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="34">
          <span class="hits">6</span>
          
          <code class="ruby">    @meta_info[:meta_description] = clean_and_truncate(contribution.content)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="35">
          <span class="hits">6</span>
          
          <code class="ruby">    @meta_info[:meta_tags] = conversation.meta_tags</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="36">
          <span class="hits">6</span>
          
          <code class="ruby">    @meta_info[:image_url] = ActionController::Base.helpers.asset_path(conversation.image.url(:panel)) if conversation.respond_to?(:image) &amp;&amp; conversation.image.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="38">
          <span class="hits">6</span>
          
          <code class="ruby">    @meta_info = sanitize_meta_values(@meta_info)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def sanitize_meta_values(meta_info)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="42">
          <span class="hits">33</span>
          
          <code class="ruby">    meta_info.each{|key,value| meta_info[key] = Sanitize.clean(value, :remove_contents =&gt; ['style','script'])}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  # Set Up Page HTML Meta Information</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def setup_meta_info(meta_data)</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="47">
          <span class="hits">39</span>
          
          <code class="ruby">    @meta_info = default_meta_info(meta_data)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    # Meta Information Overrides Take Preceidence Over Default Data</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="50">
          <span class="hits">39</span>
          
          <code class="ruby">    @meta_info[:page_title]       = Sanitize.clean(meta_data.title)             if meta_data.title &amp;&amp; @meta_info[:page_title].nil? &amp;&amp; meta_data.page_title.nil?</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="51">
          <span class="hits">39</span>
          
          <code class="ruby">    @meta_info[:meta_description] = Sanitize.clean(meta_data.meta_description)  if meta_data.meta_description.present?</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="52">
          <span class="hits">39</span>
          
          <code class="ruby">    @meta_info[:meta_tags]        = Sanitize.clean(meta_data.meta_tags)         if meta_data.meta_tags.present?</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="53">
          <span class="hits">39</span>
          
          <code class="ruby">    @meta_info[:image_url]        = Sanitize.clean(ActionController::Base.helpers.asset_path(meta_data.image.url(:panel))) if meta_data.respond_to?(:image) &amp;&amp; meta_data.image.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    #puts &quot;post setup_meta_info:#{@meta_info.inspect}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7cf8e9aad7ef39c7001577927775adeb92ab6a1d">
  <div class="header">
    <h3>app/helpers/opportunity_votes_helper.rb</h3>
    <h4><span class="green">92.31 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module OpportunityVotesHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def js(data)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="4">
          <span class="hits">7</span>
          
          <code class="ruby">    if data.respond_to? :to_json</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="5">
          <span class="hits">7</span>
          
          <code class="ruby">      data.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">      data.inspect.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def add_object_link(name, form, object, partial, where, options={})</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="12">
          <span class="hits">7</span>
          
          <code class="ruby">    options = {:parent =&gt; true}.merge(options)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="13">
          <span class="hits">7</span>
          
          <code class="ruby">    html = render(:partial =&gt; partial, :locals =&gt; { :form =&gt; form}, :object =&gt; object)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="14">
          <span class="hits">7</span>
          
          <code class="ruby">    link_to_function name, %{</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      var new_object_id = new Date().getTime() ;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      var html = $(#{js html}.replace(/index_to_replace_with_js/g, new_object_id)).hide();</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      html.appendTo($(&quot;#{where}&quot;)).slideDown('fast');</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      init_opportunity_vote_option(html);</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    }, options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def opportunity_vote_tab_nav(step)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="23">
          <span class="hits">9</span>
          
          <code class="ruby">    selected_option_ids = @vote_response_presenter &amp;&amp; @vote_response_presenter.selected_option_ids.join(',')</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="24">
          <span class="hits">9</span>
          
          <code class="ruby">    select_options_link = (step == 'select_options') ? '#' : select_options_conversation_vote_path(@conversation,@vote, :selected_option_ids =&gt; selected_option_ids)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="25">
          <span class="hits">9</span>
          
          <code class="ruby">    render :partial =&gt; 'vote_tab_nav', :locals =&gt; {:step =&gt; step, :select_options_link =&gt; select_options_link}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c2708aac4ab95c46039f1e862cf5209eff53960b">
  <div class="header">
    <h3>app/helpers/organizations_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module OrganizationsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def organization_membership_button(organization, user)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="3">
          <span class="hits">7</span>
          
          <code class="ruby">    if organization.has_member?(user)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="4">
          <span class="hits">3</span>
          
          <code class="ruby">      raw content_tag(:p, (link_to &quot;Leave this organization&quot;, remove_membership_user_path(organization.id),  :remote =&gt; true, :method =&gt; :delete, :class=&gt;'button remove'), :class=&gt;'membership')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="6">
          <span class="hits">4</span>
          
          <code class="ruby">      raw content_tag(:p, (link_to &quot;I'm affiliated with this organization&quot;, join_as_member_user_path(organization.id), :class=&gt;'button join'), :class=&gt;'membership')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="923990bfaab9b3348421f1f82ad4973ca00903f2">
  <div class="header">
    <h3>app/helpers/profile_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>31</b> relevant lines. 
      <span class="green"><b>31</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ProfileHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  CUSTOM_CLASSES = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    email: &quot;email-profile&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    twitter: &quot;twitter-profile&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    address: &quot;website-profile&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    facebook: &quot;fb-profile&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  DATA_TO_FOLD_INTO_ADDRESS = [:phone, :website]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def contact_info_for profile</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="10">
          <span class="hits">12</span>
          
          <code class="ruby">    data = fold_address_together(profile.profile_data)</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="11">
          <span class="hits">36</span>
          
          <code class="ruby">    data.reject! { |k, v| v.empty? }</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="12">
          <span class="hits">12</span>
          
          <code class="ruby">    data.inject(&quot;&quot;) do | list, (type, data) |</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="13">
          <span class="hits">20</span>
          
          <code class="ruby">      list &lt;&lt; &quot;&lt;li#{class_for(type)}&gt;#{prep(data, type)}&lt;/li&gt;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def fold_address_together data</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="20">
          <span class="hits">12</span>
          
          <code class="ruby">    address_parts = []</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="21">
          <span class="hits">12</span>
          
          <code class="ruby">    address_parts.push(data[:address]) if data[:address]</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="22">
          <span class="hits">12</span>
          
          <code class="ruby">    DATA_TO_FOLD_INTO_ADDRESS.each do |type|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      if data.has_key? type</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="24">
          <span class="hits">10</span>
          
          <code class="ruby">        address_parts.push(&quot;#{prep(data[type], type)}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="25">
          <span class="hits">50</span>
          
          <code class="ruby">        data.reject! { |(k,v)| k == type }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="28">
          <span class="hits">12</span>
          
          <code class="ruby">    address_parts.push(&quot;#{prep(data[:website], :website)}&quot;) if data[:website]</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="29">
          <span class="hits">12</span>
          
          <code class="ruby">    data[:address] = address_parts.join('&lt;br /&gt;');</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="30">
          <span class="hits">12</span>
          
          <code class="ruby">    data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def class_for type</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="33">
          <span class="hits">20</span>
          
          <code class="ruby">    return &quot; class=\&quot;#{CUSTOM_CLASSES[type]}\&quot;&quot; if CUSTOM_CLASSES.has_key? type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def prep data, type</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="36">
          <span class="hits">30</span>
          
          <code class="ruby">    data.gsub! /\n/, &quot;&lt;br /&gt;&quot;</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="37">
          <span class="hits">30</span>
          
          <code class="ruby">    return link_to(data, 'mailto:' + data) if type == :email</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="38">
          <span class="hits">26</span>
          
          <code class="ruby">    return twitter_url(data) if type == :twitter</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="39">
          <span class="hits">22</span>
          
          <code class="ruby">    return link_to(data, data) if type == :website</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="40">
          <span class="hits">17</span>
          
          <code class="ruby">    return link_to(&quot;Facebook&quot;, data) if type == :facebook</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="41">
          <span class="hits">13</span>
          
          <code class="ruby">    return &quot;P: #{data}&quot; if type == :phone</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="42">
          <span class="hits">8</span>
          
          <code class="ruby">    data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def twitter_url(handle)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="45">
          <span class="hits">4</span>
          
          <code class="ruby">    link_to &quot;@#{handle}&quot;, &quot;http://twitter.com/#!/#{handle}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="63179098f2c7ee5fb195df7605ee24cae6a4f1fc">
  <div class="header">
    <h3>app/helpers/radioshow_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>11</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module RadioshowHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def radioshow_hosts(radioshow)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="3">
          <span class="hits">4</span>
          
          <code class="ruby">    hosts = radioshow.hosts</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="4">
          <span class="hits">4</span>
          
          <code class="ruby">    if hosts.length &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="5">
          <span class="hits">5</span>
          
          <code class="ruby">      hosts_html = hosts.collect{|host| text_profile(host) }</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="6">
          <span class="hits">2</span>
          
          <code class="ruby">      raw &quot;&lt;p&gt;&lt;strong&gt;Hosted by:&lt;/strong&gt;&amp;nbsp;#{hosts_html.join(' and ')}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def radioshow_guests(radioshow)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="10">
          <span class="hits">4</span>
          
          <code class="ruby">    guests = radioshow.guests</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="11">
          <span class="hits">4</span>
          
          <code class="ruby">    if guests.length &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="12">
          <span class="hits">5</span>
          
          <code class="ruby">      guests_html = guests.collect{|guest| text_profile(guest) }</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="13">
          <span class="hits">2</span>
          
          <code class="ruby">      raw &quot;&lt;p&gt;&lt;strong&gt;Special Guest:&lt;/strong&gt;&amp;nbsp;#{guests_html.join(' and ')}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="40f93eb08c8721e1a3b7c4cdae04f91025ff1d87">
  <div class="header">
    <h3>app/helpers/ratings_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module RatingsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8de65eda300250ddd3bcba32b03f6e4a06912528">
  <div class="header">
    <h3>app/helpers/redirect_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module RedirectHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.valid?(redirect_link)</code>
        </li>
      
        <li class="covered" data-hits="274" data-linenumber="4">
          <span class="hits">274</span>
          
          <code class="ruby">    !redirect_link.nil? &amp;&amp; !self.matches_devise_routes?(redirect_link)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.matches_devise_routes?(redirect_link)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    # only set the previous page url if it is not a devise route</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="11">
          <span class="hits">16</span>
          
          <code class="ruby">    match = false</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="12">
          <span class="hits">16</span>
          
          <code class="ruby">    Devise.mappings.each_key do |mapping|</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="13">
          <span class="hits">16</span>
          
          <code class="ruby">      scoped_path = Devise.mappings[mapping].scoped_path</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="14">
          <span class="hits">16</span>
          
          <code class="ruby">      Devise.mappings[mapping].path_names.each_pair do |path_key, path_name|</code>
        </li>
      
        <li class="covered" data-hits="144" data-linenumber="15">
          <span class="hits">144</span>
          
          <code class="ruby">        path = scoped_path + '/' + path_name</code>
        </li>
      
        <li class="covered" data-hits="144" data-linenumber="16">
          <span class="hits">144</span>
          
          <code class="ruby">        if redirect_link.match(&quot;#{path}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="17">
          <span class="hits">10</span>
          
          <code class="ruby">          match = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="21">
          <span class="hits">16</span>
          
          <code class="ruby">    match</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f6cd1373ff943948d44aad50ecb0db35dc2c9f7a">
  <div class="header">
    <h3>app/helpers/reflections_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ReflectionsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="adf8111df702ee508571907cc7db88dc7942a0ad">
  <div class="header">
    <h3>app/helpers/region_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module RegionHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # Region(metrocode) of CivicCommons</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def cc_metro_region</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="5">
          <span class="hits">11</span>
          
          <code class="ruby">    510</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def region_tab_image_url</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="9">
          <span class="hits">2</span>
          
          <code class="ruby">    &quot;http://s3.amazonaws.com/#{S3Config.bucket.to_s}/images-regions/#{default_region}.png&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  # Set up the Default Region for the User</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # If one is not given, default to 510 - Cleveland-Akron (Canton) OH</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # This method sets the region if the region param is supplied. Otherwise reads it from database or cookie</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def default_region(region = nil)</code>
        </li>
      
        <li class="covered" data-hits="276" data-linenumber="16">
          <span class="hits">276</span>
          
          <code class="ruby">    if region.blank?</code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="17">
          <span class="hits">271</span>
          
          <code class="ruby">      region = user_region</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="19">
          <span class="hits">5</span>
          
          <code class="ruby">      current_person.set_default_region(params[:metrocode]) if signed_in?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="20">
          <span class="hits">5</span>
          
          <code class="ruby">      cookies.permanent[:default_region] = {:value =&gt; &quot;#{region}&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="276" data-linenumber="23">
          <span class="hits">276</span>
          
          <code class="ruby">    return region.present? ? region.to_i : nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_region</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="27">
          <span class="hits">39</span>
          
          <code class="ruby">    @current_region ||= MetroRegion.find_by_metrocode(default_region)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  # Weather a user is logged in or not, we need to figure out if they have a region filter selected.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  # * check the database, if logged in</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  # * check the cookie, if not logged in</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_region</code>
        </li>
      
        <li class="covered" data-hits="719" data-linenumber="34">
          <span class="hits">719</span>
          
          <code class="ruby">    if signed_in?</code>
        </li>
      
        <li class="covered" data-hits="364" data-linenumber="35">
          <span class="hits">364</span>
          
          <code class="ruby">      current_person.default_region</code>
        </li>
      
        <li class="covered" data-hits="355" data-linenumber="36">
          <span class="hits">355</span>
          
          <code class="ruby">    elsif cookies[:default_region].present?</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="37">
          <span class="hits">31</span>
          
          <code class="ruby">      cookies[:default_region]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0a6d5efb442e9b4d035d37335e25981969b943ac">
  <div class="header">
    <h3>app/helpers/search_helper.rb</h3>
    <h4><span class="red">69.23 %</span> covered</h4>
    <div>
      <b>39</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>12</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module SearchHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def best_hit_description(hit, field_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    text = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    if highlight = hit.highlight(field_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">      if(!highlight.nil?)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">        text = highlight.format { |fragment|  &quot;___&quot; + fragment + &quot;~~~&quot; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      text = hit.result.method(field_name).call</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    if(!text.nil?)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      clean_text = Sanitize.clean(text).strip</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      text = text_containing_match clean_text</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    raw(text)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def text_containing_match(text)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">    matched_text_start = text.index(/(___)/) || 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">    matched_text_end = text.rindex(/(~~~)/) || 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    # Get only text surrounding the matched elements</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="26">
          <span class="hits">2</span>
          
          <code class="ruby">    if(matched_text_start &lt; 100)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="27">
          <span class="hits">2</span>
          
          <code class="ruby">      slice_start = 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="28">
          <span class="hits">2</span>
          
          <code class="ruby">      slice_end = matched_text_end + 150</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">      slice_start = matched_text_start - 50</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">      slice_end = matched_text_end + 200</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="33">
          <span class="hits">2</span>
          
          <code class="ruby">    text = text.slice!(slice_start..slice_end).strip</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    # truncate text so that it doesn't cut off the strong tags</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="36">
          <span class="hits">2</span>
          
          <code class="ruby">    truncated = truncate(text, :length =&gt; 200)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="37">
          <span class="hits">2</span>
          
          <code class="ruby">    highlighted = truncated.gsub(/(___)/, &quot;&lt;strong&gt;&quot;).gsub(/~{2,}/, &quot;&lt;/strong&gt;&quot;).gsub(/~+/, &quot;&amp;nbsp;&quot;).gsub(/_{2,}/, &quot;&lt;/strong&gt;&quot;).gsub(/_+/, &quot;&amp;nbsp;&quot;)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="38">
          <span class="hits">2</span>
          
          <code class="ruby">    highlighted = auto_close_strong_tag(highlighted)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="39">
          <span class="hits">2</span>
          
          <code class="ruby">    highlighted = append_ellipsis_if_missing(highlighted)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="40">
          <span class="hits">2</span>
          
          <code class="ruby">    return highlighted</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def auto_close_strong_tag(text)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    # check if strong closing tag exists at the end of the string</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="45">
          <span class="hits">4</span>
          
          <code class="ruby">    strong_start_index = text.rindex(/\&lt;(strong)\&gt;/) || 0</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="46">
          <span class="hits">4</span>
          
          <code class="ruby">    strong_end_index =  text.rindex(/\&lt;\/(strong)\&gt;/) || 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="48">
          <span class="hits">4</span>
          
          <code class="ruby">    if(strong_start_index &gt; strong_end_index)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      # need to append closing strong tag to string since it was detected that an opening strong tag exists</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="50">
          <span class="hits">2</span>
          
          <code class="ruby">      text += &quot;&lt;/strong&gt;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="52">
          <span class="hits">4</span>
          
          <code class="ruby">    return text</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">  def append_ellipsis_if_missing(text)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="56">
          <span class="hits">4</span>
          
          <code class="ruby">    ellipsis_index = text.rindex(/\.{3}/)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="57">
          <span class="hits">4</span>
          
          <code class="ruby">    if(ellipsis_index == nil)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="58">
          <span class="hits">3</span>
          
          <code class="ruby">      text += &quot;...&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">    elsif(ellipsis_index &lt; (text.length - 3))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">      text += &quot;...&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="62">
          <span class="hits">4</span>
          
          <code class="ruby">    return text</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1183ab14f8a59c4f02f40ca0cbb158e364637b47">
  <div class="header">
    <h3>app/helpers/secure_url_helper.rb</h3>
    <h4><span class="green">93.1 %</span> covered</h4>
    <div>
      <b>29</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module SecureUrlHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include Rails.application.routes.url_helpers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.protocol</code>
        </li>
      
        <li class="covered" data-hits="304" data-linenumber="5">
          <span class="hits">304</span>
          
          <code class="ruby">    if self.https?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="6">
          <span class="hits">3</span>
          
          <code class="ruby">      'https'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="301" data-linenumber="8">
          <span class="hits">301</span>
          
          <code class="ruby">      'http'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.http?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    not self.https?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.https?</code>
        </li>
      
        <li class="covered" data-hits="778" data-linenumber="17">
          <span class="hits">778</span>
          
          <code class="ruby">    cc = Civiccommons::Config</code>
        </li>
      
        <li class="covered" data-hits="778" data-linenumber="18">
          <span class="hits">778</span>
          
          <code class="ruby">    cc.respond_to?('security') and cc.security.key?('ssl_login') and cc.security['ssl_login']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def secure_registration_form_url</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="22">
          <span class="hits">3</span>
          
          <code class="ruby">    new_person_registration_url(:protocol =&gt; SecureUrlHelper.protocol)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def secure_registration_url(resource_name)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="26">
          <span class="hits">13</span>
          
          <code class="ruby">    if SecureUrlHelper.https?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">      registration_url(resource_name).gsub(/http:\/\//, 'https://')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="29">
          <span class="hits">12</span>
          
          <code class="ruby">      registration_url(resource_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def secure_edit_user_url(resource_name)</code>
        </li>
      
        <li class="covered" data-hits="260" data-linenumber="34">
          <span class="hits">260</span>
          
          <code class="ruby">    edit_user_url(resource_name, :protocol =&gt; SecureUrlHelper.protocol)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  def secure_user_url(resource_name)</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="38">
          <span class="hits">27</span>
          
          <code class="ruby">    user_url(resource_name, :protocol =&gt; SecureUrlHelper.protocol)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def secure_session_url(resource_name)</code>
        </li>
      
        <li class="covered" data-hits="145" data-linenumber="42">
          <span class="hits">145</span>
          
          <code class="ruby">    if SecureUrlHelper.https?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">      session_url(resource_name).gsub(/http:\/\//, 'https://')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="144" data-linenumber="45">
          <span class="hits">144</span>
          
          <code class="ruby">      session_url(resource_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  def secure_new_person_registration_url()</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">    new_person_registration_url(:protocol =&gt; SecureUrlHelper.protocol)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def secure_new_person_session_url()</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="54">
          <span class="hits">14</span>
          
          <code class="ruby">    new_person_session_url(:protocol =&gt; SecureUrlHelper.protocol)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="20381500122db46f4c80aecde29a6b6ad5d715ca">
  <div class="header">
    <h3>app/helpers/surveys_helper.rb</h3>
    <h4><span class="yellow">80.77 %</span> covered</h4>
    <div>
      <b>26</b> relevant lines. 
      <span class="green"><b>21</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module SurveysHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def relative_weighted_votes_percentage(weighted_votes_percentage, highest_weighted_votes_percentage, offset=0)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="3">
          <span class="hits">9</span>
          
          <code class="ruby">    total = (weighted_votes_percentage.to_f / highest_weighted_votes_percentage.to_f)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="4">
          <span class="hits">9</span>
          
          <code class="ruby">    total = total.nan? ? 0 : total * 100</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="6">
          <span class="hits">9</span>
          
          <code class="ruby">    total = total + offset if total &gt; offset.abs</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="7">
          <span class="hits">9</span>
          
          <code class="ruby">    return total.to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def back_to_surveyable(survey)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="11">
          <span class="hits">13</span>
          
          <code class="ruby">    if !survey.surveyable_type.blank? &amp;&amp; !survey.surveyable_id.blank?</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="12">
          <span class="hits">12</span>
          
          <code class="ruby">      case survey.surveyable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      when Issue</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="14">
          <span class="hits">9</span>
          
          <code class="ruby">        surveyable = survey.surveyable.becomes(Issue)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="15">
          <span class="hits">9</span>
          
          <code class="ruby">        title = survey.surveyable.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      when Conversation</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">        surveyable = survey.surveyable</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">        title = survey.surveyable.title</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="20">
          <span class="hits">12</span>
          
          <code class="ruby">      raw &quot;Back to: #{link_to title, surveyable}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def polymorphic_survey_response_url(survey_response)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    surveyable_type = survey_response.try(:survey).try(:surveyable_type)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    if surveyable_type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">      surveyable = survey_response.try(:survey).try(:surveyable)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">      send(&quot;#{surveyable_type.underscore}_#{survey_response.survey_type.underscore}_url&quot;.to_sym, surveyable, survey_response.survey_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">      send(&quot;#{survey_response.survey.type.underscore}_url&quot;.to_sym,survey_response.survey.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def polymorphic_survey_url(survey)</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="35">
          <span class="hits">76</span>
          
          <code class="ruby">    case survey.type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    when 'Vote'</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="37">
          <span class="hits">76</span>
          
          <code class="ruby">      if survey.surveyable &amp;&amp; survey.surveyable_type == 'Conversation'</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="38">
          <span class="hits">41</span>
          
          <code class="ruby">        conversation_vote_url(survey.surveyable, survey, :anchor =&gt; 'opportunity-nav')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="40">
          <span class="hits">35</span>
          
          <code class="ruby">        vote_url(survey.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      send(&quot;#{survey.type.underscore}_url&quot;.to_sym, survey.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="dc1bb52ce14a0e4648cb26785838844a6079a675">
  <div class="header">
    <h3>app/helpers/topics_helper.rb</h3>
    <h4><span class="yellow">89.19 %</span> covered</h4>
    <div>
      <b>37</b> relevant lines. 
      <span class="green"><b>33</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module TopicsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_issue_topics_sidebar</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="3">
          <span class="hits">4</span>
          
          <code class="ruby">    render 'topics/issue_topic_sidebar', :topics =&gt; @topics</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def issue_topic_filter(topic)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="7">
          <span class="hits">4</span>
          
          <code class="ruby">    active = @current_topic == topic</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="8">
          <span class="hits">4</span>
          
          <code class="ruby">    css_class = active ? 'active' : ''</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="9">
          <span class="hits">4</span>
          
          <code class="ruby">    topic_id = active ? nil : topic.id</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="10">
          <span class="hits">4</span>
          
          <code class="ruby">    link_to raw(&quot;&lt;span&gt;#{topic.name}&lt;/span&gt; &lt;em&gt;#{topic.issue_count}&lt;/em&gt;&quot;), issues_path(:topic =&gt; topic_id), :class=&gt; css_class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_topic_filter(topic)</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="14">
          <span class="hits">18</span>
          
          <code class="ruby">    active = @current_topic == topic</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="15">
          <span class="hits">18</span>
          
          <code class="ruby">    css_class = active ? 'active' : ''</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="16">
          <span class="hits">18</span>
          
          <code class="ruby">    topic_id = active ? nil : topic.id</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="17">
          <span class="hits">18</span>
          
          <code class="ruby">    link_to raw(&quot;&lt;span&gt;#{topic.name}&lt;/span&gt; &lt;em&gt;#{topic.conversation_count}&lt;/em&gt;&quot;), conversations_path(:topic =&gt; topic_id), :class=&gt; css_class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_radioshow_topics_sidebar</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="21">
          <span class="hits">3</span>
          
          <code class="ruby">    render 'topics/radioshow_topic_sidebar', :topics =&gt; @topics</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_blogpost_topics_sidebar</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="25">
          <span class="hits">9</span>
          
          <code class="ruby">    render 'topics/blogpost_topic_sidebar', :topics =&gt; @topics</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def content_item_topic_filter(topic, content_type)</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="29">
          <span class="hits">31</span>
          
          <code class="ruby">    active = @current_topic == topic</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="30">
          <span class="hits">31</span>
          
          <code class="ruby">    css_class = active ? 'active' : ''</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="31">
          <span class="hits">31</span>
          
          <code class="ruby">    topic_id = active ? nil : topic.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="33">
          <span class="hits">31</span>
          
          <code class="ruby">    case content_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    when :blogpost</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="35">
          <span class="hits">26</span>
          
          <code class="ruby">      path = blog_index_path(request.parameters.merge({:topic =&gt; topic_id, :page =&gt; nil}))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    when :radioshow</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="37">
          <span class="hits">5</span>
          
          <code class="ruby">      path = radioshow_index_path(:topic =&gt; topic_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">      path = ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="42">
          <span class="hits">31</span>
          
          <code class="ruby">    link_to raw(&quot;&lt;span&gt;#{topic.name}&lt;/span&gt; &lt;em&gt;#{topic.content_item_count}&lt;/em&gt;&quot;), path , :class=&gt; css_class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def topics_one_line(obj)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    topics = obj.topics.collect{|topic|topic.name}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    if topics.present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">      &quot;Topic: #{topics.to_sentence(:last_word_connector =&gt; ', ')}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">  def topics_list_for(obj)</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="56">
          <span class="hits">35</span>
          
          <code class="ruby">    rendered_list = obj.topics.map do |topic|</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="57">
          <span class="hits">35</span>
          
          <code class="ruby">      if obj.class == Issue</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="58">
          <span class="hits">12</span>
          
          <code class="ruby">        render partial: &quot;issues/issue_list_item&quot;, locals: { topic: topic }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      elsif obj.class == ContentItem and obj.content_type == 'RadioShow'</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="60">
          <span class="hits">8</span>
          
          <code class="ruby">        render partial: &quot;radioshow/radioshow_list_item&quot;, locals: { topic: topic }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      elsif obj.class == ContentItem and obj.content_type == 'BlogPost'</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="62">
          <span class="hits">15</span>
          
          <code class="ruby">        render partial: &quot;blog/blog_list_item&quot;, locals: { topic: topic }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="65">
          <span class="hits">35</span>
          
          <code class="ruby">    rendered_list.to_sentence(last_word_connector: &quot;, &quot;, two_words_connector: &quot;, &quot;).gsub(/\n/, &quot;&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f08433aab6ae7d065a9b1592c7c7a5f972bbe5d5">
  <div class="header">
    <h3>app/helpers/user_helper.rb</h3>
    <h4><span class="green">94.74 %</span> covered</h4>
    <div>
      <b>38</b> relevant lines. 
      <span class="green"><b>36</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module UserHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def classes(contribution)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="4">
          <span class="hits">6</span>
          
          <code class="ruby">    cls = ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="6">
          <span class="hits">6</span>
          
          <code class="ruby">    if contribution.is_image? or contribution.embedly_type == 'image'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      cls = 'image dnld'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    elsif contribution.embedly_type == 'video'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">      cls = 'video dnld'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    elsif contribution.has_attachment?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">      cls = 'document dnld'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    elsif contribution.has_media?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">      cls = 'link dnld'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="16">
          <span class="hits">6</span>
          
          <code class="ruby">    return cls</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def avatar_label_text</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="20">
          <span class="hits">25</span>
          
          <code class="ruby">    if @person.is_organization?</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="21">
          <span class="hits">7</span>
          
          <code class="ruby">      &quot;Company Logo&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="23">
          <span class="hits">18</span>
          
          <code class="ruby">      &quot;Your Photograph&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def bio_label_text</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="28">
          <span class="hits">25</span>
          
          <code class="ruby">    if @person.is_organization?</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="29">
          <span class="hits">7</span>
          
          <code class="ruby">      &quot;Tell us about your company&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="31">
          <span class="hits">18</span>
          
          <code class="ruby">      &quot;Tell us a little about yourself&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_image_label_text</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="36">
          <span class="hits">25</span>
          
          <code class="ruby">    if @person.is_organization?</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="37">
          <span class="hits">7</span>
          
          <code class="ruby">      &quot;Current Logo&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="39">
          <span class="hits">18</span>
          
          <code class="ruby">      &quot;Current Photograph&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def name_label_text</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="44">
          <span class="hits">25</span>
          
          <code class="ruby">    if @person.is_organization?</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="45">
          <span class="hits">7</span>
          
          <code class="ruby">      &quot;Name of Organization&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="47">
          <span class="hits">18</span>
          
          <code class="ruby">      &quot;Your Name&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def title_label_text</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="52">
          <span class="hits">25</span>
          
          <code class="ruby">    &quot;Your Title&quot; if !@person.is_organization?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">  def remove_avatar_text</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="56">
          <span class="hits">4</span>
          
          <code class="ruby">    if @person.is_organization?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="57">
          <span class="hits">2</span>
          
          <code class="ruby">      &quot;Remove Logo&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="59">
          <span class="hits">2</span>
          
          <code class="ruby">      &quot;Remove Photograph&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  def remote_url(url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">    url.gsub(/www\./, 'http://www.')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">  def url_to_contribution(contribution)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="68">
          <span class="hits">14</span>
          
          <code class="ruby">    if contribution.issue &amp;&amp; ! ( controller.controller_name == 'issues' &amp;&amp; controller.action_name == 'show' )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">      issue_node_url( contribution )</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="70">
          <span class="hits">14</span>
          
          <code class="ruby">    elsif contribution.conversation</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="71">
          <span class="hits">14</span>
          
          <code class="ruby">      conversation_node_url( contribution )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="09397abb38f3a2a03e95e80788bc6f4d6ee2d420">
  <div class="header">
    <h3>app/mailers/notifier.rb</h3>
    <h4><span class="yellow">81.16 %</span> covered</h4>
    <div>
      <b>69</b> relevant lines. 
      <span class="green"><b>56</b> lines covered</span> and
      <span class="red"><b>13</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Notifier &lt; Devise::Mailer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  layout 'mailer'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  add_template_helper(ConversationsHelper)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  add_template_helper(SurveysHelper)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  add_template_helper(ApplicationHelper)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def email_changed(old_email, new_email)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="9">
          <span class="hits">8</span>
          
          <code class="ruby">    @old_email = old_email</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="10">
          <span class="hits">8</span>
          
          <code class="ruby">    @new_email = new_email</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="11">
          <span class="hits">8</span>
          
          <code class="ruby">    headers['X-SMTPAPI'] = '{&quot;category&quot;: &quot;email_changed&quot;}'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    mail(:subject =&gt; &quot;You've recently changed your email with The Civic Commons&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">         :from =&gt; Devise.mailer_sender,</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">         :to =&gt; [old_email, new_email])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def welcome(record)</code>
        </li>
      
        <li class="covered" data-hits="2660" data-linenumber="18">
          <span class="hits">2660</span>
          
          <code class="ruby">    @resource = record</code>
        </li>
      
        <li class="covered" data-hits="2660" data-linenumber="19">
          <span class="hits">2660</span>
          
          <code class="ruby">    headers['X-SMTPAPI'] = '{&quot;category&quot;: &quot;welcome&quot;}'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    mail(:subject =&gt; &quot;Welcome to The Civic Commons&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">         :from =&gt; Devise.mailer_sender,</code>
        </li>
      
        <li class="covered" data-hits="2660" data-linenumber="22">
          <span class="hits">2660</span>
          
          <code class="ruby">         :to =&gt; @resource.email)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def new_registration_notification(record)</code>
        </li>
      
        <li class="covered" data-hits="2986" data-linenumber="26">
          <span class="hits">2986</span>
          
          <code class="ruby">    @resource = record</code>
        </li>
      
        <li class="covered" data-hits="2986" data-linenumber="27">
          <span class="hits">2986</span>
          
          <code class="ruby">    headers['X-SMTPAPI'] = '{&quot;category&quot;: &quot;new_registration_notification&quot;}'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    mail(:subject =&gt; &quot;New User Registered&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">         :from =&gt; Devise.mailer_sender,</code>
        </li>
      
        <li class="covered" data-hits="2986" data-linenumber="30">
          <span class="hits">2986</span>
          
          <code class="ruby">         :to =&gt; 'register@theciviccommons.com')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def suggestion_thank_you(record)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    @resource = record</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    headers['X-SMTPAPI'] = '{&quot;category&quot;: &quot;suggestion_thank_you&quot;}'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    mail(:subject =&gt; &quot;Thank you for your suggestion&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">         :from =&gt; Devise.mailer_sender,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">         :to =&gt; @resource.email)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def invite_to_conversation(resource)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="42">
          <span class="hits">3</span>
          
          <code class="ruby">    @resource = resource</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="43">
          <span class="hits">3</span>
          
          <code class="ruby">    @user = @resource[:user]</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="44">
          <span class="hits">3</span>
          
          <code class="ruby">    @conversation = @resource[:conversation]</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="45">
          <span class="hits">3</span>
          
          <code class="ruby">    headers['X-SMTPAPI'] = '{&quot;category&quot;: &quot;invite_to_conversation&quot;}'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    mail(:subject =&gt; @user.name + &quot; wants to invite you to a conversation at The Civic Commons&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">         :from =&gt; Devise.mailer_sender,</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="48">
          <span class="hits">3</span>
          
          <code class="ruby">         :to =&gt; @resource[:emails])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def violation_complaint(resource)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="52">
          <span class="hits">2</span>
          
          <code class="ruby">    @resource = resource</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="53">
          <span class="hits">2</span>
          
          <code class="ruby">    @user = @resource[:user]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="54">
          <span class="hits">2</span>
          
          <code class="ruby">    @reason = @resource[:reason]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">    @contribution = @resource[:contribution]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="56">
          <span class="hits">2</span>
          
          <code class="ruby">    headers['X-SMTPAPI'] = '{&quot;category&quot;: &quot;violation_complaint&quot;}'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    mail(:subject =&gt; &quot;ALERT: Possible TOS Violation reported&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">         :from =&gt; Devise.mailer_sender,</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="59">
          <span class="hits">2</span>
          
          <code class="ruby">         :to =&gt; Civiccommons::Config.email[&quot;default_email&quot;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">  def daily_digest(person, conversations)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="63">
          <span class="hits">6</span>
          
          <code class="ruby">    @person = person</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="64">
          <span class="hits">6</span>
          
          <code class="ruby">    @conversations = conversations</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="65">
          <span class="hits">6</span>
          
          <code class="ruby">    headers['X-SMTPAPI'] = '{&quot;category&quot;: &quot;daily_digest&quot;}'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    mail(:subject =&gt; &quot;The Civic Commons Daily Digest&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">         :from =&gt; '&quot;Curator of Conversation&quot; &lt;curator@theciviccommons.com&gt;',</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="68">
          <span class="hits">6</span>
          
          <code class="ruby">         :to =&gt; @person.email)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">  def survey_confirmation(survey_response)</code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="72">
          <span class="hits">184</span>
          
          <code class="ruby">    @person = survey_response.person</code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="73">
          <span class="hits">184</span>
          
          <code class="ruby">    @survey = survey_response.survey</code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="74">
          <span class="hits">184</span>
          
          <code class="ruby">    @selected_survey_option_titles = survey_response.selected_survey_option_titles</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="75">
          <span class="hits">71</span>
          
          <code class="ruby">    headers['X-SMTPAPI'] = '{&quot;category&quot;: &quot;survey_confirmation&quot;}'</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="76">
          <span class="hits">71</span>
          
          <code class="ruby">    mail(:subject =&gt; &quot;Thanks for your #{@survey.type.to_s.downcase} participation.&quot;,:from =&gt; Devise.mailer_sender,:to =&gt; @person.email) do |format|</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="77">
          <span class="hits">71</span>
          
          <code class="ruby">      format.html do</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="78">
          <span class="hits">71</span>
          
          <code class="ruby">        if @survey.is_a?(Vote)</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="79">
          <span class="hits">71</span>
          
          <code class="ruby">          render :template =&gt; '/notifier/survey_vote_confirmation'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">  def survey_ended(person, survey)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="86">
          <span class="hits">3</span>
          
          <code class="ruby">    @person = person</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="87">
          <span class="hits">3</span>
          
          <code class="ruby">    @survey = survey</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="88">
          <span class="hits">3</span>
          
          <code class="ruby">    headers['X-SMTPAPI'] = '{&quot;category&quot;: &quot;survey_ended&quot;}'</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="89">
          <span class="hits">3</span>
          
          <code class="ruby">    mail(:subject =&gt; &quot;Check out the results of the \&quot;#{survey.title}\&quot; #{@survey.type.to_s.downcase}!&quot;,:from =&gt; Devise.mailer_sender,:to =&gt; @person.email) do |format|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="90">
          <span class="hits">3</span>
          
          <code class="ruby">      format.html do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="91">
          <span class="hits">3</span>
          
          <code class="ruby">        if @survey.is_a?(Vote)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="92">
          <span class="hits">3</span>
          
          <code class="ruby">          render :template =&gt; '/notifier/survey_vote_ended'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">  def products_services_promo(name, email, question, product = '')</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">    @name = name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">    @email = email</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">    @question = question</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">    @product = product</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">    headers['X-SMTPAPI'] = '{&quot;category&quot;: &quot;products_services_promo&quot;}'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="105">
          
          
          <code class="ruby">    mail(:subject =&gt; &quot;Engagement Services Form Request from #{name} #{product.present? ? ('about '+ product) : ''}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">         :from =&gt; email,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="107">
          
          
          <code class="ruby">         :to =&gt; Civiccommons::Config.email[&quot;products_services_email&quot;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">  def other_conversation_topic_selected(conversation)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">    @resource = conversation</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">    headers['X-SMTPAPI'] = '{&quot;category&quot;: &quot;other_conversation_topic_selected&quot;}'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    mail(:subject =&gt; &quot;A conversation has been created with Other Topic selected&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">         :from =&gt; Devise.mailer_sender,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">         :to =&gt; 'suggestions@theciviccommons.com')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c115ea5002c674a49b46b6d86b31cc11a2b62284">
  <div class="header">
    <h3>app/models/ability.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Ability</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include CanCan::Ability</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  AVAILABLE_ADMIN_CONTROLLER_ROLES = [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">      :admin_dashboard,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">      :admin_featured_homepages ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">      :admin_featured_opportunities ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">      :admin_articles ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">      :admin_conversations ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      :admin_metro_regions ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      :admin_topics ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      :admin_issues ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      :admin_people ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      :admin_content_items ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      :admin_blog_posts ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      :admin_news_items ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      :admin_radio_shows ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      :admin_content_templates ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      :admin_curated_feeds ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      :admin_surveys ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      :admin_email_restrictions ,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      :admin_widget_stats, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      :admin_content_item_links, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      :admin_curated_feed_items,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      :admin_managed_issue_pages,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      :admin_regions,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      :admin_user_registrations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(user)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    # CanCan is curently used only on the admin controller.</code>
        </li>
      
        <li class="covered" data-hits="563" data-linenumber="34">
          <span class="hits">563</span>
          
          <code class="ruby">    if user.admin?</code>
        </li>
      
        <li class="covered" data-hits="543" data-linenumber="35">
          <span class="hits">543</span>
          
          <code class="ruby">      can :manage,  :all</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="36">
          <span class="hits">20</span>
          
          <code class="ruby">    elsif user.blog_admin?</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="37">
          <span class="hits">18</span>
          
          <code class="ruby">      can :manage,  :admin_dashboard</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="38">
          <span class="hits">18</span>
          
          <code class="ruby">      can :manage, ContentItem</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="39">
          <span class="hits">18</span>
          
          <code class="ruby">      can :manage, :admin_blog_posts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    # Define abilities for the passed in user here. For example:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    #   user ||= User.new # guest user (not logged in)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    #   if user.admin?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    #     can :manage, :all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    #   else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    #     can :read, :all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    #   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    # The first argument to `can` is the action you are giving the user permission to do.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    # If you pass :manage it will apply to every action. Other common actions here are</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    # :read, :create, :update and :destroy.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    # The second argument is the resource the user can perform the action on. If you pass</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    # :all it will apply to every resource. Otherwise pass a Ruby class of the resource.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    # The third argument is an optional hash of conditions to further filter the objects.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    # For example, here the user can only update published articles.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    #   can :update, Article, :published =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    # See the wiki for details: https://github.com/ryanb/cancan/wiki/Defining-Abilities</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ded849bb54e2138b73765ab3526f557c41496185">
  <div class="header">
    <h3>app/models/action.rb</h3>
    <h4><span class="yellow">85.71 %</span> covered</h4>
    <div>
      <b>14</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Action &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :conversation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :actionable, :polymorphic =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  has_and_belongs_to_many :reflections</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_and_belongs_to_many :featured_opportunities, :join_table =&gt; :featured_opportunities_actions, :uniq =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :conversation_id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">                        :actionable_id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">                        :actionable_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # the other end of actionable must have participants method</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :participants, :to =&gt; :actionable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :title, :to =&gt; :actionable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def one_line_summary</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="16">
          <span class="hits">11</span>
          
          <code class="ruby">    [actionable.person.name, actionable.title, actionable.description].delete_if(&amp;:blank?).join(' - ')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_petition?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    self.actionable_type == &quot;Petition&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_ballot?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    self.actionable_type == &quot;Survey&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0498eca24dd96eeebb1b0e1c7e958549bfd7a8e5">
  <div class="header">
    <h3>app/models/activity.rb</h3>
    <h4><span class="yellow">89.91 %</span> covered</h4>
    <div>
      <b>109</b> relevant lines. 
      <span class="green"><b>98</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Activity &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  self.table_name = &quot;top_items&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :item, polymorphic: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item_id, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item_type, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item_created_at, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :person_id, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  VALID_TYPES = [ Conversation, Contribution, Issue, RatingGroup, SurveyResponse,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">                  Petition, PetitionSignature, Reflection, ReflectionComment, Survey]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # Accept an Active Record object of valid type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(attributes = nil)</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="18">
          <span class="hits">197</span>
          
          <code class="ruby">    if Activity.valid_type?(attributes)</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="19">
          <span class="hits">105</span>
          
          <code class="ruby">      attributes = attributes.becomes(Contribution) if attributes.is_a?(Contribution)</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="20">
          <span class="hits">105</span>
          
          <code class="ruby">      attr = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">        item_id: attributes.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">        item_type: attributes.class.to_s,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">        item_created_at: attributes.created_at,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">        person_id: attributes.person.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="26">
          <span class="hits">105</span>
          
          <code class="ruby">      if attributes.respond_to?(:conversation_id) &amp;&amp; !attributes.conversation_id.nil?</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="27">
          <span class="hits">48</span>
          
          <code class="ruby">        attr[:conversation_id] = attributes.conversation_id</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="28">
          <span class="hits">48</span>
          
          <code class="ruby">        attr[:activity_cache] = Activity.encode(attributes)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      elsif attributes.respond_to?(:issue_id) &amp;&amp; !attributes.issue_id.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">        attr[:issue_id] = attributes.issue_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">        attr[:activity_cache] = Activity.encode(attributes)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      elsif attributes.is_a?(Conversation)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="33">
          <span class="hits">33</span>
          
          <code class="ruby">        attr[:conversation_id] = attributes.id</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="34">
          <span class="hits">33</span>
          
          <code class="ruby">        attr[:activity_cache] = Activity.encode(attributes)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      elsif attributes.is_a?(Vote)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="36">
          <span class="hits">15</span>
          
          <code class="ruby">        attr[:conversation_id] = attributes.surveyable_id if attributes.surveyable_type == 'Conversation'</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="37">
          <span class="hits">15</span>
          
          <code class="ruby">        attr[:activity_cache] = Activity.encode(attributes)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="40">
          <span class="hits">105</span>
          
          <code class="ruby">      attributes = attr</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    elsif attributes.is_a?(ActiveRecord::Base)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      # if it's not a valid Activity type, and it's an activerecord object, then nullify it, because it breaks in rails &gt;= 3.1 (Perry)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="43">
          <span class="hits">4</span>
          
          <code class="ruby">      attributes = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="45">
          <span class="hits">197</span>
          
          <code class="ruby">    super(attributes)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  ############################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  # class utility methods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  ############################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  # Update cache data</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.update(model)</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="54">
          <span class="hits">122</span>
          
          <code class="ruby">    model = model.becomes(Contribution) if model.is_a?(Contribution)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="56">
          <span class="hits">122</span>
          
          <code class="ruby">    if Activity.valid_type?(model)</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="57">
          <span class="hits">122</span>
          
          <code class="ruby">      item = Activity.where(item_id: model.id, item_type: model.class.to_s).first</code>
        </li>
      
        <li class="covered" data-hits="122" data-linenumber="58">
          <span class="hits">122</span>
          
          <code class="ruby">      unless item.nil?</code>
        </li>
      
        <li class="covered" data-hits="91" data-linenumber="59">
          <span class="hits">91</span>
          
          <code class="ruby">        item.activity_cache = Activity.encode(model)</code>
        </li>
      
        <li class="covered" data-hits="91" data-linenumber="60">
          <span class="hits">91</span>
          
          <code class="ruby">        item.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  # Accept an Active Record object of valid type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.delete(model)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="67">
          <span class="hits">2</span>
          
          <code class="ruby">    if Activity.valid_type?(model)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="68">
          <span class="hits">2</span>
          
          <code class="ruby">      model = model.becomes(Contribution) if model.is_a?(Contribution)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="69">
          <span class="hits">2</span>
          
          <code class="ruby">      Activity.delete_all(&quot;item_id = #{model.id} and item_type like '#{model.class}'&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">      super(model)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  # Accept an Active Record object of valid type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy(model)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="77">
          <span class="hits">13</span>
          
          <code class="ruby">    if Activity.valid_type?(model)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="78">
          <span class="hits">13</span>
          
          <code class="ruby">      model = model.becomes(Contribution) if model.is_a?(Contribution)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="79">
          <span class="hits">13</span>
          
          <code class="ruby">      Activity.destroy_all(&quot;item_id = #{model.id} and item_type like '#{model.class}'&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">      super(model)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  # Find if the activity exists for an Active Record object.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.exists?(model)</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="87">
          <span class="hits">25</span>
          
          <code class="ruby">    if Activity.valid_type?(model)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="88">
          <span class="hits">12</span>
          
          <code class="ruby">      model = model.becomes(Contribution) if model.is_a?(Contribution)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="89">
          <span class="hits">12</span>
          
          <code class="ruby">      Activity.exists?(:item_id =&gt; model.id, :item_type=&gt; model.class)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="91">
          <span class="hits">13</span>
          
          <code class="ruby">      super(model)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  # Check if item is a valid type for Activity</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.valid_type?(item)</code>
        </li>
      
        <li class="covered" data-hits="564" data-linenumber="97">
          <span class="hits">564</span>
          
          <code class="ruby">    ok = false</code>
        </li>
      
        <li class="covered" data-hits="564" data-linenumber="98">
          <span class="hits">564</span>
          
          <code class="ruby">    VALID_TYPES.each do |type|</code>
        </li>
      
        <li class="covered" data-hits="2898" data-linenumber="99">
          <span class="hits">2898</span>
          
          <code class="ruby">      if (item.is_a? Contribution and not item.top_level_contribution?)</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="100">
          <span class="hits">80</span>
          
          <code class="ruby">        ok = true</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="101">
          <span class="hits">80</span>
          
          <code class="ruby">        break</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">      elsif item.is_a? type and not item.is_a? Contribution</code>
        </li>
      
        <li class="covered" data-hits="379" data-linenumber="103">
          <span class="hits">379</span>
          
          <code class="ruby">        ok = true</code>
        </li>
      
        <li class="covered" data-hits="379" data-linenumber="104">
          <span class="hits">379</span>
          
          <code class="ruby">        break</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">      elsif item.is_a? GenericObject and item.__class__ == 'Contribution' and not item.top_level_contribution?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="106">
          
          
          <code class="ruby">        ok = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="107">
          
          
          <code class="ruby">        break</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">      elsif item.is_a? GenericObject and item.__class__ == type.to_s and not item.__class__ == 'Contribution'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="109">
          
          
          <code class="ruby">        ok = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">        break</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="564" data-linenumber="113">
          <span class="hits">564</span>
          
          <code class="ruby">    return ok</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.encode(item)</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="117">
          <span class="hits">205</span>
          
          <code class="ruby">    obj = nil</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="118">
          <span class="hits">205</span>
          
          <code class="ruby">    if Activity.valid_type?(item)</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="119">
          <span class="hits">205</span>
          
          <code class="ruby">      case item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">      when Conversation</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="121">
          <span class="hits">68</span>
          
          <code class="ruby">        obj = ActiveSupport::JSON.encode(item, include: [:person])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">      when Contribution</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="123">
          <span class="hits">39</span>
          
          <code class="ruby">        obj = ActiveSupport::JSON.encode(item, include: [:person, :conversation])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">      when RatingGroup</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">        # need to load rating descriptors</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="126">
          <span class="hits">8</span>
          
          <code class="ruby">        obj = ActiveSupport::JSON.encode(item, include: [:person, :ratings, :conversation, :contribution])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">      when SurveyResponse</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="128">
          <span class="hits">11</span>
          
          <code class="ruby">        obj = ActiveSupport::JSON.encode(item, include: {person:{}, survey: {methods: :type}}) #included the STI type on surveys</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">      when Petition</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="130">
          <span class="hits">10</span>
          
          <code class="ruby">        obj = ActiveSupport::JSON.encode(item, include: [:person, :conversation])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">      when PetitionSignature</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="132">
          <span class="hits">14</span>
          
          <code class="ruby">        obj = ActiveSupport::JSON.encode(item, include: [:person, :petition])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">      when Reflection</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="134">
          <span class="hits">10</span>
          
          <code class="ruby">        obj = ActiveSupport::JSON.encode(item, include: [:person, :conversation])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">      when Survey, Vote</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="136">
          <span class="hits">39</span>
          
          <code class="ruby">        obj = ActiveSupport::JSON.encode(item, include: [:person, :surveyable])  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">      when ReflectionComment</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="138">
          <span class="hits">6</span>
          
          <code class="ruby">        obj = ActiveSupport::JSON.encode(item, include: [:person, :reflection])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="141">
          <span class="hits">205</span>
          
          <code class="ruby">    return obj</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.decode(item)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="145">
          <span class="hits">9</span>
          
          <code class="ruby">    hash = ActiveSupport::JSON.decode(item)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="146">
          <span class="hits">9</span>
          
          <code class="ruby">    return self.to_active_record(hash.keys.first, hash.values.first)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">  ############################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">  # custom finders</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">  # Retrieves the most recent activity items</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">  # If any of the items do not exist, they will not be returned. Hence</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">  # it is possible to get less than the requested amount of activity</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">  # items.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.most_recent_activity_items(options = {})</code>
        </li>
      
        <li class="covered" data-hits="213" data-linenumber="158">
          <span class="hits">213</span>
          
          <code class="ruby">    options.reverse_merge!(limit: nil, offset:nil, order:'DESC', exclude_conversation: false, exclude_rating: true)</code>
        </li>
      
        <li class="covered" data-hits="213" data-linenumber="159">
          <span class="hits">213</span>
          
          <code class="ruby">    options[:order] = 'DESC' if options[:order].nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="213" data-linenumber="161">
          <span class="hits">213</span>
          
          <code class="ruby">    activities = nil</code>
        </li>
      
        <li class="covered" data-hits="213" data-linenumber="162">
          <span class="hits">213</span>
          
          <code class="ruby">    activities = Activity.where(conversation_id: options[:conversation])  if options[:conversation].present?</code>
        </li>
      
        <li class="covered" data-hits="213" data-linenumber="163">
          <span class="hits">213</span>
          
          <code class="ruby">    activities = Activity.where(      person_id: options[:person])        if options[:person].present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="213" data-linenumber="165">
          <span class="hits">213</span>
          
          <code class="ruby">    if activities.nil?</code>
        </li>
      
        <li class="covered" data-hits="193" data-linenumber="166">
          <span class="hits">193</span>
          
          <code class="ruby">      activities = Activity.where('item_type != &quot;Conversation&quot;')          if options[:exclude_conversation]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="168">
          <span class="hits">20</span>
          
          <code class="ruby">      activities = activities.where('item_type != &quot;Conversation&quot;')        if options[:exclude_conversation]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="213" data-linenumber="171">
          <span class="hits">213</span>
          
          <code class="ruby">    if activities.nil?</code>
        </li>
      
        <li class="covered" data-hits="193" data-linenumber="172">
          <span class="hits">193</span>
          
          <code class="ruby">      activities = Activity.where('item_type != &quot;RatingGroup&quot;')           if options[:exclude_rating]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="174">
          <span class="hits">20</span>
          
          <code class="ruby">      activities = activities.where('item_type != &quot;RatingGroup&quot;')         if options[:exclude_rating]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="213" data-linenumber="177">
          <span class="hits">213</span>
          
          <code class="ruby">    if activities.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">      activities = Activity.order(&quot;item_created_at #{options[:order]}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="212" data-linenumber="180">
          <span class="hits">212</span>
          
          <code class="ruby">      activities = activities.order(&quot;item_created_at #{options[:order]}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="213" data-linenumber="183">
          <span class="hits">213</span>
          
          <code class="ruby">    activities = activities.offset(options[:offset])                      if options[:offset]</code>
        </li>
      
        <li class="covered" data-hits="213" data-linenumber="184">
          <span class="hits">213</span>
          
          <code class="ruby">    activities = activities.limit(options[:limit])                        if options[:limit]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="243" data-linenumber="186">
          <span class="hits">243</span>
          
          <code class="ruby">    activities.collect{|a| a.item}.compact</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.items</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="190">
          
          
          <code class="ruby">    this.collect do |a|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="191">
          
          
          <code class="ruby">      a.item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">    end.compact</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">  ############################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">  # encode/decode helpers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.to_active_record(clazz, data)</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="201">
          <span class="hits">26</span>
          
          <code class="ruby">    clazz = clazz.classify.constantize</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="202">
          <span class="hits">26</span>
          
          <code class="ruby">    data.each do |key, value|</code>
        </li>
      
        <li class="covered" data-hits="439" data-linenumber="203">
          <span class="hits">439</span>
          
          <code class="ruby">      if value.is_a? Hash</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="204">
          <span class="hits">17</span>
          
          <code class="ruby">        data[key] = self.to_active_record(key, value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">      elsif value.is_a? Array</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">        value.each_with_index do |data, index|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="207">
          
          
          <code class="ruby">          value[index] = self.to_active_record(key, data) if value[index].is_a? Hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="211">
          <span class="hits">26</span>
          
          <code class="ruby">    data['__class__'] = clazz.to_s</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="212">
          <span class="hits">26</span>
          
          <code class="ruby">    obj = GenericObject.new(data)</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="213">
          <span class="hits">26</span>
          
          <code class="ruby">    return obj</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="6d5ed5496b177122b9c3f04947ff466c238cc2b1">
  <div class="header">
    <h3>app/models/article.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Article &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include YouTubeable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def url</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="5">
          <span class="hits">14</span>
          
          <code class="ruby">    self.video_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def url=(value)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="9">
          <span class="hits">6</span>
          
          <code class="ruby">    self.video_url = value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  has_attached_file :image,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    :styles =&gt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">       :subfeature =&gt; &quot;90x60#&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">       :mainfeature =&gt; &quot;340x225#&quot; },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    :storage =&gt; :s3,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    :s3_credentials =&gt; S3Config.credential_file,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    :path =&gt; &quot;articles/:attachment/:id/:style/:filename&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  ['homepage', 'conversation', 'issue'].each do |type|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="21">
          <span class="hits">3</span>
          
          <code class="ruby">    scope :&quot;#{type}_main_article&quot;, where(:current =&gt; true, :main =&gt; true, :&quot;#{type}_article&quot; =&gt; true)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="22">
          <span class="hits">3</span>
          
          <code class="ruby">    scope :&quot;#{type}_sub_articles&quot;, where(&quot;main != ? AND current = ? AND #{type}_article = ?&quot;, true, true, true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="24dfc110c9faf558d0677d530d575aa642473dc2">
  <div class="header">
    <h3>app/models/authentication.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Authentication &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :uid, :provider</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_uniqueness_of :uid, :scope =&gt; :provider</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.new_from_auth_hash(auth_hash)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    new(:provider =&gt; auth_hash['provider'],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">          :uid =&gt; auth_hash['uid'],</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="9">
          <span class="hits">18</span>
          
          <code class="ruby">          :token =&gt; (auth_hash['credentials']['token'] if auth_hash['credentials']))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_from_auth_hash(auth_hash)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="13">
          <span class="hits">6</span>
          
          <code class="ruby">    find_by_provider_and_uid( auth_hash['provider'], auth_hash['uid'])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.email_from_auth_hash(auth_hash)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="17">
          <span class="hits">15</span>
          
          <code class="ruby">    auth_hash &amp;&amp; auth_hash['info'] &amp;&amp; auth_hash['info']['email'] &amp;&amp; auth_hash['info']['email'].to_s.downcase.strip</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f25f2e42baefd34e7883b980512df3d7e797901b">
  <div class="header">
    <h3>app/models/ckeditor/asset.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Ckeditor::Asset &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include Ckeditor::Orm::ActiveRecord::AssetBase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :url, :current_path, :size, :content_type, :filename, :to =&gt; :data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="6d673350c800d0734653dc45024d04b682c700b3">
  <div class="header">
    <h3>app/models/ckeditor/attachment_file.rb</h3>
    <h4><span class="red">75.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Ckeditor::AttachmentFile &lt; Ckeditor::Asset</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  mount_uploader :data, CkeditorAttachmentFileUploader, :mount_on =&gt; :data_file_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def url_thumb</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    @url_thumb ||= Ckeditor::Utils.filethumb(filename)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="badadc0cc745c070e75f35c6a4749a6c81bf0cd3">
  <div class="header">
    <h3>app/models/ckeditor/picture.rb</h3>
    <h4><span class="red">75.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Ckeditor::Picture &lt; Ckeditor::Asset</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  mount_uploader :data, CkeditorPictureUploader, :mount_on =&gt; :data_file_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">	</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">	def url_content</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">	  url(:content)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1b22f59c78815e9eb30a54336160998329fecfcb">
  <div class="header">
    <h3>app/models/content_item.rb</h3>
    <h4><span class="green">95.6 %</span> covered</h4>
    <div>
      <b>91</b> relevant lines. 
      <span class="green"><b>87</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ContentItem &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include Rails.application.routes.url_helpers</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  extend FriendlyId</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :url_slug</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  CONTENT_TYPES = [&quot;BlogPost&quot;, &quot;NewsItem&quot;, &quot;RadioShow&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  searchable :include =&gt; [:author, :conversations], :ignore_attribute_changes_of =&gt; [ :updated_at ] do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    text :title, :boost =&gt; 2, :default_boost =&gt; 2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    text :body, :stored =&gt; true do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      Sanitize.clean(body, :remove_contents =&gt; ['style','script'])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    text :summary, :stored =&gt; true do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      Sanitize.clean(summary, :remove_contents =&gt; ['style','script'])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    string :content_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :blog_post, where(:content_type =&gt; 'BlogPost')</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :radio_show, where(:content_type =&gt; 'RadioShow' )</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :news_item, where(:content_type =&gt; 'NewsItem')</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="23">
          <span class="hits">11</span>
          
          <code class="ruby">  scope :newer_than, lambda {|date| where(['published &gt;= ?',date.to_s(:db)])}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :recent_blog_posts, lambda { |author = nil|</code>
        </li>
      
        <li class="covered" data-hits="188" data-linenumber="25">
          <span class="hits">188</span>
          
          <code class="ruby">    if author.nil?</code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="26">
          <span class="hits">184</span>
          
          <code class="ruby">      return where(&quot;content_type = 'BlogPost' AND (published &lt;= curdate() OR DAY(published) = DAY(curdate())) &quot;).order(&quot;published desc, created_at desc&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="28">
          <span class="hits">4</span>
          
          <code class="ruby">      author = author.id if author.is_a? Person</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="29">
          <span class="hits">4</span>
          
          <code class="ruby">      return where(person_id: author).where(&quot;content_type = 'BlogPost' AND (published &lt;= curdate() OR DAY(published) = DAY(curdate())) &quot;).order(&quot;published desc, created_at desc&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  has_attached_file :image,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    :styles =&gt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      :normal =&gt; &quot;480x300#&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      :panel =&gt; &quot;198x130#&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    :storage =&gt; :s3,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    :s3_credentials =&gt; S3Config.credential_file,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    :path =&gt; IMAGE_ATTACHMENT_PATH,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    :default_url =&gt; 'convo_img_:style.gif'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_attachment_content_type :image,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">                                    :content_type =&gt; /image\/*/,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">                                    :message =&gt; &quot;Not a valid image file.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :author, :class_name =&gt; &quot;Person&quot;, :foreign_key =&gt; &quot;person_id&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :content_items_topics, :uniq =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :topics, :through =&gt; :content_items_topics, uniq: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :content_items_conversations, :uniq =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :conversations, :through =&gt; :content_items_conversations, uniq: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :links, :class_name =&gt; 'ContentItemLink', :dependent =&gt; :destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :content_items_people, uniq: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  # Any radioshow people</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :people,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    :through =&gt; :content_items_people,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    :readonly =&gt; true,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    :uniq =&gt; true,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    :class_name =&gt; 'Person'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  #radioshow hosts </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  # creating or deleting this doesn't work as it should, there's an open issue https://github.com/rails/rails/issues/5057</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  # use add_person method, or delete_person method, instead of content_item.hosts = [@person] and content_item.hosts.delete(@person)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :hosts,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    :through =&gt; :content_items_people,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    :uniq =&gt; true,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    :class_name =&gt; 'Person',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    :conditions =&gt; {:content_items_people =&gt; {:role =&gt; 'Host'}},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    :source =&gt; :person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  #radioshow guests</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  # creating or deleting this doesn't work as it should, there's an open issue https://github.com/rails/rails/issues/5057</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">  # use add_person method, or delete_person method, instead of content_item.guests = [@person] and content_item.guests.delete(@person)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :guests,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    :through =&gt; :content_items_people,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">    :uniq =&gt; true,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    :class_name =&gt; 'Person',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    :conditions =&gt; {:content_items_people =&gt; {:role =&gt; 'Guest'}},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    :source =&gt; :person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate   :name, :to =&gt; :author, :prefix =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :title, :body, :author</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_uniqueness_of :title</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :require_topic</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_format_of :external_link, :with =&gt; /^(http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/ix, :allow_blank =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :external_link, :if =&gt; :content_type_is_news_item?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :published</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">  friendly_id :title, :use =&gt; :slugged</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">  def should_generate_new_friendly_id?</code>
        </li>
      
        <li class="covered" data-hits="161" data-linenumber="99">
          <span class="hits">161</span>
          
          <code class="ruby">    new_record? || slug.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">  def people=(record)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">    raise Exception, &quot;:people is readonly. please use :hosts or :guests habtm association, instead!&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_topic?(topic)</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="107">
          <span class="hits">39</span>
          
          <code class="ruby">    topics.include?(topic)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">  def require_topic</code>
        </li>
      
        <li class="covered" data-hits="161" data-linenumber="111">
          <span class="hits">161</span>
          
          <code class="ruby">    errors.add(:base, &quot;Please select at least one Topic&quot;) if self.topic_ids.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">  def link_title(title=nil)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="115">
          <span class="hits">5</span>
          
          <code class="ruby">    if title.nil?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="116">
          <span class="hits">4</span>
          
          <code class="ruby">      title = &quot;Listen to the podcast...&quot; if self.content_type_is_radio_show?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="117">
          <span class="hits">4</span>
          
          <code class="ruby">      title = &quot;Continue reading...&quot; if self.content_type_is_blog_post? || title.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="120">
          <span class="hits">5</span>
          
          <code class="ruby">    self.link_text.blank? ? title : self.link_text</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.recent_radio_shows</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">    ContentItem.where('content_type = ?', 'RadioShow').order(&quot;published desc, created_at desc&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">  def url</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="128">
          <span class="hits">3</span>
          
          <code class="ruby">    return blog_path(self) if self.content_type == 'BlogPost'</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="129">
          <span class="hits">2</span>
          
          <code class="ruby">    return self.external_link if self.content_type == 'NewsItem'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">    return radioshow_path(self) if self.content_type == 'RadioShow'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="131">
          
          
          <code class="ruby">    return content_path(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">  def add_person(role, person)</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="135">
          <span class="hits">25</span>
          
          <code class="ruby">    case role</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">    when 'guest'</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="137">
          <span class="hits">11</span>
          
          <code class="ruby">      self.content_items_people &lt;&lt; ContentItemsPerson.create(role: 'Guest', person: person, content_item: self)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="138">
          <span class="hits">11</span>
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">    when 'host'</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="140">
          <span class="hits">12</span>
          
          <code class="ruby">      self.content_items_people &lt;&lt; ContentItemsPerson.create(role: 'Host', person: person, content_item: self)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="141">
          <span class="hits">12</span>
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="143">
          <span class="hits">2</span>
          
          <code class="ruby">      return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">  def delete_person(role, person)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="148">
          <span class="hits">7</span>
          
          <code class="ruby">    case role</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">    when 'guest'</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="150">
          <span class="hits">3</span>
          
          <code class="ruby">      self.content_items_people.where(role: 'Guest', person_id: person.id, content_item_id: self.id).each do |content_item|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="151">
          <span class="hits">3</span>
          
          <code class="ruby">        content_item.delete</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="153">
          <span class="hits">3</span>
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">    when 'host'</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="155">
          <span class="hits">3</span>
          
          <code class="ruby">      self.content_items_people.where(role: 'Host', person_id: person.id, content_item_id: self.id).each do |content_item|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="156">
          <span class="hits">3</span>
          
          <code class="ruby">        content_item.delete</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="158">
          <span class="hits">3</span>
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">      return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">  def content_type_is_blog_post?</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="165">
          <span class="hits">9</span>
          
          <code class="ruby">    content_type == &quot;BlogPost&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">  def content_type_is_news_item?</code>
        </li>
      
        <li class="covered" data-hits="163" data-linenumber="169">
          <span class="hits">163</span>
          
          <code class="ruby">    content_type == &quot;NewsItem&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">  def content_type_is_radio_show?</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="173">
          <span class="hits">18</span>
          
          <code class="ruby">    content_type == &quot;RadioShow&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.blog_authors</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="177">
          <span class="hits">10</span>
          
          <code class="ruby">    people_query = ContentItem.blog_post.recent_blog_posts.newer_than(3.months.ago).select('DISTINCT(person_id)')</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="178">
          <span class="hits">10</span>
          
          <code class="ruby">    blog_author_ids = people_query.collect(&amp;:person_id)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="179">
          <span class="hits">10</span>
          
          <code class="ruby">    Person.find(blog_author_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">  def h_content_type</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="183">
          <span class="hits">5</span>
          
          <code class="ruby">    return &quot;Blog&quot; if content_type_is_blog_post?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="184">
          <span class="hits">2</span>
          
          <code class="ruby">    return &quot;News&quot; if content_type_is_news_item?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="185">
          <span class="hits">2</span>
          
          <code class="ruby">    return content_type.titlecase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e90618e81fda42c6d152e6384bc72b7b8f7842dc">
  <div class="header">
    <h3>app/models/content_item_description.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ContentItemDescription &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :content_type, :presence =&gt; true, :uniqueness =&gt; true, :inclusion =&gt; ['BlogPost', 'RadioShow']</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :description_long, :presence =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :description_short, :presence =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="6">
          <span class="hits">16</span>
          
          <code class="ruby">  scope :blog_post, lambda {where(:content_type =&gt; &quot;BlogPost&quot;)}</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="7">
          <span class="hits">6</span>
          
          <code class="ruby">  scope :radio_show, lambda {where(:content_type =&gt; &quot;RadioShow&quot;)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3696d16bb3955de3b84ed437576802c673ad9c44">
  <div class="header">
    <h3>app/models/content_item_link.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ContentItemLink &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :content_item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :url, :title</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_format_of :url, :with =&gt; /^(http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/ix, :allow_blank =&gt; true, :message =&gt; 'must look like a url(example http://google.com)'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3b868cbbd80612a99f16857854af45fa2673b015">
  <div class="header">
    <h3>app/models/content_items_conversation.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ContentItemsConversation &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :content_item</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="92eedf1790759f0a1cc1e40955eaa090fd5948a4">
  <div class="header">
    <h3>app/models/content_items_person.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ContentItemsPerson &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :content_item</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d99e91460859931ed6cecc94083b0079f9faef7d">
  <div class="header">
    <h3>app/models/content_items_topic.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ContentItemsTopic &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :content_item</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :topic</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d77d3bbcdcd53984a917ed4fa34059314406fe64">
  <div class="header">
    <h3>app/models/content_template.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ContentTemplate &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend FriendlyId</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  acts_as_revisionable :on_update =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :author, :foreign_key =&gt; 'person_id', :class_name =&gt; 'Person'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :name, :template, :author</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_uniqueness_of :name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  friendly_id :name, :use =&gt; :slugged</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def should_generate_new_friendly_id?</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="13">
          <span class="hits">37</span>
          
          <code class="ruby">    new_record? || slug.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f873abec6c9ba57a98d981884c906b9f662dbc27">
  <div class="header">
    <h3>app/models/contribution.rb</h3>
    <h4><span class="yellow">84.15 %</span> covered</h4>
    <div>
      <b>164</b> relevant lines. 
      <span class="green"><b>138</b> lines covered</span> and
      <span class="red"><b>26</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'parent_validator'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">class Contribution &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include Visitable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  searchable :include =&gt; [:person, :conversation, :issue], :ignore_attribute_changes_of =&gt; [ :total_visits, :recent_visits, :last_visit_date, :updated_at, :recent_rating ] do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    text :title</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    text :description, :stored =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    text :content, :stored =&gt; true, :boost =&gt; 1, :default_boost =&gt; 1 do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      Sanitize.clean(content, :remove_contents =&gt; ['style','script'])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    integer :region_metrocodes, :multiple =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :top_level</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # nested contributions are destroyed via callbacks</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  acts_as_nested_set :exclude_unless =&gt; {:confirmed =&gt; true}, :dependent =&gt; :destroy, :scope =&gt; :conversation_id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_protected :lft, :rgt</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  acts_as_revisionable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  profanity_filter :content, :method =&gt; 'hollow'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :moderation_reason</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person, :foreign_key =&gt; &quot;owner&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :conversation, :touch =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :issue</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many   :rating_groups, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  has_and_belongs_to_many :featured_opportunities, :join_table =&gt; :featured_opportunities_contributions, :uniq =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :title, :to =&gt; :item, :prefix =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :name, :to =&gt; :person, :prefix =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  #############################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  # Validations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item, :presence =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  # In a perfect world a contribution would require an owner. Unfortunately,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  # there is some complexity to the way we create the first contribution when</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  # creating a new community-generated conversation. This prevents proper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  # validation of the owner during contribution creation.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  # -Jerry</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  #validates :person, :presence =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :requires_an_owner</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :requires_content_or_link</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :requires_one_of_url_or_attachement</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  def requires_an_owner</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="48">
          <span class="hits">504</span>
          
          <code class="ruby">    self.errors[:person] &lt;&lt; &quot;Must have an owner&quot; if self.person.nil? and self.item.is_a?(Issue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def requires_content_or_link</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="52">
          <span class="hits">504</span>
          
          <code class="ruby">    self.errors[:content] &lt;&lt; &quot;Comment cannot be blank&quot; if self.content.blank? and self.url.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">  def requires_one_of_url_or_attachement</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="56">
          <span class="hits">504</span>
          
          <code class="ruby">    self.errors[:content] &lt;&lt; &quot;Contributions can only have attachment or link, not both.&quot; if not self.url.blank? and has_attachment?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.valid_attributes?(attributes)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">    mock = self.new(attributes)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">    unless mock.valid?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">      return mock.errors.select{|k,v| attributes.keys.collect(&amp;:to_sym).include?(k)}.size == 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">    true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  #############################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  # Embedly</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">  before_save :create_embeddly_info</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_format_of :url, :with =&gt; URI::regexp(%w(http https)), :allow_blank =&gt; true, :message =&gt; &quot;The link you provided is invalid&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">  def base_url</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="74">
          <span class="hits">4</span>
          
          <code class="ruby">    match = /^(?&lt;base_url&gt;http[s]?:\/\/(\w|[^\?\/:])+(:\d+)?).*$/i.match(url)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="75">
          <span class="hits">4</span>
          
          <code class="ruby">    return match.nil? ? nil : match[:base_url]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_embeddly_info</code>
        </li>
      
        <li class="covered" data-hits="474" data-linenumber="79">
          <span class="hits">474</span>
          
          <code class="ruby">    if not url.blank? and url =~ URI::regexp(%w(http https))</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="80">
          <span class="hits">26</span>
          
          <code class="ruby">      embedly = EmbedlyService.new</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="81">
          <span class="hits">26</span>
          
          <code class="ruby">      embedly.fetch_and_update_attributes(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_media?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="86">
          <span class="hits">3</span>
          
          <code class="ruby">    not self.embedly_code.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">  def one_line_summary</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="90">
          <span class="hits">11</span>
          
          <code class="ruby">    [person.name,title,content].delete_if(&amp;:blank?).join(' - ')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">  #############################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">  # Paperclip</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  # supported files:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">  # xls, ppt, pdf, doc, txt, xlsx, docx, pptx, rtf, jpg, png</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">  has_attached_file :attachment,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    :storage =&gt; :s3,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">    :s3_credentials =&gt; S3Config.credential_file,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">    :path =&gt; IMAGE_ATTACHMENT_PATH,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">    :styles =&gt; {:thumb =&gt; &quot;75x75&gt;&quot;, :medium =&gt; &quot;300x300&gt;&quot;, :large =&gt; &quot;800x800&gt;&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">  before_attachment_post_process :is_image?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">  # Return true if attachment is an image</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  # Returns false if it is not an image</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  # Does not return nil since before_attachment_post_process relies requires</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">  # true or false</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_image?</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="112">
          <span class="hits">24</span>
          
          <code class="ruby">    !(attachment_content_type =~ /^image.*/).nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_attachment?</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="116">
          <span class="hits">41</span>
          
          <code class="ruby">    not self.attachment_file_name.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">  #############################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">  # Scopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :most_recent, {:order =&gt; 'created_at DESC'}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :not_top_level, where(&quot;top_level_contribution = 0&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :without_parent, where(:parent_id =&gt; nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :confirmed, where(:confirmed =&gt; true)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :unconfirmed, where(:confirmed =&gt; false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  # Scope for contributions that are still editable, i.e. no descendants and less than 30 minutes old</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :editable, where([&quot;created_at &gt;= DATE_SUB(CURRENT_TIMESTAMP, INTERVAL 30 MINUTE)&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :for_conversation, lambda { |convo|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="131">
          
          
          <code class="ruby">    confirmed.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">      where(:conversation_id =&gt; convo.id).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">      includes([:person]).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">      order('contributions.created_at ASC')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">  #############################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">  # Confirmation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">  after_initialize :set_confirmed, :if =&gt; :new_record? # sets confirmed to false by default when object created</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :set_person_from_item, :if =&gt; :person_blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :override_confirmed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">  #############################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">  # Construction/Destruction</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.update_or_create_node(params,person)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="149">
          <span class="hits">2</span>
          
          <code class="ruby">    if contribution = Contribution.unconfirmed.where(:parent_id =&gt; params[:parent_id], :owner =&gt; person.id).first</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">      contribution.update_attributes(params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">      contribution = Contribution.create_node(params,person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="154">
          <span class="hits">2</span>
          
          <code class="ruby">    return contribution</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.new_node(params, person, confirmed = false)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="158">
          <span class="hits">1</span>
          
          <code class="ruby">    params.merge!( { :person =&gt; person, :override_confirmed =&gt; confirmed } )</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">    Contribution.new(params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.create_node(params, person, confirmed = false)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="163">
          <span class="hits">7</span>
          
          <code class="ruby">    params.merge!( { :person =&gt; person, :override_confirmed =&gt; confirmed } )</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="164">
          <span class="hits">7</span>
          
          <code class="ruby">    Contribution.create(params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.delete_old_and_unconfirmed(age = 30.minutes)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="168">
          <span class="hits">4</span>
          
          <code class="ruby">    count = self.unconfirmed.where([&quot;created_at &lt; ?&quot;, (Time.now - age)]).count</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="169">
          <span class="hits">4</span>
          
          <code class="ruby">    self.unconfirmed.destroy_all([&quot;created_at &lt; ?&quot;, (Time.now - age)])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="170">
          <span class="hits">4</span>
          
          <code class="ruby">    return count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy_by_user(user)</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="174">
          <span class="hits">19</span>
          
          <code class="ruby">    if self.editable_by?(user)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="175">
          <span class="hits">10</span>
          
          <code class="ruby">      self.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="177">
          <span class="hits">9</span>
          
          <code class="ruby">      self.errors[:base] &lt;&lt; &quot;Contributions cannot be deleted if they are older than 30 minutes or have any responses.&quot;</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="178">
          <span class="hits">9</span>
          
          <code class="ruby">      return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">  #############################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">  # Finders</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_or_new_unconfirmed(params,person)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="186">
          
          
          <code class="ruby">    attrs = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">      :conversation_id =&gt; params[:id],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">      :parent_id =&gt; params[:contribution_id],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">      :owner =&gt; person.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="191">
          
          
          <code class="ruby">    return Contribution.unconfirmed.editable.where(attrs).first || Contribution.new(attrs)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">  #############################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">  # Item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">  def item=(item)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="198">
          
          
          <code class="ruby">    conversation = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="199">
          
          
          <code class="ruby">    issue = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="200">
          
          
          <code class="ruby">    if item.is_a?(Conversation)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="201">
          
          
          <code class="ruby">      self.conversation = item</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="202">
          
          
          <code class="ruby">    elsif item.is_a?(Issue)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="203">
          
          
          <code class="ruby">      self.issue = item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">  def item</code>
        </li>
      
        <li class="covered" data-hits="541" data-linenumber="208">
          <span class="hits">541</span>
          
          <code class="ruby">    self.conversation || self.issue</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">  #############################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">  # Special Attributes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">  def comment_only?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="215">
          
          
          <code class="ruby">    self.url.blank? and self.attachment_file_name.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">  # The redundancy here is legacy, refactor when you have time - Jerry</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">  def top_level=(value)</code>
        </li>
      
        <li class="covered" data-hits="494" data-linenumber="220">
          <span class="hits">494</span>
          
          <code class="ruby">    self.top_level_contribution = (true &amp; value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">  def top_level</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="224">
          
          
          <code class="ruby">    self.top_level_contribution</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">  def top_level_contribution?</code>
        </li>
      
        <li class="covered" data-hits="878" data-linenumber="228">
          <span class="hits">878</span>
          
          <code class="ruby">    self.top_level_contribution</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">  def unconfirmed?</code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="232">
          <span class="hits">46</span>
          
          <code class="ruby">    !self.confirmed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">  def confirm!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">    self.update_attribute(:confirmed, true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">  def override_confirmed=(value)</code>
        </li>
      
        <li class="covered" data-hits="499" data-linenumber="240">
          <span class="hits">499</span>
          
          <code class="ruby">    self.confirmed = @override_confirmed = (true &amp; value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">  #############################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">  # Edit/Moderate/Delete</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_attributes_by_user(params, user)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="246">
          <span class="hits">10</span>
          
          <code class="ruby">    if self.editable_by?(user)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="247">
          <span class="hits">7</span>
          
          <code class="ruby">      if params.has_key?(:contributions)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="248">
          
          
          <code class="ruby">        self.update_attributes(params[:contributions])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="250">
          <span class="hits">7</span>
          
          <code class="ruby">        self.update_attributes(params[:contribution])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="253">
          <span class="hits">3</span>
          
          <code class="ruby">      self.errors[:base] &lt;&lt; &quot;Contributions cannot be edited if they are older than 30 minutes or have any responses.&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="254">
          <span class="hits">3</span>
          
          <code class="ruby">      return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">  def editable_by?(user = nil)</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="259">
          <span class="hits">30</span>
          
          <code class="ruby">    if user &amp;&amp; (user.admin? || owner_editable?(user))</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="260">
          <span class="hits">17</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="262">
          <span class="hits">13</span>
          
          <code class="ruby">      false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">  def moderate_content(params, moderated_by)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="267">
          <span class="hits">5</span>
          
          <code class="ruby">   reason = params[:contribution][:moderation_reason]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="268">
          <span class="hits">5</span>
          
          <code class="ruby">   self.content = &quot;&lt;b&gt;&lt;i&gt;Contribution removed by #{moderated_by.name} on #{Time.now.strftime('%B %d, %Y')}, for the following reason: #{reason}&lt;/i&gt;&lt;/b&gt;&quot;</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="269">
          <span class="hits">5</span>
          
          <code class="ruby">   self.clear_attributes</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="270">
          <span class="hits">5</span>
          
          <code class="ruby">   self.save(validate: false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="273">
          <span class="hits">1</span>
          
          <code class="ruby">  def clear_attributes</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="274">
          <span class="hits">5</span>
          
          <code class="ruby">    if respond_to?(:attachment)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="275">
          <span class="hits">5</span>
          
          <code class="ruby">      destroy_attached_files</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="276">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="277">
          <span class="hits">5</span>
          
          <code class="ruby">    [:url=, :embedly_type=, :embedly_code=, :title=, :description=].each do |attribute|</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="278">
          <span class="hits">25</span>
          
          <code class="ruby">      self.send(attribute, nil)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="282">
          <span class="hits">1</span>
          
          <code class="ruby">  def attachment_url</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="283">
          
          
          <code class="ruby">    if self.attachment_file_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="284">
          
          
          <code class="ruby">      if self.is_image?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="285">
          
          
          <code class="ruby">        attachment.url(:thumb).gsub(/\?\d+$/, '')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="287">
          
          
          <code class="ruby">        attachment.url.gsub(/\?\d+$/, '')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="290">
          
          
          <code class="ruby">      ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">  def owner_editable?(user)</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="295">
          <span class="hits">22</span>
          
          <code class="ruby">    if self.owner == user.id &amp;&amp; self.created_at &gt; 30.minutes.ago &amp;&amp; self.children.count == 0 &amp;&amp; self.rating_groups.empty?</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="296">
          <span class="hits">11</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="298">
          <span class="hits">11</span>
          
          <code class="ruby">      false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">  def region_metrocodes</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="303">
          
          
          <code class="ruby">    item.region_metrocodes if item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="307">
          
          
          <code class="ruby">  #############################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby">  # Ratings</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">  def newest_rating_for_contribution_branch</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">    # First get the Rating Group that is associated with each Contribution</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">    #   Contribution_id =&gt; [Rating Group(s)]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">    rgs       = RatingGroup.scoped</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">    rgs       = rgs.where(:conversation_id =&gt; conversation).includes(:ratings)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="315">
          <span class="hits">1</span>
          
          <code class="ruby">    contribution_ids = self.self_and_descendants.collect(&amp;:id).uniq</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="316">
          <span class="hits">1</span>
          
          <code class="ruby">    rgs       = rgs.where(&quot;contribution_id in (?)&quot;, contribution_ids )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="318">
          <span class="hits">1</span>
          
          <code class="ruby">    newest = rgs.max_by(&amp;:updated_at)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">    newest.respond_to?(:updated_at) ? newest.updated_at : nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="321">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">  #############################################################################</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_confirmed</code>
        </li>
      
        <li class="covered" data-hits="654" data-linenumber="330">
          <span class="hits">654</span>
          
          <code class="ruby">    self.confirmed = self.override_confirmed || self.top_level_contribution? ? true : 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">    # RAILS BUG - ActiveRecord::RecordNotSaved if set to false, but works for true, 1, and 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">  def url_title</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="335">
          
          
          <code class="ruby">    if self.url</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="336">
          
          
          <code class="ruby">      self.title</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="337">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="338">
          
          
          <code class="ruby">      ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="340">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">  def person_blank?</code>
        </li>
      
        <li class="covered" data-hits="504" data-linenumber="343">
          <span class="hits">504</span>
          
          <code class="ruby">    self.person.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="344">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="346">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_person_from_item</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="347">
          <span class="hits">4</span>
          
          <code class="ruby">    self.person = item.person unless item.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0727df4162b0875a3f9ba973ce76b27204209292">
  <div class="header">
    <h3>app/models/conversation.rb</h3>
    <h4><span class="yellow">87.5 %</span> covered</h4>
    <div>
      <b>200</b> relevant lines. 
      <span class="green"><b>175</b> lines covered</span> and
      <span class="red"><b>25</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Conversation &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend FriendlyId</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include Visitable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include Subscribable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  include Regionable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  include GeometryForStyle</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  include HomepageFeaturable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  include Thumbnail</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :agree_to_be_civil, :other_topic</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :actions, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :activities</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  searchable :ignore_attribute_changes_of =&gt; [ :total_visits, :recent_visits, :last_visit_date, :updated_at, :recent_rating ] do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    text :title, :boost =&gt; 3, :default_boost =&gt; 3</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    text :summary, :stored =&gt; true, :boost =&gt; 2, :default_boost =&gt; 2 do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      Sanitize.clean(summary, :remove_contents =&gt; ['style','script'])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    integer :region_metrocodes, :multiple =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :contributions, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :confirmed_contributions, :class_name =&gt; 'Contribution',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">           :conditions =&gt; ['confirmed = ?', true]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  accepts_nested_attributes_for :contributions, :allow_destroy =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :subscriptions, :as =&gt; :subscribable, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :featured_opportunities, :dependent =&gt; :nullify</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def top_level_contributions</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    Contribution.where(:conversation_id =&gt; self.id, :top_level_contribution =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  # any person that has made a contribution to the convo</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :contributors, :through =&gt; :confirmed_contributions,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">           :source =&gt; :person, :uniq =&gt; true,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">           :order =&gt; &quot;contributions.created_at ASC&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :petitions, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :reflections, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  has_and_belongs_to_many :issues</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :conversations_topics, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :topics, :through =&gt; :conversations_topics, :uniq =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_length_of :topics, :minimum =&gt; 1, :message =&gt; 'Please select at least one topic for your conversation', :if =&gt; 'self.other_topic.nil?'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  accepts_nested_attributes_for :topics</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :conversations_people, :uniq =&gt; true, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :people, :through =&gt; :conversations_people, :foreign_key =&gt; 'conversation_id', uniq: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def moderators</code>
        </li>
      
        <li class="covered" data-hits="102" data-linenumber="54">
          <span class="hits">102</span>
          
          <code class="ruby">    self.people</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  def moderated_by?(person)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">    if person</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">      moderators.include?(person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :content_items_conversations, :uniq =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :content_items, :through =&gt; :content_items_conversations, uniq: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :surveys, :as =&gt; :surveyable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person, :foreign_key =&gt; &quot;owner&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :metro_region</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :name, :to =&gt; :person, :prefix =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :standard_issue, :to =&gt; :issues</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :managed_issue, :to =&gt; :issues</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :city_display_name, :to =&gt; :metro_region, :prefix =&gt; true, :allow_nil =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">  has_attached_file :image,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    :styles =&gt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">       :normal =&gt; &quot;480x300#&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">       :panel =&gt; &quot;198x130#&quot;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    :storage =&gt; :s3,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    :s3_credentials =&gt; S3Config.credential_file,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">    :path =&gt; IMAGE_ATTACHMENT_PATH,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    :default_url =&gt; 'convo_img_:style.gif'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_attachment_content_type :image,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">                                    :content_type =&gt; /image\/*/,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">                                    :message =&gt; &quot;Not a valid image file.&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :owner, :must_be_logged_in =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :owner, :message =&gt; &quot;You must be logged in.&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :title, :message =&gt; &quot;Please choose a title for your conversation.&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_length_of :title, :maximum =&gt; 50, :message =&gt; 'Please enter a title with less than 50 characters', :on =&gt; :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :summary, :message =&gt; &quot;Please give us a short summary.&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_format_of :link, :with =&gt; /^(http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/ix, :on =&gt; :create, :allow_blank =&gt; true, :message =&gt; &quot;Link must look like a url (example http://google.com).&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :zip_code, :message =&gt; &quot;Please give us a zip code for a little geographic context.&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :metro_region_id, :message =&gt; 'Please give us a Location name.'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">  after_create :set_initial_position, :subscribe_creator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">  around_create :send_notification_on_other_topic</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">  friendly_id :title, :use =&gt; :slugged</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">  def should_generate_new_friendly_id?</code>
        </li>
      
        <li class="covered" data-hits="913" data-linenumber="101">
          <span class="hits">913</span>
          
          <code class="ruby">    new_record? || slug.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_notification_on_other_topic</code>
        </li>
      
        <li class="covered" data-hits="857" data-linenumber="105">
          <span class="hits">857</span>
          
          <code class="ruby">    other_topic = self.other_topic</code>
        </li>
      
        <li class="covered" data-hits="857" data-linenumber="106">
          <span class="hits">857</span>
          
          <code class="ruby">    yield</code>
        </li>
      
        <li class="covered" data-hits="857" data-linenumber="107">
          <span class="hits">857</span>
          
          <code class="ruby">    Notifier.other_conversation_topic_selected(self).deliver if other_topic</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :latest_updated, :order =&gt; 'updated_at DESC'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :latest_created, where(:exclude_from_most_recent =&gt; false).order('created_at DESC')</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :alphabet_ascending_by_title, :order =&gt; 'title ASC'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :staff_picked, where(:staff_pick =&gt; true)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :sort_position_asc, order('position ASC')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">  # Filters by metro region, if metrocode parameter is supplied, otherwise, ignores it.</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="117">
          <span class="hits">45</span>
          
          <code class="ruby">  scope :filter_metro_region, lambda{|metrocode| joins(:metro_region).where(:metro_regions=&gt;{metrocode: metrocode}) if metrocode.present?}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">  # position starts from 0, and so forth</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">  def move_to_position(new_position)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="122">
          <span class="hits">5</span>
          
          <code class="ruby">    if new_position.is_a?(Integer)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="123">
          <span class="hits">5</span>
          
          <code class="ruby">      conversations = Conversation.sort_position_asc.select([:id,:position]).where(['id != ?', self.id]).all</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="124">
          <span class="hits">5</span>
          
          <code class="ruby">      self.transaction do</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="125">
          <span class="hits">5</span>
          
          <code class="ruby">        conversations.each_with_index do |conversation, index|</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="126">
          <span class="hits">16</span>
          
          <code class="ruby">          if index &gt;= new_position</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="127">
          <span class="hits">10</span>
          
          <code class="ruby">            new_index = index + 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="129">
          <span class="hits">6</span>
          
          <code class="ruby">            new_index = index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="131">
          <span class="hits">16</span>
          
          <code class="ruby">          Conversation.where(:id=&gt;conversation.id).update_all(:position =&gt; (new_index))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="133">
          <span class="hits">5</span>
          
          <code class="ruby">        Conversation.where(:id=&gt;self.id).update_all(:position =&gt; new_position)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">  # Return conversations that have actions and reflections.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.conversations_with_actions_and_reflections</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="140">
          <span class="hits">14</span>
          
          <code class="ruby">    actions = Action.all</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="141">
          <span class="hits">18</span>
          
          <code class="ruby">    action_conversations = actions.collect{|action| action.conversation}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="143">
          <span class="hits">14</span>
          
          <code class="ruby">    reflections = Reflection.all</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="144">
          <span class="hits">18</span>
          
          <code class="ruby">    reflection_conversations = reflections.collect{|reflection| reflection.conversation}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="146">
          <span class="hits">14</span>
          
          <code class="ruby">    action_conversations &amp; reflection_conversations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">  # Number of Contributors in this Conversation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">  def community_user_ids</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">    rater_ids = RatingGroup.select(:person_id).where(contribution_id: contribution_ids).uniq.collect do |rating_group|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">      rating_group.person_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="154">
          
          
          <code class="ruby">    person_ids = Array.new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="155">
          
          
          <code class="ruby">    person_ids += [owner]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="156">
          
          
          <code class="ruby">    person_ids += contributor_ids</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">    person_ids += rater_ids</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">    person_ids = person_ids.flatten.uniq.reject(&amp;:blank?)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="159">
          
          
          <code class="ruby">    people = Person.select(:id).where(:id =&gt; person_ids).where('confirmed_at IS NOT NULL and locked_at IS NULL')</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="160">
          
          
          <code class="ruby">    people.collect{ |person| person.id }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">  # Number of Participants in related to the Talk portion of this Conversation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">  def participants</code>
        </li>
      
        <li class="covered" data-hits="169" data-linenumber="165">
          <span class="hits">169</span>
          
          <code class="ruby">    raters = RatingGroup.where(contribution_id: contribution_ids).collect{|rating_group| rating_group.person }.uniq</code>
        </li>
      
        <li class="covered" data-hits="169" data-linenumber="166">
          <span class="hits">169</span>
          
          <code class="ruby">    persons = [self.person]</code>
        </li>
      
        <li class="covered" data-hits="169" data-linenumber="167">
          <span class="hits">169</span>
          
          <code class="ruby">    persons += self.contributors</code>
        </li>
      
        <li class="covered" data-hits="169" data-linenumber="168">
          <span class="hits">169</span>
          
          <code class="ruby">    persons += raters</code>
        </li>
      
        <li class="covered" data-hits="169" data-linenumber="169">
          <span class="hits">169</span>
          
          <code class="ruby">    persons.flatten.uniq.reject(&amp;:blank?)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">  # Number of Action Participants Related to this Conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">  # * Originator of Action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">  # * Number of people signing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">  # * Number of people voting</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">  def action_participants</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="178">
          <span class="hits">10</span>
          
          <code class="ruby">    actions.collect(&amp;:participants).flatten.uniq</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">  # Number of Action Participants Related to this Conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">  # * Originator of Action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">  # * Number of people signing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">  # * Number of people voting</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">  def action_participants_count</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">    action_participants.count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">  def petition_actions_count</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="191">
          <span class="hits">3</span>
          
          <code class="ruby">    self.actions.select{|a| a.is_petition?}.count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">  def ballot_actions_count</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="195">
          <span class="hits">3</span>
          
          <code class="ruby">    self.actions.select{|a| a.is_ballot?}.count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">  # Reflection Participants Related to this Conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">  # * Number of people posting Reflection or Comments</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">  def reflection_participants</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="202">
          <span class="hits">3</span>
          
          <code class="ruby">    reflections.collect(&amp;:participants).flatten.uniq</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">  # Number of Reflection Participants Related to this Conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">  # * Number of people posting Reflection or Comments</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">  def reflection_participants_count</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">    reflection_participants.count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">  # region_metrocodes is plural because this method is available across several models, which is used to index the metrocodes in Solr.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">  def region_metrocodes</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="214">
          <span class="hits">2</span>
          
          <code class="ruby">    [metro_region.metrocode].compact if metro_region_id.present? &amp;&amp;  metro_region.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="218">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.available_filters</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">      :recommended =&gt; :recommended,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">      :active =&gt; :most_active,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">      :recent =&gt; :latest_created</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="223">
          <span class="hits">33</span>
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.available_filter_names</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="227">
          <span class="hits">21</span>
          
          <code class="ruby">    available_filters.keys.collect(&amp;:to_s)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">  # Display Conversations by Most Active</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.most_active(options = {})</code>
        </li>
      
        <li class="covered" data-hits="181" data-linenumber="232">
          <span class="hits">181</span>
          
          <code class="ruby">    options.reverse_merge!(filter:0)</code>
        </li>
      
        <li class="covered" data-hits="181" data-linenumber="233">
          <span class="hits">181</span>
          
          <code class="ruby">    daysago = options.delete(:daysago)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="181" data-linenumber="235">
          <span class="hits">181</span>
          
          <code class="ruby">    filter = options[:filter]</code>
        </li>
      
        <li class="covered" data-hits="181" data-linenumber="236">
          <span class="hits">181</span>
          
          <code class="ruby">    filter = [filter] unless options[:filter].respond_to?(:flatten) || filter.nil?</code>
        </li>
      
        <li class="covered" data-hits="181" data-linenumber="237">
          <span class="hits">181</span>
          
          <code class="ruby">    filter.flatten!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="181" data-linenumber="239">
          <span class="hits">181</span>
          
          <code class="ruby">    results = Conversation.select('conversations.*, COUNT(*) AS count_all, MAX(contributions.created_at) AS max_contributions_created_at').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">                     joins('LEFT OUTER JOIN contributions ON conversations.id = contributions.conversation_id').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">                     where(&quot;conversations.id not in (?)&quot;, filter).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">                     group('conversations.id').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">                     order('count_all DESC, max_contributions_created_at DESC')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="181" data-linenumber="245">
          <span class="hits">181</span>
          
          <code class="ruby">    results = results.where(&quot;contributions.created_at &gt; ?&quot;, Time.now - daysago.days) if daysago</code>
        </li>
      
        <li class="covered" data-hits="181" data-linenumber="246">
          <span class="hits">181</span>
          
          <code class="ruby">    return results</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">  # From the top active conversations, select a random sample.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">  # limit = number of most active conversations to select from (default 4)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">  # select = number of random conversations to select (default 2)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.random_active(select=2, limit=4, filter = [])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">    filter = [filter] unless filter.respond_to?(:flatten)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">    filter.flatten!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">    limit = select if select &gt; limit</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">    actives = Conversation.most_active - filter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">    actives = actives[0,limit]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">    actives.sample(select)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="264">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.random_recommended(select=1, filter = [])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="265">
          <span class="hits">1</span>
          
          <code class="ruby">    filter = [filter] unless filter.respond_to?(:flatten)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">    filter.flatten!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">    r = Conversation.recommended</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">    r = r - filter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">    r.sample(select)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="273">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.recommended(options = {})</code>
        </li>
      
        <li class="covered" data-hits="180" data-linenumber="274">
          <span class="hits">180</span>
          
          <code class="ruby">    options.reverse_merge!(filter:0)</code>
        </li>
      
        <li class="covered" data-hits="180" data-linenumber="275">
          <span class="hits">180</span>
          
          <code class="ruby">    filter = options[:filter]</code>
        </li>
      
        <li class="covered" data-hits="180" data-linenumber="276">
          <span class="hits">180</span>
          
          <code class="ruby">    filter = [filter] unless options[:filter].respond_to?(:flatten) || filter.nil?</code>
        </li>
      
        <li class="covered" data-hits="180" data-linenumber="277">
          <span class="hits">180</span>
          
          <code class="ruby">    filter.flatten!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="180" data-linenumber="279">
          <span class="hits">180</span>
          
          <code class="ruby">    Conversation.where('staff_pick = true').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">                 where(&quot;conversations.id not in (?)&quot;, filter).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">                 order('position ASC')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.filtered(filter)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="285">
          <span class="hits">9</span>
          
          <code class="ruby">    raise &quot;Undefined Filter :#{filter}&quot; unless available_filter_names.include?(filter)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="286">
          <span class="hits">9</span>
          
          <code class="ruby">    scoped.merge(self.send(available_filters[filter.to_sym]))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.sort</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="290">
          <span class="hits">10</span>
          
          <code class="ruby">    conversations = Conversation.order('staff_pick DESC, position ASC, id ASC')</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="291">
          <span class="hits">27</span>
          
          <code class="ruby">    staff_picks = conversations.select { |c| c.staff_pick? }</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="292">
          <span class="hits">10</span>
          
          <code class="ruby">    others = conversations - staff_picks</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="294">
          <span class="hits">10</span>
          
          <code class="ruby">    staff_picks.each_with_index do |conversation, i|</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="295">
          <span class="hits">11</span>
          
          <code class="ruby">      Conversation.where('id = ?', conversation.id).update_all(position: i)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="296">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="298">
          <span class="hits">10</span>
          
          <code class="ruby">    staff_picks_length = staff_picks.length</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="299">
          <span class="hits">10</span>
          
          <code class="ruby">    others.each_with_index do |conversation, i|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="300">
          <span class="hits">6</span>
          
          <code class="ruby">      Conversation.where('id = ?', conversation.id).update_all(position: i + staff_picks_length)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_generated?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="305">
          
          
          <code class="ruby">    from_community</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="307">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">  def sort</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="309">
          <span class="hits">6</span>
          
          <code class="ruby">    max_position = Conversation.where('staff_pick = true').maximum('position')</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="310">
          <span class="hits">6</span>
          
          <code class="ruby">    Conversation.where('id = ?', self.id).update_all(position: max_position + 1) if max_position</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="311">
          <span class="hits">6</span>
          
          <code class="ruby">    Conversation.sort</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">  def staff_pick?</code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="315">
          <span class="hits">29</span>
          
          <code class="ruby">    staff_pick</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">  # Return a comma-and-space-delimited list of the Issues</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">  # relevant to this Conversation, e.g., &quot;Jobs, Sports, Religion&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">  def issues_text</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="321">
          
          
          <code class="ruby">    if issues.any?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="322">
          
          
          <code class="ruby">       issues.map(&amp;:name).join(&quot;, &quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="324">
          
          
          <code class="ruby">      &quot;No issues yet&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">  # Original plan: single Moderator per Conversation.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">  # New plan: Zero or more Guides per Conversation.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">  # validates :moderator, :presence =&gt; :true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="333">
          <span class="hits">1</span>
          
          <code class="ruby">  def guides_text</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="334">
          
          
          <code class="ruby">    if (guides.count &gt; 0)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="335">
          
          
          <code class="ruby">      guides.join(&quot;, &quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="337">
          
          
          <code class="ruby">      &quot;No Guides yet&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="340">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">  def start_month_text</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="342">
          
          
          <code class="ruby">    if started_at.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="343">
          
          
          <code class="ruby">      &quot;?&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="344">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="345">
          
          
          <code class="ruby">      started_at.strftime(&quot;%B&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="349">
          <span class="hits">1</span>
          
          <code class="ruby">  def start_day</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="350">
          
          
          <code class="ruby">    if started_at.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="351">
          
          
          <code class="ruby">      &quot;?&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="353">
          
          
          <code class="ruby">      started_at.mday</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="354">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="357">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_initial_position</code>
        </li>
      
        <li class="covered" data-hits="857" data-linenumber="358">
          <span class="hits">857</span>
          
          <code class="ruby">    max = Conversation.maximum(:position)</code>
        </li>
      
        <li class="covered" data-hits="857" data-linenumber="359">
          <span class="hits">857</span>
          
          <code class="ruby">    if max</code>
        </li>
      
        <li class="covered" data-hits="317" data-linenumber="360">
          <span class="hits">317</span>
          
          <code class="ruby">     self.update_attribute(:position, max + 1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="540" data-linenumber="362">
          <span class="hits">540</span>
          
          <code class="ruby">      self.update_attribute(:position, 0)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">  def subscriber_ids</code>
        </li>
      
        <li class="covered" data-hits="73" data-linenumber="367">
          <span class="hits">73</span>
          
          <code class="ruby">    subscriptions ? subscriptions.collect(&amp;:person_id) : []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="369">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">  def subscribe_creator</code>
        </li>
      
        <li class="covered" data-hits="857" data-linenumber="371">
          <span class="hits">857</span>
          
          <code class="ruby">    Subscription.create_unless_exists(person, self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="372">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="373">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">  def metro_region_city_display_name=(record)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby">    # ignore this attribute that comes back from form post, on a delegator method.</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="376">
          <span class="hits">3</span>
          
          <code class="ruby">    return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">  # Due to caching, we need to update the issue updated_at timestamp</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">  #   so we can automatically expire the old cache.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">  # Conversations do not have issues when they are created so we don't</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="382">
          
          
          <code class="ruby">  #   need to do this after_save, only when an admin adds a convo to</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby">  #   an issue or project.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">  def touch_issues</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="385">
          <span class="hits">2</span>
          
          <code class="ruby">    self.issues.each do |issue|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="386">
          
          
          <code class="ruby">      issue.touch</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="387">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="388">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="389">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="390">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="bf60ae24ffa1c8ebbdb2633af61f66bd675b4305">
  <div class="header">
    <h3>app/models/conversations_person.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ConversationsPerson &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :conversation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a5afd10a65ce889689ceba3f4c798f0c212c700b">
  <div class="header">
    <h3>app/models/conversations_topic.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ConversationsTopic &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :conversation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :topic</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :topic_id, :uniqueness =&gt; { :scope =&gt; :conversation_id }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="37ffb718fc6d36625ef8842cb6d63a9b95c1185c">
  <div class="header">
    <h3>app/models/county.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class County &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :name </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :state </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_length_of :state, :maximum=&gt;2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="845fc5cc9e7c7734e4636d1ed249328dbf06c3cd">
  <div class="header">
    <h3>app/models/curated_feed.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class CuratedFeed &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend FriendlyId</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :title</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_uniqueness_of :title</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :curated_feed_items, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  alias_attribute :items, :curated_feed_items</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  friendly_id :title, :use =&gt; :slugged</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def should_generate_new_friendly_id?</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="12">
          <span class="hits">65</span>
          
          <code class="ruby">    new_record? || slug.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="45687ff8a36303a4085809e37dccaedd368eb9c0">
  <div class="header">
    <h3>app/models/curated_feed_item.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>45</b> relevant lines. 
      <span class="green"><b>45</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class CuratedFeedItem &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_protected :raw</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # dependency injection to short-circuit during testing</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :update_embed_on_save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  default_scope :order =&gt; 'pub_date DESC, created_at DESC'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :curated_feed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  alias_attribute :url, :original_url</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  alias_attribute :feed, :curated_feed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :original_url</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :curated_feed_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :set_pub_date</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  before_save :update_embedly</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_embed_on_save</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="22">
          <span class="hits">37</span>
          
          <code class="ruby">    @update_embed_on_save = true if @update_embed_on_save.nil?</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="23">
          <span class="hits">37</span>
          
          <code class="ruby">    return @update_embed_on_save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_embed_on_save=(value)</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="27">
          <span class="hits">42</span>
          
          <code class="ruby">    @update_embed_on_save = (true &amp; value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_embedly</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="31">
          <span class="hits">37</span>
          
          <code class="ruby">    return true unless self.update_embed_on_save</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="32">
          <span class="hits">3</span>
          
          <code class="ruby">    embedly = EmbedlyService.new</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="33">
          <span class="hits">3</span>
          
          <code class="ruby">    embedly.fetch(self.original_url)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="34">
          <span class="hits">3</span>
          
          <code class="ruby">    if embedly.ok?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="35">
          <span class="hits">2</span>
          
          <code class="ruby">      self.raw = embedly.raw</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="36">
          <span class="hits">2</span>
          
          <code class="ruby">      self.provider_url = embedly.properties[:provider_url]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="37">
          <span class="hits">2</span>
          
          <code class="ruby">      self.title = embedly.properties[:title]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="38">
          <span class="hits">2</span>
          
          <code class="ruby">      self.description = embedly.properties[:description]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">      errors.add(:objectify, embedly.error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="42">
          <span class="hits">3</span>
          
          <code class="ruby">    return embedly.ok?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def objectify</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="46">
          <span class="hits">2</span>
          
          <code class="ruby">    @objectify ||= structify(self.raw)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="47">
          <span class="hits">2</span>
          
          <code class="ruby">    return @objectify</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_pub_date</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="53">
          <span class="hits">45</span>
          
          <code class="ruby">    self.pub_date = DateTime.now if self.pub_date.blank?</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="54">
          <span class="hits">45</span>
          
          <code class="ruby">    return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  def structify(item)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="58">
          <span class="hits">14</span>
          
          <code class="ruby">    item = ActiveSupport::JSON.decode(item) unless item.is_a? Hash</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="59">
          <span class="hits">14</span>
          
          <code class="ruby">    struct = OpenStruct.new(item)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="60">
          <span class="hits">14</span>
          
          <code class="ruby">    item.each do |key, value|</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="61">
          <span class="hits">63</span>
          
          <code class="ruby">      if value.is_a? Hash</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="62">
          <span class="hits">7</span>
          
          <code class="ruby">        obj = structify(value)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="63">
          <span class="hits">7</span>
          
          <code class="ruby">        struct.send(&quot;#{key}=&quot;.to_sym, obj)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">      elsif value.is_a? Array</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="65">
          <span class="hits">3</span>
          
          <code class="ruby">        value = struct.send(key.to_sym)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="66">
          <span class="hits">3</span>
          
          <code class="ruby">        (0 .. value.size-1).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="67">
          <span class="hits">6</span>
          
          <code class="ruby">          value[i] = structify(value[i]) if value[i].is_a? Hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="71">
          <span class="hits">14</span>
          
          <code class="ruby">    return struct</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4437993eb1794d7d4870c0abfb8cb777a31738cc">
  <div class="header">
    <h3>app/models/email_restriction.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class EmailRestriction &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="09acf8feb722ef74d325c80c844d9cb20a2fbe9d">
  <div class="header">
    <h3>app/models/featured_opportunity.rb</h3>
    <h4><span class="red">75.0 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class FeaturedOpportunity &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :conversation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  has_and_belongs_to_many :contributions, :join_table =&gt; :featured_opportunities_contributions, :uniq =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  has_and_belongs_to_many :actions, :join_table =&gt; :featured_opportunities_actions, :uniq =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_and_belongs_to_many :reflections, :join_table  =&gt; :featured_opportunities_reflections, :uniq =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :conversation_id, :contributions, :reflections, :actions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def contribution</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    self.contributions.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def action</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    self.actions.first.actionable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def reflection</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    self.reflections.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="680a5bc315bb1faa10f78e6e93a25b4482c8ccd6">
  <div class="header">
    <h3>app/models/homepage_featured.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class HomepageFeatured &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :homepage_featureable, polymorphic: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :homepage_featureable_id, :homepage_featureable_type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_uniqueness_of :homepage_featureable_id, scope: :homepage_featureable_type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :image, :title, to: :homepage_featureable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # Returns back a minimium of the desired items that are not in the filter.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  # returns back an empty array if the desired number is not available.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.sample_and_filtered(limit=10, filter = [])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="11">
          <span class="hits">3</span>
          
          <code class="ruby">    filter = [filter] unless filter.respond_to?(:flatten)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="12">
          <span class="hits">3</span>
          
          <code class="ruby">    filter.flatten!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="14">
          <span class="hits">3</span>
          
          <code class="ruby">    featured = self.all</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="15">
          <span class="hits">12</span>
          
          <code class="ruby">    featured = featured.select{|feature| !(([feature.homepage_featureable] - filter)).blank?}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="17">
          <span class="hits">3</span>
          
          <code class="ruby">    samples = featured.sample(limit)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="19">
          <span class="hits">8</span>
          
          <code class="ruby">    samples.collect{|sample| sample.homepage_featureable}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="47cf9b09925af3e73fc7beae521f90c3920ec86e">
  <div class="header">
    <h3>app/models/invite.rb</h3>
    <h4><span class="green">93.75 %</span> covered</h4>
    <div>
      <b>32</b> relevant lines. 
      <span class="green"><b>30</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Invite #makes invitation behaves like an activerecord model</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include ActiveModel::Validations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include ActiveModel::Conversion</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveModel::Naming</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  EMAIL_SPLIT = /[\s\,]+/i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :emails, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">                :conversation,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">                :user,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">                :source_type, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">                :source_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :emails,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">                        :source_type,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">                        :source_id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">                        :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">                        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :email_formatting</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(attributes = {})</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="21">
          <span class="hits">25</span>
          
          <code class="ruby">    attributes.each do |name, value|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">      send(&quot;#{name}=&quot;, value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="27">
          <span class="hits">5</span>
          
          <code class="ruby">    @conversation ||= (Conversation.find_by_id(source_id) || Conversation.first)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  # email_formatting validation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def email_formatting</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="32">
          <span class="hits">23</span>
          
          <code class="ruby">    unless splitted_emails.all?{|email| email =~ EmailAddressValidation::PatternExact }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="33">
          <span class="hits">3</span>
          
          <code class="ruby">      errors.add(:emails, &quot;must be in the correct format, example: abc@test.com&quot;) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  def persisted?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">    false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def splitted_emails</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="42">
          <span class="hits">19</span>
          
          <code class="ruby">    emails.to_s.split(EMAIL_SPLIT)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  # returns an array of emails using Regex</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def parsed_emails</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="47">
          <span class="hits">28</span>
          
          <code class="ruby">    splitted_emails.find_all{|email| email =~ EmailAddressValidation::PatternExact}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_invites</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="51">
          <span class="hits">3</span>
          
          <code class="ruby">    if valid?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="52">
          <span class="hits">2</span>
          
          <code class="ruby">      case source_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      when 'conversations'</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="54">
          <span class="hits">2</span>
          
          <code class="ruby">        send_conversation_invites</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">      return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_conversation_invites</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">    parsed_emails.each do |email|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="63">
          <span class="hits">3</span>
          
          <code class="ruby">      resource = {:emails =&gt; email, :user =&gt; user, :conversation =&gt; conversation}</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="64">
          <span class="hits">3</span>
          
          <code class="ruby">      mail = Notifier.invite_to_conversation(resource)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="65">
          <span class="hits">3</span>
          
          <code class="ruby">      mail_result = mail.deliver</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4d3fe8c348257031543f19b442e44078c9169f7d">
  <div class="header">
    <h3>app/models/issue.rb</h3>
    <h4><span class="green">93.33 %</span> covered</h4>
    <div>
      <b>135</b> relevant lines. 
      <span class="green"><b>126</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Issue &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend FriendlyId</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include Visitable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include Subscribable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  include Regionable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  include GeometryForStyle</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  include HomepageFeaturable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  include Thumbnail</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  searchable :ignore_attribute_changes_of =&gt; [ :total_visits, :recent_visits, :last_visit_date, :updated_at, :recent_rating ] do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    text :name, :boost =&gt; 3, :default_boost =&gt; 3</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    text :summary, :stored =&gt; true, :boost =&gt; 2, :default_boost =&gt; 2 do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      Sanitize.clean(summary, :remove_contents =&gt; ['style','script'])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    string :type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    integer :region_metrocodes, :multiple =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  ALL_TYPES = ['Issue', 'ManagedIssue']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  has_and_belongs_to_many :conversations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :issues_topics, uniq: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :topics, through: :issues_topics, uniq: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  # Contributions directly related to this Issue</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :contributions</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :suggested_actions</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :surveys, :as =&gt; :surveyable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :votes, :as =&gt; :surveyable, :class_name =&gt; 'Survey', :conditions =&gt; {:type =&gt; 'Vote'}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many(:media_contributions, :class_name =&gt; &quot;Contribution&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">           :conditions =&gt; {:type =&gt; ['EmbeddedSnippet', 'Link', 'AttachedFile']})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :subscriptions, :as =&gt; :subscribable, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  # Anyone who has contributed directly to the issue via a contribution</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many(:participants,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">           :through =&gt; :contributions,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">           :source =&gt; :person,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">           :uniq =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  has_attached_file(:image,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">                    :styles =&gt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">                      :normal =&gt; &quot;480x300#&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">                      :panel =&gt; &quot;198x130#&quot; },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">                    :storage =&gt; :s3,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">                    :s3_credentials =&gt; S3Config.credential_file,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">                    :path =&gt; IMAGE_ATTACHMENT_PATH)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_attachment_content_type :image,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">                                    :content_type =&gt; /image\/*/,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">                                    :message =&gt; &quot;Not a valid image file.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">  has_attached_file(:standard_banner_image,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">                    :styles =&gt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">                      :normal =&gt; '940x100#',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">                      :panel =&gt; &quot;198x130#&quot; },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">                    :storage =&gt; :s3,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">                    :s3_credentials =&gt; S3Config.credential_file,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                    :path =&gt; IMAGE_ATTACHMENT_PATH)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_attachment_content_type :standard_banner_image,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">                                    :content_type =&gt; /image\/*/,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">                                    :message =&gt; &quot;Not a valid image file.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  friendly_id :name, :use =&gt; :slugged</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">  def should_generate_new_friendly_id?</code>
        </li>
      
        <li class="covered" data-hits="1287" data-linenumber="67">
          <span class="hits">1287</span>
          
          <code class="ruby">    new_record? || slug.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  before_create :assign_position</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, :presence =&gt; true, :length =&gt; { :minimum =&gt; 5 }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :require_topic</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_uniqueness_of :name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_attachment_presence :image</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :standard_issue, where(:type =&gt; 'Issue')</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :managed_issue, where(:type =&gt; 'ManagedIssue')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">  scope(:most_active, :select =&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">        'count(1) as contribution_count, issues.*',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">        :joins =&gt; [:contributions],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">        :group =&gt; &quot;issues.id&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">        :order =&gt; 'contribution_count DESC')</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :custom_order, {:order =&gt; 'position ASC'}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :most_recent, {:order =&gt; 'created_at DESC'}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :most_recent_update, {:order =&gt; 'updated_at DESC'}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :published, where(:exclude_from_result =&gt; false)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :alphabetical, {:order =&gt; 'name ASC'}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :sort, lambda { |sort_type|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="91">
          <span class="hits">4</span>
          
          <code class="ruby">      case sort_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">      when 'most_recent'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">        most_recent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      when 'alphabetical'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">        alphabetical</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      when 'most_recent_update'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">        most_recent_update</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">      when 'most_active'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">        most_active</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">        custom_order</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  # Filters by metro region, if metrocode parameter is supplied, otherwise, ignores it.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :filter_metro_region, lambda{|metrocode|</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="106">
          <span class="hits">13</span>
          
          <code class="ruby">      joins(:conversations =&gt; :metro_region).where(:metro_regions=&gt;{metrocode: metrocode}).group('issues.id') if metrocode.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.random</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">    if (c = count) != 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">      find(:first, :offset =&gt;rand(c))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.sample(count=1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">    result = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">    until result.size == count do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">      random_issue = self.random</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">      result &lt;&lt; random_issue if !result.include?(random_issue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">    result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.assign_positions</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="127">
          <span class="hits">13</span>
          
          <code class="ruby">    non_nil_positions = Issue.where('position IS NOT NULL').order('position ASC, id ASC')</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="128">
          <span class="hits">13</span>
          
          <code class="ruby">    nil_positions = Issue.where('position IS NULL').order('position ASC, id ASC')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="130">
          <span class="hits">13</span>
          
          <code class="ruby">    non_nil_positions.each_with_index do |issue, i|</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="131">
          <span class="hits">25</span>
          
          <code class="ruby">      issue.update_attribute(:position, i)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="133">
          <span class="hits">13</span>
          
          <code class="ruby">    nil_positions.each_with_index do |issue, i|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="134">
          <span class="hits">3</span>
          
          <code class="ruby">      issue.update_attribute(:position, i + non_nil_positions.size)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.set_position(current_position, next_position, previous_position)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="139">
          <span class="hits">7</span>
          
          <code class="ruby">    if previous_position.nil?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="140">
          <span class="hits">2</span>
          
          <code class="ruby">      self.update_positions(current_position, 0, next_position)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">    elsif next_position.nil?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="142">
          <span class="hits">2</span>
          
          <code class="ruby">      self.update_positions(current_position, Issue.maximum('position') + 2, previous_position)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    elsif next_position &gt; previous_position</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="144">
          <span class="hits">2</span>
          
          <code class="ruby">      self.update_positions(current_position, previous_position + 1, next_position)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">    elsif next_position &lt; previous_position</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">      self.update_positions(current_position, next_position + 1, previous_position)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="148">
          <span class="hits">7</span>
          
          <code class="ruby">    Issue.assign_positions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.top_issues</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">    Issue.all.sort_by do |issue|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="153">
          <span class="hits">2</span>
          
          <code class="ruby">      issue.activity_weight</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">  def activity_weight</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="158">
          <span class="hits">2</span>
          
          <code class="ruby">    visits = self.visits.count</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="159">
          <span class="hits">2</span>
          
          <code class="ruby">    contributions = self.contributions.count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="161">
          <span class="hits">2</span>
          
          <code class="ruby">    @activity_weight = visits + contributions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_comments</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="165">
          <span class="hits">13</span>
          
          <code class="ruby">    Contribution.joins(:conversation).where({:conversations =&gt; {:id =&gt; self.conversation_ids}})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_contributer_ids</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="169">
          <span class="hits">42</span>
          
          <code class="ruby">    self.conversations.collect do |conversation|</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="170">
          <span class="hits">30</span>
          
          <code class="ruby">      conversation.contributor_ids</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">    end.uniq</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_creators_ids</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="175">
          <span class="hits">44</span>
          
          <code class="ruby">    self.conversations.collect do |conversation|</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="176">
          <span class="hits">36</span>
          
          <code class="ruby">      conversation.owner</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">    end.uniq</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_rater_ids</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="181">
          <span class="hits">42</span>
          
          <code class="ruby">    contribution_ids = self.conversations.collect do |conversation|</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="182">
          <span class="hits">30</span>
          
          <code class="ruby">      conversation.contribution_ids</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">    end.uniq</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="184">
          <span class="hits">42</span>
          
          <code class="ruby">    RatingGroup.select(:person_id).where(contribution_id: contribution_ids).uniq.collect do |rating_group|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">      rating_group.person_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">  # Determine the user ids for participants of this issue.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">  def community_user_ids</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="191">
          <span class="hits">42</span>
          
          <code class="ruby">    person_ids = Array.new</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="192">
          <span class="hits">42</span>
          
          <code class="ruby">    person_ids += participant_ids</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="193">
          <span class="hits">42</span>
          
          <code class="ruby">    person_ids += conversation_creators_ids</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="194">
          <span class="hits">42</span>
          
          <code class="ruby">    person_ids += conversation_contributer_ids</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="195">
          <span class="hits">42</span>
          
          <code class="ruby">    person_ids += conversation_rater_ids</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="196">
          <span class="hits">42</span>
          
          <code class="ruby">    person_ids = person_ids.flatten.uniq.reject(&amp;:blank?)</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="197">
          <span class="hits">42</span>
          
          <code class="ruby">    people = Person.select(:id).where(:id =&gt; person_ids).where('confirmed_at IS NOT NULL and locked_at IS NULL')</code>
        </li>
      
        <li class="covered" data-hits="98" data-linenumber="198">
          <span class="hits">98</span>
          
          <code class="ruby">    people.collect{ |person| person.id }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">  def most_active_users</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="202">
          <span class="hits">22</span>
          
          <code class="ruby">    Person.find_confirmed_order_by_most_active(community_user_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">  def most_newest_users</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="206">
          <span class="hits">2</span>
          
          <code class="ruby">    Person.find_confirmed_order_by_recency(community_user_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">  def order_by_alpha_users(letter = nil)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="210">
          <span class="hits">2</span>
          
          <code class="ruby">    Person.find_confirmed_order_by_last_name(letter, community_user_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">  def managed?</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="214">
          <span class="hits">7</span>
          
          <code class="ruby">    false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="217">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_topic?(topic)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="218">
          <span class="hits">10</span>
          
          <code class="ruby">    topics.include?(topic)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">  define_method(:title) do</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="222">
          <span class="hits">34</span>
          
          <code class="ruby">    name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">  def region_metrocodes</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="226">
          <span class="hits">2</span>
          
          <code class="ruby">    conversations.collect do |conversation|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">      conversation.metro_region.metrocode if conversation.metro_region_id.present? &amp;&amp;  conversation.metro_region.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">    end.compact.uniq</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">  #validation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">  def require_topic</code>
        </li>
      
        <li class="covered" data-hits="1287" data-linenumber="233">
          <span class="hits">1287</span>
          
          <code class="ruby">    errors.add(:base, &quot;Please select at least one Topic&quot;) if self.topic_ids.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.update_positions(current, new_index, comparison)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="240">
          <span class="hits">7</span>
          
          <code class="ruby">    current_issue = Issue.find_by_position(current)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="241">
          <span class="hits">7</span>
          
          <code class="ruby">    Issue.where('position &gt;= ?', comparison).each do |issue|</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="242">
          <span class="hits">12</span>
          
          <code class="ruby">      issue.position += 1</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="243">
          <span class="hits">12</span>
          
          <code class="ruby">      issue.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="245">
          <span class="hits">7</span>
          
          <code class="ruby">    current_issue.position = new_index</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="246">
          <span class="hits">7</span>
          
          <code class="ruby">    current_issue.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="249">
          <span class="hits">1</span>
          
          <code class="ruby">  def assign_position</code>
        </li>
      
        <li class="covered" data-hits="1202" data-linenumber="250">
          <span class="hits">1202</span>
          
          <code class="ruby">    if self.position.nil?</code>
        </li>
      
        <li class="covered" data-hits="1166" data-linenumber="251">
          <span class="hits">1166</span>
          
          <code class="ruby">      self.position = Issue.maximum('position') ? Issue.maximum('position') + 1 : 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="254">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="95317e25da27133a7e60dd2d2fd8a4e3996a5454">
  <div class="header">
    <h3>app/models/issues_topic.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class IssuesTopic &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :issue</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :topic</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4d63446d3112c6fcd9a29d09e0ff8f244ce11a2f">
  <div class="header">
    <h3>app/models/managed_issue.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ManagedIssue &lt; Issue</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :index,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    :class_name =&gt; 'ManagedIssuePage',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    :foreign_key =&gt; 'managed_issue_page_id',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    :readonly =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :pages,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    :class_name =&gt; 'ManagedIssuePage',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    :foreign_key =&gt; 'issue_id',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    :dependent =&gt; :destroy,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    :readonly =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :index_is_a_circular_reference</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def managed?</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="17">
          <span class="hits">11</span>
          
          <code class="ruby">    true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def index_is_a_circular_reference</code>
        </li>
      
        <li class="covered" data-hits="158" data-linenumber="23">
          <span class="hits">158</span>
          
          <code class="ruby">    if index and (index.issue.nil? or id != index.issue.id)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      errors.add(:index, 'index page must be associated with this issue')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d6fa366d057df9a2bd4dee638f658a138b10190a">
  <div class="header">
    <h3>app/models/managed_issue_page.rb</h3>
    <h4><span class="yellow">88.46 %</span> covered</h4>
    <div>
      <b>26</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ManagedIssuePage &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend FriendlyId</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include Rails.application.routes.url_helpers #needed by the url helper in this class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  acts_as_revisionable :on_update =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :issue,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    :class_name =&gt; 'ManagedIssue',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    :foreign_key =&gt; 'issue_id',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    :readonly =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :author,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    :foreign_key =&gt; 'person_id',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    :class_name =&gt; 'Person',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    :readonly =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  has_one :index_for,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    :class_name =&gt; 'ManagedIssue',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    :foreign_key =&gt; 'managed_issue_page_id',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    :readonly =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :name, :template, :issue, :author</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_uniqueness_of :name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :valid_ccml_tags</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  friendly_id :name, :use =&gt; :slugged</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def should_generate_new_friendly_id?</code>
        </li>
      
        <li class="covered" data-hits="58" data-linenumber="28">
          <span class="hits">58</span>
          
          <code class="ruby">    new_record? || slug.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  searchable :ignore_attribute_changes_of =&gt; [ :updated_at, :stylesheet_path, :template ] do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    text :template, :stored =&gt; true, :boost =&gt; 1, :default_boost =&gt; 1 do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">      text = Sanitize.clean(template, :remove_contents =&gt; ['style','script'])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">      CCML.sanitize_tags(text)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    string :type do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">      'ManagedIssuePage'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def valid_ccml_tags</code>
        </li>
      
        <li class="covered" data-hits="58" data-linenumber="42">
          <span class="hits">58</span>
          
          <code class="ruby">    if !self.template.blank? &amp;&amp; !self.issue_id.blank?</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="43">
          <span class="hits">50</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="44">
          <span class="hits">50</span>
          
          <code class="ruby">        CCML.parse(self.template,</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="45">
          <span class="hits">50</span>
          
          <code class="ruby">          issue_page_url((self.id || 'temporary-id'), :issue_id =&gt; issue_id, :host=&gt;'localhost'), # need the url to properly parse it</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">          {:silence_external_source_errors =&gt; false})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">      rescue =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">        self.errors.add(:template,&quot;has a CCML tag error: #{e}&quot; )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1ac2ac381b4d3eadac56d70df897463fd2d10a0b">
  <div class="header">
    <h3>app/models/metro_region.rb</h3>
    <h4><span class="red">45.24 %</span> covered</h4>
    <div>
      <b>42</b> relevant lines. 
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>23</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class MetroRegion &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :conversations, :dependent =&gt; :restrict</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  searchable do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    text :city_name, :boost =&gt; 3</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    text :province, :boost =&gt; 1.2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    text :display_name, :boost =&gt; 1.1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    text :city_display_name,:boost =&gt; 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    text :province_code, :boost =&gt; 0.9</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def indexed_city_province_token</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    &quot;#{city_name.to_s.downcase.gsub(/\s/i, '-')}-#{province.to_s.downcase.gsub(/\s/i, '-')}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def city_display_name</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="18">
          <span class="hits">8</span>
          
          <code class="ruby">    &quot;#{city_name}, #{province}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def generate_slideout_image</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    image = MiniMagick::Image.open(&quot;#{Rails.root}/public/images/regions/template.png&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    image.combine_options do |c|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">      c.fill        'white'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      #c.font        'Helvetica'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      c.pointsize   '15'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">      c.gravity     'center'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">      c.annotate    '270', self.display_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">      c.trim        '+repage'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    puts &quot; * Generating image:#{self.metrocode}.png&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    image.format  &quot;png&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    image.write   &quot;#{Rails.root}/public/images/regions/#{self.metrocode}.png&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    &quot;#{Rails.root}/public/images/regions/#{self.metrocode}.png&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_amazon_slideout_image</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">    puts &quot;MetroRegion copy_slideout_to_amazon...&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    AWS::S3::Base.establish_connection!(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      :access_key_id     =&gt; S3Config.access_key_id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      :secret_access_key =&gt; S3Config.secret_access_key,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    slideout_image = self.generate_slideout_image</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    AWS::S3::S3Object.store(&quot;#{self.metrocode}.png&quot;, open(slideout_image) , &quot;#{S3Config.bucket}/images-regions&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.top_metro_regions(limit = 5)</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="50">
          <span class="hits">51</span>
          
          <code class="ruby">    sql = &lt;&lt;-SQL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      SELECT m.*, count(m.id) as count_mid from metro_regions m join conversations c on c.`metro_region_id` = m.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      GROUP BY m.metrocode</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      ORDER BY count_mid DESC</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      LIMIT #{limit}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    SQL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="57">
          <span class="hits">51</span>
          
          <code class="ruby">    MetroRegion.find_by_sql(sql)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.metrocodes</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">    self.group(:metrocode)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.update_all_city_province_token</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">    MetroRegion.all.each do |metro_region|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">      metro_region.city_province_token = metro_region.indexed_city_province_token</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">      metro_region.save(:validate =&gt; false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.search_city_province(q)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">    q = q.to_s.gsub(/,|\./i,'') #remove comma</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">    q = q.gsub(/\s/i, '-') # sub whitespace into '-' because the tokens are using '-'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">    MetroRegion.where(&quot;city_province_token LIKE '#{q}%'&quot;).order('city_province_token ASC').limit(50)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c1dd906fcb9813625222821f95fbf7004662e55a">
  <div class="header">
    <h3>app/models/must_be_logged_in_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class MustBeLoggedInValidator &lt; ActiveModel::EachValidator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_each(record, attribute, value)</code>
        </li>
      
        <li class="covered" data-hits="913" data-linenumber="4">
          <span class="hits">913</span>
          
          <code class="ruby">    record.errors[:base] &lt;&lt; &quot;You must be logged in&quot; if value.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5bfbfb1940b2cb74020f040ab3a54e1765f1e7c1">
  <div class="header">
    <h3>app/models/notification.rb</h3>
    <h4><span class="green">91.5 %</span> covered</h4>
    <div>
      <b>200</b> relevant lines. 
      <span class="green"><b>183</b> lines covered</span> and
      <span class="red"><b>17</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># The Notification model is based off of the Activity model.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># The main difference is that the Notification model is per person.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">class Notification &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :item, polymorphic: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :receiver, :class_name =&gt; 'Person'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item_id, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item_type, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :item_created_at, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :person_id, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :receiver_id, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  VALID_TYPES = [ Conversation, Contribution, Issue, RatingGroup, SurveyResponse,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">                  Petition, PetitionSignature, Reflection, ReflectionComment, Survey]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :name, :to =&gt; :person, :prefix =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # Items title</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  # * Whitespace trimmed from the left and right</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def item_title</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    item.title.strip</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def item_content</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    Sanitize.clean(item.content, :remove_contents =&gt; ['script', 'style']).strip</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  # Accept an Active Record object of valid type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(attributes = nil)</code>
        </li>
      
        <li class="covered" data-hits="178" data-linenumber="32">
          <span class="hits">178</span>
          
          <code class="ruby">    if Notification.valid_type?(attributes)</code>
        </li>
      
        <li class="covered" data-hits="168" data-linenumber="33">
          <span class="hits">168</span>
          
          <code class="ruby">      attributes = attributes.becomes(Contribution) if attributes.is_a?(Contribution)</code>
        </li>
      
        <li class="covered" data-hits="168" data-linenumber="34">
          <span class="hits">168</span>
          
          <code class="ruby">      attr = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">        item_id: attributes.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">        item_type: attributes.class.to_s,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">        item_created_at: attributes.created_at,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">        person_id: attributes.person.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="covered" data-hits="168" data-linenumber="40">
          <span class="hits">168</span>
          
          <code class="ruby">      if attributes.respond_to?(:conversation_id) &amp;&amp; !attributes.conversation_id.nil?</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="41">
          <span class="hits">146</span>
          
          <code class="ruby">        attr[:conversation_id] = attributes.conversation_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      elsif attributes.respond_to?(:issue_id) &amp;&amp; !attributes.issue_id.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">        attr[:issue_id] = attributes.issue_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      elsif attributes.is_a?(Conversation)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">        attr[:conversation_id] = attributes.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      elsif attributes.is_a?(Vote)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">        attr[:conversation_id] = attributes.surveyable_id if attributes.surveyable_type == 'Conversation'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="168" data-linenumber="50">
          <span class="hits">168</span>
          
          <code class="ruby">      attributes = attr</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    elsif attributes.is_a?(ActiveRecord::Base)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      # if it's not a valid Notification type, and it's an activerecord object, then nullify it, because it breaks in rails &gt;= 3.1 (Perry)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="53">
          <span class="hits">4</span>
          
          <code class="ruby">      attributes = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="178" data-linenumber="55">
          <span class="hits">178</span>
          
          <code class="ruby">    super(attributes)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.commented_on_created_reflection_notification(reflection_comment)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="59">
          <span class="hits">7</span>
          
          <code class="ruby">    if reflection_comment.reflection</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="60">
          <span class="hits">7</span>
          
          <code class="ruby">      Notification.update_or_create_notification(reflection_comment, reflection_comment.person_id, reflection_comment.reflection.owner)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.commented_on_commented_reflection_notification(reflection_comment)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="65">
          <span class="hits">6</span>
          
          <code class="ruby">    if reflection_comment.reflection</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="66">
          <span class="hits">6</span>
          
          <code class="ruby">      Notification.update_or_create_notification(reflection_comment, reflection_comment.person_id, reflection_comment.reflection.commenter_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.contributed_on_created_conversation_notification(contribution)</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="71">
          <span class="hits">25</span>
          
          <code class="ruby">    if contribution.conversation</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="72">
          <span class="hits">24</span>
          
          <code class="ruby">      Notification.update_or_create_notification(contribution, contribution.owner, contribution.conversation.owner)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.contributed_on_contribution_notification(contribution)</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="77">
          <span class="hits">25</span>
          
          <code class="ruby">    if contribution.parent</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="78">
          <span class="hits">3</span>
          
          <code class="ruby">      Notification.update_or_create_notification(contribution, contribution.owner, contribution.parent.owner)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.contributed_on_followed_conversation_notification(contribution)</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="83">
          <span class="hits">25</span>
          
          <code class="ruby">    if contribution.conversation</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="84">
          <span class="hits">25</span>
          
          <code class="ruby">      Notification.update_or_create_notification(contribution, contribution.owner, contribution.conversation.subscriber_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.create_for(item)</code>
        </li>
      
        <li class="covered" data-hits="108" data-linenumber="89">
          <span class="hits">108</span>
          
          <code class="ruby">    case item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">    when Contribution</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="91">
          <span class="hits">23</span>
          
          <code class="ruby">      self.contributed_on_created_conversation_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="92">
          <span class="hits">23</span>
          
          <code class="ruby">      self.contributed_on_contribution_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="93">
          <span class="hits">23</span>
          
          <code class="ruby">      self.contributed_on_followed_conversation_notification(item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">    when RatingGroup</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="95">
          <span class="hits">5</span>
          
          <code class="ruby">      self.rated_on_contribution_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="96">
          <span class="hits">5</span>
          
          <code class="ruby">      self.rated_on_followed_conversation_notification(item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">    when Reflection</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="98">
          <span class="hits">5</span>
          
          <code class="ruby">      self.reflected_on_followed_conversation_notification(item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">    when SurveyResponse</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="100">
          <span class="hits">11</span>
          
          <code class="ruby">      self.voted_on_followed_conversation_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="101">
          <span class="hits">11</span>
          
          <code class="ruby">      self.voted_on_created_vote_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="102">
          <span class="hits">11</span>
          
          <code class="ruby">      self.voted_on_voted_vote_notification(item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">    when PetitionSignature</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="104">
          <span class="hits">9</span>
          
          <code class="ruby">      self.signed_petition_on_followed_conversation_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="105">
          <span class="hits">9</span>
          
          <code class="ruby">      self.signed_on_created_petition_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="106">
          <span class="hits">9</span>
          
          <code class="ruby">      self.signed_on_signed_petition_notification(item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">    when ReflectionComment</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="108">
          <span class="hits">4</span>
          
          <code class="ruby">      self.commented_on_created_reflection_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="109">
          <span class="hits">4</span>
          
          <code class="ruby">      self.commented_on_commented_reflection_notification(item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_commented_on_commented_reflection_notification(reflection_comment)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="114">
          <span class="hits">3</span>
          
          <code class="ruby">    if reflection_comment.reflection</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="115">
          <span class="hits">3</span>
          
          <code class="ruby">      Notification.destroy_notification(reflection_comment, reflection_comment.person_id, reflection_comment.reflection.commenter_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_commented_on_created_reflection_notification(reflection_comment)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="120">
          <span class="hits">3</span>
          
          <code class="ruby">    if reflection_comment.reflection</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="121">
          <span class="hits">3</span>
          
          <code class="ruby">      Notification.destroy_notification(reflection_comment, reflection_comment.person_id, reflection_comment.reflection.owner)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_contributed_on_created_conversation_notification(contribution)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="126">
          <span class="hits">4</span>
          
          <code class="ruby">    if contribution.conversation</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="127">
          <span class="hits">4</span>
          
          <code class="ruby">      Notification.destroy_notification(contribution, contribution.owner, contribution.conversation.owner)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_contributed_on_contribution_notification(contribution)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="132">
          <span class="hits">4</span>
          
          <code class="ruby">    if contribution.parent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">      Notification.destroy_notification(contribution, contribution.owner, contribution.parent.owner)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_contributed_on_followed_conversation_notification(contribution)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="138">
          <span class="hits">4</span>
          
          <code class="ruby">    if contribution.conversation</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="139">
          <span class="hits">4</span>
          
          <code class="ruby">      Notification.destroy_notification(contribution, contribution.owner, contribution.conversation.subscriber_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_rated_on_contribution_notification(rating_group)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="144">
          <span class="hits">3</span>
          
          <code class="ruby">    if rating_group.contribution</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="145">
          <span class="hits">3</span>
          
          <code class="ruby">      Notification.destroy_notification(rating_group, rating_group.person_id, rating_group.contribution.owner)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_rated_on_followed_conversation_notification(rating_group)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="150">
          <span class="hits">3</span>
          
          <code class="ruby">    if rating_group.conversation</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="151">
          <span class="hits">3</span>
          
          <code class="ruby">      Notification.destroy_notification(rating_group, rating_group.person_id, rating_group.conversation.subscriber_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_reflected_on_followed_conversation_notification(reflection)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="156">
          <span class="hits">2</span>
          
          <code class="ruby">    if reflection.conversation</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="157">
          <span class="hits">2</span>
          
          <code class="ruby">      Notification.destroy_notification(reflection, reflection.owner, reflection.conversation.subscriber_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_signed_petition_on_followed_conversation_notification(petition_signature)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="162">
          <span class="hits">5</span>
          
          <code class="ruby">    if petition_signature.petition &amp;&amp; petition_signature.petition.conversation</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="163">
          <span class="hits">5</span>
          
          <code class="ruby">      Notification.destroy_notification(petition_signature, petition_signature.person_id, petition_signature.petition.conversation.subscriber_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_for(item)</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="168">
          <span class="hits">24</span>
          
          <code class="ruby">    case item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">    when Contribution</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="170">
          <span class="hits">4</span>
          
          <code class="ruby">      self.destroy_contributed_on_created_conversation_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="171">
          <span class="hits">4</span>
          
          <code class="ruby">      self.destroy_contributed_on_contribution_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="172">
          <span class="hits">4</span>
          
          <code class="ruby">      self.destroy_contributed_on_followed_conversation_notification(item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">    when RatingGroup</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="174">
          <span class="hits">3</span>
          
          <code class="ruby">      self.destroy_rated_on_contribution_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="175">
          <span class="hits">3</span>
          
          <code class="ruby">      self.destroy_rated_on_followed_conversation_notification(item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">    when Reflection</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="177">
          <span class="hits">2</span>
          
          <code class="ruby">      self.destroy_reflected_on_followed_conversation_notification(item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">    when SurveyResponse</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="179">
          <span class="hits">4</span>
          
          <code class="ruby">      self.destroy_voted_on_followed_conversation_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="180">
          <span class="hits">4</span>
          
          <code class="ruby">      self.destroy_voted_on_created_vote_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="181">
          <span class="hits">4</span>
          
          <code class="ruby">      self.destroy_voted_on_voted_vote_notification(item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">    when PetitionSignature</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="183">
          <span class="hits">5</span>
          
          <code class="ruby">      self.destroy_signed_petition_on_followed_conversation_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="184">
          <span class="hits">5</span>
          
          <code class="ruby">      self.destroy_signed_on_created_petition_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="185">
          <span class="hits">5</span>
          
          <code class="ruby">      self.destroy_signed_on_signed_petition_notification(item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">    when ReflectionComment</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="187">
          <span class="hits">3</span>
          
          <code class="ruby">      self.destroy_commented_on_created_reflection_notification(item)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="188">
          <span class="hits">3</span>
          
          <code class="ruby">      self.destroy_commented_on_commented_reflection_notification(item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_signed_on_created_petition_notification(petition_signature)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="193">
          <span class="hits">5</span>
          
          <code class="ruby">    if petition_signature.petition</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="194">
          <span class="hits">5</span>
          
          <code class="ruby">      Notification.destroy_notification(petition_signature, petition_signature.person_id, petition_signature.petition.person_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_signed_on_signed_petition_notification(petition_signature)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="199">
          <span class="hits">5</span>
          
          <code class="ruby">    if petition_signature.petition</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="200">
          <span class="hits">5</span>
          
          <code class="ruby">      Notification.destroy_notification(petition_signature, petition_signature.person_id, petition_signature.petition.signer_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_notification(item, person_id, receiver_id)</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="205">
          <span class="hits">51</span>
          
          <code class="ruby">    receiver_id.delete(person_id) if receiver_id.is_a?(Array)</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="206">
          <span class="hits">51</span>
          
          <code class="ruby">    if person_id != receiver_id</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="207">
          <span class="hits">50</span>
          
          <code class="ruby">      Notification.destroy_all(:item_id =&gt; item.id, :item_type =&gt; item.class.name, :person_id =&gt; person_id, :receiver_id =&gt;  receiver_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_voted_on_created_vote_notification(survey_response)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="212">
          <span class="hits">4</span>
          
          <code class="ruby">    if survey_response.survey &amp;&amp; survey_response.survey.conversation</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="213">
          <span class="hits">3</span>
          
          <code class="ruby">      Notification.destroy_notification(survey_response, survey_response.person_id, survey_response.survey.person_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="217">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_voted_on_followed_conversation_notification(survey_response)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="218">
          <span class="hits">4</span>
          
          <code class="ruby">    if survey_response.survey &amp;&amp; survey_response.survey.conversation</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="219">
          <span class="hits">3</span>
          
          <code class="ruby">      Notification.destroy_notification(survey_response, survey_response.person_id, survey_response.survey.conversation.subscriber_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy_voted_on_voted_vote_notification(survey_response)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="224">
          <span class="hits">4</span>
          
          <code class="ruby">    if survey_response.survey</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="225">
          <span class="hits">4</span>
          
          <code class="ruby">      Notification.destroy_notification(survey_response, survey_response.person_id, survey_response.survey.respondent_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.signed_on_created_petition_notification(petition_signature)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="230">
          <span class="hits">11</span>
          
          <code class="ruby">    if petition_signature.petition</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="231">
          <span class="hits">11</span>
          
          <code class="ruby">      Notification.update_or_create_notification(petition_signature, petition_signature.person_id, petition_signature.petition.person_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.rated_on_contribution_notification(rating_group)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="236">
          <span class="hits">8</span>
          
          <code class="ruby">    if rating_group.contribution</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="237">
          <span class="hits">8</span>
          
          <code class="ruby">      Notification.update_or_create_notification(rating_group, rating_group.person_id, rating_group.contribution.owner)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.signed_petition_on_followed_conversation_notification(petition_signature)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="242">
          <span class="hits">11</span>
          
          <code class="ruby">    if petition_signature.petition &amp;&amp; petition_signature.petition.conversation</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="243">
          <span class="hits">11</span>
          
          <code class="ruby">      Notification.update_or_create_notification(petition_signature, petition_signature.person_id, petition_signature.petition.conversation.subscriber_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="246">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.signed_on_signed_petition_notification(petition_signature)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="248">
          <span class="hits">11</span>
          
          <code class="ruby">    if petition_signature.petition</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="249">
          <span class="hits">11</span>
          
          <code class="ruby">      Notification.update_or_create_notification(petition_signature, petition_signature.person_id, petition_signature.petition.signer_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.rated_on_followed_conversation_notification(rating_group)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="254">
          <span class="hits">7</span>
          
          <code class="ruby">    if rating_group.conversation</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="255">
          <span class="hits">7</span>
          
          <code class="ruby">      Notification.update_or_create_notification(rating_group, rating_group.person_id, rating_group.conversation.subscriber_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.reflected_on_followed_conversation_notification(reflection)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="260">
          <span class="hits">7</span>
          
          <code class="ruby">    if reflection.conversation</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="261">
          <span class="hits">7</span>
          
          <code class="ruby">      Notification.update_or_create_notification(reflection, reflection.owner, reflection.conversation.subscriber_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="265">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.update_or_create_notification(item, person_id, receiver_id)</code>
        </li>
      
        <li class="covered" data-hits="159" data-linenumber="266">
          <span class="hits">159</span>
          
          <code class="ruby">    if receiver_id.is_a?(Array)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="267">
          <span class="hits">86</span>
          
          <code class="ruby">      Notification.update_or_create_multiple_notifications(item, person_id, receiver_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="73" data-linenumber="269">
          <span class="hits">73</span>
          
          <code class="ruby">      Notification.update_or_create_single_notification(item, person_id, receiver_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="270">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="273">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.update_or_create_single_notification(item, person_id, receiver_id)</code>
        </li>
      
        <li class="covered" data-hits="198" data-linenumber="274">
          <span class="hits">198</span>
          
          <code class="ruby">    if person_id != receiver_id</code>
        </li>
      
        <li class="covered" data-hits="172" data-linenumber="275">
          <span class="hits">172</span>
          
          <code class="ruby">      notification = Notification.where(:item_id =&gt; item.id, :item_type =&gt; item.class.name, :person_id =&gt; person_id, :receiver_id =&gt; receiver_id).first</code>
        </li>
      
        <li class="covered" data-hits="172" data-linenumber="276">
          <span class="hits">172</span>
          
          <code class="ruby">      if notification</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="277">
          <span class="hits">20</span>
          
          <code class="ruby">        notification.attributes = Notification.new(item).attributes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="152" data-linenumber="279">
          <span class="hits">152</span>
          
          <code class="ruby">        notification = Notification.new(item)</code>
        </li>
      
        <li class="covered" data-hits="152" data-linenumber="280">
          <span class="hits">152</span>
          
          <code class="ruby">        notification.receiver_id = receiver_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="172" data-linenumber="282">
          <span class="hits">172</span>
          
          <code class="ruby">      notification.save</code>
        </li>
      
        <li class="covered" data-hits="172" data-linenumber="283">
          <span class="hits">172</span>
          
          <code class="ruby">      return notification</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="287">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.update_or_create_multiple_notifications(item, person_id, receiver_ids)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="288">
          <span class="hits">86</span>
          
          <code class="ruby">    receiver_ids.each do |receiver_id|</code>
        </li>
      
        <li class="covered" data-hits="125" data-linenumber="289">
          <span class="hits">125</span>
          
          <code class="ruby">      Notification.update_or_create_single_notification(item, person_id, receiver_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">  # Check if item is a valid type for Activity</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.valid_type?(item)</code>
        </li>
      
        <li class="covered" data-hits="178" data-linenumber="295">
          <span class="hits">178</span>
          
          <code class="ruby">    ok = false</code>
        </li>
      
        <li class="covered" data-hits="178" data-linenumber="296">
          <span class="hits">178</span>
          
          <code class="ruby">    VALID_TYPES.each do |type|</code>
        </li>
      
        <li class="covered" data-hits="843" data-linenumber="297">
          <span class="hits">843</span>
          
          <code class="ruby">      if (item.is_a? Contribution and not item.top_level_contribution?)</code>
        </li>
      
        <li class="covered" data-hits="59" data-linenumber="298">
          <span class="hits">59</span>
          
          <code class="ruby">        ok = true</code>
        </li>
      
        <li class="covered" data-hits="59" data-linenumber="299">
          <span class="hits">59</span>
          
          <code class="ruby">        break</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">      elsif item.is_a? type and not item.is_a? Contribution</code>
        </li>
      
        <li class="covered" data-hits="109" data-linenumber="301">
          <span class="hits">109</span>
          
          <code class="ruby">        ok = true</code>
        </li>
      
        <li class="covered" data-hits="109" data-linenumber="302">
          <span class="hits">109</span>
          
          <code class="ruby">        break</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">      elsif item.is_a? GenericObject and item.__class__ == 'Contribution' and not item.top_level_contribution?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="304">
          
          
          <code class="ruby">        ok = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="305">
          
          
          <code class="ruby">        break</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">      elsif item.is_a? GenericObject and item.__class__ == type.to_s and not item.__class__ == 'Contribution'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="307">
          
          
          <code class="ruby">        ok = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="308">
          
          
          <code class="ruby">        break</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="310">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="178" data-linenumber="311">
          <span class="hits">178</span>
          
          <code class="ruby">    return ok</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.voted_on_created_vote_notification(survey_response)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="315">
          <span class="hits">14</span>
          
          <code class="ruby">    if survey_response.survey</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="316">
          <span class="hits">14</span>
          
          <code class="ruby">      Notification.update_or_create_notification(survey_response, survey_response.person_id, survey_response.survey.person_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.voted_on_followed_conversation_notification(survey_response)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="321">
          <span class="hits">14</span>
          
          <code class="ruby">    if survey_response.survey &amp;&amp; survey_response.survey.conversation</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="322">
          <span class="hits">6</span>
          
          <code class="ruby">      Notification.update_or_create_notification(survey_response, survey_response.person_id, survey_response.survey.conversation.subscriber_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.voted_on_voted_vote_notification(survey_response)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="327">
          <span class="hits">12</span>
          
          <code class="ruby">    if survey_response.survey</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="328">
          <span class="hits">12</span>
          
          <code class="ruby">      Notification.update_or_create_notification(survey_response, survey_response.person_id, survey_response.survey.respondent_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="332">
          <span class="hits">1</span>
          
          <code class="ruby">  def viewed?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="333">
          
          
          <code class="ruby">    !self.viewed_at.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="334">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">  def not_viewed?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="336">
          
          
          <code class="ruby">    self.viewed_at.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="337">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.viewed(person)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="340">
          
          
          <code class="ruby">    notifications = self.where(&quot;receiver_id = ?&quot;, person).where(&quot;viewed_at is null&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="341">
          
          
          <code class="ruby">    notifications.update_all(:viewed_at =&gt; Time.now)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="343">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="344">
          
          
          <code class="ruby">  # Retrieve list of Old Notifications</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">  # Purpose:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">  # * We'll want to clean up Old Notifications.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">  # * This will probably be a two step process.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">  # ** Old viewed Notifications</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">  # ** Older unviewed Notifications.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="351">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby">  # Options:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby">  # * before: Find Notifications older than before date</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="354">
          
          
          <code class="ruby">  # * viewed: Find Notifications that have been viewed (default:false)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.old_notifications(options = {})</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="356">
          
          
          <code class="ruby">    options.reverse_merge!({before:14.days.ago, viewed:false})</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="357">
          
          
          <code class="ruby">    notifications = Notification.where(&quot;created_at &lt; ?&quot;, options[:before])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="358">
          
          
          <code class="ruby">    notifications = notifications.where(&quot;viewed_at is null&quot;) unless options[:viewed]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="359">
          
          
          <code class="ruby">    notifications</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby">  # List of Users That Have Notifications</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.users_with_notifications</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="364">
          <span class="hits">7</span>
          
          <code class="ruby">    Notification.group(&quot;person_id&quot;).collect{|n| n.person_id}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="367">
          
          
          <code class="ruby">  # Purge notifications over limit for each user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.limit_notifications_per_user(options = {})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">    options.reverse_merge!({limit:50, log:false})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">    puts &quot;* limit_notifications set to #{options[:limit]} notifications&quot; if options[:log]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">    users = Notification.users_with_notifications</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">    users.each do |user|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">      user_notifications = Notification.where('receiver_id = ?', user).order(&quot;created_at desc&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">      if user_notifications.count &gt; options[:limit]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="377">
          <span class="hits">1</span>
          
          <code class="ruby">        puts &quot;* limit_notifications: #{Person.find(user).name} has #{user_notifications.count} notifications&quot; if options[:log]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="378">
          <span class="hits">1</span>
          
          <code class="ruby">        newest_notifications = user_notifications.limit(options[:limit]).all</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="379">
          <span class="hits">1</span>
          
          <code class="ruby">        Notification.where('receiver_id = ?', user).destroy_all(['id NOT IN (?)', newest_notifications.collect(&amp;:id)])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="382">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="408e449ce5258753d7df0bf7d1850f4d7cdb8c49">
  <div class="header">
    <h3>app/models/organization.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Organization &lt; Person</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include Subscribable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :authorized_to_setup_an_account</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :organization_members, uniq: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :members,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    class_name: 'Person',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    source: :person,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    through: :organization_members,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    uniq: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_acceptance_of :authorized_to_setup_an_account, :on =&gt; :create, :message =&gt; 'must be checked.'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  alias_attribute :name, :last_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  define_method(:title) do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="19">
          <span class="hits">2</span>
          
          <code class="ruby">    name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def allow_facebook_connect?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">    false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_member?(person)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="27">
          <span class="hits">8</span>
          
          <code class="ruby">    !person.blank? &amp;&amp; self.members.exists?(person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def join_as_member(person)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="31">
          <span class="hits">7</span>
          
          <code class="ruby">    self.members &lt;&lt; person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def remove_member(person)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="35">
          <span class="hits">2</span>
          
          <code class="ruby">    self.members.delete(person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4dd7e370970bdc6fa2e35cbe8191771d0ab0f74b">
  <div class="header">
    <h3>app/models/organization_detail.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class OrganizationDetail &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_address?</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="3">
          <span class="hits">6</span>
          
          <code class="ruby">        street.present? or city.present? or region.present? or postal_code.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="97d7d59418146858c971dfe0e64fce03454b1c9f">
  <div class="header">
    <h3>app/models/organization_member.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class OrganizationMember &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :organization</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="acce817e34a6719cc32dd254ee768a8eb1c6497d">
  <div class="header">
    <h3>app/models/password_salt_validator.rb</h3>
    <h4><span class="red">60.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'bcrypt'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">class PasswordSaltValidator &lt; ActiveModel::Validator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # Ensure the salt is a valid bcrypt salt since the salt can be assigned</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # via People Aggregator API updates.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # NOTE this is a very leaky abstraction in that it assumes BCrypt is the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  # password encryption algorithm</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate(record)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    if record.password_salt &amp;&amp; !BCrypt::Engine.valid_salt?(record.password_salt)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      record.errors[:password_salt] &lt;&lt; &quot;Invalid salt format&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3ea6b67d6d5018ec766b7d50f10ee965a6fe72ad">
  <div class="header">
    <h3>app/models/person.rb</h3>
    <h4><span class="green">94.58 %</span> covered</h4>
    <div>
      <b>240</b> relevant lines. 
      <span class="green"><b>227</b> lines covered</span> and
      <span class="red"><b>13</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Person &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend FriendlyId</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include Regionable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include GeometryForStyle</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  include UnsubscribeSomeone</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  searchable :if =&gt; :confirmed?, :unless =&gt; :locked?,</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    :ignore_attribute_changes_of =&gt; [ :updated_at, :failed_attempts, :current_sign_in_at, :last_sign_in_at, :current_sign_in_ip, :confirmed_at, :sign_in_count, :avatar_cached_image_url ] do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    text :first_name, :boost =&gt; 2, :default_boost =&gt; 2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    text :last_name, :boost =&gt; 2, :default_boost =&gt; 2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    text :bio, :stored =&gt; true, :boost =&gt; 1, :default_boost =&gt; 1 do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      Sanitize.clean(bio, :remove_contents =&gt; ['style','script'])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # Include default devise modules. Others available are:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  # :token_authenticatable, :confirmable, and :timeoutable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  devise :database_authenticatable,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">         :registerable,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">         :recoverable,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">         :rememberable,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">         :trackable,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">         :validatable,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">         :confirmable,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">         :lockable,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">         :omniauthable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :send_welcome,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">                :create_from_auth,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">                :facebook_unlinking,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">                :send_email_change_notification,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">                :require_zip_code</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  # Setup accessible attributes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible :name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">                  :first_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">                  :last_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">                  :email,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">                  :password,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">                  :password_confirmation,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">                  :bio,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">                  :website,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">                  :twitter_username,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">                  :zip_code,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">                  :admin,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">                  :validated,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">                  :avatar,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">                  :remember_me,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">                  :daily_digest,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">                  :create_from_auth,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">                  :facebook_unlinking</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  # Setup protected attributes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_protected :admin, :blog_admin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :authentications, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :organization_members</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :organizations,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    through: :organization_members,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    uniq: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  accepts_nested_attributes_for :authentications</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  has_one :facebook_authentication, :class_name =&gt; 'Authentication', :conditions =&gt; {:provider =&gt; 'facebook'}, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :content_items_people</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :content_items, :through =&gt; :content_items_people, :foreign_key =&gt; 'person_id', :dependent =&gt; :restrict</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :conversations_people, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :conversations, :through =&gt; :conversations_people, :foreign_key =&gt; 'person_id', :dependent =&gt; :restrict</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :authored_content_items, :class_name =&gt; 'ContentItem', :foreign_key =&gt; 'person_id', :dependent =&gt; :restrict</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :content_templates, :foreign_key =&gt; 'person_id', :dependent =&gt; :restrict</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :contributions, :foreign_key =&gt; 'owner', :uniq =&gt; true, :dependent =&gt; :restrict</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :managed_issue_pages, :foreign_key =&gt; 'person_id', :dependent =&gt; :restrict</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :rating_groups, :dependent =&gt; :restrict</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :subscriptions, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :survey_responses</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">  has_one :organization_detail</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :contributed_conversations, :through =&gt; :contributions, :source =&gt; :conversation, :uniq =&gt; true, :dependent =&gt; :restrict</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :contributed_issues, :through =&gt; :contributions, :source =&gt; :issue, :uniq =&gt; true, :dependent =&gt; :restrict</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :petition_signatures, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :signed_petitions, :class_name =&gt; 'Petition', :through =&gt; :petition_signatures, :source =&gt; :petition</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_length_of :email, :within =&gt; 6..255, :too_long =&gt; &quot;please use a shorter email address&quot;, :too_short =&gt; &quot;please use a longer email address&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :zip_code, :message =&gt; ' please enter zipcode'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_length_of :zip_code, :message =&gt; ' must be 5 characters or higher', :within =&gt; (5..10), :allow_blank =&gt; false, :allow_nil =&gt; false</code>
        </li>
      
        <li class="covered" data-hits="3141" data-linenumber="90">
          <span class="hits">3141</span>
          
          <code class="ruby">  validates_presence_of :first_name, :last_name, :if =&gt; Proc.new{|record| record.type != 'Organization'}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :check_twitter_username_format</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">  friendly_id :name, :use =&gt; :slugged</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">  def should_generate_new_friendly_id?</code>
        </li>
      
        <li class="covered" data-hits="3140" data-linenumber="95">
          <span class="hits">3140</span>
          
          <code class="ruby">    new_record? || slug.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">  def participated_actions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">    # To do: need to merge this array with vote when we integrate them with vote</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">    self.signed_petitions.collect(&amp;:action).compact.uniq</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">  def participated_actions_for_conversation(conversation)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">    participated_actions.delete_if{|action|action.conversation_id != conversation.id}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">  # Ensure format of salt</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  # Commented out because devise 1.2.RC doesn't store password_salt column anymore, if it uses bcrypt</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  # validates_with PasswordSaltValidator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">  has_attached_file :avatar,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">    :styles =&gt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      :small =&gt; &quot;20x20#&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">      :medium =&gt; &quot;40x40#&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">      :standard =&gt; &quot;70x70#&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">      :large =&gt; &quot;185x185#&quot;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">    :storage =&gt; :s3,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    :s3_credentials =&gt; S3Config.credential_file,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">    :default_url =&gt; &quot;http://s3.amazonaws.com/#{S3Config.bucket.to_s}/avatars/default/avatar_70.gif&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">    :path =&gt; &quot;:attachment/:id/:style/:filename&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_attachment_content_type :avatar,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">                                    :content_type =&gt; /image\/*/,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">                                    :message =&gt; &quot;Not a valid image file.&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">  process_in_background :avatar</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :participants_of_issue, lambda{ |issue|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="128">
          
          
          <code class="ruby">      joins(:conversations =&gt; :issues).where(['issue_id = ?',issue.id]).select('DISTINCT(people.id),people.*') if issue</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :real_accounts, where(&quot;proxy is not true&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :proxy_accounts, where(:proxy =&gt; true)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :confirmed_accounts, where(&quot;confirmed_at is not null&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :unconfirmed_accounts, where(:confirmed_at =&gt; nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :only_people, where(:type =&gt; nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :only_organizations, where(:type =&gt; 'Organization')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :conversations, :to =&gt; :subscriptions, :prefix =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :issues,        :to =&gt; :subscriptions, :prefix =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :organizations, :to =&gt; :subscriptions, :prefix =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">  # All these emails could be moved to an observer - Jerry</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">  after_create :notify_civic_commons</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">  before_save :check_to_send_welcome_email</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">  after_save :send_welcome_email, :if =&gt; :send_welcome?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">  around_save :update_newsletter_subscription</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">  around_update :check_to_notify_email_change, :if =&gt; :send_email_change_notification?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_email_change_notification?</code>
        </li>
      
        <li class="covered" data-hits="222" data-linenumber="151">
          <span class="hits">222</span>
          
          <code class="ruby">    @send_email_change_notification || false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_to_notify_email_change</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="155">
          <span class="hits">7</span>
          
          <code class="ruby">    old_email, new_email = self.email_change</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="156">
          <span class="hits">7</span>
          
          <code class="ruby">    yield</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="157">
          <span class="hits">7</span>
          
          <code class="ruby">    Notifier.email_changed(old_email, new_email).deliver if old_email &amp;&amp; new_email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_confirmation_instructions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    # if spam don't send confirmation</code>
        </li>
      
        <li class="covered" data-hits="328" data-linenumber="162">
          <span class="hits">328</span>
          
          <code class="ruby">    SpamService.spam?(email) ? false : super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">  def newly_confirmed?</code>
        </li>
      
        <li class="covered" data-hits="3208" data-linenumber="166">
          <span class="hits">3208</span>
          
          <code class="ruby">    confirmed_at_changed? &amp;&amp; confirmed_at_was.blank? &amp;&amp; !confirmed_at.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">  def subscribed_to? mailing_type</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="169">
          <span class="hits">2</span>
          
          <code class="ruby">    send(mailing_type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_default_region(metrocode)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="173">
          <span class="hits">2</span>
          
          <code class="ruby">    self.update_attribute(:default_region, metrocode) if MetroRegion.find_by_metrocode(metrocode)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_to_send_welcome_email</code>
        </li>
      
        <li class="covered" data-hits="3208" data-linenumber="177">
          <span class="hits">3208</span>
          
          <code class="ruby">    @send_welcome = true if newly_confirmed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_from_auth?</code>
        </li>
      
        <li class="covered" data-hits="6120" data-linenumber="181">
          <span class="hits">6120</span>
          
          <code class="ruby">    @create_from_auth || false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">  def display_name</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="185">
          <span class="hits">18</span>
          
          <code class="ruby">    self.last_name.blank? || self.first_name.blank? ? self.name : &quot;#{self.last_name}, #{self.first_name}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">  def avatar_width_for_style(style)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="189">
          
          
          <code class="ruby">    geometry_for_style(style, :avatar).width.to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">  def avatar_height_for_style(style)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="193">
          
          
          <code class="ruby">    geometry_for_style(style, :avatar).height.to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">  def facebook_unlinking?</code>
        </li>
      
        <li class="covered" data-hits="228" data-linenumber="197">
          <span class="hits">228</span>
          
          <code class="ruby">    @facebook_unlinking || false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">  def locked?</code>
        </li>
      
        <li class="covered" data-hits="3232" data-linenumber="201">
          <span class="hits">3232</span>
          
          <code class="ruby">    not self.locked_at.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">  def require_zip_code?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="205">
          
          
          <code class="ruby">    @require_zip_code || false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">  def name=(value)</code>
        </li>
      
        <li class="covered" data-hits="107" data-linenumber="209">
          <span class="hits">107</span>
          
          <code class="ruby">    @name = value</code>
        </li>
      
        <li class="covered" data-hits="107" data-linenumber="210">
          <span class="hits">107</span>
          
          <code class="ruby">    self.first_name, self.last_name = self.class.parse_name(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">  def name</code>
        </li>
      
        <li class="covered" data-hits="8705" data-linenumber="214">
          <span class="hits">8705</span>
          
          <code class="ruby">    @name ||= (&quot;%s %s&quot; % [self.first_name, self.last_name]).strip</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="217">
          <span class="hits">1</span>
          
          <code class="ruby">  def on_facebook_auth?</code>
        </li>
      
        <li class="covered" data-hits="125" data-linenumber="218">
          <span class="hits">125</span>
          
          <code class="ruby">    create_from_auth? || facebook_unlinking?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">  def notify_civic_commons</code>
        </li>
      
        <li class="covered" data-hits="2986" data-linenumber="222">
          <span class="hits">2986</span>
          
          <code class="ruby">    Notifier.new_registration_notification(self).deliver</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_welcome?</code>
        </li>
      
        <li class="covered" data-hits="3208" data-linenumber="226">
          <span class="hits">3208</span>
          
          <code class="ruby">    @send_welcome</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_welcome_email</code>
        </li>
      
        <li class="covered" data-hits="2660" data-linenumber="230">
          <span class="hits">2660</span>
          
          <code class="ruby">    Notifier.welcome(self).deliver</code>
        </li>
      
        <li class="covered" data-hits="2660" data-linenumber="231">
          <span class="hits">2660</span>
          
          <code class="ruby">    @send_welcome = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="234">
          <span class="hits">1</span>
          
          <code class="ruby">  def short_name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">    self.first_name.blank? ? self.name : self.first_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">  # A valid zip code is composed of:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">  # * base, and</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">  # * optionally the extension</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">  # Typical Format: 12345-1234</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">  def base_zip_code</code>
        </li>
      
        <li class="covered" data-hits="2990" data-linenumber="244">
          <span class="hits">2990</span>
          
          <code class="ruby">    zip_code.respond_to?(:to_s) ? zip_code.to_s.gsub(/\-.*/, '') : ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="246">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">  # Short zip code is the base zip code unless it is too short or long, then it is blank</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="248">
          <span class="hits">1</span>
          
          <code class="ruby">  def short_zip_code</code>
        </li>
      
        <li class="covered" data-hits="2986" data-linenumber="249">
          <span class="hits">2986</span>
          
          <code class="ruby">    short_zip = base_zip_code</code>
        </li>
      
        <li class="covered" data-hits="2986" data-linenumber="250">
          <span class="hits">2986</span>
          
          <code class="ruby">    if short_zip.size &lt; 4 or short_zip.size &gt; 5</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="251">
          <span class="hits">4</span>
          
          <code class="ruby">      ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2982" data-linenumber="253">
          <span class="hits">2982</span>
          
          <code class="ruby">      short_zip</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="254">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">  def most_recent_activity</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="258">
          <span class="hits">10</span>
          
          <code class="ruby">    Activity.most_recent_activity_items(person:self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="260">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_all_by_name(name)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="262">
          <span class="hits">3</span>
          
          <code class="ruby">    first, last = parse_name(name)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="263">
          <span class="hits">3</span>
          
          <code class="ruby">    where(:first_name =&gt; first, :last_name =&gt; last)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_confirmed_order_by_recency(person_ids=nil)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="267">
          <span class="hits">13</span>
          
          <code class="ruby">    person = Person.order('confirmed_at DESC').where('confirmed_at IS NOT NULL').where('locked_at IS NULL')</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="268">
          <span class="hits">13</span>
          
          <code class="ruby">    if not person_ids.nil?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="269">
          <span class="hits">3</span>
          
          <code class="ruby">      person = person.where('confirmed_at IS NOT NULL')</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="270">
          <span class="hits">3</span>
          
          <code class="ruby">      person = person.where('locked_at IS NULL')</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="271">
          <span class="hits">3</span>
          
          <code class="ruby">      person = person.where({ 'people.id' =&gt; person_ids})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="273">
          <span class="hits">13</span>
          
          <code class="ruby">    return person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_confirmed_order_by_most_active(person_ids=nil)</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="277">
          <span class="hits">27</span>
          
          <code class="ruby">    person = Person.select(&quot;people.*, count(ti.person_id)&quot;).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">      joins('left outer join top_items ti on people.id = ti.person_id').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">      group('people.id').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">      order('count(ti.person_id) DESC').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">      where('confirmed_at IS NOT NULL AND locked_at IS NULL')</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="282">
          <span class="hits">27</span>
          
          <code class="ruby">    if not person_ids.nil?</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="283">
          <span class="hits">25</span>
          
          <code class="ruby">      person = person.where(&quot;confirmed_at IS NOT NULL AND locked_at IS NULL&quot;)</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="284">
          <span class="hits">25</span>
          
          <code class="ruby">      person = person.where({ 'people.id' =&gt; person_ids})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="286">
          <span class="hits">27</span>
          
          <code class="ruby">    return person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_confirmed_order_by_last_name(letter = nil, person_ids=nil)</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="290">
          <span class="hits">17</span>
          
          <code class="ruby">    person = Person</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="291">
          <span class="hits">17</span>
          
          <code class="ruby">    if not person_ids.nil?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="292">
          <span class="hits">3</span>
          
          <code class="ruby">      person = person.where({ 'people.id' =&gt; person_ids})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="295">
          <span class="hits">17</span>
          
          <code class="ruby">    if letter.nil?</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="296">
          <span class="hits">9</span>
          
          <code class="ruby">      person = person.order('blank_last_name, last_name, first_name ASC').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby">        where('confirmed_at IS NOT NULL and locked_at IS NULL').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">        select(&quot;*, IF(last_name IS NULL OR last_name='' OR UCASE(SUBSTR(last_name, 1) NOT BETWEEN 'A' AND 'Z'), 1, 0) as blank_last_name&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="300">
          <span class="hits">8</span>
          
          <code class="ruby">      person = person.order('last_name, first_name ASC').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">        where('confirmed_at IS NOT NULL').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">        where(&quot;last_name like '#{letter}%'&quot;).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">        where('locked_at IS NULL')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="305">
          <span class="hits">17</span>
          
          <code class="ruby">    return person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="307">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby">  # Takes a full name and return an array of first and last name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby">  # Examples</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="310">
          
          
          <code class="ruby">  #  &quot;Wendy&quot; =&gt; [&quot;Wendy&quot;, &quot;&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">  #  &quot;Wendy Smith&quot; =&gt; [&quot;Wendy&quot;, &quot;Smith&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">  #  &quot;Wendy van Buren&quot; =&gt; [&quot;Wendy&quot;, &quot;van Buren&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.parse_name(name)</code>
        </li>
      
        <li class="covered" data-hits="115" data-linenumber="315">
          <span class="hits">115</span>
          
          <code class="ruby">    first, *last = name.split(' ')</code>
        </li>
      
        <li class="covered" data-hits="115" data-linenumber="316">
          <span class="hits">115</span>
          
          <code class="ruby">    last = last.try(:join, &quot; &quot;) || &quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="115" data-linenumber="317">
          <span class="hits">115</span>
          
          <code class="ruby">    return first, last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_proxy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="321">
          
          
          <code class="ruby">    self.email = (first_name + last_name).gsub(/['\s]/,'').downcase + &quot;@example.com&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="322">
          
          
          <code class="ruby">    self.password = 'p4s$w0Rd'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="323">
          
          
          <code class="ruby">    self.proxy = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">  def subscriptions_include?(subscribable)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="327">
          
          
          <code class="ruby">    subscriptions.map(&amp;:subscribable).include?(subscribable)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">  def unlink_from_facebook(person_hash)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="331">
          <span class="hits">12</span>
          
          <code class="ruby">    ActiveRecord::Base.transaction do</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="332">
          <span class="hits">12</span>
          
          <code class="ruby">      self.email = person_hash[:email]</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="333">
          <span class="hits">12</span>
          
          <code class="ruby">      self.password = person_hash[:password]</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="334">
          <span class="hits">12</span>
          
          <code class="ruby">      self.password_confirmation = person_hash[:password_confirmation]</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="335">
          <span class="hits">12</span>
          
          <code class="ruby">      self.facebook_unlinking = true</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="336">
          <span class="hits">12</span>
          
          <code class="ruby">      self.send_email_change_notification = true # sends email change notification</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="337">
          <span class="hits">12</span>
          
          <code class="ruby">      save!</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="338">
          <span class="hits">7</span>
          
          <code class="ruby">      self.facebook_authentication.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="340">
          
          
          <code class="ruby">  rescue</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="341">
          <span class="hits">5</span>
          
          <code class="ruby">    self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="343">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_newsletter_subscription</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">    # store if it's a new record before save since *_changed? only works with existing models</code>
        </li>
      
        <li class="covered" data-hits="3208" data-linenumber="346">
          <span class="hits">3208</span>
          
          <code class="ruby">    new_record = new_record?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3208" data-linenumber="348">
          <span class="hits">3208</span>
          
          <code class="ruby">    yield</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3208" data-linenumber="350">
          <span class="hits">3208</span>
          
          <code class="ruby">    if new_record or weekly_newsletter_changed?</code>
        </li>
      
        <li class="covered" data-hits="2992" data-linenumber="351">
          <span class="hits">2992</span>
          
          <code class="ruby">      if weekly_newsletter</code>
        </li>
      
        <li class="covered" data-hits="2982" data-linenumber="352">
          <span class="hits">2982</span>
          
          <code class="ruby">        add_newsletter_subscription</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="354">
          <span class="hits">10</span>
          
          <code class="ruby">        remove_newsletter_subscription</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="358">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">  def avatar_path(style='')</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="360">
          
          
          <code class="ruby">    self.avatar.path(style)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">  # https://graph.facebook.com/#{uid}/picture</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">  # optional params: type=small|square|large</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">  # square (50x50), small (50 pixels wide, variable height), and large (about 200 pixels wide, variable height):</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">  def facebook_profile_pic_url(type = :square)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="367">
          <span class="hits">3</span>
          
          <code class="ruby">    &quot;https://graph.facebook.com/#{facebook_authentication.uid}/picture?type=#{type}&quot; if facebook_authenticated?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="369">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">  def allow_facebook_connect?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby">    # override this in the subclass</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="372">
          <span class="hits">4</span>
          
          <code class="ruby">    true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="373">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="374">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">  def facebook_authenticated?</code>
        </li>
      
        <li class="covered" data-hits="6341" data-linenumber="376">
          <span class="hits">6341</span>
          
          <code class="ruby">    !facebook_authentication.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="379">
          <span class="hits">1</span>
          
          <code class="ruby">  def link_with_facebook(authentication)</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="380">
          <span class="hits">36</span>
          
          <code class="ruby">    begin </code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="381">
          <span class="hits">36</span>
          
          <code class="ruby">      ActiveRecord::Base.transaction do</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="382">
          <span class="hits">36</span>
          
          <code class="ruby">        self.facebook_authentication = authentication</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="383">
          <span class="hits">33</span>
          
          <code class="ruby">        self.encrypted_password = ''</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="384">
          <span class="hits">33</span>
          
          <code class="ruby">        self.create_from_auth = true</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="385">
          <span class="hits">33</span>
          
          <code class="ruby">        save!</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="386">
          <span class="hits">33</span>
          
          <code class="ruby">        AvatarService.update_avatar_url_for(self)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="387">
          <span class="hits">33</span>
          
          <code class="ruby">        facebook_authentication.persisted?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="388">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="389">
          <span class="hits">3</span>
          
          <code class="ruby">    rescue ActiveRecord::RecordNotSaved</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="390">
          <span class="hits">3</span>
          
          <code class="ruby">      return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="394">
          <span class="hits">1</span>
          
          <code class="ruby">  def conflicting_email?(other_email)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="395">
          <span class="hits">11</span>
          
          <code class="ruby">    if other_email.blank? || (other_email.to_s.downcase.strip == email.to_s.downcase.strip)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="396">
          <span class="hits">9</span>
          
          <code class="ruby">      false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="397">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="398">
          <span class="hits">2</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="399">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="400">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="401">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="402">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="403">
          
          
          <code class="ruby">  # Avatar Image Cache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="404">
          
          
          <code class="ruby">  # The cached avatar image url as determined by the AvatarService.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">  def avatar_image_url</code>
        </li>
      
        <li class="covered" data-hits="1081" data-linenumber="406">
          <span class="hits">1081</span>
          
          <code class="ruby">    if self.avatar_cached_image_url.blank?</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="407">
          <span class="hits">9</span>
          
          <code class="ruby">      self.avatar_cached_image_url = AvatarService.avatar_image_url(self)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="408">
          <span class="hits">9</span>
          
          <code class="ruby">      save(:validate =&gt; false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1081" data-linenumber="410">
          <span class="hits">1081</span>
          
          <code class="ruby">    self.avatar_cached_image_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="414">
          
          
          <code class="ruby">  # Overiding Devise::Models::DatabaseAuthenticatable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="415">
          
          
          <code class="ruby">  # due to needing to set encrypted_password to blank, so that it doesn't error out when it is set to nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">  def valid_password?(password)</code>
        </li>
      
        <li class="covered" data-hits="125" data-linenumber="417">
          <span class="hits">125</span>
          
          <code class="ruby">    encrypted_password.blank? ? false : super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="418">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="419">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.build_from_auth_hash(auth_hash)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="421">
          <span class="hits">5</span>
          
          <code class="ruby">    new_person = new(:name =&gt; auth_hash['info']['name'],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby">        :email =&gt; Authentication.email_from_auth_hash(auth_hash),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">        :encrypted_password =&gt; '',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">        :create_from_auth =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="426">
          <span class="hits">5</span>
          
          <code class="ruby">    new_person.authentications &lt;&lt; Authentication.new_from_auth_hash(auth_hash)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="427">
          <span class="hits">5</span>
          
          <code class="ruby">    new_person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="430">
          
          
          <code class="ruby">  # overriding devise's recoverable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.send_reset_password_instructions(attributes={})</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="432">
          <span class="hits">3</span>
          
          <code class="ruby">    recoverable = find_or_initialize_with_errors(authentication_keys, attributes, :not_found)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="433">
          <span class="hits">3</span>
          
          <code class="ruby">    recoverable.send_reset_password_instructions if recoverable.persisted? &amp;&amp; !recoverable.facebook_authenticated?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="434">
          <span class="hits">3</span>
          
          <code class="ruby">    recoverable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="435">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="436">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">  def subscribed_conversations</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="438">
          <span class="hits">9</span>
          
          <code class="ruby">    subscriptions_conversations.order('created_at desc')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="439">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="440">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="441">
          <span class="hits">1</span>
          
          <code class="ruby">  def subscribed_issues</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="442">
          <span class="hits">1</span>
          
          <code class="ruby">    subscriptions_issues.order('created_at desc')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="445">
          <span class="hits">1</span>
          
          <code class="ruby">  def subscribed_organizations</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="446">
          <span class="hits">9</span>
          
          <code class="ruby">    subscriptions_organizations.order('created_at desc')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="448">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_website?</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="450">
          <span class="hits">8</span>
          
          <code class="ruby">    attribute_present? :website</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="451">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="452">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_twitter?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="454">
          <span class="hits">5</span>
          
          <code class="ruby">    attribute_present? :twitter_username</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="455">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="457">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_email?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="458">
          
          
          <code class="ruby">    attribute_present? :email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="460">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_organization?</code>
        </li>
      
        <li class="covered" data-hits="187" data-linenumber="462">
          <span class="hits">187</span>
          
          <code class="ruby">    is_a? Organization</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="463">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="464">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="465">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_twitter_username_format</code>
        </li>
      
        <li class="covered" data-hits="3140" data-linenumber="467">
          <span class="hits">3140</span>
          
          <code class="ruby">    match = /^@?(?&lt;username&gt;.*)$/.match(self.twitter_username)</code>
        </li>
      
        <li class="covered" data-hits="3140" data-linenumber="468">
          <span class="hits">3140</span>
          
          <code class="ruby">    self.twitter_username = match[:username] unless match.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="469">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="470">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="471">
          <span class="hits">1</span>
          
          <code class="ruby">  def password_required?</code>
        </li>
      
        <li class="covered" data-hits="6285" data-linenumber="472">
          <span class="hits">6285</span>
          
          <code class="ruby">    if facebook_authenticated?</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="473">
          <span class="hits">106</span>
          
          <code class="ruby">      facebook_unlinking? ? true : false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="6179" data-linenumber="475">
          <span class="hits">6179</span>
          
          <code class="ruby">      (!persisted? &amp;&amp; !create_from_auth?) || password.present? || password_confirmation.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="476">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="477">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">  def add_newsletter_subscription</code>
        </li>
      
        <li class="covered" data-hits="2981" data-linenumber="480">
          <span class="hits">2981</span>
          
          <code class="ruby">    if Civiccommons::Config.mailer['mailchimp']</code>
        </li>
      
        <li class="covered" data-hits="2981" data-linenumber="481">
          <span class="hits">2981</span>
          
          <code class="ruby">      merge_tags = { :FNAME =&gt; first_name, :LNAME =&gt; last_name, :ZIP =&gt; short_zip_code }</code>
        </li>
      
        <li class="covered" data-hits="11924" data-linenumber="482">
          <span class="hits">11924</span>
          
          <code class="ruby">      merge_tags = merge_tags.each{|key, value| merge_tags[key] = '' if value.nil? }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="483">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2981" data-linenumber="484">
          <span class="hits">2981</span>
          
          <code class="ruby">      Delayed::Job.enqueue Jobs::SubscribeToEmailListJob.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby">        Civiccommons::Config.mailer['api_token'],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">        Civiccommons::Config.mailer['weekly_newsletter_list_id'],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="487">
          
          
          <code class="ruby">        email,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">        merge_tags)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="491">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">  def remove_newsletter_subscription</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="493">
          <span class="hits">9</span>
          
          <code class="ruby">    if Civiccommons::Config.mailer['mailchimp']</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="494">
          <span class="hits">9</span>
          
          <code class="ruby">      Delayed::Job.enqueue Jobs::UnsubscribeFromEmailListJob.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="495">
          
          
          <code class="ruby">        Civiccommons::Config.mailer['api_token'],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="496">
          
          
          <code class="ruby">        Civiccommons::Config.mailer['weekly_newsletter_list_id'],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="497">
          
          
          <code class="ruby">        email)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="498">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="499">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="500">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="501">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8af5b8f3eada80c653b20f8d09268d15c9896fa7">
  <div class="header">
    <h3>app/models/petition.rb</h3>
    <h4><span class="green">96.55 %</span> covered</h4>
    <div>
      <b>29</b> relevant lines. 
      <span class="green"><b>28</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Petition &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :conversation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  has_one :action, :as =&gt; :actionable, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :signatures, :class_name =&gt; 'PetitionSignature', :dependent =&gt; :destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :signers, :class_name =&gt; 'Person', :through =&gt; :signatures, :source =&gt; :person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :title,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">                        :description,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">                        :resulting_actions,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">                        :signature_needed,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">                        :person_id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_numericality_of :signature_needed, :greater_than =&gt; 0, :allow_blank =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # Participants of a Petition is the Petition Owner and it's Signers... or just the signers since a petition owner is required to sign the petition.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  alias_attribute :participants, :signers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  after_save :create_or_update_action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  define_method(:content) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    description</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  # Owner of the petition.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def creator_name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    self.person.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def reflections</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    self.action.reflections</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def signed_by?(person)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="35">
          <span class="hits">13</span>
          
          <code class="ruby">    signers.exists?(person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def signature_needed_left</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="39">
          <span class="hits">8</span>
          
          <code class="ruby">    if signature_needed &gt; signatures.count</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="40">
          <span class="hits">7</span>
          
          <code class="ruby">      signature_needed - signatures.count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">      0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def sign(person)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="47">
          <span class="hits">3</span>
          
          <code class="ruby">    unless signers.exists?(person)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="48">
          <span class="hits">3</span>
          
          <code class="ruby">      self.signers &lt;&lt; person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  # Needed to create the Action model when Petition is created</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_or_update_action</code>
        </li>
      
        <li class="covered" data-hits="60" data-linenumber="54">
          <span class="hits">60</span>
          
          <code class="ruby">    if self.action.present?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">      self.action.update_attributes(:conversation_id =&gt; self.conversation_id) if self.conversation_id_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="58" data-linenumber="57">
          <span class="hits">58</span>
          
          <code class="ruby">      self.build_action(:conversation_id =&gt; self.conversation_id).save if self.conversation_id.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="88bfd596fb0b3d3ac8cbe26f6e15a004f8fd31d7">
  <div class="header">
    <h3>app/models/petition_signature.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>11</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PetitionSignature &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :petition</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :petition_id, :person_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :conversation, :title, :description, :to =&gt; :petition, :prefix =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def petition_name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    petition.title</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def signer_name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    person.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_id</code>
        </li>
      
        <li class="covered" data-hits="78" data-linenumber="14">
          <span class="hits">78</span>
          
          <code class="ruby">    try(:petition).try(:conversation_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="635696a40b4e1cfb31c07df903514520db7969bc">
  <div class="header">
    <h3>app/models/rating.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Rating &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :rating_descriptor</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :rating_group, :touch =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :person,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">           :contribution, :to =&gt; :rating_group</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :title, :to =&gt; :rating_descriptor</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :name, :to =&gt; :person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  # For Historical reasons, Commented out so we don't lose it as part of a git rebase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  #scope :group_by_contribution, lambda { |contribution|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    #joins(:rating_descriptor).joins(:rating_group).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    #where(:'rating_groups.contribution_id' =&gt; contribution).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    #group('rating_descriptors.title')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  #}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  #scope :group_by_rating_descriptor, lambda {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    #joins(:rating_descriptor).joins(:rating_group).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    #group('rating_descriptors.title')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  #}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  #def self.by_all_contributions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    #group_by_rating_descriptor.count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  #end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  #def self.by_contribution(contribution)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    #group_by_contribution(contribution).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  #end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  #def self.person_ratings_for_contribution(person, contribution)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    #group_by_contribution(contribution).where(:person_id =&gt; person).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  #end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  #def self.person_ratings_for_contribution_and_descriptor(person, contribution, descriptor)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    #descriptor_title = descriptor.respond_to?(:title) ? descriptor.title : descriptor.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    #group_by_contribution(contribution).where(:'rating_groups.person_id' =&gt; person).count[descriptor_title]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  #end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  #def self.descriptor_total_for_contribution(contribution, descriptor)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    #descriptor_title = descriptor.respond_to?(:title) ? descriptor.title : descriptor.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    #group_by_contribution(contribution).count[descriptor_title]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  #end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="89b31a44bfc86e9ebfc21bea2f327c398be6cb1d">
  <div class="header">
    <h3>app/models/rating_descriptor.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class RatingDescriptor &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5b262c98280ce4cf7967fbe9a5869ea1720d9f22">
  <div class="header">
    <h3>app/models/rating_group.rb</h3>
    <h4><span class="green">98.48 %</span> covered</h4>
    <div>
      <b>66</b> relevant lines. 
      <span class="green"><b>65</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class RatingGroup &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  @@cached_rating_descriptors = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :conversation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :contribution</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many   :ratings, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :set_conversation_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :person_id, :contribution_id, :conversation_id, :presence =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_uniqueness_of :person_id, :scope =&gt; :contribution_id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_with RatingGroupValidator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :group_by_contribution, lambda { |contribution|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    joins(:rating_descriptor).joins(:rating_group).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    where(:contribution_id =&gt; contribution).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    group('rating_descriptors.title')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_conversation_id</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="22">
          <span class="hits">68</span>
          
          <code class="ruby">    self.conversation_id = contribution.conversation_id if conversation_id.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.cached_rating_descriptors</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="26">
          <span class="hits">10</span>
          
          <code class="ruby">    @@cached_rating_descriptors = @@cached_rating_descriptors || RatingGroup.rating_descriptors</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.refresh_cached_rating_descriptors</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="30">
          <span class="hits">8</span>
          
          <code class="ruby">    @@cached_rating_descriptors = RatingGroup.rating_descriptors</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.add_rating!(person, contribution, descriptor, rg=nil)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="34">
          <span class="hits">12</span>
          
          <code class="ruby">    rg ||= RatingGroup.find_or_create_by_person_id_and_contribution_id(person.id, contribution.id)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="35">
          <span class="hits">12</span>
          
          <code class="ruby">    rg.ratings.create(:rating_descriptor =&gt; descriptor) unless rg.new_record? # not saved</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="36">
          <span class="hits">12</span>
          
          <code class="ruby">    return rg</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.remove_rating!(person, contribution, descriptor, rg=nil)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="40">
          <span class="hits">4</span>
          
          <code class="ruby">    rg ||= RatingGroup.includes(:ratings).find_by_person_id_and_contribution_id(person.id, contribution.id)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="41">
          <span class="hits">4</span>
          
          <code class="ruby">    self.transaction do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="42">
          <span class="hits">8</span>
          
          <code class="ruby">      rating = rg.ratings.detect{|r| r.rating_descriptor_id == descriptor.id}</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="43">
          <span class="hits">4</span>
          
          <code class="ruby">      rating &amp;&amp; rg.ratings.size == 1 ? rg.destroy : rating.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="45">
          <span class="hits">3</span>
          
          <code class="ruby">    return rg</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.toggle_rating!(person, contribution, descriptor)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="49">
          <span class="hits">2</span>
          
          <code class="ruby">    rg = RatingGroup.includes(:ratings).find_by_person_id_and_contribution_id(person.id, contribution.id)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="50">
          <span class="hits">4</span>
          
          <code class="ruby">    self.send( ( rg &amp;&amp; rg.ratings.detect{|r| r.rating_descriptor_id == descriptor.id} ? :remove_rating! : :add_rating! ), person, contribution, descriptor)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def ratings_titles</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">    self.ratings.collect(&amp;:title).to_sentence</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  # Potential Direct SQL Query:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  #   SELECT RG.CONTRIBUTION_ID, RD.TITLE, COUNT(*)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  #     FROM RATING_GROUPS AS RG,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  #          RATINGS AS R,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  #          RATING_DESCRIPTORS AS RD</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  #    WHERE RG.CONVERSATION_ID = 120</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  #      AND RG.ID = R.RATING_GROUP_ID</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  #      AND R.`RATING_DESCRIPTOR_ID` = RD.ID</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  # GROUP BY CONTRIBUTION_ID,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  #          RATING_DESCRIPTOR_ID</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.ratings_for_conversation(conversation)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="70">
          <span class="hits">2</span>
          
          <code class="ruby">    rgs = RatingGroup.where(:conversation_id =&gt; conversation).includes(:ratings)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="72">
          <span class="hits">2</span>
          
          <code class="ruby">    Hash.new.tap do |hash|</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="73">
          <span class="hits">10</span>
          
          <code class="ruby">      RatingGroup.cached_rating_descriptors.values.collect{ |rd_title| hash[rd_title] = [] }</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="74">
          <span class="hits">4</span>
          
          <code class="ruby">    end.merge( rgs.collect{|rg| rg.ratings}.flatten.group_by(&amp;:title) )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.ratings_for_conversation_with_count(conversation)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">    rgs = ratings_for_conversation(conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="80">
          <span class="hits">5</span>
          
          <code class="ruby">    RatingGroup.cached_rating_descriptors.values.each{|rd_title| rgs[rd_title] = rgs[rd_title].count}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">    rgs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.ratings_for_conversation_by_contribution_with_count(conversation, person=nil)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="85">
          <span class="hits">13</span>
          
          <code class="ruby">    person = person.is_a?(Person) ? person.id : person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    # First get the Rating Group that is associated with each Contribution</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">    #   Contribution_id =&gt; [Rating Group(s)]</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="88">
          <span class="hits">13</span>
          
          <code class="ruby">    rgs       = RatingGroup.scoped</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="89">
          <span class="hits">13</span>
          
          <code class="ruby">    rgs       = rgs.where(:conversation_id =&gt; conversation).includes(:ratings).all</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="90">
          <span class="hits">13</span>
          
          <code class="ruby">    contribution_ids = rgs.collect(&amp;:contribution_id).uniq</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="91">
          <span class="hits">13</span>
          
          <code class="ruby">    ratings = rgs.collect(&amp;:ratings)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    # Start with new Hash #=&gt; {}</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="94">
          <span class="hits">13</span>
          
          <code class="ruby">    out = contribution_ids.each.inject(default_contribution_hash(person)) do |h, contribution_id|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="95">
          <span class="hits">9</span>
          
          <code class="ruby">      contribution_rgs = rgs.select{ |rg| rg.contribution_id == contribution_id }</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="96">
          <span class="hits">7</span>
          
          <code class="ruby">      contribution_person_ratings = contribution_rgs.select{ |rg| rg.person_id == person }.collect(&amp;:ratings).flatten if person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">      # Populate hash with each unique contribution_id as a key #=&gt; { 1 =&gt; {}, 2 =&gt; {} }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="98">
          <span class="hits">3</span>
          
          <code class="ruby">      contribution_hash = Hash.new.tap do |h2|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">        # Populate each contribution_id value hash with rating_descriptor keys</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">        # e.g. { 1 =&gt; { 'some-descriptor' =&gt; ... }, 2 =&gt; { 'some-descriptor' =&gt; ... } }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="101">
          <span class="hits">3</span>
          
          <code class="ruby">        RatingGroup.cached_rating_descriptors.each do |rd_id, rd_title|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">          # Populate each rating_descriptor value with hash of total and person ratings</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="103">
          <span class="hits">12</span>
          
          <code class="ruby">          h2[rd_title] = {</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="104">
          <span class="hits">48</span>
          
          <code class="ruby">            :total =&gt; contribution_rgs.collect(&amp;:ratings).flatten.count{|r| r.rating_descriptor_id == rd_id },</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="105">
          <span class="hits">14</span>
          
          <code class="ruby">            :person =&gt; person ? contribution_person_ratings.any?{ |r| r.rating_descriptor_id == rd_id } : nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="109">
          <span class="hits">3</span>
          
          <code class="ruby">      h.merge(contribution_id =&gt; contribution_hash)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.rating_descriptors</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    # Builds { 1 =&gt; 'Appropriate', 2 =&gt; 'Inspiring', ... }</code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="115">
          <span class="hits">46</span>
          
          <code class="ruby">    @rating_desciptors = Hash[*RatingDescriptor.select([ :id, :title ]).map{ |m| [m.id, m.title]}.flatten]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.default_ratings_hash(person=nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">    Hash.new.tap do |hash|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">      RatingGroup.cached_rating_descriptors.each do |rd_id, rd_title|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="121">
          <span class="hits">4</span>
          
          <code class="ruby">        hash[rd_title] = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">          :total =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">          :person =&gt; person ? false : nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.default_contribution_hash(person=nil)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="130">
          <span class="hits">13</span>
          
          <code class="ruby">    Hash.new do |hash, key|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">      hash[key] = default_ratings_hash(person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="255aaf2611ca8a7f87b3edbbba3695444ea5f607">
  <div class="header">
    <h3>app/models/rating_group_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class RatingGroupValidator &lt; ActiveModel::Validator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate(record)</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="4">
          <span class="hits">68</span>
          
          <code class="ruby">    record.errors[:person] &lt;&lt; &quot;Author cannot rate own contribution&quot; if person_is_author?(record)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def person_is_author?(record)</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="8">
          <span class="hits">68</span>
          
          <code class="ruby">    record.contribution.owner == record.person_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0af9b1fdf40780c8e5c0011c1bbdb44855043b4b">
  <div class="header">
    <h3>app/models/reflection.rb</h3>
    <h4><span class="yellow">86.36 %</span> covered</h4>
    <div>
      <b>22</b> relevant lines. 
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Reflection &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person, :foreign_key =&gt; &quot;owner&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :conversation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :comments, :class_name =&gt; 'ReflectionComment', :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_and_belongs_to_many :actions</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_and_belongs_to_many :featured_opportunities, :join_table =&gt; :featured_opportunities_reflections, :uniq =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :title</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :details</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible :action_ids</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible :title, :details, :conversation_id, :owner</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # Owner/Creator of this reflection</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def owner_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    self.person.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def commenter_ids</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="20">
          <span class="hits">10</span>
          
          <code class="ruby">    comments.collect(&amp;:person_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  # Actions related to owner of this reflection</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def owner_participated_actions</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    self.person.participated_actions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # Actionables related to this reflection</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def related_actionables</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">    action.actionable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def one_line_summary</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="34">
          <span class="hits">11</span>
          
          <code class="ruby">    [person.name,title,details].delete_if(&amp;:blank?).join(' - ')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  # People Posting the Reflection or Comments to the Reflection</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def participants</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    ([self.owner] + self.comments.collect(&amp;:person_id)).flatten.uniq</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7455efe5fd2d48c76e5d7e16070187354c97099e">
  <div class="header">
    <h3>app/models/reflection_comment.rb</h3>
    <h4><span class="yellow">87.5 %</span> covered</h4>
    <div>
      <b>8</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ReflectionComment &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :reflection</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :body</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_id</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    try(:reflection).try(:conversation_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def title</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    try(:reflection).try(:title)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="bb219b626c68e671b095dbde49fd60412a3fe6e7">
  <div class="header">
    <h3>app/models/region.rb</h3>
    <h4><span class="green">97.56 %</span> covered</h4>
    <div>
      <b>41</b> relevant lines. 
      <span class="green"><b>40</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Region &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_save :create_zip_codes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :zip_codes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  accepts_nested_attributes_for :zip_codes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  has_attached_file :image,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    :styles =&gt; {:normal =&gt; &quot;300x200&gt;&quot;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      :storage =&gt; :s3,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      :s3_credentials =&gt; S3Config.credential_file,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      :path =&gt; &quot;:attachment/region/:id/:style/:filename&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_attachment_presence :image</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_attachment_content_type :image,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">                                    :content_type =&gt; /image\/*/,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">                                    :message =&gt; &quot;Not a valid image file.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.default_name</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="20">
          <span class="hits">13</span>
          
          <code class="ruby">    &quot;National&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.default</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="24">
          <span class="hits">6</span>
          
          <code class="ruby">    rv = new(:name=&gt;self.default_name)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="25">
          <span class="hits">6</span>
          
          <code class="ruby">    rv.id = 0</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="26">
          <span class="hits">6</span>
          
          <code class="ruby">    rv</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_by_zip_code(zip_code)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="30">
          <span class="hits">2</span>
          
          <code class="ruby">    Region.joins(:zip_codes).where(&quot;zip_codes.zip_code = #{zip_code}&quot;).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def issues</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="34">
          <span class="hits">4</span>
          
          <code class="ruby">    Issue.where(where_clause)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  def people</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">    Person.includes(:authentications).where(where_clause)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversations(page = 1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    Conversation.where(where_clause).paginate(:page=&gt;page, :per_page=&gt;6)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def where_clause</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="46">
          <span class="hits">5</span>
          
          <code class="ruby">    rv = &quot;zip_code = 'all' or zip_code NOT IN (SELECT DISTINCT zip_code FROM zip_codes)&quot;</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="47">
          <span class="hits">5</span>
          
          <code class="ruby">    unless self.default?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="48">
          <span class="hits">4</span>
          
          <code class="ruby">      zipcodes = zip_code_string(&quot;,&quot;)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="49">
          <span class="hits">4</span>
          
          <code class="ruby">      zipcodes = zipcodes.length &gt; 0 ? &quot;'all',#{zipcodes}&quot; : &quot;'all'&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="50">
          <span class="hits">4</span>
          
          <code class="ruby">      rv = &quot;zip_code IN (#{zipcodes})&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="52">
          <span class="hits">5</span>
          
          <code class="ruby">    rv</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">  def default?</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="56">
          <span class="hits">7</span>
          
          <code class="ruby">    self.name == Region.default_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def zip_code_string(delimiter = &quot;\n&quot;)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="60">
          <span class="hits">10</span>
          
          <code class="ruby">    self.zip_codes.collect{|c| c.zip_code}.join(delimiter)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  def zip_code_string=(val)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="64">
          <span class="hits">4</span>
          
          <code class="ruby">    @zip_code_string = val</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="65">
          <span class="hits">4</span>
          
          <code class="ruby">    create_zip_codes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_zip_codes</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="69">
          <span class="hits">11</span>
          
          <code class="ruby">    self.zip_codes = [] if self.zip_codes.nil?</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="70">
          <span class="hits">11</span>
          
          <code class="ruby">    self.zip_codes.clear</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="71">
          <span class="hits">11</span>
          
          <code class="ruby">    @zip_code_string ||= &quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="72">
          <span class="hits">11</span>
          
          <code class="ruby">    @zip_code_string.split(&quot;\n&quot;).each do |c|</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="73">
          <span class="hits">10</span>
          
          <code class="ruby">      self.zip_codes &lt;&lt; ZipCode.find_or_create_by_zip_code(c.strip)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="de8dff9cd6a6e7676911dcec6773d271b1a624d8">
  <div class="header">
    <h3>app/models/selected_survey_option.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SelectedSurveyOption &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :bypass_survey_option_id_uniqueness, :bypass_presence_validation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :survey_option</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :survey_response</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :survey_option_id, :survey_response_id, :unless =&gt; :bypass_presence_validation?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_uniqueness_of :survey_option_id, :scope =&gt; :survey_response_id, :message =&gt; 'has already been selected', :unless =&gt; :bypass_survey_option_id_uniqueness?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def bypass_survey_option_id_uniqueness?</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="9">
          <span class="hits">204</span>
          
          <code class="ruby">    @bypass_survey_option_id_uniqueness ||= false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def bypass_presence_validation?</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="13">
          <span class="hits">204</span>
          
          <code class="ruby">    @bypass_presence_validation ||= false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="acbdae30cdb48eda0d2b9f25af8bf18904c8c8ab">
  <div class="header">
    <h3>app/models/subscription.rb</h3>
    <h4><span class="red">79.17 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Subscription &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :subscribable, :polymorphic =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :conversations, where(subscribable_type: 'Conversation')</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :issues,        where(subscribable_type: 'Issue')</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :organizations, where(subscribable_type: 'Organization')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :name, :to =&gt; :person, :prefix =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :title, :to =&gt; :subscribable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.subscribable?(subscription_type, subscription_id=nil, subscriber=nil)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="13">
          <span class="hits">4</span>
          
          <code class="ruby">    subscribable_model = subscription_type.camelize.constantize</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="14">
          <span class="hits">4</span>
          
          <code class="ruby">    return subscribable_model.include? Subscribable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.subscribe(subscription_type, subscription_id, subscriber)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="18">
          <span class="hits">4</span>
          
          <code class="ruby">    if self.subscribable?(subscription_type)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="19">
          <span class="hits">4</span>
          
          <code class="ruby">      subscribable_model = subscription_type.camelize.constantize</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="20">
          <span class="hits">4</span>
          
          <code class="ruby">      subscribable_model.find(subscription_id).subscribe(subscriber)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">      raise(ArgumentError, &quot;Invalid attempt made to subscribe to:#{subscription_type}. #{subscription_type} must implement subscribable.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.unsubscribe(subscription_type, subscription_id, subscriber)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    if self.subscribable?(subscription_type)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">      subscribable_model = subscription_type.camelize.constantize</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">      subscribable_model.find(subscription_id).unsubscribe(subscriber)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">      raise(ArgumentError, &quot;#{model}'s can not be subscribed to.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.create_unless_exists(person, subscribable)</code>
        </li>
      
        <li class="covered" data-hits="866" data-linenumber="36">
          <span class="hits">866</span>
          
          <code class="ruby">    unless person.subscriptions.collect{|sub| sub.subscribable}.include?(subscribable)</code>
        </li>
      
        <li class="covered" data-hits="861" data-linenumber="37">
          <span class="hits">861</span>
          
          <code class="ruby">      person.subscriptions.create(subscribable: subscribable)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e324c3e77f8c26a3561821ce67a11f0261f36d01">
  <div class="header">
    <h3>app/models/survey.rb</h3>
    <h4><span class="green">97.92 %</span> covered</h4>
    <div>
      <b>48</b> relevant lines. 
      <span class="green"><b>47</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Survey &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  SURVEY_TYPES = ['Vote']#, 'Poll']</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :surveyable, :polymorphic =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_one :action, :as =&gt; :actionable, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :options, :class_name =&gt; 'SurveyOption', :foreign_key =&gt; 'survey_id', :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :survey_responses, :dependent =&gt; :restrict</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :respondents, :through =&gt; :survey_responses, :source =&gt; :person</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :max_selected_options, :title, :end_date</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_numericality_of :max_selected_options, :only_integer =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  accepts_nested_attributes_for :options, :reject_if =&gt; :all_blank, :allow_destroy =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  after_save :create_or_update_action, :if =&gt; :attached_to_conversation?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  after_save :send_end_notification_email_later</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  define_method(:content) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    details</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  # Participants in a survey are the survey owner and the respondents to the survey</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def respondent_ids</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="22">
          <span class="hits">17</span>
          
          <code class="ruby">    survey_responses.collect(&amp;:person_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="26">
          <span class="hits">33</span>
          
          <code class="ruby">    surveyable if attached_to_conversation?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def participants</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="30">
          <span class="hits">4</span>
          
          <code class="ruby">    ([person] + respondents).flatten.uniq</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def attached_to_conversation?</code>
        </li>
      
        <li class="covered" data-hits="316" data-linenumber="34">
          <span class="hits">316</span>
          
          <code class="ruby">    surveyable &amp;&amp; surveyable.is_a?(Conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_or_update_action</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="38">
          <span class="hits">83</span>
          
          <code class="ruby">    if self.action.present?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="39">
          <span class="hits">3</span>
          
          <code class="ruby">      self.action.update_attributes(:conversation_id =&gt; self.surveyable_id) if self.surveyable_id_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="41">
          <span class="hits">80</span>
          
          <code class="ruby">      self.build_action(:conversation_id =&gt; self.surveyable_id).save if self.surveyable_id.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_id</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="46">
          <span class="hits">21</span>
          
          <code class="ruby">    self.surveyable_id if attached_to_conversation?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  # This does not use end_date_time_for_est to prevent issues where less than a day is considered a full day.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  # Today is July 30</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  # End Date = July 31      # Result:1 day left         # Correct</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  # EST End Date = Aug 1    # Result:2 days left        # Wrong</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">  def days_until_end_date</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="55">
          <span class="hits">27</span>
          
          <code class="ruby">    (end_date - Date.today).to_i if end_date &amp;&amp; end_date &gt; Date.today</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">  def show_progress_now?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="59">
          <span class="hits">10</span>
          
          <code class="ruby">    show_progress? &amp;&amp; expired?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_end_notification_email</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="63">
          <span class="hits">5</span>
          
          <code class="ruby">    unless end_notification_email_sent</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="64">
          <span class="hits">4</span>
          
          <code class="ruby">      Survey.transaction do</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="65">
          <span class="hits">4</span>
          
          <code class="ruby">        survey_responses.each do |response|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="66">
          <span class="hits">4</span>
          
          <code class="ruby">          Notifier.survey_ended(response.person, response.survey).deliver</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="69">
          <span class="hits">4</span>
          
          <code class="ruby">        self.end_notification_email_sent = true</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="70">
          <span class="hits">4</span>
          
          <code class="ruby">        self.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_end_notification_email_later</code>
        </li>
      
        <li class="covered" data-hits="259" data-linenumber="76">
          <span class="hits">259</span>
          
          <code class="ruby">    self.delay(:run_at =&gt; real_end_date_time).send_end_notification_email if end_date_changed? &amp;&amp; !manual_results?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">  def active?</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="80">
          <span class="hits">39</span>
          
          <code class="ruby">    start_date.blank? || (start_date &amp;&amp; start_date &lt;= Date.today)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  # End of Day for Eastern Time in UTC format</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  # This is actually the end_date + 1 day since the date time will reflect when things are officially over.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">  # ex. If we want to end on July 31st, July 31st 11:59:59 is still not the end.  August 1st 00:00:00 is.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  # This is for the Eastern Time zone since our users are EST.  Then it's converted to UTC for server use.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">  def real_end_date_time</code>
        </li>
      
        <li class="covered" data-hits="357" data-linenumber="90">
          <span class="hits">357</span>
          
          <code class="ruby">    Time.parse((end_date + 1).to_s)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">  def expired?</code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="94">
          <span class="hits">114</span>
          
          <code class="ruby">    !end_date.blank? &amp;&amp; real_end_date_time.past?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="249e3ffb105ff526c2ed72721d2eb1835652ed09">
  <div class="header">
    <h3>app/models/survey_option.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SurveyOption &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  SURVEYABLE_TYPES = ['Issue', 'Conversation']</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :nested, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">                :weighted_votes_percentage, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">                :winner, # used by VoteProgressService</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">                :voted # used by VoteProgressService</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :survey</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :selected_survey_options, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :survey_id, :unless =&gt; :nested</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_uniqueness_of :position, :scope =&gt; :survey_id, :allow_blank =&gt; true, :allow_nil =&gt; true, :unless =&gt; :nested</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :validate_title_or_description</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :position_sorted, {:order =&gt;'position ASC, id ASC'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_title_or_description</code>
        </li>
      
        <li class="covered" data-hits="413" data-linenumber="15">
          <span class="hits">413</span>
          
          <code class="ruby">    if title.blank? &amp;&amp; description.blank?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="16">
          <span class="hits">4</span>
          
          <code class="ruby">      self.errors.add(:title,'Either title must be filled, or description must be filled') </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="39a5cb0880f9b322df541f395a3315718c831c8a">
  <div class="header">
    <h3>app/models/survey_response.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>37</b> relevant lines. 
      <span class="green"><b>37</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SurveyResponse &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :selected_option_ids, :validate_presence_of_selected_option</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :selected_survey_options, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :survey</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :reject_blank_selected_option_ids</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :person_id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_uniqueness_of :person_id, :scope =&gt; :survey_id, :allow_blank =&gt; true, :allow_nil =&gt; true, :message =&gt; 'already exists'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :selected_should_be_under_max_selected_options</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :presence_of_selected_options, :if =&gt; :validate_presence_of_selected_option?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  after_commit :send_survey_confirmation, :on =&gt; :create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :sort_last_created_first, {:order=&gt; 'created_at DESC'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :id, :title, :type, :to =&gt; :survey, :prefix =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate :name, :to =&gt; :person, :prefix =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_presence_of_selected_option?</code>
        </li>
      
        <li class="covered" data-hits="196" data-linenumber="20">
          <span class="hits">196</span>
          
          <code class="ruby">    @validate_presence_of_selected_option ||= false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_id</code>
        </li>
      
        <li class="covered" data-hits="59" data-linenumber="24">
          <span class="hits">59</span>
          
          <code class="ruby">    survey.surveyable_id if try(:survey).try(:surveyable).is_a?(Conversation)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def selected_option_ids=(option_ids=[])</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="28">
          <span class="hits">9</span>
          
          <code class="ruby">    @selected_option_ids = option_ids</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="29">
          <span class="hits">9</span>
          
          <code class="ruby">    @selected_option_ids.each do |option_id|</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="30">
          <span class="hits">18</span>
          
          <code class="ruby">      self.selected_survey_options.build(:survey_option_id =&gt; option_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def selected_option_ids</code>
        </li>
      
        <li class="covered" data-hits="245" data-linenumber="35">
          <span class="hits">245</span>
          
          <code class="ruby">    selected_survey_options.collect(&amp;:survey_option_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def selected_survey_option_titles</code>
        </li>
      
        <li class="covered" data-hits="459" data-linenumber="39">
          <span class="hits">459</span>
          
          <code class="ruby">    selected_survey_options.collect{|selected_option| selected_option.survey_option.title }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_survey_confirmation</code>
        </li>
      
        <li class="covered" data-hits="183" data-linenumber="43">
          <span class="hits">183</span>
          
          <code class="ruby">    Notifier.survey_confirmation(self).deliver</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def selected_should_be_under_max_selected_options</code>
        </li>
      
        <li class="covered" data-hits="196" data-linenumber="47">
          <span class="hits">196</span>
          
          <code class="ruby">    if self.survey &amp;&amp; selected_option_ids.length &gt; survey.max_selected_options</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="48">
          <span class="hits">2</span>
          
          <code class="ruby">      self.errors[:selected_option_ids] &lt;&lt; &quot;You cannot select more than #{survey.max_selected_options} option(s)&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def presence_of_selected_options</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="52">
          <span class="hits">5</span>
          
          <code class="ruby">    if selected_option_ids.length &lt; 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">      self.errors[:selected_option_ids] &lt;&lt; &quot;You must select at least one option&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  def reject_blank_selected_option_ids</code>
        </li>
      
        <li class="covered" data-hits="398" data-linenumber="58">
          <span class="hits">398</span>
          
          <code class="ruby">    selected_survey_options.delete_if{|selected_survey_option| selected_survey_option.new_record? &amp;&amp; selected_survey_option.survey_option_id.blank? }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4cb3cd71524bb20c4541042cb0b4c7b593e072f0">
  <div class="header">
    <h3>app/models/survey_types/poll.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Poll &lt; Survey</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e6d58b9c006125f3b64dbd018b3d68283e88427c">
  <div class="header">
    <h3>app/models/survey_types/vote.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>2</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Vote &lt; Survey</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :daily_digest_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="53c3c4e0d895f3c53ef7cfc6deca808f641e9bdc">
  <div class="header">
    <h3>app/models/topic.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Topic &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :issues, through: :issues_topics, uniq: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :issues_topics, uniq: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :content_items_topics, :uniq =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :conversations_topics, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :conversations, :through =&gt; :conversations_topics, :uniq =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :radioshows,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    through: :content_items_topics,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    class_name: 'ContentItem',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    conditions: 'content_type = &quot;RadioShow&quot;',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    source: :content_item,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    uniq: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :blogposts,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    through: :content_items_topics,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    class_name: 'ContentItem',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    conditions: 'content_type = &quot;BlogPost&quot;',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    source: :content_item,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    uniq: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_uniqueness_of :name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  # Filters by metro region, if metrocode parameter is supplied, otherwise, ignores it.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :filter_metro_region, lambda{|metrocode|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="28">
          <span class="hits">24</span>
          
          <code class="ruby">      joins(:issues=&gt; {:conversations =&gt; :metro_region}).where(:metro_regions=&gt;{metrocode: metrocode}).group('topics.id') if metrocode.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :including_public_issues,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    joins(:issues).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      select('topics.*,count(DISTINCT issues.id) AS issue_count').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      where(:issues=&gt;{:exclude_from_result =&gt; false,:type =&gt; 'Issue'}).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      group('topics.id').having('count(DISTINCT issues.id) &gt; 0')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :including_conversations,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    joins(:conversations).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      select('topics.*,count(DISTINCT conversations.id) AS conversation_count').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      group('topics.id').having('count(DISTINCT conversations.id) &gt; 0')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  # Issue with conditions on joins: https://github.com/rails/rails/issues/2637</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  # The conditions are incorrectly used as ON parameters for the JOIN instead of WHERE clause</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  # Would have rather done something like:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  #   joins(:radioshows).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  #     select('topics.*, count(content_items_topics.topic_id) AS radioshow_count').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  #     group('content_items_topics.topic_id')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :including_public_content_items, lambda {|content_type|</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="52">
          <span class="hits">23</span>
          
          <code class="ruby">    case content_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    when :blogpost</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="54">
          <span class="hits">17</span>
          
          <code class="ruby">      content_type_criteria = 'BlogPost'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    when :radioshow</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="56">
          <span class="hits">6</span>
          
          <code class="ruby">      content_type_criteria = 'RadioShow'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="58">
          <span class="hits">23</span>
          
          <code class="ruby">    joins('INNER JOIN `content_items_topics` ON `content_items_topics`.`topic_id` = `topics`.`id`').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      joins('INNER JOIN content_items ON content_items_topics.content_item_id = content_items.id').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      select('topics.*, count(content_items_topics.topic_id) AS content_item_count').</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      where(['content_items.content_type = ?', content_type_criteria]).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      group('content_items_topics.topic_id')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :including_public_radioshows, lambda {</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="66">
          <span class="hits">6</span>
          
          <code class="ruby">      including_public_content_items(:radioshow)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">  scope :including_public_blogposts, lambda {</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="70">
          <span class="hits">17</span>
          
          <code class="ruby">    including_public_content_items(:blogpost)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ecd84707ecff22df187c8d48de732b47e7a045eb">
  <div class="header">
    <h3>app/models/tos.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Tos</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.send_violation_complaint(user, contribution, reason)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="3">
          <span class="hits">2</span>
          
          <code class="ruby">    resource = {:user =&gt; user, :contribution =&gt; contribution, :reason =&gt; reason}</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="4">
          <span class="hits">2</span>
          
          <code class="ruby">    mail = Notifier.violation_complaint(resource)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="5">
          <span class="hits">2</span>
          
          <code class="ruby">    mail.deliver</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="03c4ab388197f81069c9e3c5a1e545eeb6ea9bc8">
  <div class="header">
    <h3>app/models/visit.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Visit &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :person</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :visitable, :polymorphic =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9417236037f905386d5cb80b6a9b18889990efea">
  <div class="header">
    <h3>app/models/widget_log.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class WidgetLog &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :url, :remote_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_all_url_summary_for_week(week_of = 0)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="5">
          <span class="hits">7</span>
          
          <code class="ruby">    from_date, to_date = process_from_and_to_date(week_of)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="6">
          <span class="hits">7</span>
          
          <code class="ruby">    sql = &lt;&lt;-SQL </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">      SELECT *, COUNT(id) AS page_views FROM </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">      (SELECT * FROM widget_logs </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">      WHERE created_at BETWEEN '#{from_date}' AND '#{to_date}'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      ORDER BY created_at DESC) AS t</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      GROUP BY url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    SQL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="14">
          <span class="hits">7</span>
          
          <code class="ruby">    self.find_by_sql(sql)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_one_url_summary_for_week(url, week_of = 0)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="18">
          <span class="hits">5</span>
          
          <code class="ruby">    url = add_first_slash_if_doesnt_exist(url)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="19">
          <span class="hits">5</span>
          
          <code class="ruby">    from_date, to_date = process_from_and_to_date(week_of)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="20">
          <span class="hits">5</span>
          
          <code class="ruby">    sql = &lt;&lt;-SQL </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      SELECT *, COUNT(id) AS page_views FROM </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      (SELECT * FROM widget_logs </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">        WHERE url = '#{url}'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">        AND created_at BETWEEN '#{from_date}' AND '#{to_date}'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">        ORDER BY created_at DESC</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      ) AS t</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      GROUP BY url, remote_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      ORDER BY page_views DESC, url ASC</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    SQL</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="30">
          <span class="hits">5</span>
          
          <code class="ruby">    self.find_by_sql(sql)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.process_from_and_to_date(week_of=0)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="34">
          <span class="hits">14</span>
          
          <code class="ruby">    from_date = week_of.to_i.weeks.ago.beginning_of_week.utc.to_s(:db)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="35">
          <span class="hits">14</span>
          
          <code class="ruby">    to_date = week_of.to_i.weeks.ago.end_of_week.utc.to_s(:db)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="36">
          <span class="hits">14</span>
          
          <code class="ruby">    return from_date, to_date</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.add_first_slash_if_doesnt_exist(url)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="39">
          <span class="hits">7</span>
          
          <code class="ruby">    url.gsub!(/^/,'/') if url.match(/^[^\/]/)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="40">
          <span class="hits">7</span>
          
          <code class="ruby">    return url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="428ffab92377ae8f42e75ad6ac4500893199723b">
  <div class="header">
    <h3>app/models/zip_code.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ZipCode &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :region</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def to_s</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    self.zip_code</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="17b71720d95612d1d897ca910d984b434ba147a8">
  <div class="header">
    <h3>app/observers/activity_observer.rb</h3>
    <h4><span class="yellow">87.5 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ActivityObserver &lt; ActiveRecord::Observer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  observe :contribution, :conversation, :rating_group, :survey_response,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">          :petition, :petition_signature, :reflection, :reflection_comment, :survey</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def after_create(model)</code>
        </li>
      
        <li class="covered" data-hits="98" data-linenumber="7">
          <span class="hits">98</span>
          
          <code class="ruby">    unless model.is_a?(Contribution) &amp;&amp; model.unconfirmed?</code>
        </li>
      
        <li class="covered" data-hits="95" data-linenumber="8">
          <span class="hits">95</span>
          
          <code class="ruby">      a = Activity.new(model)</code>
        </li>
      
        <li class="covered" data-hits="95" data-linenumber="9">
          <span class="hits">95</span>
          
          <code class="ruby">      a.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def after_save(model)</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="14">
          <span class="hits">136</span>
          
          <code class="ruby">    if model.is_a?(Contribution)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      if model.confirmed &amp;&amp;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">        (</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">          (!model.conversation.nil? &amp;&amp; model != model.conversation.contributions.first) ||</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">          (!model.issue.nil? &amp;&amp; model != model.issue.contributions.first)</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="19">
          <span class="hits">26</span>
          
          <code class="ruby">        )</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="20">
          <span class="hits">10</span>
          
          <code class="ruby">        if Activity.where(item_id: model.id, item_type: 'Contribution').empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">          a = Activity.new(model)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">          a.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="24">
          <span class="hits">10</span>
          
          <code class="ruby">          Activity.update(model)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="110" data-linenumber="28">
          <span class="hits">110</span>
          
          <code class="ruby">      Activity.update(model)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def before_destroy(model)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="33">
          <span class="hits">11</span>
          
          <code class="ruby">    Activity.destroy(model) if Activity.exists?(model)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3576ff2666215e373495169d2ee93e6c2a54cc0e">
  <div class="header">
    <h3>app/observers/notification_observer.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class NotificationObserver &lt; ActiveRecord::Observer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  observe :contribution, :conversation, :rating_group, :survey_response,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">          :petition, :petition_signature, :reflection, :reflection_comment, :survey</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def after_create(model)</code>
        </li>
      
        <li class="covered" data-hits="98" data-linenumber="7">
          <span class="hits">98</span>
          
          <code class="ruby">    unless model.is_a?(Contribution) &amp;&amp; model.unconfirmed?</code>
        </li>
      
        <li class="covered" data-hits="95" data-linenumber="8">
          <span class="hits">95</span>
          
          <code class="ruby">      Notification.create_for(model)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def before_update(model)</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="13">
          <span class="hits">38</span>
          
          <code class="ruby">    if model.is_a?(Contribution) &amp;&amp; model.confirmed_changed? &amp;&amp; model.confirmed?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">      Notification.create_for(model)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def before_destroy(model)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="19">
          <span class="hits">11</span>
          
          <code class="ruby">    Notification.destroy_for(model)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3c967247385bcacce1870de0fd7ca7101d368332">
  <div class="header">
    <h3>app/observers/person_observer.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PersonObserver &lt; ActiveRecord::Observer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def after_save(person)</code>
        </li>
      
        <li class="covered" data-hits="120" data-linenumber="4">
          <span class="hits">120</span>
          
          <code class="ruby">    AvatarService.update_avatar_url_for(person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ef0307ec34164465aea476a4f6504d2dbfed8dfa">
  <div class="header">
    <h3>app/presenters/contribution_presenter.rb</h3>
    <h4><span class="red">50.0 %</span> covered</h4>
    <div>
      <b>32</b> relevant lines. 
      <span class="green"><b>16</b> lines covered</span> and
      <span class="red"><b>16</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ContributionPresenter &lt; PresenterBase</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include ConversationsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include IssuesHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="6">
          <span class="hits">6</span>
          
          <code class="ruby">    (@object.conversation || @object.issue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_conversation?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    parent.class.name == &quot;Conversation&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_issue?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    parent.class.name == &quot;Issue&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_image</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    parent.image</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_title</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">    if parent.respond_to?(:title)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">      parent.title</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      parent.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_type</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="31">
          <span class="hits">2</span>
          
          <code class="ruby">    parent.class.name.downcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_url</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    if parent_conversation?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">      conversation_url(parent, host: request.host)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">    elsif parent_issue?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">      issue_url(parent, host: request.host)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  def node_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">     if parent_conversation?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">       conversation_node_path( @object )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">     elsif parent_issue?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">       issue_node_path( @object )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">     end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def node_url</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">    if parent_conversation?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">      conversation_node_url( @object, host: request.host )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">    elsif parent_issue?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">      issue_node_url( @object, host: request.host )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="03ce8934637f148c00b3169948249cef43399310">
  <div class="header">
    <h3>app/presenters/conversation_presenter.rb</h3>
    <h4><span class="red">66.67 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ConversationPresenter &lt; PresenterBase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def url</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    conversation_url(@object, host: request.host)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="54f9987f72e16a72b655bea415ccdc48f488671a">
  <div class="header">
    <h3>app/presenters/ingest_presenter.rb</h3>
    <h4><span class="red">29.03 %</span> covered</h4>
    <div>
      <b>31</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>22</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class IngestPresenter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :errors</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(conversation, file=nil)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="6">
          <span class="hits">7</span>
          
          <code class="ruby">    @conversation = conversation</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="7">
          <span class="hits">7</span>
          
          <code class="ruby">    @file = file</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="8">
          <span class="hits">7</span>
          
          <code class="ruby">    @errors = ActiveModel::Errors.new(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def save!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    if @file</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      dialogs = Ingester.ingest(@file.read)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      # before creating top level contributions, validate that all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      # speakers have a unique Person</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      validate_speakers(dialogs)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">      dialogs.each do |dialog|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">        speaker = Person.find_all_by_name(dialog.speaker).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">        contribution = Contribution.create!(:conversation =&gt; @conversation,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">                                            :content =&gt; dialog.content,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">                                            :person =&gt; speaker,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">                                            :top_level_contribution =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">        @conversation.contributions &lt;&lt; contribution</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  rescue Ingester::Error =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    @errors.add_to_base(e.message)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    raise ActiveRecord::RecordInvalid.new(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  # Very primitive way of validating speakers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  # Adds errors if</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  #  o can't identify a Person for the speaker</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  #  o more than 1 Person matches a speaker</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_speakers(dialogs)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    missing_speakers = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">    duplicate_speakers = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">    dialogs.map(&amp;:speaker).uniq.select do |name|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">      people = Person.find_all_by_name(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">      if people.empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">        missing_speakers &lt;&lt; name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      elsif people.size &gt; 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">        duplicate_speakers &lt;&lt; name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">    if missing_speakers.any? || duplicate_speakers.any?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">      missing_speakers.each do |name|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">        @errors.add_to_base(&quot;Could not find a person with name #{name}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">      duplicate_speakers.each do |name|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">        @errors.add_to_base(&quot;More than one Person matched name #{name}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">      raise ActiveRecord::RecordInvalid.new(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ca09b8864ae36b9bee2e5bb939486e13f902319b">
  <div class="header">
    <h3>app/presenters/issue_presenter.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class IssuePresenter &lt; PresenterBase</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def container_attribute</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    &quot;data-issue-id='#{id}'&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def class</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="6">
          <span class="hits">7</span>
          
          <code class="ruby">    Issue</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f6e122baf748cd4ed3aa6baa050878b5963e266e">
  <div class="header">
    <h3>app/presenters/presenter_base.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>8</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PresenterBase &lt; Delegator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include Rails.application.routes.url_helpers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :request</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(object, request=nil)</code>
        </li>
      
        <li class="covered" data-hits="109" data-linenumber="7">
          <span class="hits">109</span>
          
          <code class="ruby">    @object = object</code>
        </li>
      
        <li class="covered" data-hits="109" data-linenumber="8">
          <span class="hits">109</span>
          
          <code class="ruby">    @request = request</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1304" data-linenumber="11">
          <span class="hits">1304</span>
          
          <code class="ruby">  def __getobj__; @object end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def __setobj__(object); @object = object end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5d00741ced9b6403d678149ebff4ea90552b649c">
  <div class="header">
    <h3>app/presenters/presenter_form.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PresenterForm &lt; PresenterBase</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveModel::Naming</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="4">
          <span class="hits">12</span>
          
          <code class="ruby">  def to_model; self end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="85c482c2c341714d2fad1a556d7381fce795d920">
  <div class="header">
    <h3>app/presenters/profile_presenter.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>60</b> relevant lines. 
      <span class="green"><b>60</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProfilePresenter &lt; Delegator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include Rails.application.routes.url_helpers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  PER_PAGE = 10</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(user, params={})</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="7">
          <span class="hits">44</span>
          
          <code class="ruby">    @user = user</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="8">
          <span class="hits">44</span>
          
          <code class="ruby">    @page = params.fetch(:page, 1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def profile_data</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="12">
          <span class="hits">10</span>
          
          <code class="ruby">    data = {}</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="13">
          <span class="hits">10</span>
          
          <code class="ruby">    data[:address] = address if address.present?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="14">
          <span class="hits">10</span>
          
          <code class="ruby">    if organization_detail</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="15">
          <span class="hits">10</span>
          
          <code class="ruby">      data[:phone] = organization_detail.phone if organization_detail.phone.present?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="16">
          <span class="hits">10</span>
          
          <code class="ruby">      data[:facebook] = organization_detail.facebook_page if organization_detail.facebook_page.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="18">
          <span class="hits">10</span>
          
          <code class="ruby">    data[:email] = email if email.present? and is_organization?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="19">
          <span class="hits">10</span>
          
          <code class="ruby">    data[:website] = website if website.present?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="20">
          <span class="hits">10</span>
          
          <code class="ruby">    data[:twitter] = twitter_username if twitter_username.present?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="21">
          <span class="hits">10</span>
          
          <code class="ruby">    data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def __getobj__</code>
        </li>
      
        <li class="covered" data-hits="351" data-linenumber="25">
          <span class="hits">351</span>
          
          <code class="ruby">    @user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_issue_subscriptions?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    not issue_subscriptions.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def issue_subscriptions</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="33">
          <span class="hits">2</span>
          
          <code class="ruby">    @user.subscribed_issues.first(PER_PAGE)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_conversation_subscriptions?</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="37">
          <span class="hits">9</span>
          
          <code class="ruby">    not conversation_subscriptions.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_subscriptions</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="41">
          <span class="hits">10</span>
          
          <code class="ruby">    @user.subscribed_conversations.first(10)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def organization_subscriptions</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="45">
          <span class="hits">9</span>
          
          <code class="ruby">    @user.subscribed_organizations.first(10)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  def all_recent_activity</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    @user.most_recent_activity</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">  def recent_activity</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="53">
          <span class="hits">12</span>
          
          <code class="ruby">    @user.most_recent_activity.paginate(page: @page, per_page: PER_PAGE)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_profile?</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="57">
          <span class="hits">14</span>
          
          <code class="ruby">    has_website? || has_twitter? || has_address? || has_email?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  def title</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="61">
          <span class="hits">15</span>
          
          <code class="ruby">    @user.title if !@user.is_organization?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_recent_activities?</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="65">
          <span class="hits">9</span>
          
          <code class="ruby">    not recent_activity.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  def feed_path</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="69">
          <span class="hits">9</span>
          
          <code class="ruby">    user_path(@user.slug, format: :xml)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">  def feed_title</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="73">
          <span class="hits">9</span>
          
          <code class="ruby">    &quot;#{@user.name} at The Civic Commons&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">  def prompt_to_fill_out_bio? user</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="77">
          <span class="hits">10</span>
          
          <code class="ruby">    user == @user and !bio.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">  def possessive_pronoun</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="81">
          <span class="hits">10</span>
          
          <code class="ruby">    is_organization? ? &quot;Our&quot; : &quot;My&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">  def action_phrase</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="85">
          <span class="hits">18</span>
          
          <code class="ruby">    is_organization? ? &quot;We Are&quot; : &quot;I Am&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">  def website</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="88">
          <span class="hits">16</span>
          
          <code class="ruby">    if @user.website.present? &amp;&amp; !@user.website.match(/^http/)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">      &quot;http://#{@user.website}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="91">
          <span class="hits">15</span>
          
          <code class="ruby">      @user.website</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_email?</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="96">
          <span class="hits">9</span>
          
          <code class="ruby">    @user.email if is_organization?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">  def address</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="101">
          <span class="hits">14</span>
          
          <code class="ruby">    return &quot;&quot; unless has_address?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">    &quot;&quot;&quot;#{organization_detail.street}</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="103">
          <span class="hits">8</span>
          
          <code class="ruby">      #{organization_detail.city}, #{organization_detail.region} #{organization_detail.postal_code}&quot;&quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_address?</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="108">
          <span class="hits">23</span>
          
          <code class="ruby">    organization_detail != nil and organization_detail.present? and organization_detail.has_address?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e26e899dd21d09c385f2a644888f8aa9133e0b9a">
  <div class="header">
    <h3>app/presenters/promotion_form_presenter.rb</h3>
    <h4><span class="red">63.16 %</span> covered</h4>
    <div>
      <b>19</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PromotionFormPresenter &lt; PresenterForm</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include ActiveModel::Validations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include ActiveModel::Conversion</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">                :email,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">                :question,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">                :product</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :email, :name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :email_formatting</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(attributes = {})</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    attributes.each do |name, value|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      send(&quot;#{name}=&quot;, value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def any_errors?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    errors.any?{|key,val|val.present?}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def blank_form?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    self.attributes == @object.class.new.attributes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def persisted?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def email_formatting</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    unless email =~ EmailAddressValidation::PatternExact</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">      errors.add(:email, &quot; must look like: abc@test.com&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="702ba21f54f2e4b703df31d0018ea1627fc4cdb7">
  <div class="header">
    <h3>app/presenters/registration_form_presenter.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class RegistrationFormPresenter &lt; PresenterForm</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def any_errors?</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="4">
          <span class="hits">9</span>
          
          <code class="ruby">    errors.any?{|key,val|val.present?}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def blank_form?</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="8">
          <span class="hits">16</span>
          
          <code class="ruby">    self.attributes == @object.class.new.attributes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def show_normal_fields?</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="12">
          <span class="hits">8</span>
          
          <code class="ruby">    any_errors?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def show_facebook_fields?</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="16">
          <span class="hits">48</span>
          
          <code class="ruby">    not self.authentications.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="115a89b41a9a2dcc416560c56b49d0c703300664">
  <div class="header">
    <h3>app/presenters/subscription_presenter.rb</h3>
    <h4><span class="red">45.0 %</span> covered</h4>
    <div>
      <b>20</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SubscriptionPresenter &lt; PresenterBase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    @object.subscribable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_id; parent.id end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_type; parent.class.name.underscore end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_conversation?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    parent.class.name == &quot;Conversation&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_issue?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    parent.class.name == &quot;Issue&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_image</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    parent.image</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_title</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    if parent.respond_to?(:title)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      parent.title</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">      parent.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def parent_url</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    if parent_conversation?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">      conversation_url(parent, host: request.host)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    elsif parent_issue?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">      issue_url(parent, host: request.host)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f20cf6b9bd30aaf2119442e0f2a0547630f62e9e">
  <div class="header">
    <h3>app/presenters/vote_response_presenter.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>57</b> relevant lines. 
      <span class="green"><b>57</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class VoteResponsePresenter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :survey_response, :confirmed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate  :id, :class, :errors, :to_param, :new_record?, :selected_survey_options, :selected_option_ids, :selected_option_ids=, :survey, :person, :persisted?, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">            :to =&gt; :survey_response</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate  :max_selected_options, :expired?,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">            :to =&gt; :survey</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(options)</code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="10">
          <span class="hits">184</span>
          
          <code class="ruby">    person_id = options.delete(:person_id)</code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="11">
          <span class="hits">184</span>
          
          <code class="ruby">    survey_id = options.delete(:survey_id)</code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="12">
          <span class="hits">184</span>
          
          <code class="ruby">    @survey_response = SurveyResponse.find_or_initialize_by_person_id_and_survey_id(person_id, survey_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="14">
          <span class="hits">184</span>
          
          <code class="ruby">    define_methods_for_selected_options    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="16">
          <span class="hits">184</span>
          
          <code class="ruby">    options.each_pair do |key, val|</code>
        </li>
      
        <li class="covered" data-hits="227" data-linenumber="17">
          <span class="hits">227</span>
          
          <code class="ruby">      self.send(&quot;#{key}=&quot;.to_sym,val)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def selected_option(opt_id)</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="22">
          <span class="hits">25</span>
          
          <code class="ruby">    self.send(&quot;selected_option_#{opt_id}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def confirmed?</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="26">
          <span class="hits">12</span>
          
          <code class="ruby">    !!@confirmed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def already_voted?</code>
        </li>
      
        <li class="covered" data-hits="73" data-linenumber="30">
          <span class="hits">73</span>
          
          <code class="ruby">    survey_response.persisted?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def allowed?</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="34">
          <span class="hits">76</span>
          
          <code class="ruby">    !(expired? || already_voted?)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  def available_options</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="38">
          <span class="hits">17</span>
          
          <code class="ruby">    survey.options.position_sorted - selected_survey_options.collect{|record| record.survey_option}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def options_sorted</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="42">
          <span class="hits">8</span>
          
          <code class="ruby">    survey.options.position_sorted</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def define_methods_for_selected_options</code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="46">
          <span class="hits">184</span>
          
          <code class="ruby">    max_selected_options.times do |i|</code>
        </li>
      
        <li class="covered" data-hits="540" data-linenumber="47">
          <span class="hits">540</span>
          
          <code class="ruby">      index = i+1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      # def selected_survey_option_1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      #   @selected_survey_option_1 ||= selected_survey_options.find_or_initialize_by_position(1) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      # end</code>
        </li>
      
        <li class="covered" data-hits="540" data-linenumber="52">
          <span class="hits">540</span>
          
          <code class="ruby">      define_singleton_method &quot;selected_survey_option_#{index}&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1636" data-linenumber="53">
          <span class="hits">1636</span>
          
          <code class="ruby">        if not instance_variable_defined?(&quot;@selected_survey_option_#{index}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="435" data-linenumber="54">
          <span class="hits">435</span>
          
          <code class="ruby">          instance_variable_set &quot;@selected_survey_option_#{index}&quot;, selected_survey_options.find_or_initialize_by_position(index) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1636" data-linenumber="56">
          <span class="hits">1636</span>
          
          <code class="ruby">        selected_survey_option = instance_variable_get &quot;@selected_survey_option_#{index}&quot;</code>
        </li>
      
        <li class="covered" data-hits="1636" data-linenumber="57">
          <span class="hits">1636</span>
          
          <code class="ruby">        selected_survey_option.bypass_presence_validation = true</code>
        </li>
      
        <li class="covered" data-hits="1636" data-linenumber="58">
          <span class="hits">1636</span>
          
          <code class="ruby">        return selected_survey_option</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      # def selected_option_1_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      #   selected_survey_option_1.survey_option_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      # end</code>
        </li>
      
        <li class="covered" data-hits="540" data-linenumber="64">
          <span class="hits">540</span>
          
          <code class="ruby">      define_singleton_method &quot;selected_option_#{index}_id&quot; do</code>
        </li>
      
        <li class="covered" data-hits="454" data-linenumber="65">
          <span class="hits">454</span>
          
          <code class="ruby">        self.send(&quot;selected_survey_option_#{index}&quot;).survey_option_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      # def selected_option_1_id=(val)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">      #   selected_survey_option_1.survey_option_id = val</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">      # end</code>
        </li>
      
        <li class="covered" data-hits="540" data-linenumber="71">
          <span class="hits">540</span>
          
          <code class="ruby">      define_singleton_method &quot;selected_option_#{index}_id=&quot; do |val|</code>
        </li>
      
        <li class="covered" data-hits="218" data-linenumber="72">
          <span class="hits">218</span>
          
          <code class="ruby">        self.send(&quot;selected_survey_option_#{index}&quot;).survey_option_id = val</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">      # def selected_option_1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">      #   selected_survey_option_1.survey_option</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      # end</code>
        </li>
      
        <li class="covered" data-hits="540" data-linenumber="78">
          <span class="hits">540</span>
          
          <code class="ruby">      define_singleton_method &quot;selected_option_#{index}&quot; do</code>
        </li>
      
        <li class="covered" data-hits="78" data-linenumber="79">
          <span class="hits">78</span>
          
          <code class="ruby">        self.send(&quot;selected_survey_option_#{index}&quot;).survey_option</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">      # def selected_option_1=(obj)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      #   selected_survey_option_1.survey_option_id = obj</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      # end</code>
        </li>
      
        <li class="covered" data-hits="540" data-linenumber="85">
          <span class="hits">540</span>
          
          <code class="ruby">      define_singleton_method &quot;selected_option_#{index}=&quot; do |obj|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">        self.send(&quot;selected_survey_option_#{index}&quot;).survey_option = obj</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">  def valid_selected_options?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="92">
          <span class="hits">5</span>
          
          <code class="ruby">    survey_response.validate_presence_of_selected_option = true</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="93">
          <span class="hits">5</span>
          
          <code class="ruby">    survey_response.valid?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="94">
          <span class="hits">5</span>
          
          <code class="ruby">    survey_response.errors[:selected_option_ids].blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">  def only_one_selected_option?</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="98">
          <span class="hits">6</span>
          
          <code class="ruby">    selected_option_ids.length == 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">  def save</code>
        </li>
      
        <li class="covered" data-hits="118" data-linenumber="102">
          <span class="hits">118</span>
          
          <code class="ruby">    ActiveRecord::Base.transaction do</code>
        </li>
      
        <li class="covered" data-hits="118" data-linenumber="103">
          <span class="hits">118</span>
          
          <code class="ruby">      survey_response.save!</code>
        </li>
      
        <li class="covered" data-hits="118" data-linenumber="104">
          <span class="hits">118</span>
          
          <code class="ruby">      max_selected_options.times do |i|</code>
        </li>
      
        <li class="covered" data-hits="352" data-linenumber="105">
          <span class="hits">352</span>
          
          <code class="ruby">        index = i+1</code>
        </li>
      
        <li class="covered" data-hits="352" data-linenumber="106">
          <span class="hits">352</span>
          
          <code class="ruby">        unless self.send(&quot;selected_option_#{index}_id&quot;).blank?</code>
        </li>
      
        <li class="covered" data-hits="177" data-linenumber="107">
          <span class="hits">177</span>
          
          <code class="ruby">          self.send(&quot;selected_survey_option_#{index}&quot;).bypass_survey_option_id_uniqueness = true #bypasses the validates_uniqueness_of</code>
        </li>
      
        <li class="covered" data-hits="177" data-linenumber="108">
          <span class="hits">177</span>
          
          <code class="ruby">          survey_response.selected_survey_options &lt;&lt; self.send(&quot;selected_survey_option_#{index}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="110">
          <span class="hits">175</span>
          
          <code class="ruby">          self.send(&quot;selected_survey_option_#{index}&quot;).destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="352" data-linenumber="112">
          <span class="hits">352</span>
          
          <code class="ruby">        errors.add(&quot;selected_option_#{index}_id&quot;,self.send(&quot;selected_survey_option_#{index}&quot;).errors.full_messages) if self.send(&quot;selected_survey_option_#{index}&quot;).errors.any?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="118" data-linenumber="115">
          <span class="hits">118</span>
          
          <code class="ruby">    errors.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d9df10f5219ad23243c1ec6b5690500b23be24da">
  <div class="header">
    <h3>app/services/avatar_service.rb</h3>
    <h4><span class="green">93.75 %</span> covered</h4>
    <div>
      <b>32</b> relevant lines. 
      <span class="green"><b>30</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'digest'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require 'net/http'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require 'uri'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">class AvatarService</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.avatar_image_url(person, options={})</code>
        </li>
      
        <li class="covered" data-hits="172" data-linenumber="8">
          <span class="hits">172</span>
          
          <code class="ruby">    request = options.delete(:request)</code>
        </li>
      
        <li class="covered" data-hits="172" data-linenumber="9">
          <span class="hits">172</span>
          
          <code class="ruby">    if request.present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">      base_url = &quot;#{request.protocol}#{request.host_with_port}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="172" data-linenumber="12">
          <span class="hits">172</span>
          
          <code class="ruby">      base_url = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    # Image displayed by order of priority</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    # 1. image uploaded</code>
        </li>
      
        <li class="covered" data-hits="172" data-linenumber="16">
          <span class="hits">172</span>
          
          <code class="ruby">    return person.avatar.url(:standard) if person.avatar?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    # 2. facebook</code>
        </li>
      
        <li class="covered" data-hits="171" data-linenumber="18">
          <span class="hits">171</span>
          
          <code class="ruby">    return self.facebook_image_url(person) if person.authentications.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # 3. twitter</code>
        </li>
      
        <li class="covered" data-hits="154" data-linenumber="20">
          <span class="hits">154</span>
          
          <code class="ruby">    return self.twitter_image_url(person) if person.twitter_username.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    # 4. gravatar</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="22">
          <span class="hits">146</span>
          
          <code class="ruby">    return self.gravatar_image_url(person) if self.gravatar_available?(person)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    # 5. default - need to be absolute path, due to widget</code>
        </li>
      
        <li class="covered" data-hits="144" data-linenumber="24">
          <span class="hits">144</span>
          
          <code class="ruby">    &quot;#{base_url}#{person.avatar.url(:standard)}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.facebook_image_url(person)</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="28">
          <span class="hits">17</span>
          
          <code class="ruby">    facebook_id = person.authentications.first.uid</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="29">
          <span class="hits">17</span>
          
          <code class="ruby">    &quot;https://graph.facebook.com/#{facebook_id}/picture&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.twitter_image_url(person)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="33">
          <span class="hits">8</span>
          
          <code class="ruby">    &quot;http://api.twitter.com/1/users/profile_image/#{person.twitter_username}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.gravatar_available?(person)</code>
        </li>
      
        <li class="covered" data-hits="142" data-linenumber="37">
          <span class="hits">142</span>
          
          <code class="ruby">    gravatar_response = Net::HTTP.get_response(URI.parse(gravatar_image_url(person)))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="142" data-linenumber="39">
          <span class="hits">142</span>
          
          <code class="ruby">    unless gravatar_response.class == Net::HTTPNotFound</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="142" data-linenumber="42">
          <span class="hits">142</span>
          
          <code class="ruby">      false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.gravatar_image_url(person)</code>
        </li>
      
        <li class="covered" data-hits="144" data-linenumber="47">
          <span class="hits">144</span>
          
          <code class="ruby">    hashed_email = self.create_email_hash(person)</code>
        </li>
      
        <li class="covered" data-hits="144" data-linenumber="48">
          <span class="hits">144</span>
          
          <code class="ruby">    &quot;http://gravatar.com/avatar/#{hashed_email}?d=404&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.create_email_hash(person)</code>
        </li>
      
        <li class="covered" data-hits="142" data-linenumber="52">
          <span class="hits">142</span>
          
          <code class="ruby">    Digest::MD5.hexdigest(person.email)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  # Update an entities avatar url</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.update_avatar_url_for(person)</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="57">
          <span class="hits">153</span>
          
          <code class="ruby">    avatar_image = avatar_image_url(person)</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="58">
          <span class="hits">153</span>
          
          <code class="ruby">    Person.update_all({avatar_url: avatar_image, avatar_cached_image_url: avatar_image}, {id: person.id})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5d883922a643e8f0f1d1fccbb301c1060d2fd16e">
  <div class="header">
    <h3>app/services/digest_service.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>89</b> relevant lines. 
      <span class="green"><b>89</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class DigestService</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :digest_recipients,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">              :digest_set,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">              :updated_contributions,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">              :updated_conversations,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">              :updated_reflections,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">              :votes_created_activities,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">              :votes_ended_activities,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">              :vote_response_activities,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">              :new_petitions,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">              :petition_signatures_activity,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">              :grouped_petition_signatures_activity</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="16">
          <span class="hits">20</span>
          
          <code class="ruby">    @digest_set = { }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  #TODO: Make a class for the digest data and return an array of that class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  #TODO: Use 'letter' param to segment the data set by first letter of last name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  #TODO: Optimize the data retrieval</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def generate_digest_set(letter = nil)</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="23">
          <span class="hits">22</span>
          
          <code class="ruby">    get_digest_recipients</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="24">
          <span class="hits">22</span>
          
          <code class="ruby">    get_updated_reflections</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="25">
          <span class="hits">22</span>
          
          <code class="ruby">    get_vote_activities</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="26">
          <span class="hits">22</span>
          
          <code class="ruby">    get_petition_related_activities</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="27">
          <span class="hits">22</span>
          
          <code class="ruby">    get_updated_contributions</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="28">
          <span class="hits">22</span>
          
          <code class="ruby">    get_updated_conversations</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="29">
          <span class="hits">22</span>
          
          <code class="ruby">    get_recipient_subscriptions</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="30">
          <span class="hits">22</span>
          
          <code class="ruby">    group_activities_by_conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def process_daily_digest(set = nil)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    # get the set of people receiving the digest email</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="36">
          <span class="hits">8</span>
          
          <code class="ruby">    set = self.generate_digest_set if set.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    # for each person</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="38">
          <span class="hits">8</span>
          
          <code class="ruby">    set.each do |person, conversations|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="40">
          <span class="hits">7</span>
          
          <code class="ruby">      unless set[person].empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">        # send the email</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="42">
          <span class="hits">6</span>
          
          <code class="ruby">        Notifier.daily_digest(person, conversations).deliver</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_digest_recipients</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="50">
          <span class="hits">22</span>
          
          <code class="ruby">    @digest_recipients = Person.where(:daily_digest =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def time_range</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    # set the time range for yesterday</code>
        </li>
      
        <li class="covered" data-hits="154" data-linenumber="55">
          <span class="hits">154</span>
          
          <code class="ruby">    (Time.now.midnight - 1.day)..(Time.now.midnight - 1.second)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_updated_contributions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    # get the list of conversations that were updated yesterday</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="60">
          <span class="hits">22</span>
          
          <code class="ruby">    @updated_contributions = Contribution.confirmed.includes(:conversation).order('conversation_id ASC, id ASC').where(created_at: time_range).where(top_level_contribution: false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_updated_conversations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    # extract the individual conversation ids</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    # Get conversations from updated contributions</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="67">
          <span class="hits">30</span>
          
          <code class="ruby">    @updated_conversations = @updated_contributions.map { |c| c.conversation }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    # Get conversations from updated reflections</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="69">
          <span class="hits">26</span>
          
          <code class="ruby">    @updated_conversations += @updated_reflections.map { |c| c.conversation }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    # Get conversations from votes created</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="72">
          <span class="hits">37</span>
          
          <code class="ruby">    @updated_conversations += @votes_created_activities.map { |c| c.surveyable }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    # Get conversations from votes ended</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="74">
          <span class="hits">37</span>
          
          <code class="ruby">    @updated_conversations += @votes_ended_activities.map { |c| c.surveyable }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    # Get conversations from votes responses</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="76">
          <span class="hits">37</span>
          
          <code class="ruby">    @updated_conversations += @vote_response_activities.map { |c| c.survey.surveyable }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">    ##### PETITION RELATED ACTIVITY #####</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    # Get Conversations from Petitions Created</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="80">
          <span class="hits">26</span>
          
          <code class="ruby">    @updated_conversations += @new_petitions.map {|p| p.conversation } if @new_petitions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">    # Get Conversations from Petition Signatures</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="82">
          <span class="hits">26</span>
          
          <code class="ruby">    @updated_conversations += @petition_signatures_activity.map {|sig| sig.petition_conversation } if @petition_signatures_activity</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="84">
          <span class="hits">22</span>
          
          <code class="ruby">    @updated_conversations.uniq!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_updated_reflections</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="88">
          <span class="hits">22</span>
          
          <code class="ruby">    @updated_reflections = Reflection.includes(:conversation).order('conversation_id ASC, id ASC').where(created_at: time_range)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_recipient_subscriptions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    # get the subscriptions for each person</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="93">
          <span class="hits">22</span>
          
          <code class="ruby">    @digest_recipients.each do |person|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="95">
          <span class="hits">21</span>
          
          <code class="ruby">      subscriptions = person.subscriptions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="97">
          <span class="hits">21</span>
          
          <code class="ruby">      digest = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="99">
          <span class="hits">21</span>
          
          <code class="ruby">      subscriptions.each do |sub|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">        # is the subscription in the list of current conversations?</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="102">
          <span class="hits">31</span>
          
          <code class="ruby">        if @updated_conversations.include? sub.subscribable</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="103">
          <span class="hits">20</span>
          
          <code class="ruby">          digest &lt;&lt; [sub.subscribable]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="107">
          <span class="hits">21</span>
          
          <code class="ruby">      @digest_set[person] = digest</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_votes_created_activities</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="113">
          <span class="hits">22</span>
          
          <code class="ruby">    @votes_created_activities = Vote.where(surveyable_type: Conversation, created_at: time_range).order('surveyable_id ASC, id ASC').includes(:surveyable)</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="114">
          <span class="hits">22</span>
          
          <code class="ruby">    @votes_created_activities.each do |record|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">      #set this as an indicator for the mailer view</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="116">
          <span class="hits">15</span>
          
          <code class="ruby">      record.daily_digest_type = 'created'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_votes_ended_activities</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="121">
          <span class="hits">22</span>
          
          <code class="ruby">    @votes_ended_activities = Vote.where(surveyable_type: Conversation, end_date: time_range.last.to_date).order('surveyable_id ASC, id ASC').includes(:surveyable)</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="122">
          <span class="hits">22</span>
          
          <code class="ruby">    @votes_ended_activities.each do |record|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">      #set this as an indicator for the mailer view</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="124">
          <span class="hits">15</span>
          
          <code class="ruby">      record.daily_digest_type = 'ended'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_vote_response_activities</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="130">
          <span class="hits">22</span>
          
          <code class="ruby">    @vote_response_activities = SurveyResponse.joins(:survey).where(surveys: {surveyable_type: Conversation, type: Vote}, created_at: time_range).includes( survey: :surveyable)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_vote_activities</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="134">
          <span class="hits">22</span>
          
          <code class="ruby">    get_votes_created_activities</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="135">
          <span class="hits">22</span>
          
          <code class="ruby">    get_votes_ended_activities</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="136">
          <span class="hits">22</span>
          
          <code class="ruby">    get_vote_response_activities</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">  # Retrieves all the activity related to Petitions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">  # 1) Petition Creation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">  # 2) Petition Signatures</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_petition_related_activities</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="143">
          <span class="hits">22</span>
          
          <code class="ruby">    get_new_petitions</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="144">
          <span class="hits">22</span>
          
          <code class="ruby">    get_petition_signatures_activity</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">  # Get All New Petitions</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_new_petitions</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="149">
          <span class="hits">22</span>
          
          <code class="ruby">    @new_petitions = Petition.where(created_at: time_range).order('created_at ASC')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">  # Get Activity from Users Signing Petitions</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_petition_signatures_activity</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="154">
          <span class="hits">22</span>
          
          <code class="ruby">    @petition_signatures_activity = PetitionSignature.where(created_at: time_range).order('created_at ASC')</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="155">
          <span class="hits">26</span>
          
          <code class="ruby">    @grouped_petition_signatures_activity = @petition_signatures_activity.group_by(&amp;:petition_id).map{|k,v| [k,v]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">  # Gather All Activity by Conversation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">  def group_activities_by_conversation</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="160">
          <span class="hits">22</span>
          
          <code class="ruby">    @digest_set.each do |person, conversations_array|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="162">
          <span class="hits">21</span>
          
          <code class="ruby">      conversations_array.each do |conversation|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="164">
          <span class="hits">20</span>
          
          <code class="ruby">        contributions = @updated_contributions.select do |contribution|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="165">
          <span class="hits">8</span>
          
          <code class="ruby">          contribution.conversation == conversation.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="168">
          <span class="hits">20</span>
          
          <code class="ruby">        reflections = @updated_reflections.select do |reflection|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="169">
          <span class="hits">4</span>
          
          <code class="ruby">          reflection.conversation == conversation.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="172">
          <span class="hits">20</span>
          
          <code class="ruby">        votes_created = @votes_created_activities.select do |vote|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="173">
          <span class="hits">15</span>
          
          <code class="ruby">          vote.surveyable == conversation.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="176">
          <span class="hits">20</span>
          
          <code class="ruby">        votes_ended = @votes_ended_activities.select do |vote|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="177">
          <span class="hits">15</span>
          
          <code class="ruby">          vote.surveyable == conversation.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="180">
          <span class="hits">20</span>
          
          <code class="ruby">        vote_responses = @vote_response_activities.select do |vote_response|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="181">
          <span class="hits">15</span>
          
          <code class="ruby">          vote_response.survey.surveyable == conversation.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="184">
          <span class="hits">20</span>
          
          <code class="ruby">        petitions_created = @new_petitions.select do |petition|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="185">
          <span class="hits">4</span>
          
          <code class="ruby">          petition.conversation == conversation.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="188">
          <span class="hits">20</span>
          
          <code class="ruby">        grouped_petition_signatures = @grouped_petition_signatures_activity.select do |petition_signature|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="189">
          <span class="hits">4</span>
          
          <code class="ruby">          petition_signature[1][0].petition_conversation == conversation.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="192">
          <span class="hits">20</span>
          
          <code class="ruby">        items = (contributions + reflections + votes_created + votes_ended + vote_responses + petitions_created + grouped_petition_signatures)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="194">
          <span class="hits">20</span>
          
          <code class="ruby">        conversation &lt;&lt; items</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="197">
          <span class="hits">22</span>
          
          <code class="ruby">    return @digest_set</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">  #TODO: Use 'letter' param to segment the data set by first letter of last name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.send_digest(letter = nil, set = nil)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="204">
          <span class="hits">5</span>
          
          <code class="ruby">    digest = self.new</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="205">
          <span class="hits">5</span>
          
          <code class="ruby">    digest.generate_digest_set(letter)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="206">
          <span class="hits">5</span>
          
          <code class="ruby">    digest.process_daily_digest(set)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f909e6a77b0188250de2f1afa724603b93172411">
  <div class="header">
    <h3>app/services/embedly_service.rb</h3>
    <h4><span class="yellow">84.54 %</span> covered</h4>
    <div>
      <b>207</b> relevant lines. 
      <span class="green"><b>175</b> lines covered</span> and
      <span class="red"><b>32</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class EmbedlyService</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # http://embed.ly/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  # https://pro.embed.ly/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # http://explore.embed.ly/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # http://api.embed.ly/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  HTTP = /^https?:\/\//i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :properties</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :error</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :error_code</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(embedly = nil)</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="15">
          <span class="hits">48</span>
          
          <code class="ruby">    clear_state</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="16">
          <span class="hits">48</span>
          
          <code class="ruby">    if embedly.nil?</code>
        </li>
      
        <li class="covered" data-hits="43" data-linenumber="17">
          <span class="hits">43</span>
          
          <code class="ruby">      @embedly = Embedly::API.new(key: Civiccommons::Config.embedly['key'])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="19">
          <span class="hits">5</span>
          
          <code class="ruby">      @embedly = embedly</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def fetch(url, opts = {})</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="24">
          <span class="hits">41</span>
          
          <code class="ruby">    clear_state</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="25">
          <span class="hits">41</span>
          
          <code class="ruby">    opts[:url] = url.strip</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="26">
          <span class="hits">41</span>
          
          <code class="ruby">    opts[:url] = &quot;http://#{opts[:url]}&quot; if opts[:url].match(HTTP).nil?</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="27">
          <span class="hits">41</span>
          
          <code class="ruby">    opts[:wmode] = 'opaque'</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="28">
          <span class="hits">41</span>
          
          <code class="ruby">    objs = @embedly.objectify(opts)</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="29">
          <span class="hits">39</span>
          
          <code class="ruby">    @properties = objs[0].marshal_dump</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="30">
          <span class="hits">38</span>
          
          <code class="ruby">    raise @properties[:error_message] if @properties.has_key?(:error_message)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  rescue =&gt; error</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="32">
          <span class="hits">5</span>
          
          <code class="ruby">    @error = error.message</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="33">
          <span class="hits">5</span>
          
          <code class="ruby">    if not @properties.nil? and @properties.has_key?(:error_code)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="34">
          <span class="hits">2</span>
          
          <code class="ruby">      @error_code = @properties[:error_code].to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="36">
          <span class="hits">3</span>
          
          <code class="ruby">      @error_code = 500</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="37">
          <span class="hits">3</span>
          
          <code class="ruby">      @error = &quot;Server Issues&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="39">
          <span class="hits">5</span>
          
          <code class="ruby">    @properties = nil</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="40">
          <span class="hits">5</span>
          
          <code class="ruby">    Rails.logger.error error.message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def fetch_and_merge_params!(params)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="44">
          <span class="hits">4</span>
          
          <code class="ruby">    fetch(params[:contribution][:url])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="45">
          <span class="hits">4</span>
          
          <code class="ruby">    unless properties.nil?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="46">
          <span class="hits">4</span>
          
          <code class="ruby">      if properties[:type] == 'html' and not properties[:oembed].empty?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="47">
          <span class="hits">4</span>
          
          <code class="ruby">        params[:contribution][:embedly_type] = properties[:oembed][:type]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">        params[:contribution][:embedly_type] = properties[:type]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="51">
          <span class="hits">4</span>
          
          <code class="ruby">      params[:contribution][:embedly_code] = raw</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="52">
          <span class="hits">4</span>
          
          <code class="ruby">      params[:contribution][:url] = properties[:url]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="53">
          <span class="hits">4</span>
          
          <code class="ruby">      params[:contribution][:title] = properties[:title] unless properties[:title].blank?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="54">
          <span class="hits">4</span>
          
          <code class="ruby">      if params[:description].blank? and not properties[:title].blank?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="55">
          <span class="hits">4</span>
          
          <code class="ruby">        params[:contribution][:description] = properties[:description]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="58">
          <span class="hits">4</span>
          
          <code class="ruby">    return (not properties.nil?)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  def fetch_and_update_attributes(contribution)</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="62">
          <span class="hits">28</span>
          
          <code class="ruby">    fetch(contribution.url)</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="63">
          <span class="hits">28</span>
          
          <code class="ruby">    unless properties.nil?</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="64">
          <span class="hits">28</span>
          
          <code class="ruby">      if properties[:type] == 'html' and not properties[:oembed].empty?</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="65">
          <span class="hits">28</span>
          
          <code class="ruby">        contribution.embedly_type = properties[:oembed][:type]</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="66">
          <span class="hits">28</span>
          
          <code class="ruby">        contribution.embed_target = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">        contribution.embedly_type = properties[:type]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="70">
          <span class="hits">28</span>
          
          <code class="ruby">      contribution.embedly_code = raw</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="71">
          <span class="hits">28</span>
          
          <code class="ruby">      contribution.url = properties[:url]</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="72">
          <span class="hits">28</span>
          
          <code class="ruby">      contribution.title = properties[:title] unless properties[:title].blank?</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="73">
          <span class="hits">28</span>
          
          <code class="ruby">      unless  properties[:title].blank?</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="74">
          <span class="hits">28</span>
          
          <code class="ruby">        contribution.description = properties[:description]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="77">
          <span class="hits">28</span>
          
          <code class="ruby">    return (not properties.nil?)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  ### Error Code Convenience Methods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">  def ok?</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="83">
          <span class="hits">7</span>
          
          <code class="ruby">    @error_code == 200</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  def bad_request?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">    @error_code == 400</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">  def forbidden?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">    @error_code == 403</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">  def not_found?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">    @error_code == 404</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">  def server_issues?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">    @error_code == 500</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">  def not_implemented?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">    @error_code == 501</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">  def raw</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="107">
          <span class="hits">34</span>
          
          <code class="ruby">    @properties.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">  ### Utility Methods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">  def load(data)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="113">
          <span class="hits">8</span>
          
          <code class="ruby">    @properties = EmbedlyService.parse_raw(data)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="114">
          <span class="hits">8</span>
          
          <code class="ruby">    return self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.parse_raw(data)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="119">
          <span class="hits">395</span>
          
          <code class="ruby">    if not data.is_a?(Hash)</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="120">
          <span class="hits">105</span>
          
          <code class="ruby">      data = data.embedly_code if data.is_a?(Contribution)</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="121">
          <span class="hits">105</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="122">
          <span class="hits">105</span>
          
          <code class="ruby">        data = JSON.parse(data)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">      rescue JSON::ParserError, TypeError</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="124">
          <span class="hits">80</span>
          
          <code class="ruby">        data = {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="128">
          <span class="hits">395</span>
          
          <code class="ruby">    data.keys.each do |key|</code>
        </li>
      
        <li class="covered" data-hits="1763" data-linenumber="129">
          <span class="hits">1763</span>
          
          <code class="ruby">      if not key.is_a?(Symbol)</code>
        </li>
      
        <li class="covered" data-hits="1533" data-linenumber="130">
          <span class="hits">1533</span>
          
          <code class="ruby">        new_key = key.to_sym</code>
        </li>
      
        <li class="covered" data-hits="1533" data-linenumber="131">
          <span class="hits">1533</span>
          
          <code class="ruby">        data[new_key] = data[key]</code>
        </li>
      
        <li class="covered" data-hits="1533" data-linenumber="132">
          <span class="hits">1533</span>
          
          <code class="ruby">        data.delete(key)</code>
        </li>
      
        <li class="covered" data-hits="1533" data-linenumber="133">
          <span class="hits">1533</span>
          
          <code class="ruby">        if data[new_key].is_a?(Hash)</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="134">
          <span class="hits">175</span>
          
          <code class="ruby">          data[new_key] = self.parse_raw(data[new_key])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">        elsif data[new_key].is_a?(Array)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="136">
          <span class="hits">86</span>
          
          <code class="ruby">          data[new_key].each do |element|</code>
        </li>
      
        <li class="covered" data-hits="176" data-linenumber="137">
          <span class="hits">176</span>
          
          <code class="ruby">            element = self.parse_raw(element)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="143">
          <span class="hits">395</span>
          
          <code class="ruby">    return data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get_simple_embed(url, max_embed_width = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">    embed = nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">    service = EmbedlyService.new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">    service.fetch(url)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">    embed = service.to_embed_or_fancybox(max_embed_width) if service.ok?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">    return embed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">  def to_embed_or_fancybox(max_embed_width = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">    EmbedlyService.to_embed_or_fancybox(properties, max_embed_width)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="158">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.to_embed_or_fancybox(code, max_embed_width = nil)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="160">
          <span class="hits">4</span>
          
          <code class="ruby">    html = nil</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="161">
          <span class="hits">4</span>
          
          <code class="ruby">    code = self.parse_raw(code) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    # link type always generates linked thumbnail</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="164">
          <span class="hits">4</span>
          
          <code class="ruby">    if code[:type] == 'link' or code[:oembed][:type] == 'link'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="165">
          
          
          <code class="ruby">      html = self.to_linked_thumbnail(code, max_embed_width)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">    # only show full embed if the width is less than max</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">    elsif !max_embed_width.nil? &amp;&amp; !code[:oembed].empty? &amp;&amp; code[:oembed].has_key?(:html)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">      match = code[:oembed][:html].match(/width=&quot;(?&lt;width&gt;\d+)&quot;/i) </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">      if !match.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">        width = match[:width].to_i</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">        if width &lt;= max_embed_width</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">          html = self.to_embed(code)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">    # otherwise show fancybox</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="179">
          <span class="hits">4</span>
          
          <code class="ruby">    if html.nil?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="180">
          <span class="hits">3</span>
          
          <code class="ruby">      html = self.to_fancybox(code, max_embed_width)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="183">
          <span class="hits">4</span>
          
          <code class="ruby">    return html</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">  def to_embed</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="187">
          <span class="hits">4</span>
          
          <code class="ruby">    EmbedlyService.to_embed(properties)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.to_embed(code)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="192">
          <span class="hits">12</span>
          
          <code class="ruby">    html = nil</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="193">
          <span class="hits">12</span>
          
          <code class="ruby">    code = self.parse_raw(code)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="195">
          <span class="hits">12</span>
          
          <code class="ruby">    if code.has_key?(:oembed) and not code.has_key?(:error_code)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="196">
          <span class="hits">8</span>
          
          <code class="ruby">      if code[:oembed].has_key?(:html)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="197">
          <span class="hits">6</span>
          
          <code class="ruby">        html = code[:oembed][:html]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">      elsif code[:oembed][:type] == 'photo'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">        html = self.generate_img_html(code[:oembed])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">      elsif code[:oembed][:type] == 'link' || code[:type] == 'link'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="201">
          
          
          <code class="ruby">        html = self.generate_link_html(code[:oembed][:url], code[:oembed][:title])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">        html = self.generate_link_html(code[:url], code[:title])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="207">
          <span class="hits">12</span>
          
          <code class="ruby">    return html</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.to_linked_thumbnail(code, maxwidth = nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="211">
          
          
          <code class="ruby">    thumb = self.to_thumbnail(code, maxwidth)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="212">
          
          
          <code class="ruby">    return self.generate_link_html(code[:url], code[:title], thumb)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">  def to_thumbnail(maxwidth = nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="216">
          
          
          <code class="ruby">    EmbedlyService.to_thumbnail(properties, maxwidth)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.to_thumbnail(code, maxwidth = nil)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="221">
          <span class="hits">11</span>
          
          <code class="ruby">    html = nil</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="222">
          <span class="hits">11</span>
          
          <code class="ruby">    img = nil</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="223">
          <span class="hits">11</span>
          
          <code class="ruby">    code = self.parse_raw(code)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="225">
          <span class="hits">11</span>
          
          <code class="ruby">    if not code[:oembed].empty? and code[:oembed].has_key?(:thumbnail_url)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="226">
          <span class="hits">8</span>
          
          <code class="ruby">      img = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">        :url =&gt; code[:oembed][:thumbnail_url],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">        :height =&gt; code[:oembed][:thumbnail_height],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">        :width =&gt; code[:oembed][:thumbnail_width],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">    elsif !code[:images].empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="232">
          
          
          <code class="ruby">      small = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="234">
          
          
          <code class="ruby">      if maxwidth.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="235">
          
          
          <code class="ruby">        code[:images].each do |image|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">          if img.nil? or (image[:width].to_i &gt; img[:width].to_i)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="237">
          
          
          <code class="ruby">            img = image</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="241">
          
          
          <code class="ruby">        code[:images].each do |image|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="242">
          
          
          <code class="ruby">          if image[:width].to_i &lt; maxwidth &amp;&amp; (img.nil? || image[:width].to_i &gt; img[:width].to_i)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="243">
          
          
          <code class="ruby">            img = image</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="245">
          
          
          <code class="ruby">          if small.nil? or (image[:width].to_i &lt; small[:width].to_i)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="246">
          
          
          <code class="ruby">            small = image</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="249">
          
          
          <code class="ruby">        img = small if img.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">    end </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="253">
          <span class="hits">11</span>
          
          <code class="ruby">    if not img.nil?</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="254">
          <span class="hits">8</span>
          
          <code class="ruby">      if not maxwidth.nil? and img[:width].to_i &gt; maxwidth</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">        img[:height] = img[:height].to_i * maxwidth / img[:width].to_i</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">        img[:width] = maxwidth</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="258">
          <span class="hits">8</span>
          
          <code class="ruby">      opt = { description: code[:description], title: code[:title] }</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="259">
          <span class="hits">8</span>
          
          <code class="ruby">      opt.merge!(img)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="260">
          <span class="hits">8</span>
          
          <code class="ruby">      html = self.generate_img_html(opt)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="263">
          <span class="hits">11</span>
          
          <code class="ruby">    return html</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">  def to_fancybox(thumb_maxwdith = nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="267">
          
          
          <code class="ruby">    EmbedlyService.to_thumbnail(properties, thumb_maxwidth)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.to_fancybox(code, thumb_maxwidth = nil)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby">    # http://fancybox.net/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">    #&lt;a id=&quot;inline&quot; href=&quot;#data&quot;&gt;thumbnail&lt;/a&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby">    #&lt;div style=&quot;display:none&quot;&gt;&lt;div id=&quot;data&quot;&gt;embed&lt;/div&gt;&lt;/div&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="276">
          
          
          <code class="ruby">    #&lt;a id=&quot;single_image&quot; href=&quot;image_big.jpg&quot;&gt;&lt;img src=&quot;image_small.jpg&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="278">
          <span class="hits">3</span>
          
          <code class="ruby">    html = nil</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="279">
          <span class="hits">3</span>
          
          <code class="ruby">    code = self.parse_raw(code)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="281">
          <span class="hits">3</span>
          
          <code class="ruby">    if code.has_key?(:oembed)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="283">
          <span class="hits">3</span>
          
          <code class="ruby">      r = 1000 + rand(9000)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="285">
          <span class="hits">3</span>
          
          <code class="ruby">      html = ''</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="286">
          <span class="hits">3</span>
          
          <code class="ruby">      js = &quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">        &lt;script type='text/javascript'&gt; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">          //&lt;![CDATA[</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">            $(document).ready(function() {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">              $(\&quot;a#single_image-#{r}\&quot;).fancybox({'scrolling': 'no'});</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">            });</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">          //]]&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">        &lt;/script&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">      &quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="296">
          <span class="hits">3</span>
          
          <code class="ruby">      thumbnail = self.to_thumbnail(code, thumb_maxwidth)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="298">
          <span class="hits">3</span>
          
          <code class="ruby">      if not thumbnail.nil?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="299">
          <span class="hits">2</span>
          
          <code class="ruby">        if code[:oembed][:type] == 'photo'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">          html &lt;&lt; js</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="301">
          <span class="hits">1</span>
          
          <code class="ruby">          html &lt;&lt; &quot;&lt;a id=\&quot;single_image-#{r}\&quot; href=\&quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">          html &lt;&lt; code[:oembed][:url]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">          html &lt;&lt; '&quot;&gt;'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">          html &lt;&lt; thumbnail</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">          html &lt;&lt; '&lt;/a&gt;'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">          html &lt;&lt; js</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">          html &lt;&lt; &quot;&lt;a id=\&quot;inline-#{r}\&quot; href=\&quot;#{CGI::escapeHTML(CGI::unescapeHTML(code[:url]))}\&quot; target=\&quot;_blank\&quot;&gt;&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">          html &lt;&lt; thumbnail</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">          html &lt;&lt; '&lt;/a&gt;'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">          html &lt;&lt; &quot;&lt;div style=\&quot;display:none\&quot;&gt;&lt;div id=\&quot;data-#{r}\&quot;&gt;&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">          html &lt;&lt; self.to_embed(code)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">          html &lt;&lt; '&lt;/div&gt;&lt;/div&gt;'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="314">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="318">
          <span class="hits">3</span>
          
          <code class="ruby">    return html</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="320">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">  def clear_state</code>
        </li>
      
        <li class="covered" data-hits="89" data-linenumber="324">
          <span class="hits">89</span>
          
          <code class="ruby">    @error_code = 200</code>
        </li>
      
        <li class="covered" data-hits="89" data-linenumber="325">
          <span class="hits">89</span>
          
          <code class="ruby">    @error = nil</code>
        </li>
      
        <li class="covered" data-hits="89" data-linenumber="326">
          <span class="hits">89</span>
          
          <code class="ruby">    @properties = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.generate_img_html(opts)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="330">
          <span class="hits">9</span>
          
          <code class="ruby">    html = '&lt;img'</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="331">
          <span class="hits">9</span>
          
          <code class="ruby">    html &lt;&lt; &quot; src=\&quot;#{CGI::escapeHTML(CGI::unescapeHTML(opts[:url]))}\&quot;&quot; if opts[:url]</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="332">
          <span class="hits">9</span>
          
          <code class="ruby">    html &lt;&lt; &quot; height=\&quot;#{opts[:height]}\&quot;&quot; if opts[:height]</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="333">
          <span class="hits">9</span>
          
          <code class="ruby">    html &lt;&lt; &quot; width=\&quot;#{opts[:width]}\&quot;&quot; if opts[:width]</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="334">
          <span class="hits">9</span>
          
          <code class="ruby">    html &lt;&lt; &quot; title=\&quot;#{CGI::escapeHTML(CGI::unescapeHTML(opts[:title]))}\&quot;&quot; if opts[:title]</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="335">
          <span class="hits">9</span>
          
          <code class="ruby">    html &lt;&lt; &quot; alt=\&quot;#{CGI::escapeHTML(CGI::unescapeHTML(opts[:description]))}\&quot;&quot; if opts[:description]</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="336">
          <span class="hits">9</span>
          
          <code class="ruby">    html &lt;&lt; ' /&gt;'</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="337">
          <span class="hits">9</span>
          
          <code class="ruby">    return html</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.generate_thumbnail_html(opts)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="341">
          
          
          <code class="ruby">    html = '&lt;img'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="342">
          
          
          <code class="ruby">    html &lt;&lt; &quot; src=\&quot;#{CGI::escapeHTML(CGI::unescapeHTML(opts[:thumbnail_url]))}\&quot;&quot; if opts[:thumbnail_url]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="343">
          
          
          <code class="ruby">    html &lt;&lt; &quot; height=\&quot;#{opts[:thumbnail_height]}\&quot;&quot; if opts[:thumbnail_height]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="344">
          
          
          <code class="ruby">    html &lt;&lt; &quot; width=\&quot;#{opts[:thumbnail_width]}\&quot;&quot; if opts[:thumbnail_width]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="345">
          
          
          <code class="ruby">    html &lt;&lt; &quot; title=\&quot;#{CGI::escapeHTML(CGI::unescapeHTML(opts[:title]))}\&quot;&quot; if opts[:title]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="346">
          
          
          <code class="ruby">    html &lt;&lt; &quot; alt=\&quot;#{CGI::escapeHTML(CGI::escapeHTML(opts[:description]))}\&quot;&quot; if opts[:description]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="347">
          
          
          <code class="ruby">    html &lt;&lt; ' /&gt;'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="348">
          
          
          <code class="ruby">    return html</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.generate_link_html(url, title, link_body = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">    html = ''</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">    link_body = title if link_body.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">    if not url.nil? and not title.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">      html &lt;&lt; '&lt;a'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">      html &lt;&lt; &quot; href=\&quot;#{CGI::escapeHTML(CGI::unescapeHTML(url))}\&quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="357">
          <span class="hits">1</span>
          
          <code class="ruby">      html &lt;&lt; &quot; title=\&quot;#{CGI::escapeHTML(CGI::unescapeHTML(title))}\&quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">      html &lt;&lt; &quot; target=\&quot;_blank\&quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">      html &lt;&lt; '&gt;'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">      html &lt;&lt; link_body</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">      html &lt;&lt; '&lt;/a&gt;'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">    return html</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="41856a5a13d806968aaa6c50a3bb8b716e7958c1">
  <div class="header">
    <h3>app/services/member_export_service.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'csv'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">class MemberExportService</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.export_to_csv</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="5">
          <span class="hits">24</span>
          
          <code class="ruby">    people = Person.all</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="6">
          <span class="hits">24</span>
          
          <code class="ruby">    csv_string = CSV.generate do |csv|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">      # header row</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="9">
          <span class="hits">24</span>
          
          <code class="ruby">      csv &lt;&lt; ['ID','Type', 'Name', 'Email', 'Website', 'Zip Code', 'Registered', 'Confirmed', 'Admin', 'Proxy', 'Locked']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      # body row</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="12">
          <span class="hits">24</span>
          
          <code class="ruby">      people.each do |person|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">        csv &lt;&lt; [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">          person.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">          person.class.name, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">          person.name, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">          person.email, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">          person.website, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">          person.zip_code, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">          person.created_at.to_s(:yyyymmdd), </code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">          (person.confirmed_at.to_s(:yyyymmdd) if person.confirmed_at?),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">          person.admin? ? 'yes' : 'no', </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">          person.proxy? ? 'yes' : 'no', </code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">          person.locked? ? 'yes' : 'no']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="addf6df3dd00c4232e688bdf9e59eafda93d2a6e">
  <div class="header">
    <h3>app/services/participation_service.rb</h3>
    <h4><span class="red">67.65 %</span> covered</h4>
    <div>
      <b>34</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ParticipationService</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :issue_result</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :conversation_result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :issues</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :conversations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  ISSUE_SQL = &lt;&lt;-sql</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    select</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      i.id as 'issue_id',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      i.name as 'issue_name',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      c.id as 'conversation_id'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    from</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      issues i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    inner join</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      conversations_issues ci</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    on</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      ci.issue_id = i.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    inner join</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      conversations c</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    on</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      ci.conversation_id = c.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    order by</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      i.id asc</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    ;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  sql</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  CONVERSATION_SQL = &lt;&lt;-sql</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    select</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      c.id as 'conversation',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      count(t.id) as 'contributions',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      count(distinct(t.owner)) as 'participants'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    from</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      contributions t</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    inner join</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      conversations c</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    on</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      t.conversation_id = c.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    where</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      t.confirmed = 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    group by</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      c.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    ;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  sql</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversations_by_issue(issue_id)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="48">
          <span class="hits">2</span>
          
          <code class="ruby">    load_issue_data if @issues.nil?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="49">
          <span class="hits">2</span>
          
          <code class="ruby">    count = 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="50">
          <span class="hits">2</span>
          
          <code class="ruby">    count = @issues[issue_id.to_i][:conversations].size if @issues.has_key?(issue_id.to_i)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="51">
          <span class="hits">2</span>
          
          <code class="ruby">    return count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">  def contributions_by_issue(issue_id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">    load_issue_data if @issues.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">    count = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">    if @issues.has_key?(issue_id.to_i)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">      @issues[issue_id.to_i][:conversations].each do |conversation_id|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">        count += @conversations[conversation_id][:contributions]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">    return count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">  def participants_by_issue(issue_id)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="68">
          <span class="hits">3</span>
          
          <code class="ruby">    Issue.find(issue_id).community_user_ids.count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">  def load_issue_data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="75">
          <span class="hits">2</span>
          
          <code class="ruby">    @issue_result =  ActiveRecord::Base.connection.execute(ISSUE_SQL)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="76">
          <span class="hits">2</span>
          
          <code class="ruby">    @conversation_result =  ActiveRecord::Base.connection.execute(CONVERSATION_SQL)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="78">
          <span class="hits">2</span>
          
          <code class="ruby">    @issues = {}</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="79">
          <span class="hits">2</span>
          
          <code class="ruby">    @issue_result.each do |i|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">      unless @issues.has_key? i[0]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">        @issues[i[0]] = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">          issue_id: i[0],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">          issue_name: i[1],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">          conversations: [i[2]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">        @issues[i[0]][:conversations] &lt;&lt; i[2]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="91">
          <span class="hits">2</span>
          
          <code class="ruby">    @conversations = {}</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="92">
          <span class="hits">2</span>
          
          <code class="ruby">    @conversation_result.each do |c|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">      unless @conversations.has_key? [c[0]]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">        @conversations[c[0]] = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">          conversation_id: c[0],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">          contributions: c[1],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">          participants: c[2]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ffe4fcdd5e9a152c386b8aa20d27fc3ef6d711ca">
  <div class="header">
    <h3>app/services/petition_print_service.rb</h3>
    <h4><span class="red">18.46 %</span> covered</h4>
    <div>
      <b>65</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>53</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'cgi'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require 'uri'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">class PetitionPrintService</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :context,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">                :link_color,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">                :number_of_columns,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">                :pdf,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">                :petition,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">                :text_color</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(context, pdf, petition)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    self.context = context</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    self.link_color = '286BCC'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    self.number_of_columns = 3</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    self.petition = petition</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    self.pdf = pdf</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    self.text_color = '444444'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def render</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    # Civic Commons logo</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    pdf.image &quot;#{RAILS_ROOT}/public/images/cc_logo_300dpi.png&quot;, :scale =&gt; 0.1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    # today's date</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    pdf.move_up 5</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    pdf.text &quot;As of #{ date_string(Date.today) }&quot;, align: :right, color: text_color, size: 10</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    # horizontal line</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    pdf.stroke do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">      pdf.horizontal_rule</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    # petition title</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    pdf.move_down 20</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">    pdf.formatted_text [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      { text: petition.title, size: 20, color: text_color, style: :bold }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    # petition creator info</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    pdf.move_down 5</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">    pdf.formatted_text [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      { text: &quot;Written by: &quot;, color: text_color },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      { text: petition.person.name, color: link_color, link: context.user_url(petition.person) },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      { text: &quot; on #{ date_string(petition.created_at) }&quot;, color: text_color }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    # petition description</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">    pdf.move_down 10</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">    matches = petition.description.scan(/&lt;p&gt;(.+?)&lt;\/p&gt;/m)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">    matches.each do |paragraph|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">      pdf.text CGI.unescapeHTML(paragraph[0]), color: text_color, size: 12</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">      pdf.move_down 10</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    # today's date</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">    pdf.move_down 20</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">    pdf.text &quot;#{ petition.signer_ids.count } Signatures&quot;, color: text_color, size: 10, style: :bold</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    # horizontal line</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">    pdf.stroke do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">      pdf.horizontal_rule</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    # column for user names/avatars</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">    pdf.move_down 15</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    # output petition signers or a message if no signers</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">    if petition.signatures.length == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">      pdf.text &quot;There have been no signatures so far.&quot;, color: text_color</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">      signature_table.draw()</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">  def date_string(date)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">    date.strftime('%b %d, %Y')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">  def signer_text_data(name, signature_date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    [</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">      [name],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      [&quot;#{ date_string(signature_date) } (date signed)&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">    ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">  def signer_text_table(signature)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">    signer = signature.person</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">    pdf.make_table(signer_text_data(signer.name, signature.created_at), cell_style: { text_color: text_color }, width: 140) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">      cells.borders = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">      cells.size = 10</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">      row(0).font_style = :bold</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="96">
          
          
          <code class="ruby">      row(0).padding = [0, 15, 0, 0]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">      row(1).padding = [2, 15, 10, 0]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">  def signature_data(signature)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">    [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">      {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">        image: open(URI.escape(AvatarService.avatar_image_url(signature.person))),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">        scale: 0.4</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="106">
          
          
          <code class="ruby">      },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">      signer_text_table(signature)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">    ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">  def signature_table</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">    data = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">    row = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">    petition.signatures.each_with_index do |signature, index|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">      if index % self.number_of_columns == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">        row = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">      values = signature_data(signature)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">      for value in values</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">        row.push(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">      if (index % self.number_of_columns == self.number_of_columns - 1) or</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">        (petition.signatures.length == index + 1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="126">
          
          
          <code class="ruby">        data.push(row)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="130">
          
          
          <code class="ruby">    pdf.make_table(data) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="131">
          
          
          <code class="ruby">      cells.borders = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">      columns((0..(data.first.length * 2)).step(2)).padding = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="133">
          
          
          <code class="ruby">      columns((0..(data.first.length * 2)).step(2)).width = 40</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="cff9992a50770b00c31ec9988e99d74ddeb68186">
  <div class="header">
    <h3>app/services/search_service.rb</h3>
    <h4><span class="red">40.0 %</span> covered</h4>
    <div>
      <b>55</b> relevant lines. 
      <span class="green"><b>22</b> lines covered</span> and
      <span class="red"><b>33</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SearchService</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(search = nil)</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="4">
          <span class="hits">18</span>
          
          <code class="ruby">    if search.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">      # called by search controller since nothing was passed in</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="6">
          <span class="hits">15</span>
          
          <code class="ruby">      @search = Sunspot</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">      # called by search spec since a mock was passed in</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="9">
          <span class="hits">3</span>
          
          <code class="ruby">      @search = search</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def fetch_results(query = nil, options = {})</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="14">
          <span class="hits">9</span>
          
          <code class="ruby">    models = [options.delete(:models)]</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="15">
          <span class="hits">9</span>
          
          <code class="ruby">    fields = accepted_fields(models)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="16">
          <span class="hits">9</span>
          
          <code class="ruby">    fields[:fragment_size] = -1</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="17">
          <span class="hits">9</span>
          
          <code class="ruby">    region_metrocodes = options.delete(:region_metrocodes)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="19">
          <span class="hits">9</span>
          
          <code class="ruby">    results = @search.search(models) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">      keywords(query) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">        highlight fields</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      # If region_metrocodes present, then filter conversation and issues, Contribution, and ignore filter an other objects</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      if region_metrocodes.present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">        classes_with_regional_metrocodes = [Conversation, ManagedIssue, Contribution]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">        any_of do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">          all_of do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">             with(:class, classes_with_regional_metrocodes)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">             with(:region_metrocodes, region_metrocodes) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">          without(:class, classes_with_regional_metrocodes)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="38">
          <span class="hits">9</span>
          
          <code class="ruby">    results.hits({ verify: true }).reject do |hit|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="39">
          <span class="hits">2</span>
          
          <code class="ruby">      hit.result.is_a?(Contribution) and not hit.result.confirmed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def fetch_filtered_results(query = nil, filter = nil, options = {})</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">    models = [options.delete(:models)]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    fields = accepted_fields(models)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    fields[:fragment_size] = -1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    region_metrocodes = options.delete(:region_metrocodes)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">    results = @search.search(models) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">      with(:content_type, 'BlogPost') if filter == 'blogs'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">      with(:content_type, 'RadioShow') if filter == 'radioshows'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">      with(:type, 'Issue') if filter == 'issues'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">      case filter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      when 'projects'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">        any_of do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">          with(:type, 'ManagedIssue')</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">          with(:type, 'ManagedIssuePage')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      when 'issues', 'conversations', 'contributions'</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">        with(:region_metrocodes, region_metrocodes) if region_metrocodes.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">      keywords(query) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">        highlight fields</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">    results.hits({ verify: true }).reject do |hit|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">      hit.result.is_a?(Contribution) and not hit.result.confirmed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">  def accepted_fields(models)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="72">
          <span class="hits">9</span>
          
          <code class="ruby">    fields = {}</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="73">
          <span class="hits">9</span>
          
          <code class="ruby">    i = 0 </code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="74">
          <span class="hits">9</span>
          
          <code class="ruby">    models.each do |mod|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">      case </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">      when mod == Contribution then</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">        fields[i] = :content</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      when mod == Conversation then</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">        fields[i] = :summary</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">      when mod == Person then</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">        fields[i] = :bio</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">      when mod == Issue then</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">        fields[i] = :summary</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      when mod == ManagedIssuePage then</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">        fields[i] = :template</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      when mod == ContentItem then</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">        fields[i] = :body</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="88">
          
          
          <code class="ruby">        i = i + 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">        fields[i] = :summary</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="90">
          <span class="hits">9</span>
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="91">
          <span class="hits">9</span>
          
          <code class="ruby">      i = i + 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="93">
          <span class="hits">9</span>
          
          <code class="ruby">    return fields</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e042531bb8a3ebd0d8af83c31ed056ff062ce258">
  <div class="header">
    <h3>app/services/spam_service.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>17</b> relevant lines. 
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SpamService</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :domain_pattern, :email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(email)</code>
        </li>
      
        <li class="covered" data-hits="336" data-linenumber="5">
          <span class="hits">336</span>
          
          <code class="ruby">    @email = email</code>
        </li>
      
        <li class="covered" data-hits="336" data-linenumber="6">
          <span class="hits">336</span>
          
          <code class="ruby">    create_regex_pattern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def spam?</code>
        </li>
      
        <li class="covered" data-hits="336" data-linenumber="10">
          <span class="hits">336</span>
          
          <code class="ruby">    return false if @domain_pattern.blank?  </code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="11">
          <span class="hits">7</span>
          
          <code class="ruby">    email_domains_to_reject.match(@email) ? true : false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def email_domains_to_reject</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="15">
          <span class="hits">7</span>
          
          <code class="ruby">    Regexp.new(@domain_pattern,'i') </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_regex_pattern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # creates a regex pattern like:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    # 163\.com|yeah\.net|21cn\.com</code>
        </li>
      
        <li class="covered" data-hits="336" data-linenumber="21">
          <span class="hits">336</span>
          
          <code class="ruby">    domains = EmailRestriction.select(:domain).all.collect do |record|</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="22">
          <span class="hits">17</span>
          
          <code class="ruby">      Regexp.escape(record.domain)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="336" data-linenumber="24">
          <span class="hits">336</span>
          
          <code class="ruby">    @domain_pattern = domains.join('|')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.spam?(email)</code>
        </li>
      
        <li class="covered" data-hits="336" data-linenumber="28">
          <span class="hits">336</span>
          
          <code class="ruby">    mail = SpamService.new(email)</code>
        </li>
      
        <li class="covered" data-hits="336" data-linenumber="29">
          <span class="hits">336</span>
          
          <code class="ruby">    mail.spam?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8952029e12444817cd6194faf2b5f8756c978eb5">
  <div class="header">
    <h3>app/services/vote_progress_service.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>71</b> relevant lines. 
      <span class="green"><b>71</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'gchart'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require 'csv'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">class VoteProgressService</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  include ActionView::Helpers::TagHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  include ActionView::Helpers::TextHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :survey, :progress_result, :total_weighted_votes, :highest_weighted_votes_percentage, :voter, :selected_survey_options</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  delegate  :max_selected_options,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">            :to =&gt; :survey</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  DEFAULT_CHART_COLORS = %w(EFD279 95CBE9 024769 AFD775 2C5700 DE9D7F 097054 FFDE00 6599FF FF9900 FFC6A5 FFFF42 DEF3BD 00A5C6 DEBDDE)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(survey, voter = nil)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="15">
          <span class="hits">52</span>
          
          <code class="ruby">    @survey = survey</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="16">
          <span class="hits">52</span>
          
          <code class="ruby">    calculate_progress</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="17">
          <span class="hits">52</span>
          
          <code class="ruby">    calculate_weighted_votes_percentage</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="18">
          <span class="hits">52</span>
          
          <code class="ruby">    get_voted_options_by_voter(voter) if voter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_voted_options_by_voter(voter)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">    response = @survey.survey_responses.find_by_person_id(voter.id)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">    if response</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">      selected_option_id = response.selected_survey_options.collect(&amp;:survey_option_id)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">      progress_result.each_with_index do |record, index|</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="26">
          <span class="hits">10</span>
          
          <code class="ruby">        record.voted = true if selected_option_id.include?(record.survey_option_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_chart</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    chart = GChart.bar do |g|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">        g.title = 'Vote Results'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">        g.data   = formatted_weigthed_votes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        g.colors = DEFAULT_CHART_COLORS</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="36">
          <span class="hits">7</span>
          
          <code class="ruby">        g.legend = progress_result.collect{|record| record.title}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">        g.orientation = :horizontal</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">        g.width  = 450</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">        g.height = (progress_result.count * 40) + 60</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">        g.thickness = 20</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">        g.spacing = 2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">        g.grouped = false</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="43">
          <span class="hits">8</span>
          
          <code class="ruby">        g.axis(:left) { |a| a.labels = progress_result.collect{|record| pluralize(record.weighted_votes.to_i, 'Point', 'Points')}.reverse}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">        g.extras = {'chdlp'=&gt;'tv',            # Positioning of legend</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">                    'chma' =&gt; '20,20,20,20',  # Margin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">                    'chf'=&gt;'bg,s,FFFFFF00',   # Transparant background</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">                    'chts' =&gt; '000000,18,l'   # Align Title to the left</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">                    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">    chart.to_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def total_weighted_votes</code>
        </li>
      
        <li class="covered" data-hits="272" data-linenumber="54">
          <span class="hits">272</span>
          
          <code class="ruby">    @total_weighted_votes ||= calculate_total_weighted_votes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  def calculate_total_weighted_votes</code>
        </li>
      
        <li class="covered" data-hits="324" data-linenumber="58">
          <span class="hits">324</span>
          
          <code class="ruby">    progress_result.inject(0){|sum,record| sum + record.weighted_votes.to_i}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  def calculate_weighted_votes_percentage</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="62">
          <span class="hits">52</span>
          
          <code class="ruby">    progress_result.each_with_index do |record, index|</code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="63">
          <span class="hits">271</span>
          
          <code class="ruby">      weighted_vote_num = record.weighted_votes.to_f / total_weighted_votes.to_f</code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="64">
          <span class="hits">271</span>
          
          <code class="ruby">      record.weighted_votes_percentage = (weighted_vote_num.nan? ? 0 : weighted_vote_num * 100).to_i</code>
        </li>
      
        <li class="covered" data-hits="271" data-linenumber="65">
          <span class="hits">271</span>
          
          <code class="ruby">      record.winner = true if index &lt; max_selected_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="67">
          <span class="hits">52</span>
          
          <code class="ruby">    @highest_weighted_votes_percentage = progress_result.collect(&amp;:weighted_votes_percentage).max</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  def calculate_progress</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    # Calculation of survey results based on weigthed points on the order of selected options.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    # If Max Selected Options is 3, then the first selected option is assigned a 3 point.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    # the second selected option is assigned 2 points, and the third, 1 point.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    # To get the weigthed_votes, we multiply the weigth(points) with the number of times a particular option have been selected.</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="75">
          <span class="hits">63</span>
          
          <code class="ruby">    progress_sql = &lt;&lt;-SQL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">      SELECT s.id AS survey_id, so.id AS survey_option_id, so.title, so.description,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      COALESCE(SUM(s.max_selected_options - (sso.position) + 1),0) AS weighted_votes,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      COUNT(sso.id) AS total_votes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">      FROM surveys s RIGHT JOIN survey_options so</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">      ON s.id = so.survey_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      LEFT JOIN selected_survey_options sso</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">      ON sso.survey_option_id = so.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      WHERE so.survey_id = #{survey.id}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      GROUP BY so.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      ORDER BY weighted_votes DESC</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    SQL</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="87">
          <span class="hits">63</span>
          
          <code class="ruby">    @progress_result =  SurveyOption.find_by_sql(progress_sql)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">  def calculate_selected_survey_options    </code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="91">
          <span class="hits">18</span>
          
          <code class="ruby">    progress_sql = &lt;&lt;-SQL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">      SELECT s.id AS survey_id, p.id AS person_id, p.first_name, p.last_name, p.email, sr.created_at AS date_voted, so.id AS survey_option_id, so.title, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">      COALESCE((s.max_selected_options - sso.position + 1),0) AS weight</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      FROM surveys s JOIN survey_responses sr ON s.id = sr.survey_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      JOIN selected_survey_options sso ON sso.survey_response_id = sr.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      JOIN survey_options so ON sso.survey_option_id = so.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">      JOIN people p ON sr.person_id = p.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">      WHERE s.id = #{survey.id}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">    SQL</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="100">
          <span class="hits">18</span>
          
          <code class="ruby">     @selected_survey_options = SelectedSurveyOption.find_by_sql(progress_sql)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">  def formatted_weigthed_votes</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="104">
          <span class="hits">14</span>
          
          <code class="ruby">    VoteProgressService.format_data(progress_result.collect{|record| record.weighted_votes})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">  def export_to_csv</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="109">
          <span class="hits">6</span>
          
          <code class="ruby">    csv_string = CSV.generate do |csv|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">      # header row</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="111">
          <span class="hits">6</span>
          
          <code class="ruby">      csv &lt;&lt; ['Vote Title','Vote Option','Weighted Vote (percentage)']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      # body row</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="114">
          <span class="hits">6</span>
          
          <code class="ruby">      progress_result.each_with_index do |option, index|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">        csv &lt;&lt; [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">          @survey.title,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">          option.title,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">          option.weighted_votes_percentage</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="119">
          <span class="hits">36</span>
          
          <code class="ruby">        ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">  def export_selected_survey_options_to_csv</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="125">
          <span class="hits">7</span>
          
          <code class="ruby">    calculate_selected_survey_options</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="126">
          <span class="hits">7</span>
          
          <code class="ruby">    csv_string = CSV.generate do |csv|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">      # header row</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="128">
          <span class="hits">7</span>
          
          <code class="ruby">      csv &lt;&lt; ['Vote Title','Voter', 'Email', 'Date Voted', 'Selection ID', 'Selection', 'Weight']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">      # body row</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="131">
          <span class="hits">7</span>
          
          <code class="ruby">      selected_survey_options.each_with_index do |selection, index|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">        csv &lt;&lt; [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">          @survey.title,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">          selection.first_name.to_s + ' ' + selection.last_name.to_s,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">          selection.email.to_s,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">          selection.date_voted,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">          selection.survey_option_id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">          selection.title,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">          selection.weight</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="140">
          <span class="hits">21</span>
          
          <code class="ruby">        ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.format_data(data=[])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">    #turns one dimensional array into multi dimensional array needed for the google chart</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">    # from :</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">    #  [1,2,3]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">    # into :</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">    #  [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">    #   [1,0,0],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">    #   [0,2,0],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">    #   [0,0,3]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">    #  ]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="157">
          <span class="hits">5</span>
          
          <code class="ruby">    formatted_data = []</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="158">
          <span class="hits">5</span>
          
          <code class="ruby">    data.each_with_index do |col, index|</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="159">
          <span class="hits">12</span>
          
          <code class="ruby">      d = []</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="160">
          <span class="hits">12</span>
          
          <code class="ruby">      data.length.times do |i|</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="161">
          <span class="hits">50</span>
          
          <code class="ruby">        d[i] = (i == index) ? col : 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="163">
          <span class="hits">12</span>
          
          <code class="ruby">      formatted_data &lt;&lt; d</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="165">
          <span class="hits">5</span>
          
          <code class="ruby">    return formatted_data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e2b1f41a0e9d04a507f530bd1532b728e1805100">
  <div class="header">
    <h3>app/uploaders/ckeditor_attachment_file_uploader.rb</h3>
    <h4><span class="red">71.43 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># encoding: utf-8</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">class CkeditorAttachmentFileUploader &lt; CarrierWave::Uploader::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include Ckeditor::Backend::CarrierWave</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # Include RMagick or ImageScience support:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # include CarrierWave::RMagick</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # include CarrierWave::MiniMagick</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  # include CarrierWave::ImageScience</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # Choose what kind of storage to use for this uploader:</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  storage :fog</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # Override the directory where uploaded files will be stored.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # This is a sensible default for uploaders that are meant to be mounted:</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def store_dir</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    &quot;ckeditor_assets/attachments/#{model.id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  # Provide a default URL as a default if there hasn't been a file uploaded:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # def default_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  #   &quot;/images/fallback/&quot; + [version_name, &quot;default.png&quot;].compact.join('_')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  # end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  # Process files as they are uploaded:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  # process :scale =&gt; [200, 300]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  # def scale(width, height)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  #   # do something</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  # end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  # Add a white list of extensions which are allowed to be uploaded.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  # For images you might use something like this:</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def extension_white_list</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    Ckeditor.attachment_file_types</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  # Override the filename of the uploaded files:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  # Avoid using model.id or version_name here, see uploader/store.rb for details.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  # def filename</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  #   &quot;something.jpg&quot; if original_filename</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  # end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="80120a5a19d462217fc47d88af1f9fdf6cc1a185">
  <div class="header">
    <h3>app/uploaders/ckeditor_picture_uploader.rb</h3>
    <h4><span class="yellow">84.62 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># encoding: utf-8</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">class CkeditorPictureUploader &lt; CarrierWave::Uploader::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include Ckeditor::Backend::CarrierWave</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # Include RMagick or ImageScience support:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # include CarrierWave::RMagick</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  include CarrierWave::MiniMagick</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  # include CarrierWave::ImageScience</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # Choose what kind of storage to use for this uploader:</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  storage :fog</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # Override the directory where uploaded files will be stored.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # This is a sensible default for uploaders that are meant to be mounted:</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def store_dir</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    &quot;ckeditor_assets/pictures/#{model.id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  # Provide a default URL as a default if there hasn't been a file uploaded:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # def default_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  #   &quot;/images/fallback/&quot; + [version_name, &quot;default.png&quot;].compact.join('_')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  # end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  # Process files as they are uploaded:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  # process :scale =&gt; [200, 300]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  # def scale(width, height)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  #   # do something</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  # end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  process :read_dimensions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  # Create different versions of your uploaded files:</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  version :thumb do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">    process :resize_to_fill =&gt; [118, 100]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  version :content do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    process :resize_to_limit =&gt; [800, 800]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  # Add a white list of extensions which are allowed to be uploaded.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  # For images you might use something like this:</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def extension_white_list</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    Ckeditor.image_file_types</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  # Override the filename of the uploaded files:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  # Avoid using model.id or version_name here, see uploader/store.rb for details.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  # def filename</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  #   &quot;something.jpg&quot; if original_filename</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  # end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="66cebf0bc2525f154a5cf525408d7d167ad6e8ec">
  <div class="header">
    <h3>lib/ccml.rb</h3>
    <h4><span class="green">93.83 %</span> covered</h4>
    <div>
      <b>81</b> relevant lines. 
      <span class="green"><b>76</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># = Civic Commons Markup Language</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># CCML is a minimal markup language based on ExpressionEngine tag syntax. It is</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"># intended to allow web designers on The Civic Commons project easily embed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"># server-side dynamic behavior into an HTML output stream. CCML was originally</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"># created for Managed Issues but may be leveraged for other features.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"># == Syntax</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"># The syntax of a CCML tag is identical to the syntax of an ExpressionEngine</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"># template tag except that &quot;exp&quot; in the ExpressionEngine tag is replaced by</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"># &quot;ccml&quot; in the CCML tag. Tags can be either single tags or tag pairs. Single</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"># tags simply generate string data in place of the tag. Tag pairs are iterative.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"># They loop over the body of the tag pair zero or more times and generate more</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"># complex string output. The initial implementation will only support single</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"># tags. The general syntax of a single tag is:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"># &lt;code&gt;{ccml:tag_class:method opt='value' opt='value' opt='value'}&lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"># Tag pairs have two tags: an open tag and a close tag. The open tag follows</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"># the same format as a single tag. The close tag has the following syntax:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"># &lt;code&gt;{/ccml:tag_class:method}&lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"># An example of a single tag with no method name and a parameter list is:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"># &lt;code&gt;{ccml:partial path='conversation/tile'}&lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"># For more information on the ExpressionEngine tag syntax see the documentation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"># at http://expressionengine.com/user_guide/overview/tags.html. Only the tag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"># syntax has been borrowed from ExpressionEngine. The library design and all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"># programming are original.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"># == Architecture</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"># CCML processing is handled by a series of modules and classes in the Rails</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"># &quot;lib&quot; directory. All classes must exist within the CCML module. The CCML</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"># module has a single public method called parse. The parse method takes a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"># single parameter, a string representing the CCML data to be parsed. The</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"># return value is a text (HTML, XML, JSON, etc.) string capable of being</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"># inserted into a Rails HTTP response.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"># The class *CCML::Error::TemplateError* is the base class for all template</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"># parsing exceptions. The parse method of the CCML module will raise an</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"># instance of this class if an error is encountered during parsing. Parsing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"># of the CCML template will cease on the first error.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"># === Parsing Process</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"># The CCML parsing process is designed to be very simple yet very flexible.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"># Each CCML tag maps to an instance of a *CCML::Tag::Base* subclass.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"># *CCML::Tag::Base* is an abstract class and cannot be used in a template.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"># Using *CCML::Tag::Base* in a template raises a TagBaseClassInTemplate error.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"># *CCML::Tag::Single* and *CCML::Tag::Pair* are abstract subclass of Base used</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"># as base subclasses for single tags and tag pairs respectfully. Their direct</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"># use will also result in a TagBaseClassInTemplate exception being raised.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"># *CCML::Tag* defines a constructor with an optional hash parameter called opts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"># The value of the opts parameter is assigned to an instance data member of the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"># same name. If the opts parameter is missing or is not a Hash object the data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"># member is set to an empty hash. Subclasses of Tag can always expect the opts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"># data member to not be nil and to be a hash. *CCML::Tag::Base* defines one</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"># instance method called index. The index method takes no parameters and returns</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"># a string.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"># During the parsing process the parser replaces every instance of a valid tag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"># with string data generated by an associated tag class instance. The parser</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"># does not examine the tag output, it simply injects it into the output stream</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"># in place of the tag. The general steps for processing a valid tag are:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"># * Parse for tag pairs the single tags the malformed tags.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"># * Raise _MalformedTagError_ if a malformed tag is encountered.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"># * Create an instance of the appropriate tag subclass, passing the options hash as the constructor parameter.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"># * Raise _TagClassNotFoundError_ if the appropriate tag class does not exist.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"># * If a method name does not appear in the tag call the index method of the tag object.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"># * If a method name appears in the tag call the appropriate method of the tag object.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"># * If the method does not exist on the tag object raise _TagMethodNotFoundError_.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"># * If the tag method returns without raising an exception replace the tag in the content with the return value of the method, converting to a string if necessary.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"># == URL Segments and Query String Fields</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"># Much like ExpressionEngine, the CCML system also performs URL parsing. If the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"># URL parameter is passed to the CCML _parse_ method the the URL will, in turn,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"># be passed to the tag constructor for parsing. The constructor will break the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"># URL down into its component parts and make them accessible through various</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"># attribute readers. In addition, *CCML::Tag::Base* will perform additional</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"># processing of the options array and substitue values based on special URL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby"># path segment and query string field variables. This processing is based on</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"># ExpressionEngine's URL segment variables but is much more powerful. More</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby"># information regarding ExpressionEngine URL segment variables can be found at</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"># http://expressionengine.com/user_guide/templates/globals/url_segments.html.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"># === URL Format</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"># CCML uses its own nomenclature to define the structure of a URL. The basic</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"># structure is:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"># &lt;code&gt;protocol://host/resourse&lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby"># The resource is further subdivided into the _path_ and the _query string_. The</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"># _path_ is further subdivided into URL _segments_. If the query string is</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"># formatted in key/value pairs using then it is further subdivided into fields</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"># (see below).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"># The following URL:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby"># &lt;code&gt;http://www.theciviccommons.com/segment_0/segment_1/segment_2/?field1=value1&amp;field2=value2&amp;field3=value3&lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"># is parsed as:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby"># * Protocol: _http_</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"># * Host: _www.theciviccommons.com_</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby"># * Resource: _/segment_0/segment_1/segment_2/?field1=value1&amp;field2=value2&amp;field3=value3_</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"># * Path: _/segment_0/segment_1/segment_2_</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"># * Query String: _field1=value1&amp;field2=value2&amp;field3=value3_</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby"># === URL Segment Variables</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"># Because Rails uses the URL path as the basis for routing it is essential that</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby"># CCML tags have access to the path when being used in a Web environment. The</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby"># special URL segment variables provide this access. The tag base class will</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby"># parse the URL _path_ variable into an array of segments similar to</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby"># ExpressionEngine. CCML uses the same format of the word segment followed by</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby"># an underscore followed by the index value (i.e. 'segment_0'). The main</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby"># differences between ExpressionEngine and CCML URL segment variables are that</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby"># CCML path segments begin at index zero (ExpressionEngine begins at index one)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby"># and CCML has no maximum index (ExpressionEngine only supports nine URL segment</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby"># variables).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby"># CCML URL segment variables are available in two contexts: tag options and</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby"># tag pair attributes. On tag creation any options with segment variables for</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby"># values will be updated with the corresponding path segment value. For example,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby"># the tag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby"># &lt;code&gt;{ccml:issue id='segment_1'}&lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby"># under the URL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby"># &lt;code&gt;http://www.theciviccommons.com/issues/1&lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby"># will have the value of the _id_ option automatically set to 1.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby"># As with ExpressionEngine, CCML supports the special segment variable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"># 'last_segment' which always maps to the last URL path segment.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby"># === Query String Field Variables</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby"># Althought the query string is not used in Rails as often as it is used in</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"># environments, CCML still provides support for the query string similar to the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby"># support it provides for path segments. Accessing this functionality requires</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby"># the query string to be formatted as key/value pairs with pairs separated by</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby"># ampersands and keys separated from values by equal signs. When the query</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby"># string is formatted this way it is parsed into a _fields_ hash. Hash keys</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby"># are symbolized versions of the keys from the query string.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"># CCML tags have access to a special set of field variables similar to path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby"># segment variables and available in the same contexts. Field variables, when</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby"># used for tag option values or as tag pair attributes, follow the format</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"># 'field_' followed by the field name. On tag creation any options with field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby"># variables for values will be updated with the corresponding field value.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby"># For example, the tag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby"># &lt;code&gt;{ccml:issue id='field_id'}&lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby"># under the URL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby"># &lt;code&gt;http://www.theciviccommons.com/issues?id=1&lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby"># will have the value of the _id_ option automatically set to 1.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby"># The special field variable 'query_string' will always map to the entire</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby"># query string, whether or not it is formatted in key/value pairs.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby"># == Tag Pair Variable Processing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby"># CCML tag pair processing is very robust and supports several advanced</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby"># processing features. These features allow for very granular control of the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby"># tag output without the need to write complex processing login within the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"># tag class itself.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"># The magic occurs in the *CCML::Tag::TagPair#process_tag_body* method. Any</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby"># tag pair subclass can pass a hash, an object with attribute readers, an</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby"># array of hashes, and array of objects, an ActiveRecord object, or an</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby"># ActiveRecord collection to this method and method will return the tag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby"># body parsed against the object(s). Tags needing more complex processing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby"># can access the *CCML:Tag::TagPair#tag_body* reader (*@tag_body* instance</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby"># variable) and process it directly. This approach is not recommended.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby"># === Conditional Processing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby"># CCML tag pair variables support ExpressionEngine-style conditional processing.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby"># Conditional expressions allow very granular control of the tag output.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"># Conditional expressions operate on one variable value and process the output</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby"># based on the result of the conditional. An example conditional expression is</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby"># &lt;code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">#   {if id == 1}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">#     &lt;h1&gt;The ID is {id}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">#   {/if}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby"># &lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby"># Conditional expressions in CCML follow the same format as ExpressionEngine</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby"># with one difference. ExpressionEngine uses 'elseif' but Ruby uses 'elsif'.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby"># CCML supports both syntaxes so both</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby"># &lt;code&gt;{if:elseif author}&lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby"># and</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby"># &lt;code&gt;{if:elsif author}&lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby"># are legal.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby"># For more information on ExpressionEngine conditional processing see</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby"># http://expressionengine.com/user_guide/templates/globals/conditionals.html</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby"># NOTE: CCML conditionals are processed using Ruby's 'eval' method so the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby"># conditional itself should work with any valid Ruby statement. Your mileage</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby"># may very so test thoroughly if you get fancy.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby"># === Date and Time Formatting</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby"># CCML tag pair variables support ExpressionEngine-style date and time formatting.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby"># Any variable within a tag pair may include a 'format' option. The value of the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby"># 'format' option is a Ruby date/time format string. When the 'format' option is</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby"># present the parser will assume the value of the variable is a valid Ruby date</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby"># or time object and will format it according to the provided format string.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby"># Formatting occurs at the final substitution, well after conditional processing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby"># has occurred. Subsequently, conditional expressions operate on the raw</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby"># date/time value, not the formatted value.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby"># An example of a formatted date variable is:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby"># &lt;code&gt;{created_at format=&quot;%m-%d-%Y %I:%M %p&quot;}&lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby"># For more infotmation on ExpressionEngine date/time formatting see</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby"># http://expressionengine.com/user_guide/templates/date_variable_formatting.html</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby"># For more information on Ruby date/time formatting see</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby"># http://www.ruby-doc.org/core/classes/Time.html#M000392</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby"># === ActiveRecord Associations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby"># CCML tag pairs are ActiveRecord aware and will process tag variables through</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby"># singular associations. Subsequently, the following variable is legal and will</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="246">
          
          
          <code class="ruby"># work as expected:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby"># &lt;code&gt;{author.name}&lt;/code&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby"># CCML tag variable processing only supports singular associations. It will not</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby"># work if the association is a collection.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">  SINGLE_TAG_PATTERN = /\{ccml:(?&lt;class&gt;\w+)(:(?&lt;method&gt;\w+))?(?&lt;opts&gt;[^\{}]*)?}/</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">  TAG_PAIR_PATTERN = /\{ccml:(?&lt;class&gt;\w+)(:(?&lt;method&gt;\w+))?(?&lt;opts&gt;[^}]*)?}(?&lt;tag_body&gt;.*?)\{\/ccml:\k&lt;class&gt;(:(?&lt;close_method&gt;\k&lt;method&gt;))?}/m</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">  INVALID_TAGS_PATTERN = /(\{ccml)|(\{\/ccml)/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">  OPTIONS_PATTERN = /\s+(\w+)=(&quot;([^&quot;]*)&quot;|'([^']*)')/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">  ILLEGAL_TAGS = ['base', 'single_tag', 'tag_pair']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">  def CCML.parse(ccml, url = nil, options={})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">    #silence external source errors to true by default</code>
        </li>
      
        <li class="covered" data-hits="82" data-linenumber="265">
          <span class="hits">82</span>
          
          <code class="ruby">    unless options.has_key?(:silence_external_source_errors)</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="266">
          <span class="hits">31</span>
          
          <code class="ruby">      options[:silence_external_source_errors] = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby">    # die if ccml data is not a string</code>
        </li>
      
        <li class="covered" data-hits="82" data-linenumber="270">
          <span class="hits">82</span>
          
          <code class="ruby">    unless ccml.is_a?(String)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">      raise CCML::Error::TemplateError, &quot;CCML data is not a string.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby">    # find and process tag pairs</code>
        </li>
      
        <li class="covered" data-hits="81" data-linenumber="275">
          <span class="hits">81</span>
          
          <code class="ruby">    ccml = CCML.parse_tag_pairs(ccml, url, options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="276">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby">    # find and process single tags</code>
        </li>
      
        <li class="covered" data-hits="77" data-linenumber="278">
          <span class="hits">77</span>
          
          <code class="ruby">    ccml = CCML.parse_single_tags(ccml, url, options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">    # find malformed tags and abend</code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="281">
          <span class="hits">74</span>
          
          <code class="ruby">    if ccml =~ INVALID_TAGS_PATTERN</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="282">
          <span class="hits">5</span>
          
          <code class="ruby">      raise CCML::Error::TemplateError, &quot;Template contains invalid CCML tags.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="69" data-linenumber="285">
          <span class="hits">69</span>
          
          <code class="ruby">    return ccml</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">  # Does sanitizes text of CCML tag.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">  def CCML.sanitize_tags(ccml)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">    ccml.to_s.gsub(CCML::TAG_PAIR_PATTERN,'').gsub(CCML::SINGLE_TAG_PATTERN,'')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="295">
          <span class="hits">1</span>
          
          <code class="ruby">  def CCML.instanciate_tag(clazz, url, opts = {})</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="296">
          <span class="hits">34</span>
          
          <code class="ruby">    if ILLEGAL_TAGS.include?(clazz)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="297">
          
          
          <code class="ruby">      raise CCML::Error::TagBaseClassInTemplateError</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="299">
          <span class="hits">34</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="300">
          <span class="hits">34</span>
          
          <code class="ruby">      clazz = &quot;CCML::Tag::#{clazz.camelize}Tag&quot;</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="301">
          <span class="hits">34</span>
          
          <code class="ruby">      tag = clazz.constantize.new(opts, url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">    rescue NameError</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">      raise CCML::Error::TagClassNotFoundError, &quot;Unable to initialize object for '#{clazz}' tag.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="305">
          <span class="hits">33</span>
          
          <code class="ruby">    return tag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="307">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">  def CCML.run_tag_method(tag, method)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="309">
          <span class="hits">33</span>
          
          <code class="ruby">    if tag.respond_to?(method.to_sym)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="310">
          <span class="hits">32</span>
          
          <code class="ruby">      sub = tag.send(method.to_sym)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">      raise CCML::Error::TagMethodNotFoundError, &quot;Unable to find method '#{method}' of '#{tag.class}' object.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="314">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="316">
          <span class="hits">1</span>
          
          <code class="ruby">  def CCML.parse_options(match)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="317">
          <span class="hits">34</span>
          
          <code class="ruby">    opts = {}</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="318">
          <span class="hits">34</span>
          
          <code class="ruby">    unless match[:opts].blank?</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="319">
          <span class="hits">14</span>
          
          <code class="ruby">      options = match[:opts].scan(OPTIONS_PATTERN)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="320">
          <span class="hits">14</span>
          
          <code class="ruby">      options.each do |opt|</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="321">
          <span class="hits">39</span>
          
          <code class="ruby">        opt.pop if opt.last.nil?</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="322">
          <span class="hits">39</span>
          
          <code class="ruby">        opts[opt.first.to_sym] = opt.last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="325">
          <span class="hits">34</span>
          
          <code class="ruby">    return opts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">  def CCML.parse_opening_tag(match)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="329">
          <span class="hits">34</span>
          
          <code class="ruby">    clazz = match[:class]</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="330">
          <span class="hits">34</span>
          
          <code class="ruby">    method = ( match[:method].nil? ? 'index' : match[:method] )</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="331">
          <span class="hits">34</span>
          
          <code class="ruby">    opts = CCML.parse_options(match)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="332">
          <span class="hits">34</span>
          
          <code class="ruby">    return clazz, method, opts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="334">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">  def CCML.parse_tag_pairs(ccml, url, options={})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="337">
          
          
          <code class="ruby">    # find the first match</code>
        </li>
      
        <li class="covered" data-hits="81" data-linenumber="338">
          <span class="hits">81</span>
          
          <code class="ruby">    match = TAG_PAIR_PATTERN.match(ccml)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="340">
          
          
          <code class="ruby">    # iterate until no more matches exist</code>
        </li>
      
        <li class="covered" data-hits="81" data-linenumber="341">
          <span class="hits">81</span>
          
          <code class="ruby">    while not match.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">      # check for matching open/close method</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="343">
          <span class="hits">17</span>
          
          <code class="ruby">      if match[:method] != match[:close_method]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">        raise CCML::Error::TemplateError, &quot;Open tag '#{match[:method]}' method does not match close tag '#{match[:close_method]}' method.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">      # get the data from the matching string</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="348">
          <span class="hits">16</span>
          
          <code class="ruby">      clazz, method, opts = CCML.parse_opening_tag(match)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">      # create an instance of the tag class and set tag data</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="351">
          <span class="hits">16</span>
          
          <code class="ruby">      tag = CCML.instanciate_tag(clazz, url, opts)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="352">
          <span class="hits">16</span>
          
          <code class="ruby">      tag.tag_body = match[:tag_body]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="354">
          
          
          <code class="ruby">      # run the method and substitute the results into the ccml</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="355">
          <span class="hits">16</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="356">
          <span class="hits">16</span>
          
          <code class="ruby">        sub = CCML.run_tag_method(tag, method)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">      rescue CCML::Error::ExternalSourceError =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="358">
          <span class="hits">4</span>
          
          <code class="ruby">        sub = ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">        # If CCML::Error::ExternalSourceError then ignore it by default and report it to airbrake</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="360">
          <span class="hits">4</span>
          
          <code class="ruby">        if options[:silence_external_source_errors] == false</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="361">
          <span class="hits">2</span>
          
          <code class="ruby">          raise e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="363">
          <span class="hits">2</span>
          
          <code class="ruby">          Airbrake.notify(e) if defined?(Airbrake)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="367">
          <span class="hits">14</span>
          
          <code class="ruby">      if sub.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">        raise CCML::Error::TemplateError, &quot;Requested #{clazz} #{method} method but #{method} was not used.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="369">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="370">
          <span class="hits">13</span>
          
          <code class="ruby">      ccml = ccml.sub(match.to_s, sub)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="372">
          
          
          <code class="ruby">      # look for another match</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="373">
          <span class="hits">13</span>
          
          <code class="ruby">      pos = match.begin(0) + sub.length</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="374">
          <span class="hits">13</span>
          
          <code class="ruby">      match = TAG_PAIR_PATTERN.match(ccml, pos)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="77" data-linenumber="377">
          <span class="hits">77</span>
          
          <code class="ruby">    return ccml</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="380">
          <span class="hits">1</span>
          
          <code class="ruby">  def CCML.parse_single_tags(ccml, url, options={})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="382">
          
          
          <code class="ruby">    # find the first match</code>
        </li>
      
        <li class="covered" data-hits="77" data-linenumber="383">
          <span class="hits">77</span>
          
          <code class="ruby">    match = SINGLE_TAG_PATTERN.match(ccml)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="385">
          
          
          <code class="ruby">    # iterate until no more matches exist</code>
        </li>
      
        <li class="covered" data-hits="77" data-linenumber="386">
          <span class="hits">77</span>
          
          <code class="ruby">    while not match.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="387">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="388">
          
          
          <code class="ruby">      # get the data from the matching string</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="389">
          <span class="hits">18</span>
          
          <code class="ruby">      clazz, method, opts = CCML.parse_opening_tag(match)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="390">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">      # create an instance of the tag class</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="392">
          <span class="hits">18</span>
          
          <code class="ruby">      tag = CCML.instanciate_tag(clazz, url, opts)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">      # run the method and substitute the results into the ccml</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="395">
          <span class="hits">17</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="396">
          <span class="hits">17</span>
          
          <code class="ruby">        sub = CCML.run_tag_method(tag, method)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="397">
          
          
          <code class="ruby">      rescue CCML::Error::ExternalSourceError =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="398">
          
          
          <code class="ruby">        sub = ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="399">
          
          
          <code class="ruby">        # If CCML::Error::ExternalSourceError then ignore it by default and report it to airbrake</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="400">
          
          
          <code class="ruby">        if options[:silence_external_source_errors] == false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="401">
          
          
          <code class="ruby">          raise e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="402">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="403">
          
          
          <code class="ruby">          Airbrake.notify(e) if defined?(Airbrake)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="404">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="405">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="406">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="408">
          <span class="hits">16</span>
          
          <code class="ruby">      if sub.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="409">
          <span class="hits">1</span>
          
          <code class="ruby">        raise CCML::Error::TemplateError, &quot;Requested #{clazz} #{method} method but #{method} was not used.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="411">
          <span class="hits">15</span>
          
          <code class="ruby">      ccml = ccml.sub(match.to_s, sub)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">      # look for another match</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="414">
          <span class="hits">15</span>
          
          <code class="ruby">      pos = match.begin(0) + sub.length</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="415">
          <span class="hits">15</span>
          
          <code class="ruby">      match = SINGLE_TAG_PATTERN.match(ccml, pos)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="416">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="417">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="418">
          <span class="hits">74</span>
          
          <code class="ruby">    return ccml</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="419">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="420">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5dd11277b29118acf976bf0a3c8e8a6212c23c56">
  <div class="header">
    <h3>lib/ccml/error.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>2</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="84a8d4feacbed4c375a321530f6b6457f0b37e25">
  <div class="header">
    <h3>lib/ccml/error/base.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    class Base &lt; StandardError</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :trace</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(message = nil)</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="8">
          <span class="hits">28</span>
          
          <code class="ruby">        @trace = []</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="9">
          <span class="hits">28</span>
          
          <code class="ruby">        if $!</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="10">
          <span class="hits">7</span>
          
          <code class="ruby">          $!.trace.each {|e| @trace.push(e) } if $!.is_a?(CCML::Error::Base)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="11">
          <span class="hits">4</span>
          
          <code class="ruby">          @trace.push($!)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="13">
          <span class="hits">28</span>
          
          <code class="ruby">        super(message)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="6868b0d0b7b2022f228cac813d3de8850c356971">
  <div class="header">
    <h3>lib/ccml/error/external_source_error.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Error</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class ExternalSourceError &lt; CCML::Error::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="829f26b66a34b2ec40243a549fb53f4441eb25fe">
  <div class="header">
    <h3>lib/ccml/error/malformed_tag_error.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Error</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class MalformedTagError &lt; CCML::Error::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e620459a6311b9c01b2bd451fa9ee17d1187bf12">
  <div class="header">
    <h3>lib/ccml/error/not_implemented_error.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Error</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class NotImplementedError &lt; CCML::Error::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3f0f7bc09096c69f14328c17a24fd3b6411bd34e">
  <div class="header">
    <h3>lib/ccml/error/tag_base_class_in_template_error.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Error</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class TagBaseClassInTemplateError &lt; CCML::Error::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fcddb7d047616e54828e2f97e0286202046e8bb0">
  <div class="header">
    <h3>lib/ccml/error/tag_class_not_found_error.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Error</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class TagClassNotFoundError &lt; CCML::Error::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="01fa0f257ffcbed1167196b67a42d181cc3b7eb8">
  <div class="header">
    <h3>lib/ccml/error/tag_method_not_found_error.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Error</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class TagMethodNotFoundError &lt; CCML::Error::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="016a054b890b816b5479278edc9ca11ac6c01d24">
  <div class="header">
    <h3>lib/ccml/error/template_error.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Error</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class TemplateError &lt; CCML::Error::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="69b74fc1c322d99e9b1fdd32c40d0b3217134157">
  <div class="header">
    <h3>lib/ccml/tag.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>2</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Tag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="014c5c82d3434398cb37820f1879386ca96f9682">
  <div class="header">
    <h3>lib/ccml/tag/base.rb</h3>
    <h4><span class="green">98.81 %</span> covered</h4>
    <div>
      <b>84</b> relevant lines. 
      <span class="green"><b>83</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Tag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    class Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :url</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :host</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :port</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :resource</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :path</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :query_string</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :segments</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :fields</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :opts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :renderer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      define_method(:qs) { return @query_string }</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="20">
          <span class="hits">4</span>
          
          <code class="ruby">      define_method(:http?) { return @http }</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="21">
          <span class="hits">4</span>
          
          <code class="ruby">      define_method(:https?) { return @https }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">      URL_PATTERN = /^(?&lt;protocol&gt;http[s]?):\/\/(?&lt;host&gt;(\w|[^\?\/:])+)(:(?&lt;port&gt;\d+))?(?&lt;resource&gt;.*)$/i</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      PATH_AND_QS_PATTERN = /(?&lt;path&gt;^\/[^\?]*)?\/?(\?(?&lt;qs&gt;\S*$))?/</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">      FIELD_AND_VALUE_PATTERN = /(?&lt;field&gt;[^=]+)=(?&lt;value&gt;[^&amp;]+)\&amp;?/</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">      SEGMENT_INDEX_PATTERN =/^segment_(?&lt;index&gt;\d+)$/i </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">      LAST_SEGMENT_PATTERN = /^last_segment$/i </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">      FIELD_INDEX_PATTERN = /^field_(?&lt;index&gt;\w+)$/i</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">      QUERY_STRING_PATTERN = /^query_string$/i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(opts, url = nil)</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="32">
          <span class="hits">197</span>
          
          <code class="ruby">        if opts.is_a?(Hash)</code>
        </li>
      
        <li class="covered" data-hits="189" data-linenumber="33">
          <span class="hits">189</span>
          
          <code class="ruby">          @opts = opts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="35">
          <span class="hits">8</span>
          
          <code class="ruby">          @opts = {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="37">
          <span class="hits">197</span>
          
          <code class="ruby">        parse_url(url)</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="38">
          <span class="hits">197</span>
          
          <code class="ruby">        update_opts_from_url_segments</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="39">
          <span class="hits">197</span>
          
          <code class="ruby">        update_opts_from_url_fields</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="40">
          <span class="hits">197</span>
          
          <code class="ruby">        @renderer = MyRenderer.new(url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">      def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">        raise CCML::Error::NotImplementedError, &quot;You must override the index method in all #{self.class} subclasses.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">      private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">      def parse_url(url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="51">
          <span class="hits">197</span>
          
          <code class="ruby">        @segments = []</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="52">
          <span class="hits">197</span>
          
          <code class="ruby">        @fields = {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">        # parse the url or die</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="55">
          <span class="hits">197</span>
          
          <code class="ruby">        match = URL_PATTERN.match(url)</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="56">
          <span class="hits">197</span>
          
          <code class="ruby">        return if match.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">        # get the main pieces</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="59">
          <span class="hits">146</span>
          
          <code class="ruby">        @http = ( match[:protocol] == 'http' )</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="60">
          <span class="hits">146</span>
          
          <code class="ruby">        @https = ! @http</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="61">
          <span class="hits">146</span>
          
          <code class="ruby">        @host = match[:host]</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="62">
          <span class="hits">146</span>
          
          <code class="ruby">        @port = match[:port]</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="63">
          <span class="hits">146</span>
          
          <code class="ruby">        @resource = match[:resource]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">        # get the path and query string</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="66">
          <span class="hits">146</span>
          
          <code class="ruby">        match = PATH_AND_QS_PATTERN.match(@resource)</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="67">
          <span class="hits">146</span>
          
          <code class="ruby">        @path = ( match[:path] =~ /^\/$/ ? nil : match[:path] )</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="68">
          <span class="hits">146</span>
          
          <code class="ruby">        @path = @path[0, @path.size-1] if @path =~ /\/$/</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="69">
          <span class="hits">146</span>
          
          <code class="ruby">        @query_string = match[:qs]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">        # parse the path segments</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="72">
          <span class="hits">146</span>
          
          <code class="ruby">        @segments = @path.split('/') unless @path.blank?</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="73">
          <span class="hits">146</span>
          
          <code class="ruby">        @segments.shift if @segments[0].blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">        # parse the query string fields</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="76">
          <span class="hits">146</span>
          
          <code class="ruby">        unless @query_string.blank?</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="77">
          <span class="hits">63</span>
          
          <code class="ruby">          matches = @query_string.scan(FIELD_AND_VALUE_PATTERN)</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="78">
          <span class="hits">63</span>
          
          <code class="ruby">          matches.each do |match|</code>
        </li>
      
        <li class="covered" data-hits="89" data-linenumber="79">
          <span class="hits">89</span>
          
          <code class="ruby">            @fields[match.first.to_sym] = match.last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">      def update_opts_from_url_segments</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="86">
          <span class="hits">197</span>
          
          <code class="ruby">        @opts.each do |key, value|</code>
        </li>
      
        <li class="covered" data-hits="116" data-linenumber="87">
          <span class="hits">116</span>
          
          <code class="ruby">          match = SEGMENT_INDEX_PATTERN.match(value.to_s)</code>
        </li>
      
        <li class="covered" data-hits="116" data-linenumber="88">
          <span class="hits">116</span>
          
          <code class="ruby">          if match</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="89">
          <span class="hits">5</span>
          
          <code class="ruby">            @opts[key] = @segments[match[:index].to_i]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">          elsif value =~ LAST_SEGMENT_PATTERN</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="91">
          <span class="hits">2</span>
          
          <code class="ruby">            @opts[key] = @segments.last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">      def update_opts_from_url_fields</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="97">
          <span class="hits">197</span>
          
          <code class="ruby">        @opts.each do |key, value|</code>
        </li>
      
        <li class="covered" data-hits="116" data-linenumber="98">
          <span class="hits">116</span>
          
          <code class="ruby">          match = FIELD_INDEX_PATTERN.match(value.to_s)</code>
        </li>
      
        <li class="covered" data-hits="116" data-linenumber="99">
          <span class="hits">116</span>
          
          <code class="ruby">          if match</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="100">
          <span class="hits">5</span>
          
          <code class="ruby">            @opts[key] = @fields[match[:index].to_sym]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">          elsif value =~ QUERY_STRING_PATTERN</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="102">
          <span class="hits">2</span>
          
          <code class="ruby">            @opts[key] = @query_string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">      private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">      # http://amberbit.com/blog/render-views-partials-outside-controllers-rails-3</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">      class MyRenderer &lt; AbstractController::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">        # include Rails modules</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">        include AbstractController::Rendering</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">        include AbstractController::Layouts</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">        include AbstractController::Helpers</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">        include AbstractController::Translation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">        include AbstractController::AssetPaths</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">        include Rails.application.routes.url_helpers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">        include ActionView::Helpers::AssetTagHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">        include ActionView::Helpers::TagHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">        include ERB::Util</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">        # include local helpers</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">        Dir[&quot;#{Rails.root}/app/helpers/*_helper.rb&quot;].each do |file|</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="125">
          <span class="hits">27</span>
          
          <code class="ruby">          helper File.basename(file, '_helper.rb').to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">        # set required Rails configuration values</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">        self.view_paths = &quot;app/views&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">        self.config.assets_dir = ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">        def initialize(url)</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="133">
          <span class="hits">197</span>
          
          <code class="ruby">          match = /^http[s]?:\/\/(?&lt;host&gt;(\w|[^\?\/:])+(:\d+)?).*$/i.match(url)</code>
        </li>
      
        <li class="covered" data-hits="197" data-linenumber="134">
          <span class="hits">197</span>
          
          <code class="ruby">          default_url_options[:host] = (match.nil? ? '/' : match[:host])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7eb246b38c921e65133e6035b1d736618b519d40">
  <div class="header">
    <h3>lib/ccml/tag/curated_feed_tag.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>17</b> relevant lines. 
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class CCML::Tag::CuratedFeedTag &lt; CCML::Tag::TagPair</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # 'index' method with no opts grabs issue id from segment_1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # {ccml:curated_feed}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # &lt;h1&gt;{title}&lt;/h1&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # &lt;ul&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  # &lt;li&gt;id: {id}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  # &lt;li&gt;description: {description}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # &lt;/ul&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  # {/ccml:curated_feed}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # {ccml:curated_feed id='id or cached-slug or segment'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # {/ccml:curated_feed}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="16">
          <span class="hits">4</span>
          
          <code class="ruby">    @opts[:id] = @segments[1] unless @opts.has_key?(:id)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="17">
          <span class="hits">4</span>
          
          <code class="ruby">    feed = CuratedFeed.includes(:curated_feed_items).find(@opts[:id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="18">
          <span class="hits">3</span>
          
          <code class="ruby">    return process_tag_body(feed)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  rescue ActiveRecord::RecordNotFound =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  # Iterates through all curated feeds</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  # {ccml:curated_feed:all}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  # &lt;h1&gt;{title}&lt;/h1&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  # &lt;ul&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # &lt;li&gt;id: {id}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  # &lt;li&gt;description: {description}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  # &lt;/ul&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  # {/ccml:curated_feed:all}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def all</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="33">
          <span class="hits">2</span>
          
          <code class="ruby">    return process_tag_body(CuratedFeed.all)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  # Iterates through all the items associated with a given feed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  # {ccml:curated_feed:items id=&quot;really-cool-stuff&quot; limit=&quot;5&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  # &lt;h2&gt;{title}&lt;/h2&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  # &lt;ul&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  # &lt;li&gt;id: {id}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  # &lt;li&gt;original_url: {original_url}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  # &lt;li&gt;provider_url: {provider_url}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  # &lt;li&gt;title: {title}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  # &lt;li&gt;description: {description}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  # &lt;li&gt;pub_date: {pub_date}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  # &lt;li&gt;thumbnail_url: {objectify.oembed.thumbnail_url}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  # &lt;li&gt;thumbnail_width: {objectify.oembed.thumbnail_width}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  # &lt;li&gt;thumbnail_height: {objectify.oembed.thumbnail_height}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  # &lt;/ul&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  # {/ccml:curated_feed:items}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">  def items</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="53">
          <span class="hits">5</span>
          
          <code class="ruby">    @opts[:id] = @segments[1] unless @opts.has_key?(:id)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="54">
          <span class="hits">5</span>
          
          <code class="ruby">    curated_feed = CuratedFeed.find(@opts[:id])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="55">
          <span class="hits">4</span>
          
          <code class="ruby">    limit = -1 # default to showing all items</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="56">
          <span class="hits">4</span>
          
          <code class="ruby">    limit = @opts[:limit].to_i if @opts.has_key?(:limit)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="57">
          <span class="hits">4</span>
          
          <code class="ruby">    items = curated_feed.curated_feed_items</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="58">
          <span class="hits">4</span>
          
          <code class="ruby">    items = items.limit(limit) unless limit &lt; 0</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="59">
          <span class="hits">4</span>
          
          <code class="ruby">    return process_tag_body(items)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  rescue ActiveRecord::RecordNotFound =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">    return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="11dbac660417413c9f715428b011e50e61d6e77e">
  <div class="header">
    <h3>lib/ccml/tag/issue_tag.rb</h3>
    <h4><span class="red">78.57 %</span> covered</h4>
    <div>
      <b>42</b> relevant lines. 
      <span class="green"><b>33</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class CCML::Tag::IssueTag &lt; CCML::Tag::TagPair</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # 'index' method with no opts grabs issue id from segment_1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # {ccml:issue}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # &lt;h1&gt;Managed Issue: '{name}'&lt;/h1&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # &lt;ul&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  #   &lt;li&gt;ID: {id}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  #   &lt;li&gt;Name: {name}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  #   &lt;li&gt;Created: {created_at format='%A, %B %d at %I:%M%S %p'}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  #   &lt;li&gt;Updated: {updated_at format='%A, %B %d at %I:%M%S %p'}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  #   &lt;li&gt;Total Visits: {total_visits}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  #   &lt;li&gt;Recent Visits: {recent_visits}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  #   &lt;li&gt;Total Rating: {total_rating}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  #   &lt;li&gt;Recent Rating: {recent_rating}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  #   &lt;li&gt;Last Visit: {last_visit_date format='%A, %B %d at %I:%M%S %p'}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  #   &lt;li&gt;Last Rating: {last_rating_date format='%A, %B %d at %I:%M%S %p'}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  #   &lt;li&gt;Zip Code: {zip_code}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  #   &lt;li&gt;Image File Name: {image_file_name}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  #   &lt;li&gt;Image Content Type: {image_content_type}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  #   &lt;li&gt;Image File Size: {image_file_size}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  #   &lt;li&gt;URL: {url}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  #   &lt;li&gt;URL Title: {url_title}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  #   &lt;li&gt;Slug: {slug}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  #   &lt;li&gt;Type: {type}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  #   &lt;li&gt;Conversations: {conversations.size}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  #   &lt;li&gt;Participants: {participants.size}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  #   &lt;li&gt;Summary: {summary}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  # &lt;/ul&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  # {/ccml:issue}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  # {ccml:issue id='id or cached-slug or segment'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  # {/ccml:issue}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="35">
          <span class="hits">4</span>
          
          <code class="ruby">    @opts[:id] = @segments[1] unless @opts.has_key?(:id)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="36">
          <span class="hits">4</span>
          
          <code class="ruby">    @issue = Issue.includes(:conversations, :participants).find(@opts[:id])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="37">
          <span class="hits">3</span>
          
          <code class="ruby">    return process_tag_body(@issue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  rescue ActiveRecord::RecordNotFound =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  # 'pages' method with no opts grabs issue id from segment_1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  # {ccml:issue:pages id='&lt;id or cached-slug or segment&gt;'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  # &lt;h2&gt;Issue Page: '{name}'&lt;/h2&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  # &lt;ul&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  #   &lt;li&gt;ID: {id}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  #   &lt;li&gt;Name: {name}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  #   &lt;li&gt;Issue: {issue.name}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  #   &lt;li&gt;Author Name: {author.name}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  #   &lt;li&gt;Author Email: {author.email}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  #   &lt;li&gt;Created: {created_at format='%A, %B %d at %I:%M%S %p'}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  #   &lt;li&gt;Updated: {updated_at format='%A, %B %d at %I:%M%S %p'}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  #   &lt;li&gt;Slug: {slug}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  # &lt;/ul&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  # {/ccml:issue:pages}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  def pages</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="58">
          <span class="hits">6</span>
          
          <code class="ruby">    @opts[:id] = @segments[1] unless @opts.has_key?(:id)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="59">
          <span class="hits">6</span>
          
          <code class="ruby">    @issue = ManagedIssue.find(@opts[:id])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="60">
          <span class="hits">4</span>
          
          <code class="ruby">    return process_tag_body(@issue.pages)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  rescue ActiveRecord::RecordNotFound =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="62">
          <span class="hits">2</span>
          
          <code class="ruby">    return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  # 'conversations' method with no opts grabs issue id from segment_1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  # &lt;h1&gt;Conversations&lt;/h1&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  # {ccml:issue:conversations}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  # &lt;h2&gt;Conversation: '{title}'&lt;/h2&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  # &lt;ul&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  #   &lt;li&gt;ID: {id}&lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  #   &lt;li&gt;Started: {started_at format='%A, %B %d at %I:%M%S %p'} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  #   &lt;li&gt;Finished: {finished_at format='%A, %B %d at %I:%M%S %p'} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  #   &lt;li&gt;Created: {created_at format='%A, %B %d at %I:%M%S %p'} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  #   &lt;li&gt;Updated: {updated_at format='%A, %B %d at %I:%M%S %p'} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  #   &lt;li&gt;Title: {title} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  #   &lt;li&gt;Image: {image} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">  #   &lt;li&gt;Image File Name: {image_file_name} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">  #   &lt;li&gt;Image Content Type: {image_content_type} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  #   &lt;li&gt;Image File Size: {image_file_size} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  #   &lt;li&gt;Zip Code: {zip_code} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  #   &lt;li&gt;Total Visits: {total_visits} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  #   &lt;li&gt;Recent Visits: {recent_visits} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  #   &lt;li&gt;Last Visit Date: {last_visit_date} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  #   &lt;li&gt;Total Rating: {total_rating} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">  #   &lt;li&gt;Recent Rating: {recent_rating} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  #   &lt;li&gt;Last Rating Date: {last_rating_date} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  #   &lt;li&gt;Video URL: {video_url} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">  #   &lt;li&gt;Audio Clip File Name: {audio_clip_file_name} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">  #   &lt;li&gt;Audio Clip Content Type: {audio_clip_content_type} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">  #   &lt;li&gt;Audio Clip File Size: {audio_clip_file_size} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">  #   &lt;li&gt;Audio Clip Updated: {audio_clip_updated_at format='%A, %B %d at %I:%M%S %p'} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">  #   {if person}&lt;li&gt;Leader Name: {person.name} &lt;/li&gt;{/if}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">  #   {if person}&lt;li&gt;Leader Email: {person.email} &lt;/li&gt;{/if}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  #   &lt;li&gt;Summary: {summary} &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  # &lt;/ul&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">  # {/ccml:issue:conversations}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversations</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="99">
          <span class="hits">7</span>
          
          <code class="ruby">    @opts[:id] = @segments[1] unless @opts.has_key?(:id)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="100">
          <span class="hits">7</span>
          
          <code class="ruby">    @issue = Issue.find(@opts[:id])</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="101">
          <span class="hits">6</span>
          
          <code class="ruby">    return process_tag_body(@issue.conversations)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  rescue ActiveRecord::RecordNotFound =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">    return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">  def convos</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">    return conversations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">  # 'conversation_band' method with no opts grabs issue id from segment_1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">  # {ccml:issue:conversation_band id='&lt;id or cached-slug or segment&gt;'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">  # {ccml:issue:conversation_band id='&lt;id or cached-slug or segment&gt;'}{/ccml:issue:conversation_band}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">  def conversation_band</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">    issue = get_issue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">    if issue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">      limit = @opts[:limit].to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="118">
          
          
          <code class="ruby">      if limit &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">        conversations = issue.conversations.slice(0, limit)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">        conversations = issue.conversations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">      return @renderer.render :partial =&gt; '/conversations/conversation_band', :locals =&gt; {:conversations =&gt; conversations}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">  # 'vote_band' method with no opts grabs issue id from segment_1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">  # {ccml:issue:vote_band id='&lt;id or cached-slug or segment&gt;'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">  # {ccml:issue:vote_band id='&lt;id or cached-slug or segment&gt;' limit='2'}{/ccml:issue:conversation_band}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">  def vote_band</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="134">
          <span class="hits">6</span>
          
          <code class="ruby">    issue = get_issue</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="135">
          <span class="hits">6</span>
          
          <code class="ruby">    if issue</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="136">
          <span class="hits">6</span>
          
          <code class="ruby">      limit = @opts[:limit].to_i</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="137">
          <span class="hits">6</span>
          
          <code class="ruby">      if limit &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="138">
          <span class="hits">2</span>
          
          <code class="ruby">        votes = issue.votes.slice(0, limit)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="140">
          <span class="hits">4</span>
          
          <code class="ruby">        votes = issue.votes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="142">
          <span class="hits">6</span>
          
          <code class="ruby">      return @renderer.render :partial =&gt; '/surveys/vote_band', :locals =&gt; {:votes =&gt; votes}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">  def convo_band</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="149">
          
          
          <code class="ruby">    return conversation_band</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_issue</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="155">
          <span class="hits">6</span>
          
          <code class="ruby">    @opts[:id] = @segments[1] unless @opts.has_key?(:id)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="156">
          <span class="hits">6</span>
          
          <code class="ruby">    issue = Issue.find(@opts[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">  rescue ActiveRecord::RecordNotFound =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">    issue = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">  ensure</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="160">
          <span class="hits">6</span>
          
          <code class="ruby">    return issue</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="019a230d8f9dcb119ee73193d4cabb2dbe8634fa">
  <div class="header">
    <h3>lib/ccml/tag/route_tag.rb</h3>
    <h4><span class="red">65.38 %</span> covered</h4>
    <div>
      <b>26</b> relevant lines. 
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class CCML::Tag::RouteTag &lt; CCML::Tag::SingleTag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(opts, url = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    super(opts, url)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    @writer = MyUrlWriter.new(@host)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  # Returns the root RLurl</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  # </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # {ccml:route}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    return @writer.url(:root)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  # Returns the full URL to the requested route.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # Raises CCML::Error::TemplateError if the route is bad.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  # {ccml:route:url route=&quot;issues&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  # {ccml:route:url route=&quot;issue&quot; id=&quot;1&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  # {ccml:route:url route=&quot;issue&quot; id=&quot;more-about-the-civic-commons&quot;}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def url</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    return @writer.url(@opts[:route], @opts[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  # Returns the absolute path to the requested route.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  # Raises CCML::Error::TemplateError if the route is bad.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # {ccml:route:path route=&quot;issues&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  # {ccml:route:path route=&quot;issue&quot; id=&quot;1&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  # {ccml:route:path route=&quot;issue&quot; id=&quot;more-about-the-civic-commons&quot;}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    return @writer.path(@opts[:route], @opts[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  class MyUrlWriter &lt; AbstractController::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    include Rails.application.routes.url_helpers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(host)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">      default_url_options[:host] = host unless host.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    def url(route, id)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">      if id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">        return send &quot;#{route}_url&quot;.to_sym, id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">        return send &quot;#{route}_url&quot;.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    rescue RuntimeError =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">      return path(route, id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    rescue ActionController::RoutingError =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">      raise CCML::Error::TemplateError, e.message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">    def path(route, id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">      if id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">        return send &quot;#{route}_path&quot;.to_sym, id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">        return send &quot;#{route}_path&quot;.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    rescue ActionController::RoutingError =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">      raise CCML::Error::TemplateError, e.message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8461935e1a79144882aff854e1143e710d6d942f">
  <div class="header">
    <h3>lib/ccml/tag/rss_tag.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>70</b> relevant lines. 
      <span class="green"><b>70</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'rss/1.0'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require 'rss/2.0'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require 'open-uri'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">class CCML::Tag::RssTag &lt; CCML::Tag::TagPair</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  CACHE_KEY = '__ccml_rss_tag_cached_data__'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  # Retrieve an RSS feed and process both the channel and item elements.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # Channel elements will be available in every iteration but will not change.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  # Retrieved RSS data will be cached after every request using the Rails</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  # ActiveSupport::Cache::FileStore mechanism.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # Tag Options:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  #   url: The url of the feed to be processed (required)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  #   limit: The maximum number of items to process (optional)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  #   refresh: The number of minutes to cache the data (optional)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  # {ccml:rss url=&quot;&lt;feed url&gt;&quot; limit=&quot;&lt;max to display&gt;&quot; refresh=&quot;&lt;cache time in minutes&gt;&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  #   RSS Version: {rss_version}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  #   RSS Feed Version: {rss_feed_version}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  #   RSS Feed Type: {rss_feed_type}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  #   Channel Title: {channel_title}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  #   Channel Description: {channel_description}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  #   Channel Copyright: {channel_copyright}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  #   Channel Link: {channel_link}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  #   Channel Language: {channel_language}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  #   Channel Publication Date: {channel_date format='%m-%d-%Y %I:%M %p'}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  #   Channel Image Title: {channel_image_title}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  #   Channel Image URL: {channel_image_url}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  #   Channel Image Link: {channel_image_link}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  #   Channel Image Description: {channel_image_description}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  #   Channel Image Height: {channel_image_height}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  #   Channel Image Width: {channel_item_width}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  #   Channel Item Count: {channel_item_count}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  #   Item Title: {item_title}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  #   Item Link: {item_link}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  #   Item Description: {item_description}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  #   Item Publication Date: {item_date format='%m-%d-%Y %I:%M %p'}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  # {/ccml:rss}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="42">
          <span class="hits">12</span>
          
          <code class="ruby">    rss = parse_rss</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="43">
          <span class="hits">12</span>
          
          <code class="ruby">    return nil if rss.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="45">
          <span class="hits">7</span>
          
          <code class="ruby">    items = []</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="46">
          <span class="hits">7</span>
          
          <code class="ruby">    limit = [rss.items.size, @opts[:limit].to_i].min</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="47">
          <span class="hits">7</span>
          
          <code class="ruby">    limit = rss.items.size if limit == 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="49">
          <span class="hits">7</span>
          
          <code class="ruby">    channel = parse_channel(rss, 'channel_')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="51">
          <span class="hits">7</span>
          
          <code class="ruby">    (0..limit-1).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="88" data-linenumber="52">
          <span class="hits">88</span>
          
          <code class="ruby">      data = {}</code>
        </li>
      
        <li class="covered" data-hits="88" data-linenumber="53">
          <span class="hits">88</span>
          
          <code class="ruby">      channel['channel_item_count'] = limit</code>
        </li>
      
        <li class="covered" data-hits="88" data-linenumber="54">
          <span class="hits">88</span>
          
          <code class="ruby">      data.merge!(channel)</code>
        </li>
      
        <li class="covered" data-hits="88" data-linenumber="55">
          <span class="hits">88</span>
          
          <code class="ruby">      data.merge!(parse_item(rss.items[i], 'item_'))</code>
        </li>
      
        <li class="covered" data-hits="88" data-linenumber="56">
          <span class="hits">88</span>
          
          <code class="ruby">      items &lt;&lt; data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="59">
          <span class="hits">7</span>
          
          <code class="ruby">    return process_tag_body(items)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  # Retrieve an RSS feed and process the item elements. Retrieved RSS data </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  # will be cached after every request using the Rails</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  # ActiveSupport::Cache::FileStore mechanism.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  # Tag Options:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  #   url: The url of the feed to be processed (required)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  #   limit: The maximum number of items to process (optional)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  #   refresh: The number of minutes to cache the data (optional)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  # {ccml:rss:items url=&quot;&lt;feed url&gt;&quot; limit=&quot;&lt;max to display&gt;&quot; refresh=&quot;&lt;cache time in minutes&gt;&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  #   Title: {title}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  #   Link: {link}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  #   Description: {description}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  #   Publication Date: {date format='%m-%d-%Y %I:%M %p'}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  # {/ccml:rss:items}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">  def items</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="78">
          <span class="hits">8</span>
          
          <code class="ruby">    rss = parse_rss</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="80">
          <span class="hits">8</span>
          
          <code class="ruby">    if rss.nil?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="81">
          <span class="hits">5</span>
          
          <code class="ruby">      raise CCML::Error::ExternalSourceError, &quot;RSS feed url: #{@opts[:url]} is not valid.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="84">
          <span class="hits">3</span>
          
          <code class="ruby">    items = []</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="85">
          <span class="hits">3</span>
          
          <code class="ruby">    limit = [rss.items.size, @opts[:limit].to_i].min</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="86">
          <span class="hits">3</span>
          
          <code class="ruby">    limit = rss.items.size if limit == 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="88">
          <span class="hits">3</span>
          
          <code class="ruby">    (0..limit-1).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="89">
          <span class="hits">27</span>
          
          <code class="ruby">      items &lt;&lt; (parse_item(rss.items[i]))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="91">
          <span class="hits">3</span>
          
          <code class="ruby">    return process_tag_body(items)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">  # Retrieve an RSS feed and process the channel elements. This tag will</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  # iterate only once no matter how many items have been retrieved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  # Retrieved RSS data will be cached after every request using the Rails</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">  # ActiveSupport::Cache::FileStore mechanism.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">  # Tag Options:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  #   url: The url of the feed to be processed (required)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  #   refresh: The number of minutes to cache the data (optional)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">  # {ccml:rss:channel url=&quot;&lt;feed url&gt;&quot; refresh=&quot;&lt;cache time in minutes&gt;&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  #   RSS Version: {rss_version}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">  #   RSS Feed Version: {rss_feed_version}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">  #   RSS Feed Type: {rss_feed_type}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">  #   Title: {title}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  #   Description: {description}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  #   Copyright: {copyright}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">  #   Link: {link}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">  #   Language: {language}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">  #   Publication Date: {date format='%m-%d-%Y %I:%M %p'}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">  #   Image Title: {image_title}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  #   Image URL: {image_url}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">  #   Image Link: {image_link}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">  #   Image Description: {image_description}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">  #   Image Height: {image_height}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">  #   Image Width: {item_width}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">  #   Item Count: {item_count}&lt;br /&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">  # {/ccml:rss:channel}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">  def channel</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">    rss = parse_rss</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">    if rss.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">      return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">      return process_tag_body(parse_channel(rss))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">  def parse_item(rss, prefix = '')</code>
        </li>
      
        <li class="covered" data-hits="115" data-linenumber="133">
          <span class="hits">115</span>
          
          <code class="ruby">    item = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">      &quot;#{prefix}title&quot; =&gt; rss.title,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">      &quot;#{prefix}link&quot; =&gt; rss.link,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">      &quot;#{prefix}description&quot; =&gt; rss.description,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">      &quot;#{prefix}date&quot; =&gt; rss.date,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="covered" data-hits="115" data-linenumber="139">
          <span class="hits">115</span>
          
          <code class="ruby">    return item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">  def parse_channel(rss, prefix = '')</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="143">
          <span class="hits">8</span>
          
          <code class="ruby">    channel = { }</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="144">
          <span class="hits">8</span>
          
          <code class="ruby">    channel[&quot;rss_version&quot;] = rss.version</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="145">
          <span class="hits">8</span>
          
          <code class="ruby">    channel[&quot;rss_feed_version&quot;] = rss.feed_version</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="146">
          <span class="hits">8</span>
          
          <code class="ruby">    channel[&quot;rss_feed_type&quot;] = rss.feed_type</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="147">
          <span class="hits">8</span>
          
          <code class="ruby">    channel[&quot;#{prefix}title&quot;] = rss.channel.title</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="148">
          <span class="hits">8</span>
          
          <code class="ruby">    channel[&quot;#{prefix}description&quot;] = rss.channel.description</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="149">
          <span class="hits">8</span>
          
          <code class="ruby">    channel[&quot;#{prefix}copyright&quot;] = rss.channel.copyright</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="150">
          <span class="hits">8</span>
          
          <code class="ruby">    channel[&quot;#{prefix}link&quot;] = rss.channel.link</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="151">
          <span class="hits">8</span>
          
          <code class="ruby">    channel[&quot;#{prefix}language&quot;] = rss.channel.language</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="152">
          <span class="hits">8</span>
          
          <code class="ruby">    channel[&quot;#{prefix}date&quot;] = rss.channel.date</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="153">
          <span class="hits">8</span>
          
          <code class="ruby">    if rss.channel.image</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="154">
          <span class="hits">8</span>
          
          <code class="ruby">      channel[&quot;#{prefix}image_title&quot;] = rss.channel.image.title</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="155">
          <span class="hits">8</span>
          
          <code class="ruby">      channel[&quot;#{prefix}image_url&quot;] = rss.channel.image.url</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="156">
          <span class="hits">8</span>
          
          <code class="ruby">      channel[&quot;#{prefix}image_link&quot;] = rss.channel.image.link</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="157">
          <span class="hits">8</span>
          
          <code class="ruby">      channel[&quot;#{prefix}image_description&quot;] = rss.channel.image.description</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="158">
          <span class="hits">8</span>
          
          <code class="ruby">      channel[&quot;#{prefix}image_height&quot;] = rss.channel.image.width</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="159">
          <span class="hits">8</span>
          
          <code class="ruby">      channel[&quot;#{prefix}image_width&quot;] = rss.channel.image.height</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="161">
          <span class="hits">8</span>
          
          <code class="ruby">    channel[&quot;#{prefix}item_count&quot;] = rss.channel.items.size</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="162">
          <span class="hits">8</span>
          
          <code class="ruby">    return channel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">  def parse_rss</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">    # get the cache and refresh data</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="168">
          <span class="hits">21</span>
          
          <code class="ruby">    cache_key = &quot;#{CACHE_KEY}#{@opts[:url]}&quot;</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="169">
          <span class="hits">21</span>
          
          <code class="ruby">    cache = Rails.cache.fetch(cache_key)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="170">
          <span class="hits">21</span>
          
          <code class="ruby">    refresh = @opts[:refresh].to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">    # check for existing and non-stale data for this url</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="173">
          <span class="hits">21</span>
          
          <code class="ruby">    if cache.nil? or cache[:time] &lt; refresh.minutes.ago</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">      # get new data</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="175">
          <span class="hits">18</span>
          
          <code class="ruby">      content = ''</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="176">
          <span class="hits">33</span>
          
          <code class="ruby">      open(@opts[:url]) do |s| content = s.read end</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="177">
          <span class="hits">15</span>
          
          <code class="ruby">      rss = RSS::Parser.parse(content, false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">      # use the cached data</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="180">
          <span class="hits">3</span>
          
          <code class="ruby">      rss = cache[:rss]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">    # save the data back to the cache</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="184">
          <span class="hits">17</span>
          
          <code class="ruby">    cache = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">      :time =&gt; Time.now,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">      :rss =&gt; rss</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="188">
          <span class="hits">17</span>
          
          <code class="ruby">    Rails.cache.write(cache_key, cache)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">  rescue TypeError, Errno::ENOENT =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="191">
          <span class="hits">3</span>
          
          <code class="ruby">    rss = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">  ensure</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="193">
          <span class="hits">21</span>
          
          <code class="ruby">    return rss</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="dead7b191e5d38577e37f3d861a993f25df6dbeb">
  <div class="header">
    <h3>lib/ccml/tag/single_tag.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Tag</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class SingleTag &lt; Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="708387224c3ee97e9f1f39b9144d04d7bb247c96">
  <div class="header">
    <h3>lib/ccml/tag/tag_pair.rb</h3>
    <h4><span class="green">97.47 %</span> covered</h4>
    <div>
      <b>79</b> relevant lines. 
      <span class="green"><b>77</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CCML</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Tag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    class TagPair &lt; Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_writer :tag_body</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      IF_BLOCK_PATTERN = /\{if\s+.+?}.*?(\{if:elsif\s+.+?}.+?)*?(\{if:else}.+?)??\{\/if}/im</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">      IF_PATTERN = /\{if\s+(?&lt;cond&gt;.+?)}(?&lt;body&gt;.+?)\{\/?if/im</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      ELSIF_PATTERN = /\{if:else?if\s+(?&lt;cond&gt;.+?)}(?&lt;body&gt;.+?)\{\/?if/im</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">      ELSE_PATTERN = /\{if:else}(?&lt;body&gt;.+?)\{\/if}/im</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">      VAR_PATTERN = /\{(?&lt;vars&gt;\S+?)(\s+format=['&quot;](?&lt;format&gt;.*?)['&quot;])?}/i</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">      ARRAY_PATTERN = /(?&lt;method&gt;\w+)(\[(?&lt;index&gt;\d+)\])/i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      def process_tag_body(data)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">        # inputs and outputs</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="18">
          <span class="hits">52</span>
          
          <code class="ruby">        return_data = ''</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="19">
          <span class="hits">52</span>
          
          <code class="ruby">        data = [ data ] unless data.respond_to?(:each) and not data.is_a?(Hash)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">        # iterate through all data items</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="22">
          <span class="hits">52</span>
          
          <code class="ruby">        data.each do |datum|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">          # wrap the hash for later evaluation</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="25">
          <span class="hits">175</span>
          
          <code class="ruby">          datum = to_struct(datum) if datum.is_a?(Hash)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">          # process the tag body</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="28">
          <span class="hits">175</span>
          
          <code class="ruby">          tag_body = String.new(@tag_body.to_s)</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="29">
          <span class="hits">175</span>
          
          <code class="ruby">          tag_body = process_conditionals(datum, tag_body)</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="30">
          <span class="hits">175</span>
          
          <code class="ruby">          tag_body = process_variables(datum, tag_body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">          # append to the output buffer</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="33">
          <span class="hits">175</span>
          
          <code class="ruby">          return_data &lt;&lt; tag_body</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="37">
          <span class="hits">52</span>
          
          <code class="ruby">        return return_data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">      private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">      def evaluate_conditional(datum, if_match, match, tag_body)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="43">
          <span class="hits">14</span>
          
          <code class="ruby">        sub = nil</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="44">
          <span class="hits">14</span>
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="45">
          <span class="hits">14</span>
          
          <code class="ruby">          if datum.instance_eval(if_match[:cond])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="46">
          <span class="hits">5</span>
          
          <code class="ruby">            sub = if_match[:body]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="47">
          <span class="hits">5</span>
          
          <code class="ruby">            tag_body = tag_body.sub(match.to_s, sub)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">        rescue =&gt; error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">          #puts &quot;#{error.class} - #{error.message}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="52">
          <span class="hits">14</span>
          
          <code class="ruby">        return sub, tag_body</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">      def process_conditionals(datum, tag_body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">        # iterate through all the conditionals in the tag body</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="58">
          <span class="hits">175</span>
          
          <code class="ruby">        pos = 0</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="59">
          <span class="hits">175</span>
          
          <code class="ruby">        while match = IF_BLOCK_PATTERN.match(tag_body, pos)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">          # process the 'if' conditional</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="62">
          <span class="hits">7</span>
          
          <code class="ruby">          if_match = IF_PATTERN.match(match.to_s)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="63">
          <span class="hits">7</span>
          
          <code class="ruby">          sub, tag_body = evaluate_conditional(datum, if_match, match, tag_body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">          # process all 'elsif' conditionals</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="66">
          <span class="hits">7</span>
          
          <code class="ruby">          if sub.nil?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="67">
          <span class="hits">4</span>
          
          <code class="ruby">            pos = 0</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="68">
          <span class="hits">4</span>
          
          <code class="ruby">            while if_match = ELSIF_PATTERN.match(match.to_s, pos)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="69">
          <span class="hits">7</span>
          
          <code class="ruby">              sub, tag_body = evaluate_conditional(datum, if_match, match, tag_body)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="70">
          <span class="hits">7</span>
          
          <code class="ruby">              sub ? break : pos = if_match.end(2)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">          # process the else</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="75">
          <span class="hits">7</span>
          
          <code class="ruby">          if sub.nil? and if_match = ELSE_PATTERN.match(match.to_s)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="76">
          <span class="hits">2</span>
          
          <code class="ruby">            sub = if_match[:body]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="77">
          <span class="hits">2</span>
          
          <code class="ruby">            tag_body = tag_body.sub(match.to_s, sub)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">          # wipe the entire match if no conditional returned true</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="81">
          <span class="hits">7</span>
          
          <code class="ruby">          if sub.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">            sub = ''</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">            tag_body = tag_body.sub(match.to_s, sub)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">          # look for another match</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="87">
          <span class="hits">7</span>
          
          <code class="ruby">          pos = match.begin(0) + sub.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="90">
          <span class="hits">175</span>
          
          <code class="ruby">        return tag_body</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">      def process_variables(datum, tag_body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">        # iterate through all vars in the tag body</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="96">
          <span class="hits">175</span>
          
          <code class="ruby">        pos = 0</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="97">
          <span class="hits">175</span>
          
          <code class="ruby">        while match = VAR_PATTERN.match(tag_body, pos)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">          # get the variable call string</code>
        </li>
      
        <li class="covered" data-hits="1413" data-linenumber="100">
          <span class="hits">1413</span>
          
          <code class="ruby">          vars = match[:vars]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">          # get the variable data</code>
        </li>
      
        <li class="covered" data-hits="1413" data-linenumber="102">
          <span class="hits">1413</span>
          
          <code class="ruby">          begin</code>
        </li>
      
        <li class="covered" data-hits="1413" data-linenumber="103">
          <span class="hits">1413</span>
          
          <code class="ruby">            methods = vars.split('.')</code>
        </li>
      
        <li class="covered" data-hits="1413" data-linenumber="104">
          <span class="hits">1413</span>
          
          <code class="ruby">            object = datum</code>
        </li>
      
        <li class="covered" data-hits="1413" data-linenumber="105">
          <span class="hits">1413</span>
          
          <code class="ruby">            (0 .. methods.size-1).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="1420" data-linenumber="106">
          <span class="hits">1420</span>
          
          <code class="ruby">              arymtch = ARRAY_PATTERN.match(methods[i])</code>
        </li>
      
        <li class="covered" data-hits="1420" data-linenumber="107">
          <span class="hits">1420</span>
          
          <code class="ruby">              if arymtch.nil?</code>
        </li>
      
        <li class="covered" data-hits="1413" data-linenumber="108">
          <span class="hits">1413</span>
          
          <code class="ruby">                object = object.send(methods[i].to_sym)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">              else</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="110">
          <span class="hits">7</span>
          
          <code class="ruby">                object = object.send(arymtch[:method].to_sym)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="111">
          <span class="hits">7</span>
          
          <code class="ruby">                object = object[arymtch[:index].to_i]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="covered" data-hits="1405" data-linenumber="114">
          <span class="hits">1405</span>
          
          <code class="ruby">            sub = object</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">          rescue =&gt; error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">            #puts &quot;#{error.class} - #{error.message}&quot;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="117">
          <span class="hits">8</span>
          
          <code class="ruby">            sub = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">          # check for date format</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">          #TODO Make timezone aware. Parse and format functions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">          #     look at GMT vs. local differently - Jerry</code>
        </li>
      
        <li class="covered" data-hits="1413" data-linenumber="123">
          <span class="hits">1413</span>
          
          <code class="ruby">          if match[:format]</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="124">
          <span class="hits">129</span>
          
          <code class="ruby">            begin</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="125">
          <span class="hits">129</span>
          
          <code class="ruby">              sub = Time.parse(sub) unless sub.is_a?(Time)</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="126">
          <span class="hits">128</span>
          
          <code class="ruby">              sub = sub.strftime(match[:format])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">            rescue =&gt; error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">              #puts &quot;#{error.class} - #{error.message}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">          # make the substitution</code>
        </li>
      
        <li class="covered" data-hits="1413" data-linenumber="133">
          <span class="hits">1413</span>
          
          <code class="ruby">          sub = sub.to_s</code>
        </li>
      
        <li class="covered" data-hits="1413" data-linenumber="134">
          <span class="hits">1413</span>
          
          <code class="ruby">          tag_body = tag_body.sub(match.to_s, sub)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">          # look for another match</code>
        </li>
      
        <li class="covered" data-hits="1413" data-linenumber="137">
          <span class="hits">1413</span>
          
          <code class="ruby">          pos = match.begin(0) + sub.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="140">
          <span class="hits">175</span>
          
          <code class="ruby">        return tag_body</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">      def to_struct(item)</code>
        </li>
      
        <li class="covered" data-hits="135" data-linenumber="144">
          <span class="hits">135</span>
          
          <code class="ruby">        struct = OpenStruct.new(item)</code>
        </li>
      
        <li class="covered" data-hits="135" data-linenumber="145">
          <span class="hits">135</span>
          
          <code class="ruby">        item.each do |key, value|</code>
        </li>
      
        <li class="covered" data-hits="1910" data-linenumber="146">
          <span class="hits">1910</span>
          
          <code class="ruby">          if value.is_a? Hash</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="147">
          <span class="hits">2</span>
          
          <code class="ruby">            obj = to_struct(value)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="148">
          <span class="hits">2</span>
          
          <code class="ruby">            struct.send(&quot;#{key}=&quot;.to_sym, obj)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">          elsif value.is_a? Array</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="150">
          <span class="hits">2</span>
          
          <code class="ruby">            value = struct.send(key.to_sym)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="151">
          <span class="hits">2</span>
          
          <code class="ruby">            (0 .. value.size-1).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="152">
          <span class="hits">7</span>
          
          <code class="ruby">              value[i] = to_struct(value[i]) if value[i].is_a? Hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="135" data-linenumber="156">
          <span class="hits">135</span>
          
          <code class="ruby">        return struct</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="bb1541a67ddcb1a77fd0050cf7879876a2f61dba">
  <div class="header">
    <h3>lib/ccml/tag/vote_tag.rb</h3>
    <h4><span class="yellow">87.5 %</span> covered</h4>
    <div>
      <b>8</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class CCML::Tag::VoteTag &lt; CCML::Tag::SingleTag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  #{ccml:vote id='1'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  #{ccml:vote limit='10'}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="7">
          <span class="hits">5</span>
          
          <code class="ruby">    if @opts.has_key?(:id)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="8">
          <span class="hits">3</span>
          
          <code class="ruby">      votes = [Vote.find(@opts[:id])]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="10">
          <span class="hits">2</span>
          
          <code class="ruby">      limit = @opts[:limit] || 10</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="11">
          <span class="hits">2</span>
          
          <code class="ruby">      votes = Vote.all(:limit =&gt; limit.to_i)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="14">
          <span class="hits">5</span>
          
          <code class="ruby">    return @renderer.render :partial =&gt; '/surveys/vote_band', :locals =&gt; {:votes =&gt; votes}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  rescue ActiveRecord::RecordNotFound =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="14144a7d11c0b597d23d17b11a3d0a070a10f603">
  <div class="header">
    <h3>lib/filter_constraint.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class FilterConstraint</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.matches?(request)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    # Ideally, we could put</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    #   :constraints =&gt; {:filter =&gt; ['active', 'popular']}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    # in our routes.rb, but constraints does not work with arrays</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="6">
          <span class="hits">10</span>
          
          <code class="ruby">    resource, filter = request.path.split('/').last(2)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="7">
          <span class="hits">10</span>
          
          <code class="ruby">    resource = resource.singularize.camelize.constantize</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="8">
          <span class="hits">10</span>
          
          <code class="ruby">    available_filters = resource.available_filter_names || []</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="9">
          <span class="hits">10</span>
          
          <code class="ruby">    available_filters.include?(filter)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4c7d2254f8b4921fed71b9af6d6fa2b1509ea300">
  <div class="header">
    <h3>lib/generic_object.rb</h3>
    <h4><span class="red">50.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'ostruct'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">class GenericObject &lt; OpenStruct</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    if self.respond_to?('first_name') and self.respond_to?('last_name')</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">      return (&quot;%s %s&quot; % [self.first_name, self.last_name]).strip</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    return ''</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="765e8112e4aa74d57d547d1520d701a28ee1bab8">
  <div class="header">
    <h3>lib/geometry_for_style.rb</h3>
    <h4><span class="red">50.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module GeometryForStyle</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def geometry_for_style(style=:original, method=:image)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    attachment = self.send(method)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    Paperclip::Geometry.parse(attachment.styles[style].geometry)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="91868468c438398539081cb50e150532e25cb9bc">
  <div class="header">
    <h3>lib/ingester.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>60</b> relevant lines. 
      <span class="green"><b>60</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># -*- coding: utf-8 -*-</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Ingester is a tool for ingesting the transcript of a Conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"># Ingester.build takes in a transcript text in a mini DSL which is </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"># parsed and returns a collection of Ingester::Dialogs representing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"># the parsed Contribution to the Conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"># Example transcript</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"># speaker &quot;John Foo&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"># dialog &lt;&lt;-enddialog</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"># Hello my name is John Foo. Today I will be discussing the case for private wells with home owner Betty Bar.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"># enddialog</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"># </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"># speaker &quot;Betty Bar&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"># dialog &lt;&lt;-enddialog</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"># Hi John, thanks for allowing me to a be a part of this discussion.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"># enddialog</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"># The above transcript would be parsed into 2 Dialog structs:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"># [ #&lt;struct Ingester::Dialog speaker=&quot;John Foo&quot;, time=nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">#   content=&quot;Hello my name is John Foo. Today I will be discussing the case for private wells with home owner Betty Bar.&quot;&gt;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">#   #&lt;struct Ingester::Dialog speaker=&quot;Betty Bar&quot;, time=nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">#   content=&quot;Hi John, thanks for allowing me to a be a part of this discussion.&quot;&gt; ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"># When Ingester.ingest encounters an error it wraps the original exception so</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"># it can be accessed later and raises an Ingester::Error with info regarding</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"># the error encountered.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">class Ingester</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  # Represents an ingest error. Used for identifying errors</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  # coming from Ingester.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  class Error &lt; RuntimeError</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(message, wrapped_exception)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="39">
          <span class="hits">16</span>
          
          <code class="ruby">      @wrapped_exception = wrapped_exception</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="40">
          <span class="hits">16</span>
          
          <code class="ruby">      super(message)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  # Takes in a string of text and returns an Array of Dialog</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  # Structs representing the dialogs parsed in string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  # raises a wrapped IngesterError when an error occurs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  # parsing or building the Dialogs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.ingest(string)</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="51">
          <span class="hits">24</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="52">
          <span class="hits">24</span>
          
          <code class="ruby">      string = munge(string)</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="53">
          <span class="hits">24</span>
          
          <code class="ruby">      DSL.build(string)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="54">
          <span class="hits">16</span>
          
          <code class="ruby">    rescue =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="55">
          <span class="hits">16</span>
          
          <code class="ruby">      friendly_exception_info = parse_exception(e)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="56">
          <span class="hits">16</span>
          
          <code class="ruby">      raise Error.new(friendly_exception_info, e)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  # Handles problems from Copying and Pasting from Microsoft Word into plain</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  # text editors</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.munge(string)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    # Replace all ISO-8859-1 or CP1252 characters by their UTF-8 equivalent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    # resulting in a valid UTF-8 string</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="68">
          <span class="hits">24</span>
          
          <code class="ruby">    chars = ActiveSupport::Multibyte::Chars.new(string).tidy_bytes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    # Replace \r and \r\n with \n</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="71">
          <span class="hits">24</span>
          
          <code class="ruby">    chars = chars.gsub(&quot;\r\n&quot;, &quot;\r&quot;).gsub(&quot;\r&quot;, &quot;\n\n&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    # Replace smart quotes with &quot;normal quotes&quot;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="74">
          <span class="hits">24</span>
          
          <code class="ruby">    chars = chars.gsub(/[]/, '&quot;').gsub(/[]/, &quot;'&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    # Convert back to a string</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="77">
          <span class="hits">24</span>
          
          <code class="ruby">    chars.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  # Helper method that takes an exception and makes a friendlier</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  # error containing the approximate line number in the string of</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  # text to Ingest</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  # example exception format:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  # NameError: undefined local variable or method `foo' for #&lt;Ingester::DSL:0x000001032c6060&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">  # becomes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  # Error ingesting transcript; NameError: undefined local variable or method `foo'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.parse_exception(exception)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="91">
          <span class="hits">16</span>
          
          <code class="ruby">    message = exception.message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="121" data-linenumber="93">
          <span class="hits">121</span>
          
          <code class="ruby">    if exception.backtrace.detect{|l| l =~/IngesterTranscript:(\d+)/}</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="94">
          <span class="hits">14</span>
          
          <code class="ruby">      line_info = &quot;Error ingesting transcript around line #{$1}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="96">
          <span class="hits">2</span>
          
          <code class="ruby">      line_info = &quot;Error ingesting transcript&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">    # Remove info regarding instance of DSL class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    # &lt;Ingester::DSL:0x000001032c6060&gt;</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="101">
          <span class="hits">16</span>
          
          <code class="ruby">    line_info + &quot;; &quot; + message.gsub(/ for #&lt;.*?&gt;/, &quot;&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  # Simple struct for holding a particular &quot;Contribution&quot; of an</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">  # ingested transcript</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">  class Dialog &lt; Struct.new(:speaker, :time, :content)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">    def partial_dialog?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="108">
          <span class="hits">10</span>
          
          <code class="ruby">      (speaker || time) &amp;&amp; !content</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">  # Mini DSL for parsing the conversation text. Extends BasicObject</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">  # to help protect against injection like Kernel#exit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">  class DSL &lt; BasicObject</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">    # </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.build(string)</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="117">
          <span class="hits">24</span>
          
          <code class="ruby">      builder = new</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="118">
          <span class="hits">24</span>
          
          <code class="ruby">      builder.instance_eval(string, &quot;IngesterTranscript&quot;, 1)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="119">
          <span class="hits">10</span>
          
          <code class="ruby">      if builder.current_dialog.partial_dialog?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="120">
          <span class="hits">2</span>
          
          <code class="ruby">        builder.raise_illegal_state &quot;Expected a dialog.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="122">
          <span class="hits">8</span>
          
          <code class="ruby">      builder.dialogs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    # represents the current dialog being read/parsed by DSL</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :current_dialog</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">    # represents an Array of Dialogs that have been read/parsed.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">    # Dialogs is oredered earliest parsed to latest.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :dialogs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">    # Initalize the DSL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="136">
          <span class="hits">24</span>
          
          <code class="ruby">      @dialogs = []</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="137">
          <span class="hits">24</span>
          
          <code class="ruby">      @current_dialog = Dialog.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">    # Sets teh speaker of the current dialog.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">    # Raises an error if name is nil or blank or if the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">    # current dialog already has a speaker.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">    def speaker(name=nil)</code>
        </li>
      
        <li class="covered" data-hits="160" data-linenumber="145">
          <span class="hits">160</span>
          
          <code class="ruby">      if name.nil? || name.blank?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="146">
          <span class="hits">3</span>
          
          <code class="ruby">        raise_illegal_state &quot;You must provide a speaker.&quot; </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">      elsif @current_dialog.speaker</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">        raise_illegal_state &quot;Expected a dialog or time.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="156" data-linenumber="150">
          <span class="hits">156</span>
          
          <code class="ruby">      @current_dialog.speaker = name.strip</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">    # Sets the time for the current dialog.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">    # Raises an error if time is nil or blank or if the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">    # current dialog already has a time.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">    def time(_time=nil)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="158">
          <span class="hits">9</span>
          
          <code class="ruby">      if _time.nil? || _time.blank?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="159">
          <span class="hits">3</span>
          
          <code class="ruby">        raise_illegal_state &quot;You must provide a time.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">      elsif @current_dialog.time</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">        raise_illegal_state &quot;Time has already been set.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="163">
          <span class="hits">5</span>
          
          <code class="ruby">      @current_dialog.time = _time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">    # sets the content for the dialog.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">    # Raises an error if content is nil or blnak or if</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">    # the current dialog does not have a speaker or</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">    # already has content.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">    def dialog(content=nil)</code>
        </li>
      
        <li class="covered" data-hits="155" data-linenumber="172">
          <span class="hits">155</span>
          
          <code class="ruby">      if content.nil? || content.blank?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="173">
          <span class="hits">3</span>
          
          <code class="ruby">        raise_illegal_state &quot;You must provide a dialog.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">      elsif @current_dialog.speaker.nil? || @current_dialog.content</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="175">
          <span class="hits">2</span>
          
          <code class="ruby">        raise_illegal_state &quot;Expected a speaker before dialog.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="150" data-linenumber="177">
          <span class="hits">150</span>
          
          <code class="ruby">      @current_dialog.content = content.strip</code>
        </li>
      
        <li class="covered" data-hits="150" data-linenumber="178">
          <span class="hits">150</span>
          
          <code class="ruby">      @dialogs &lt;&lt; @current_dialog</code>
        </li>
      
        <li class="covered" data-hits="150" data-linenumber="179">
          <span class="hits">150</span>
          
          <code class="ruby">      @current_dialog = Dialog.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">    # Raise an error prefixed with &quot;illegal state.&quot; which can be used to</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">    # identify DSL based exceptions</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">    def raise_illegal_state(message)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="185">
          <span class="hits">15</span>
          
          <code class="ruby">      raise &quot;illegal state. #{message}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">    def raise(*args)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="189">
          <span class="hits">15</span>
          
          <code class="ruby">      ::Object.send(:raise, *args)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="059d7c1b738435adb1dde9bd87fa6691b463c15f">
  <div class="header">
    <h3>lib/parent_validator.rb</h3>
    <h4><span class="red">66.67 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ParentValidator &lt; ActiveModel::Validator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate(record)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    record.errors[:base] &lt;&lt; &quot;This record has no valid parent&quot; unless check(record)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    def check(record)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">      # parent record types are:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">      # 0 - bogus, who knows</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">      # 1 - comment</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      # 2 - event</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      # 3 - question</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      # 4 - answer</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      (record.parent_type &gt;= 1) &amp;&amp; (record.parent_type &lt;= 4)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0606951742d5a7f85388fcc8b32f54d971527c10">
  <div class="header">
    <h3>lib/s3_config.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'config/configurator'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">module S3Config</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include Configurator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  extend self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def credential_file</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    # paperclip bug: if you don't specify the path, you will get</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    # a stack overflow when trying to upload an image.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    # return an open File object that contains our Amazon S3 credentials.</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="10">
          <span class="hits">9</span>
          
          <code class="ruby">    filename = '/data/TheCivicCommons/shared/config/amazon_s3.yml' # the way it lands on EngineYard</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="11">
          <span class="hits">9</span>
          
          <code class="ruby">    unless File.exist?(filename)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="12">
          <span class="hits">9</span>
          
          <code class="ruby">      filename = Rails.root + 'config/amazon_s3.yml'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="14">
          <span class="hits">9</span>
          
          <code class="ruby">    File.new(filename)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  load_config(:file =&gt; credential_file, :environment =&gt; Rails.env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c044a9faf0a3b47c502c6aea47ac8cf8bca86ab4">
  <div class="header">
    <h3>lib/unsubscribe_someone.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module UnsubscribeSomeone</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def unsubscribe_from_daily_digest</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="3">
          <span class="hits">5</span>
          
          <code class="ruby">    self.daily_digest = false</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="4">
          <span class="hits">5</span>
          
          <code class="ruby">    save(:validate =&gt; false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def subscribed_to_daily_digest?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="7">
          <span class="hits">4</span>
          
          <code class="ruby">    daily_digest</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ae77079de42d9035fcfdca96dbf5210d7645eb36">
  <div class="header">
    <h3>lib/utilities/conversation_utilities.rb</h3>
    <h4><span class="yellow">86.21 %</span> covered</h4>
    <div>
      <b>29</b> relevant lines. 
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Utilities</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  ##</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # Contains methods that are meant to manipulate Conversation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  # records.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  module ConversationUtilities</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    ##</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    # This method flips through all conversations and looks for any Issues</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    # that are associated with them.  If there are, then the Topics from</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    # those issues are set for the conversation.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    # No change is made in the relationship between the Conversation and</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    # Issue records.  Only Topic relationships are added.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    # In case the Topics for a Conversation have been set already, no </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    # Topic relationships are removed.  Topics are only added based upon</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # any existing relationship between the Conversation and an Issue.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    # @param [Boolean] commit Whether or not to commit changes to the </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    #   database.  Default is +false+, which is essentially a dry run</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    # @param [ActiveSupport::BufferedLogger] logger Where to output all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    #   of the status messages. It doesn't have to be a BufferedLogger, but</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    #   does need to implement the +info+ method; uses the Rails.logger</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    #   by default</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    # @param [Array&lt;Conversation&gt;] conversations An optional array of</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    #   conversations to process.  If not provided, then all conversations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    #   with relationships to Issues are fetched and processed.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.set_topics_from_issues(commit = false, logger = Rails.logger, conversations = [])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="30">
          <span class="hits">5</span>
          
          <code class="ruby">      start = Time.now</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="32">
          <span class="hits">5</span>
          
          <code class="ruby">      if conversations.empty?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="33">
          <span class="hits">3</span>
          
          <code class="ruby">        conversations = Conversation.joins(:issues)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="34">
          <span class="hits">3</span>
          
          <code class="ruby">        if conversations.empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">          logger.info('There are 0 conversations to process.', 'ConversationUtilities')</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">          return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="40">
          <span class="hits">5</span>
          
          <code class="ruby">      logger.info(&quot;Processing #{conversations.count} conversations . . . &quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      # Iterate through the conversations</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="43">
          <span class="hits">5</span>
          
          <code class="ruby">      conversations.each do |conversation|</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="44">
          <span class="hits">14</span>
          
          <code class="ruby">        logger.info(&quot;Processing conversation (#{conversation.id}) - #{conversation.title} . . . &quot;, 'ConversationUtilities')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">        # Get a list of the topics that are associated with the conversation</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="47">
          <span class="hits">14</span>
          
          <code class="ruby">        all_issues = conversation.issues(true)</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="48">
          <span class="hits">42</span>
          
          <code class="ruby">        all_topics = all_issues.collect { |i| i.topic_ids }</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="49">
          <span class="hits">14</span>
          
          <code class="ruby">        all_topics.flatten!</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="50">
          <span class="hits">14</span>
          
          <code class="ruby">        all_topics.uniq!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="52">
          <span class="hits">14</span>
          
          <code class="ruby">        if all_topics.empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">          logger.info(&quot;    No topics to add.&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">          next</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="57">
          <span class="hits">14</span>
          
          <code class="ruby">        logger.info(&quot;    Topics to be added (ids):  #{all_topics.inspect}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="58">
          <span class="hits">14</span>
          
          <code class="ruby">        all_topics.each do |topic_id|</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="59">
          <span class="hits">28</span>
          
          <code class="ruby">          topic = Topic.find(topic_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="61">
          <span class="hits">28</span>
          
          <code class="ruby">          if conversation.topics.include?(topic)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="62">
          <span class="hits">8</span>
          
          <code class="ruby">            logger.info(&quot;    Conversation already has topic (#{topic.id}) #{topic.name}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">          elsif commit == false</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="64">
          <span class="hits">8</span>
          
          <code class="ruby">            logger.info(&quot;    Topic (#{topic.id}) #{topic.name} would have been added. No changes saved.&quot;, 'ConversationUtilities')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="66">
          <span class="hits">12</span>
          
          <code class="ruby">            logger.info(&quot;    Adding topic (#{topic.id}) #{topic.name}&quot;, 'ConversationUtilities')</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="67">
          <span class="hits">12</span>
          
          <code class="ruby">            conversation.topics &lt;&lt; topic unless conversation.topics.include?(topic)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="72">
          <span class="hits">5</span>
          
          <code class="ruby">      logger.info(&quot; ---------------------------------------------------&quot;)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="73">
          <span class="hits">5</span>
          
          <code class="ruby">      logger.info(&quot;Finish processing #{conversations.count} conversations in #{Time.now - start} seconds&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fcb598f6074259d87e0b26e14bb0b914a4dd9043">
  <div class="header">
    <h3>lib/utilities/person_utilities.rb</h3>
    <h4><span class="green">97.8 %</span> covered</h4>
    <div>
      <b>91</b> relevant lines. 
      <span class="green"><b>89</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Utilities</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module PersonUtilities</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    class Helper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      include ActionView::Helpers::TextHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    public</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.pluralize(count, singular, plural = nil)</code>
        </li>
      
        <li class="covered" data-hits="99" data-linenumber="13">
          <span class="hits">99</span>
          
          <code class="ruby">      @helper ||= Helper.new</code>
        </li>
      
        <li class="covered" data-hits="99" data-linenumber="14">
          <span class="hits">99</span>
          
          <code class="ruby">      return @helper.pluralize(count, singular, plural)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.debug_print(text)</code>
        </li>
      
        <li class="covered" data-hits="330" data-linenumber="18">
          <span class="hits">330</span>
          
          <code class="ruby">      puts text unless Rails.env.test?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.merge_account(to_person, from_person)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="22">
          <span class="hits">12</span>
          
          <code class="ruby">      unless to_person.is_a?(Person) and from_person.is_a?(Person) and to_person.id != from_person.id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">        return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="26">
          <span class="hits">11</span>
          
          <code class="ruby">      debug_print 'beginning rake task'</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="27">
          <span class="hits">11</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="28">
          <span class="hits">11</span>
          
          <code class="ruby">        to_person.transaction do</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="29">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'begin:   updating FROM account confirmed_at'</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="30">
          <span class="hits">11</span>
          
          <code class="ruby">          from_person.confirmed_at = nil</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="31">
          <span class="hits">11</span>
          
          <code class="ruby">          from_person.save!</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="32">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'updated: ' + pluralize(1, 'record')</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="33">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'end:     updating FROM account confirmed_at'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="35">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'begin:   updating contributions'</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="36">
          <span class="hits">11</span>
          
          <code class="ruby">          updated_record_count = 0</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="37">
          <span class="hits">11</span>
          
          <code class="ruby">          from_person.contributions.map do |contribution|</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="38">
          <span class="hits">13</span>
          
          <code class="ruby">            contribution.owner = to_person.id</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="39">
          <span class="hits">13</span>
          
          <code class="ruby">            contribution.save!</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="40">
          <span class="hits">13</span>
          
          <code class="ruby">            updated_record_count += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="42">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'updated: ' + pluralize(updated_record_count, 'record')</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="43">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'end:     updating contributions'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="45">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'begin:   updating rating groups'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">          # this will fail if the user has ratings for both accounts</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="47">
          <span class="hits">11</span>
          
          <code class="ruby">          updated_record_count = 0</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="48">
          <span class="hits">11</span>
          
          <code class="ruby">          RatingGroup.where('person_id = ?', from_person.id).map do |rating_group|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">            rating_group.person_id = to_person.id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">            rating_group.save!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">            updated_record_count += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="53">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'updated: ' + pluralize(updated_record_count, 'record')</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="54">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'end:     updating rating groups'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="56">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'begin:   updating conversation owners'</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="57">
          <span class="hits">11</span>
          
          <code class="ruby">          updated_record_count = 0</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="58">
          <span class="hits">11</span>
          
          <code class="ruby">          Conversation.where('owner = ?', from_person.id).map do |conversation|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">            conversation.owner = to_person.id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">            conversation.save!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">            updated_record_count += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="63">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'updated: ' + pluralize(updated_record_count, 'record')</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="64">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'end:     updating conversation owners'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="66">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'begin:   updating subscriptions'</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="67">
          <span class="hits">11</span>
          
          <code class="ruby">          updated_record_count = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">          # Make the TO account follow all the same conversations/issues as the FROM account</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="69">
          <span class="hits">11</span>
          
          <code class="ruby">          Subscription.where(person_id: from_person.id).each do |subscription|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="70">
          <span class="hits">2</span>
          
          <code class="ruby">            Subscription.create_unless_exists(to_person, subscription.subscribable)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="71">
          <span class="hits">2</span>
          
          <code class="ruby">            updated_record_count += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="73">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'updated: ' + pluralize(updated_record_count, 'record')</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="74">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'end:     updating subscriptions'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="76">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'begin:   updating visits'</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="77">
          <span class="hits">11</span>
          
          <code class="ruby">          updated_record_count = 0</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="78">
          <span class="hits">11</span>
          
          <code class="ruby">          Visit.where('person_id = ?', from_person.id).map do |visit|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">            visit.person_id = to_person.id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">            visit.save!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">            updated_record_count += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="83">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'updated: ' + pluralize(updated_record_count, 'record')</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="84">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'end:     updating visits'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="86">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'begin:   updating content_templates'</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="87">
          <span class="hits">11</span>
          
          <code class="ruby">          updated_record_count = 0</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="88">
          <span class="hits">11</span>
          
          <code class="ruby">          from_person.content_templates.map do |content_template|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">            content_template.person_id = to_person.id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">            content_template.save!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">            updated_record_count += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="93">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'updated: ' + pluralize(updated_record_count, 'record')</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="94">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'end:     updating content_templates'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="96">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'begin:   updating authored content_items'</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="97">
          <span class="hits">11</span>
          
          <code class="ruby">          updated_record_count = 0</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="98">
          <span class="hits">11</span>
          
          <code class="ruby">          from_person.authored_content_items.map do |content_item|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">            content_item.person_id = to_person.id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">            content_item.save!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">            updated_record_count += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="104">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'begin:   updating content_items_people'</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="105">
          <span class="hits">11</span>
          
          <code class="ruby">          to_person.content_items_people = from_person.content_items_people</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="107">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'updated: ' + pluralize(updated_record_count, 'record')</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="108">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'end:     updating content_items'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="110">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'begin:   updating managed_issue_pages'</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="111">
          <span class="hits">11</span>
          
          <code class="ruby">          updated_record_count = 0</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="112">
          <span class="hits">11</span>
          
          <code class="ruby">          from_person.managed_issue_pages.map do |managed_issue_page|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">            managed_issue_page.person_id = to_person.id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">            managed_issue_page.save!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">            updated_record_count += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="117">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'updated: ' + pluralize(updated_record_count, 'record')</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="118">
          <span class="hits">11</span>
          
          <code class="ruby">          debug_print 'end:     updating managed_issue_pages'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">        end # to_person.transaction</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">      rescue ActiveRecord::RecordInvalid =&gt; exception</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">        debug_print exception.message</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">        debug_print exception.backtrace.join(&quot;\n&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">      end # begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="127">
          <span class="hits">11</span>
          
          <code class="ruby">      debug_print 'ending rake task'</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="128">
          <span class="hits">11</span>
          
          <code class="ruby">      return Person.find(from_person.id).confirmed_at.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>
