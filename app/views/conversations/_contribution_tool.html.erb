<% content_for :header do %>

  <%= javascript_include_tag 'vendor/tiny_mce/jquery.tinymce.js' %>
  <%= javascript_include_tag 'lib/contributions/contribution_tool.js' %>

  <script type='text/javascript'> 
    //<![CDATA[

    $(document).ready(function() {

      enable_cancel_contribution($('#cancel-contribution'));

      enable_add_link_toggle($('#contribution-add-link'),
        $('#contribution_url'),
        $('#contribution_content')
      );

      enable_add_file_toggle($('#contribution-add-file'),
        $('#contribution_attachment'),
        $('#contribution_content')
      );

      init_tiny_mce('#contribution_content');
      
      // This JS can be refactored and integrated with contribution_tool.js
      
      $('.section-one #contribution-add-link').click(function() {
        $('.section-two').hide();
        $(this).parent().addClass('active');
      });
      
      $('.section-two #contribution-add-file').click(function() {
        $('.section-one').hide();
        $(this).parent().addClass('active');
      });
      $('div.contrib_tool_container .section .close').click(function() {
        $(this).parent('.section').removeClass('active');
        return false;
      });
  
    }); // end document ready function

    //]]>
  </script>

<% end %>

<div id="contrib" name="contrib" class="hide_contrib_tool contrib_tool_container">

  <p class="title">Post to this conversation:</p>

  <%= form_for contribution, :as => :contribution, :url => conversation_contributions_path(conversation), :remote => true, :method => :post, :html => {:multipart => true} do |f| %>

    <%= f.hidden_field(:parent_id) %>

    <fieldset>
      <%= f.text_area(:content, :placeholder => "Leave a Comment...", :class => 'tinymce') %>

      <div class="section section-one">
        <a href="#" id="contribution-add-link">Add a link to a related<br /> website</a>
        <%= f.text_field(:url, :type => "text", :class => "textbox link", :style => 'display:none;') %>
        <a href="#" class="close">Close</a>
      </div>

      <div class="section section-two">
        <a href="#" id="contribution-add-file">Upload a photograph, document, or other file</a>
        <%= f.file_field(:attachment, :style => 'display:none;') %>
        <a href="#" class="close">Close</a>
      </div>
    </fieldset>

    <fieldset>
      <ul class="errors"></ul>
    </fieldset>

    <fieldset>
      <%= f.submit 'Leave my response', :class => 'submit' %>
      <%= link_to "Cancel", '#', :id => 'cancel-contribution' %>
    </fieldset>

  <% end %>
</div>
