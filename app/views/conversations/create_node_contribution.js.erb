$("#contrib #error_explanation").remove();
<% unless @contribution.errors.any? %>

  hide_contribution_tool();
  
  <% if @contribution.parent %>
    <% if @contribution.parent.level_of_indentation < @contribution.level_of_indentation %>
      $('ol.thread-list #show-contribution-<%= @contribution.parent.id %>').append("<%= escape_javascript( render :partial => "conversations/threaded_contribution_template", :locals => { :contribution => @contribution } ) %>");
    <% else %>
      $('ol.thread-list #show-contribution-<%= @contribution.parent.id %>').after("<%= escape_javascript( render :partial => "conversations/threaded_contribution_template", :locals => { :contribution => @contribution } ) %>");
    <% end %>
  <% else %>
    $('#show_conversation ol.thread-list').first().append("<%= escape_javascript( render :partial => "conversations/threaded_contribution_template", :locals => { :contribution => @contribution } ) %>");
  <% end %>

  $('#respond-to-<%= @contribution.id %>').ready(enable_post_to_conversation($('.post_to_conversation')));

<% else %>

  $("#contrib fieldset").first().before("<%= escape_javascript( render :partial => 'contributions/creation_errors' ) %>");

<% end %>
