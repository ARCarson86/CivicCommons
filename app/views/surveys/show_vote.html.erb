<% content_for(:header) do %>
  <%= javascript_include_tag 'lib/surveys' %>
<% end %>
<% content_for(:main_body) do %>
  <%= render :partial => "#{@surveyable.class.name.pluralize.underscore}/survey_header", :object => @surveyable if @surveyable %>
  <div class="wrapper">
    <div class="content-container">
      <div class="voting-container">
        
      
        <h1>Cast Your Vote</h1>
        <div class="survey-options">
          <h4>SELECT FROM THESE OPTIONS:</h4>
          <div class="sortable">
            <%= render :partial => 'survey_options/survey_option_vote', :collection => @survey_response_presenter.available_options, :as => :option %>
          </div>
        </div>
      
        <div class="selected-survey-options">
          <h2 class="title"><%= @survey.title %></h2>
          <% form_for :survey_response_presenter, @survey_response_presenter, :url => polymorphic_url([:create_response, @survey]), :remote => true  do |f| %>
            <% if @survey_response_presenter.errors.any? %>
              <h3>Errors saving this vote</h3>
            <% end %>
          
            <% @survey_response_presenter.max_selected_options.times do |i|  %>
              <div class="sortable-wrapper">
                <div class="sortable">
                  <div class="placeholder">
                    Drop your <%= (i+1).ordinalize %> vote here
                  </div>
                  <%= f.text_field "selected_option_#{i+1}_id".to_sym, :class => 'selected_option_id', :style => 'display:none;' %>
                  <%= render :partial => 'survey_options/survey_option_vote', :object => @survey_response_presenter.send("selected_option_#{i+1}"), :as => :option if @survey_response_presenter.send("selected_option_#{i+1}")%>
                </div>
              </div>
            <% end %>
            <div class="menu">
              <%= f.submit 'CAST BALLOT', :class => "submit", :disabled => @survey_response_presenter.already_voted? %> or <%= link_to 'Cancel','' %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
<% end %>